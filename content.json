{"meta":{"title":"æ±‚ç´¢","subtitle":"å°”ä¸å¿…æ±‚è®°ï¼Œå´å®œæ±‚ä¸ªæ˜ç™½ï¼","description":"","author":"Mingxu.xie","url":"https://www.xiemx.com","root":"/"},"pages":[{"title":"åˆ†ç±»","date":"2019-09-27T06:54:52.021Z","updated":"2019-09-27T06:54:52.017Z","comments":false,"path":"categories/index.html","permalink":"https://www.xiemx.com/categories/index.html","excerpt":"","text":""},{"title":"","date":"2019-12-12T07:10:10.337Z","updated":"2019-12-12T07:10:10.337Z","comments":true,"path":"about/index.html","permalink":"https://www.xiemx.com/about/index.html","excerpt":"","text":"å¾’æ­¥è½¨è¿¹ æ¸…å‡‰å³°å—çº¿ è½¨è¿¹: http://www.foooooot.com/trip/3067492/ æ­¦åŠŸå±± â€Œå¾½æ­å¤é“ â€Œç¨»åŸäºšä¸ â€Œé›¨å´© â€Œé»„å—å¤é“ â€Œè«å¹²å±± â€Œè…¾æ ¼é‡Œæ²™æ¼  â€Œè™è·³å³¡ â€Œä¹Œå­™å¤é“ â€Œå´è¶Šå¤é“ â€Œæ‹¬è‹å±± â€Œèˆ¹åº•é¡¶ â€ŒéŸ­èœå²­ â€Œå››å§‘å¨˜å±± â€Œå†›éšœå¤é“ â€Œå—å¤ªè¡Œå±± â€Œäº”å°å±± ä¸Šè™æ± æ‰ è½¨è¿¹: http://foooooot.com/trip/3169829/ é™¶å®´å²­å¤é“ è½¨è¿¹: http://foooooot.com/trip/3169859/ PSï¼šä»¥åå°½é‡æ‰€æœ‰çš„è·¯çº¿éƒ½æ­£ç¡®è®°å½•è½¨è¿¹ï¼Œæœ‰ä¸€èµ·çº¦çš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥ç•™è¨€"},{"title":"Favorite site","date":"2019-10-21T09:33:20.417Z","updated":"2019-10-21T09:33:20.417Z","comments":true,"path":"links/index.html","permalink":"https://www.xiemx.com/links/index.html","excerpt":"","text":"sameersbn/docker-gitlab: Dockerized GitLab jamesrwhite/minicron: A system to manage and monitor cron jobs samwierema/go-qr-generator: A QR code generator written in Golang jumpserver/jumpserver: å¼€æºè·³æ¿æœº(å ¡å’æœº):è®¤è¯,æˆæƒ,å®¡è®¡,è‡ªåŠ¨åŒ–è¿ç»´ etsy/statsd: Daemon for easy but powerful stats aggregation mobtitude/docker-vpn-pptp adnanh/webhook: webhook is a lightweight configurable tool written in Go, that allows you to easily create HTTP endpoints (hooks) on your server, which you can use to execute configured commands. TonnyL/Awesome_APIs: A collection of APIs henices/Tcp-DNS-proxy: A TCP dns proxy which can get the RIGHT ip address robbyrussell/oh-my-zsh: A delightful community-driven (with 1,000+ contributors) framework for managing your zsh configuration. Includes 200+ optional plugins (rails, git, OSX, hub, capistrano, brew, ant, php, python, etc), over 140 themes to spice up your morning, and an auto-update tool so that makes it easy to keep up with the latest updates from the community. kylemanna/docker-openvpn: ğŸ”’ OpenVPN server in a Docker container complete with an EasyRSA PKI CA oddrationale/docker-shadowsocks: shadowsocks Docker image"},{"title":"Tags","date":"2019-09-26T09:33:06.254Z","updated":"2019-09-26T09:33:06.254Z","comments":true,"path":"tags/index.html","permalink":"https://www.xiemx.com/tags/index.html","excerpt":"","text":""},{"title":"Repositories","date":"2019-09-27T06:55:01.568Z","updated":"2019-09-27T06:55:01.567Z","comments":false,"path":"repository/index.html","permalink":"https://www.xiemx.com/repository/index.html","excerpt":"","text":""},{"title":"Commands Tips","date":"2020-01-09T06:35:52.759Z","updated":"2020-01-09T06:35:52.759Z","comments":true,"path":"tips/index.html","permalink":"https://www.xiemx.com/tips/index.html","excerpt":"","text":"123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111#è·å–æ‰€æœ‰regionçš„æœºå™¨æ•°é‡for i in $(aws ec2 describe-regions | grep RegionName| awk -F\"[\\\"]+\" '&#123;print $4&#125;');do echo -n \"$i: \"; AWS_PROFILE=jp aws --region=$i ec2 describe-instances|grep InstanceId|wc -l;done;#è·å–èŠ‚ç‚¹çš„æœºå™¨tag.nameå’ŒprivateIPaws ec2 describe-instances --filters \"Name=tag:Service,Values=eos\" --query \"Reservations[*].Instances[*].[PrivateIpAddress,Tags[?Key=='Name'].Value]\" --output text#simple http serverpython -m SimperHTTPServer 60123#sshç«¯å£è½¬å‘ssh -v -N -L 0.0.0.0:60123:192.168.10.195:60123 203.175.165.66#æŸ¥çœ‹rsaç§é’¥çš„å…¬é’¥ssh-keygen -y -f id_rsa &gt; id_rsa.pub#wget æ–­ç‚¹ç»­ä¼ wget -c -t 0 -O backup_2018_01_01_050000_9591273.bak http://47.88.192.116:12312/backup_2018_01_01_050000_9591273.bak#rsync+ssh proxyrsync -av -P -e \"ssh -o 'ProxyCommand ssh 123.206.197.235 nc %h %p'\" 2018-03-06_03-05.sql.gz 10.86.48.8:/data/backup#consul-template/srv/consul/consul-template -consul 192.168.10.123:8500 -template /srv/consul/my.ctmpl:/srv/consul/conf.d/my.conf:/etc/init.d/nginx reload -once#iptables forwardiptables -t nat -A PREROUTING -d 192.168.10.226 -p tcp -dport 6386 -j DNAT --to-destination 192.168.10.81:6386iptables -t nat -I POSTROUTING -j MASQUERADE#è¿œç¨‹æŠ“åŒ…åœ¨æœ¬åœ°è°ƒç”¨wiresharkå·¥å…·æ‰“å¼€ssh -o 'ProxyCommand ssh 123.206.197.235 nc %h %p' 192.168.199.63 \"sudo tcpdump -vv -i eth0 port 80 -w -\" | wireshark -k -i -#git diffå¯¹æ¯”commitå·®å¼‚ï¼Œåªåˆ—å‡ºæ–‡ä»¶ågit diff --name-status 128e72a28ea38d1c8691a22a28937356e7adf736^ 128e72a28ea38d1c8691a22a28937356e7adf736#docker log-opt--log-driver syslog --log-opt tag=\"eos-producer\"--log-driver json-file --log-opt max-size=500msudo docker run --log-driver=awslogs --log-opt awslogs-region=ap-southeast-1 --log-opt awslogs-group=eos-log --log-opt awslogs-datetime-format='\\[%b %d, %Y %H:%M:%S\\]' -d -p 8898:80 nginxdocker run -d -p 9876:9876 -p 80:8888 --name eos --log-driver gelf --log-opt gelf-address=udp://10.188.10.145:15155 -v /data/eos/:/eos eoslaomao/eos:1.3.0 /opt/eosio/bin/nodeos --data-dir=/eos/data --config-dir=/eos/confdocker run -d -p 9876:9876 -p 8888:8888 --name eos --log-driver json-file --log-opt max-size=1g -v /data/eos/:/eos gcr.io/eosasia-testnet/eos:v1.5.3-patch /opt/eosio/bin/nodeos --data-dir=/eos/data --config-dir=/eos/conf#pigzå¤šçº¿ç¨‹æ‰“åŒ…apt install pigztar --use-compress-program=pigz -cvpf package.tgz ./packagetar --use-compress-program=pigz -xvpf package.tgz -C ./package#aws elb reg/unreg instanceaws elbv2 register-targets --target-group-arn=arn:aws:elasticloadbalancing:ap-northeast-1:908572518:targetgroup/e-api-1/65c430c260d1556e --targets Id=i-00b7f498a742cdaws elbv2 deregister-targets --target-group-arn=arn:aws:elasticloadbalancing:ap-northeast-1:908572518:targetgroup/e-api-1/65c430c260d1556e --targets Id=i-00b7f498a742cd#pmmdocker run -d \\ -p 80:81 \\ --volumes-from pmm-data \\ --name pmm-server \\ --restart always \\ percona/pmm-server:latest#git ä½¿ç”¨æŒ‡å®šçš„private key cloneGIT_SSH_COMMAND=\"ssh -i ~/.ssh/id_rsa\" git clone git@cd.i.ly.com:ly/cat.git#K8S ç«¯å£è½¬å‘kubectl -n test port-forward $(kubectl -n test get endpoints prometheus -o jsonpath='&#123;.subsets[0].addresses[0].targetRef.name&#125;') 9090:9090#jp å¤„ç†æ•°æ®jq '.members[]|&#123;\"id\": .id, \"Name\": .fullName&#125;' trello.jsonjq '.cards[]|if .idList == \"5c64e37e57ba1c20f62751ce\" then .idMembers else .xxx end' trello.json#è·å–websocketè¿”å›ä¿¡æ¯s = new WebSocket('wss://www.staging.strikingly.com/livechat-ws')s.onclose = (e) =&gt; &#123; console.log(e)&#125;# è·å–postgresql schemeselect * from information_schema.schemata;#æŸ¥çœ‹è¡¨å­—æ®µ - postgresqlSELECT a.attname as name, a.attnotnull as notnullFROM pg_class as c,pg_attribute as awhere c.relname = 'mini_program_accounts' and a.attrelid = c.oid and a.attnum&gt;0#postgresql dump databasepg_dump -U vi -d vi -h rm-j.pg.rds.aliyuncs.com -p 3433 --no-owner --no-privileges -f vi.sql#mysqldumpmysqldump --host rm-j.mysql.rds.aliyuncs.com -u vi -p --databases via --column-statistics=0 &gt; vi.sql# è·å–å½“å‰ä¼šè¯æ€»æ•°select count(*) from pg_stat_activity;# æ€æ­»æ‰€æœ‰idleçš„è¿›ç¨‹select pg_terminate_backend(pid) from pg_stat_activity where state='idle';# æŸ¥çœ‹æ‰€æœ‰è¡¨çš„ç©ºé—´å ç”¨æƒ…å†µSELECT schemaname as schema, tablename as table_name, pg_size_pretty(pg_relation_size(schemaname || '.' || tablename)) AS size_p, pg_total_relation_size(schemaname || '.' || tablename) AS siz, pg_size_pretty(pg_total_relation_size(schemaname || '.' || tablename)) AS è¡¨æ€»å¤§å°, pg_total_relation_size(schemaname || '.' || tablename) - pg_relation_size(schemaname || '.' || tablename) AS ç´¢å¼•å¤§å°, (100*(pg_total_relation_size(schemaname || '.' || tablename) - pg_relation_size(schemaname || '.' || tablename)))/CASE WHEN pg_total_relation_size(schemaname || '.' || tablename) = 0 THEN 1 ELSE pg_total_relation_size(schemaname || '.' || tablename) END || '%' AS index_pct FROM pg_tables ORDER BY siz DESC # openssl æŒ‡å®štlsåè®®è·å–æœåŠ¡ç«¯è¯ä¹¦openssl s_client -connect www.eosx.io:443 -servername www.eosx.io -tls1_2"}],"posts":[{"title":"zombie/orphan process","slug":"zombie-and-orphan-process","date":"2020-01-22T02:52:00.000Z","updated":"2020-01-22T03:02:33.828Z","comments":true,"path":"/2020/01/22/zombie-and-orphan-process/","link":"","permalink":"https://www.xiemx.com/2020/01/22/zombie-and-orphan-process/","excerpt":"","text":"zombie process / orphan processçˆ¶è¿›ç¨‹é€šè¿‡fork()å‡½æ•°æ¥åˆ›å»ºå­è¿›ç¨‹ã€‚å­è¿›ç¨‹ä¼šcopy å½“å‰çˆ¶è¿›ç¨‹çš„çŠ¶æ€å’Œè¿è¡Œä»£ç ï¼Œç‹¬ç«‹è¿è¡Œï¼Œå­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹çš„çš„è¿è¡Œå’Œç»“æŸæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„è¿‡ç¨‹ï¼Œforkå‡ºæ¥ä¹‹åè¿è¡Œçš„å…ˆåé¡ºåºä¹Ÿå–å†³äºç³»ç»Ÿçš„è°ƒåº¦ï¼Œä¸å­˜åœ¨ç»å¯¹çš„é¡ºåºã€‚linux ä¸ºäº†è¿›ç¨‹é€€å‡ºèƒ½è¢«æ­£ç¡®å›æ”¶ï¼Œä¼šç»´æŠ¤ä¸€å¼ è¿›ç¨‹çš„æ˜ å°„è¡¨ï¼Œå½“è¿›ç¨‹ç»“æŸæ—¶ï¼Œç³»ç»Ÿä¼šå°†è¿›ç¨‹çš„ä¿¡æ¯å­˜å‚¨èµ·æ¥ï¼Œç­‰å¾…çˆ¶è¿›ç¨‹å»å¤„ç†å›æ”¶å­è¿›ç¨‹ï¼Œå¤„äºé€€å‡ºçŠ¶æ€ä¸”çˆ¶è¿›ç¨‹æ²¡æœ‰è°ƒç”¨wait()è·å–çŠ¶æ€ä¿¡æ¯çš„è¿›ç¨‹å°±ä¼šé™·å…¥Z çŠ¶æ€ï¼Œç†è®ºä¸Šæ‰€æœ‰çš„è¿›ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªçŸ­æš‚çš„Z çŠ¶æ€ã€‚ orphan processï¼šä¸€ä¸ªçˆ¶è¿›ç¨‹é€€å‡ºï¼Œè€Œå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œè¿™äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ï¼Œè¢«initè¿›ç¨‹æ‰€æ”¶å…»ï¼Œå¹¶ç”±initè¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚ zombie processï¼šè¿›ç¨‹ä½¿ç”¨forkåˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨waitæˆ–waitpidè·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œé‚£ä¹ˆå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­ã€‚è¿™ç§è¿›ç¨‹ç§°ä¹‹ä¸ºåƒµæ­»è¿›ç¨‹ã€‚ å¦‚ä½•å¤„ç†åƒµå°¸è¿›ç¨‹/å­¤å„¿è¿›ç¨‹ orphan process ç†è®ºä¸Šå­¤å„¿è¿›ç¨‹ä¸ä¼šå¯¹ç³»ç»Ÿæœ‰å½±å“ï¼Œinit è¿›ç¨‹ä¼šæ¥ç®¡æˆä¸ºçˆ¶è¿›ç¨‹ï¼Œè´Ÿè´£è¿›ç¨‹å›æ”¶ï¼Œlinuxä¸­ä¹Ÿä¼šæœ‰å¾ˆå¤šä¸»åŠ¨çš„æ“ä½œæ¥é¿å…å­è¿›ç¨‹è¢«ä¸»åŠ¨å›æ”¶ï¼Œæ¯”å¦‚è¯´nohupã€disown ï¼Œéƒ½æ˜¯é€šè¿‡å±è”½ä¿¡å·æ¥ä½¿å­è¿›ç¨‹æˆä¸ºorphan processæœ€ç»ˆè¢«initæ¥æ”¶ï¼Œå®ç°ç»ˆç«¯å…³é—­ä½†æ˜¯è¿›ç¨‹ä¸é€€å‡º zombie process ç†è®ºä¸Šzombie processæ˜¯ç”±äºçˆ¶è¿›ç¨‹ä¸wait(), å¯ä»¥ç›´æ¥å¹²æ‰çˆ¶è¿›ç¨‹ï¼Œè®©initæ¥æ‰‹æ¥å¤„ç† fork()123456789101112131415161718192021pid = fork()if pid &gt; 0 &#123; printf \"this is father\"&#125;if pid = 0 &#123; printf \"this is child\" &#125;if pid &lt; 0 &#123; printf \"fork error\" &#125;fork()åä¼šcopyä¸€ä¸ªè¿›ç¨‹å‡ºæ¥ï¼Œforkåçš„ä»£ç ä¼šåˆ†å¸ƒåœ¨å­è¿›ç¨‹å’Œå½“å‰è¿›ç¨‹ä¸­ç‹¬ç«‹è¿è¡Œã€‚ä¹Ÿå°±æ˜¯ä¼šæœ‰2æ¬¡è¾“å‡ºã€‚linux man pageçš„è¯´æ˜ï¼šDESCRIPTION The fork extension adds three functions, as follows. fork() This function creates a new process. The return value is the zero in the child and the process-id number of the child in the parent, or -1 upon error. In the latter case, ERRNO indicates the problem. In the child, PROCINFO[\"pid\"] and PROCINFO[\"ppid\"] are updated to reflect the correct values. waitpid() This function takes a numeric argument, which is the process-id to wait for. The return value is that of the wait- pid(2) system call. wait() This function waits for the first child to die. The return value is that of the wait(2) system call. å‚è€ƒï¼šhttps://www.cnblogs.com/anker/p/3271773.html","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"k8s pod lifecycle","slug":"k8s-pod-lifecycle","date":"2020-01-21T09:08:14.000Z","updated":"2020-01-21T09:08:08.899Z","comments":true,"path":"/2020/01/21/k8s-pod-lifecycle/","link":"","permalink":"https://www.xiemx.com/2020/01/21/k8s-pod-lifecycle/","excerpt":"","text":"pod phase pending: Pod å·²è¢« Kubernetes ç³»ç»Ÿæ¥å—ï¼Œä½†æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨é•œåƒå°šæœªåˆ›å»ºã€‚ç­‰å¾…æ—¶é—´åŒ…æ‹¬è°ƒåº¦ Pod çš„æ—¶é—´å’Œé€šè¿‡ç½‘ç»œä¸‹è½½é•œåƒ running: è¯¥ Pod å·²ç»ç»‘å®šåˆ°äº†ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼ŒPod ä¸­æ‰€æœ‰çš„å®¹å™¨éƒ½å·²è¢«åˆ›å»ºã€‚è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨è¿è¡Œï¼Œæˆ–è€…æ­£å¤„äºå¯åŠ¨æˆ–é‡å¯çŠ¶æ€ã€‚ successed: Pod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½è¢«æˆåŠŸç»ˆæ­¢ï¼Œå¹¶ä¸”ä¸ä¼šå†é‡å¯ã€‚ Failed: Pod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»ˆæ­¢äº†ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ˜¯å› ä¸ºå¤±è´¥ç»ˆæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¹å™¨ä»¥é0çŠ¶æ€é€€å‡ºæˆ–è€…è¢«ç³»ç»Ÿç»ˆæ­¢ã€‚ unkown: æŸäº›åŸå› æ— æ³•å–å¾— Pod çš„çŠ¶æ€ï¼Œé€šå¸¸æ˜¯å› ä¸ºä¸ Pod æ‰€åœ¨ä¸»æœºé€šä¿¡å¤±è´¥ã€‚ æ¢é’ˆ livenessProbeï¼šæŒ‡ç¤ºå®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚å¦‚æœå­˜æ´»æ¢æµ‹å¤±è´¥ï¼Œåˆ™ kubelet ä¼šæ€æ­»å®¹å™¨ï¼Œå¹¶ä¸”å®¹å™¨å°†å—åˆ°å…¶ é‡å¯ç­–ç•¥ çš„å½±å“ã€‚å¦‚æœå®¹å™¨ä¸æä¾›å­˜æ´»æ¢é’ˆï¼Œåˆ™é»˜è®¤çŠ¶æ€ä¸º Successã€‚ readinessProbeï¼šæŒ‡ç¤ºå®¹å™¨æ˜¯å¦å‡†å¤‡å¥½æœåŠ¡è¯·æ±‚ã€‚å¦‚æœå°±ç»ªæ¢æµ‹å¤±è´¥ï¼Œç«¯ç‚¹æ§åˆ¶å™¨å°†ä»ä¸ Pod åŒ¹é…çš„æ‰€æœ‰ Service çš„ç«¯ç‚¹ä¸­åˆ é™¤è¯¥ Pod çš„ IP åœ°å€ã€‚åˆå§‹å»¶è¿Ÿä¹‹å‰çš„å°±ç»ªçŠ¶æ€é»˜è®¤ä¸º Failureã€‚å¦‚æœå®¹å™¨ä¸æä¾›å°±ç»ªæ¢é’ˆï¼Œåˆ™é»˜è®¤çŠ¶æ€ä¸º Successã€‚ æ¢é’ˆæ”¯æŒçš„3ç§actionäº‹ä»¶ ExecActionï¼šåœ¨å®¹å™¨å†…æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ã€‚å¦‚æœå‘½ä»¤é€€å‡ºæ—¶è¿”å›ç ä¸º 0 åˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸã€‚ TCPSocketActionï¼šå¯¹æŒ‡å®šç«¯å£ä¸Šçš„å®¹å™¨çš„ IP åœ°å€è¿›è¡Œ TCP æ£€æŸ¥ã€‚å¦‚æœç«¯å£æ‰“å¼€ï¼Œåˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚ HTTPGetActionï¼šå¯¹æŒ‡å®šçš„ç«¯å£å’Œè·¯å¾„ä¸Šçš„å®¹å™¨çš„ IP åœ°å€æ‰§è¡Œ HTTP Get è¯·æ±‚ã€‚å¦‚æœå“åº”çš„çŠ¶æ€ç å¤§äºç­‰äº200 ä¸”å°äº 400ï¼Œåˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚ restart policy podçš„specä¸­restartPolicy æœ‰ä¸‰ç§æ¨¡å¼* Always * Never * OnFailure job çš„specä¸­æœ‰2ç§ OnFailure Never","categories":[{"name":"k8s","slug":"k8s","permalink":"https://www.xiemx.com/categories/k8s/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.xiemx.com/tags/k8s/"},{"name":"pod","slug":"pod","permalink":"https://www.xiemx.com/tags/pod/"}],"author":"xiemx"},{"title":"aws-vpc-cni","slug":"aws-vpc-cni","date":"2020-01-21T09:05:04.000Z","updated":"2020-01-21T09:05:25.527Z","comments":true,"path":"/2020/01/21/aws-vpc-cni/","link":"","permalink":"https://www.xiemx.com/2020/01/21/aws-vpc-cni/","excerpt":"","text":"aws-vpc-cniè¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒä¸€ä¸‹awsçš„ææ¡ˆ æ€»ç»“å¦‚ä¸‹ï¼š AWS EKSè¿è¡Œåœ¨vpcä¸­ï¼Œå› æ­¤æ‰€æœ‰èŠ‚ç‚¹èƒ½å¤Ÿè¿è¡Œçš„æ€»podæ•°æœ€ç»ˆç”±vpc cidrä¸­èƒ½å¤Ÿä½¿ç”¨çš„ipåœ°å€æ•°é‡æ¥å†³å®šã€‚ EKS nodeèƒ½å¤Ÿè¿è¡Œçš„podæ•°é‡ï¼Œç”±nodeä¸Šçš„secendary ipæ•°é‡å†³å®šï¼Œsecendary ipæ˜¯ç”±eniçš„æ•°é‡æ¥å†³å®šçš„ï¼Œå¯ä»¥ç†è§£ä¸åŒçš„æœºå‹èƒ½å¤Ÿattachçš„eniæ•°é‡å†³å®šäº†ï¼Œnodeä¸Šèƒ½å¤Ÿè¿è¡Œå¤šå°‘podã€‚ podä½¿ç”¨cniæ¥é€šè®¯ï¼Œå‡å°‘äº†ä¸­é—´ç½‘ç»œå±‚çš„å°åŒ…/è§£åŒ…ï¼Œç½‘ç»œæ€§èƒ½ä¸Šæ¯”è¾ƒé«˜ã€‚ aws-vpc-cniç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆ Aws-vpc-cni ä¼šåœ¨æœºå™¨ä¸ŠåµŒå…¥ä¸€ä¸ªè¿›ç¨‹L-ipadm æ¥ç®¡ç†podçš„IPåˆ†é…ï¼Œeniçš„ç»‘å®šå’Œç”³è¯·ï¼Œip poolçš„ç®¡ç†ç­‰ç­‰å·¥ä½œ cni pluginè´Ÿè´£ç½‘ç»œå±‚çš„æ•°æ®è°ƒåº¦ aws ææ¡ˆï¼šhttps://github.com/aws/amazon-vpc-cni-k8s/blob/master/docs/cni-proposal.md","categories":[{"name":"k8s","slug":"k8s","permalink":"https://www.xiemx.com/categories/k8s/"}],"tags":[{"name":"aws","slug":"aws","permalink":"https://www.xiemx.com/tags/aws/"},{"name":"k8s","slug":"k8s","permalink":"https://www.xiemx.com/tags/k8s/"},{"name":"network","slug":"network","permalink":"https://www.xiemx.com/tags/network/"}],"author":"xiemx"},{"title":"linux network namespace and bridge","slug":"linux-network-namespace","date":"2020-01-21T05:09:52.000Z","updated":"2020-01-21T08:56:26.914Z","comments":true,"path":"/2020/01/21/linux-network-namespace/","link":"","permalink":"https://www.xiemx.com/2020/01/21/linux-network-namespace/","excerpt":"","text":"linux netns å’Œ bridgenetns æœ€è¿‘åœ¨å­¦ä¹ k8sç½‘ç»œï¼Œçœ‹åˆ°æƒå¨æŒ‡å—ä¸­æœ‰è®²åˆ°åŸºç¡€ç½‘ç»œçš„å®ç°ï¼Œæ•…è€Œæ¬è¿ä¸€ä¸‹é‡æ–°å­¦ä¹ network namespaceçš„éš”ç¦»æŠ€æœ¯ï¼Œé»˜è®¤binaryæ˜¯æ”¾åœ¨iproute2è¿™ä¸ªå¥—ä»¶ä¸­çš„ 123456789vagrant@ubuntu-xenial:~$ apt-file search $(which ip)cups-ipp-utils: /usr/sbin/ippserverfreeipa-client: /usr/sbin/ipa-certupdatefreeipa-client: /usr/sbin/ipa-client-automountfreeipa-client: /usr/sbin/ipa-client-installfreeipa-client: /usr/sbin/ipa-getkeytabfreeipa-client: /usr/sbin/ipa-joinfreeipa-client: /usr/sbin/ipa-rmkeytabiproute2: /sbin/ip é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ ip netns æ˜¯æ²¡æœ‰ç½‘ç»œ namespace çš„ï¼Œæ‰€ä»¥ ip netns ls å‘½ä»¤çœ‹ä¸åˆ°ä»»ä½•è¾“å‡ºã€‚ 12345678910vagrant@ubuntu-xenial:~$ ip netns helpUsage: ip netns list ip netns add NAME ip netns set NAME NETNSID ip [-all] netns delete [NAME] ip netns identify [PID] ip netns pids NAME ip [-all] netns exec [NAME] cmd ... ip netns monitor ip netns list-id æ–°åˆ›å»ºçš„ netns ä¼šåœ¨/var/run/netns/ ç›®å½•ä¸­ç”Ÿå­˜å¯¹åº”åç§°çš„æ–‡ä»¶ 1234567891011vagrant@ubuntu-xenial:~$ sudo ip netns add xiemx1vagrant@ubuntu-xenial:~$ sudo ip netns add xiemx2vagrant@ubuntu-xenial:~$ sudo ip netns lsxiemx2xiemx1vagrant@ubuntu-xenial:~$ ll /var/run/netns/total 0drwxr-xr-x 2 root root 80 Jan 21 03:19 ./drwxr-xr-x 28 root root 1140 Jan 21 03:19 ../-r--r--r-- 1 root root 0 Jan 21 03:19 xiemx1-r--r--r-- 1 root root 0 Jan 21 03:19 xiemx2 ç”±äºnetns ä¹‹é—´äº’ç›¸éƒ½æ˜¯éš”ç¦»çš„ï¼Œå› æ­¤è¦æŸ¥çœ‹å¯¹åº”å‘½åç©ºé—´çš„ç½‘ç»œè®¾å¤‡ã€è·¯ç”±è¡¨å°±éœ€è¦ä½¿ç”¨ ip netns exec &lt;netns name&gt; bash å¼€å¯å­bashè¿›å…¥å¯¹åº”çš„å‘½åç©ºé—´ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ 12345678910111213141516171819202122232425262728293031vagrant@ubuntu-xenial:~$ sudo ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 02:97:71:8a:f0:d8 brd ff:ff:ff:ff:ff:ff inet 10.0.2.15/24 brd 10.0.2.255 scope global enp0s3 valid_lft forever preferred_lft forever inet6 fe80::97:71ff:fe8a:f0d8/64 scope link valid_lft forever preferred_lft forever3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 08:00:27:f1:22:f6 brd ff:ff:ff:ff:ff:ff inet 10.110.120.65/24 brd 10.110.120.255 scope global enp0s8 valid_lft forever preferred_lft forever inet6 fe80::a00:27ff:fef1:22f6/64 scope link valid_lft forever preferred_lft forever4: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default link/ether 02:42:da:5a:39:42 brd ff:ff:ff:ff:ff:ff inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0 valid_lft forever preferred_lft forever vagrant@ubuntu-xenial:~$ sudo ip net exec xiemx1 ip a1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 vagrant@ubuntu-xenial:~$ sudo ip net exec xiemx2 ip a1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 æ¯ä¸ª namespace åœ¨åˆ›å»ºçš„æ—¶å€™ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª lo ï¼Œé»˜è®¤æ—¶DOWNçŠ¶æ€ï¼Œå¦‚æœéœ€è¦å¯ç”¨è®°å¾—UPä¸€ä¸‹ï¼š 1234567891011vagrant@ubuntu-xenial:~$ sudo ip net exec xiemx1 ip a1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00vagrant@ubuntu-xenial:~$ sudo ip netns exec xiemx1 ip link set lo upvagrant@ubuntu-xenial:~$ sudo ip netns exec xiemx1 ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever veth pair netns ä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œlinux æä¾›äº† veth è®¾å¤‡å¯¹æ¥å®ç°ä¸åŒnetnsä¹‹é—´çš„å¾€æ¥é€šè®¯ï¼Œveth è®¾å¤‡æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œç±»ä¼¼äºä¸€æ ¹ç½‘çº¿æ’åˆ°äº†ä¸¤ä¸ªéš”ç¦»çš„nsä¹‹ä¸­ï¼Œå®ç°äº†ä¸¤ä¸ªéš”ç¦»ç½‘ç»œçš„äº’è”ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ip link add &lt;name1&gt; type veth peer name &lt;name2&gt; æ¥åˆ›å»ºä¸€å¯¹ veth pair å‡ºæ¥ï¼Œéœ€è¦è®°ä½çš„æ˜¯ veth pair æ— æ³•å•ç‹¬å­˜åœ¨ï¼Œåˆ é™¤å…¶ä¸­ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªä¹Ÿä¼šè‡ªåŠ¨æ¶ˆå¤±ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738vagrant@ubuntu-xenial:~$ sudo ip netns exec xiemx1 bashroot@ubuntu-xenial:~# ip add1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft foreverroot@ubuntu-xenial:~# ip link add xiemx-veth1 type veth peer name xiemx-veth2root@ubuntu-xenial:~# ip add1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever4: xiemx-veth2@xiemx-veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether a6:76:6f:47:e1:f9 brd ff:ff:ff:ff:ff:ff5: xiemx-veth1@xiemx-veth2: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether 42:6a:cb:19:0d:2a brd ff:ff:ff:ff:ff:ff ####å¦‚æœå¯¹åç§°æ²¡æœ‰ç‰¹åˆ«è¦æ±‚å¯ä»¥ä½¿ç”¨é»˜è®¤å‘½ä»¤åˆ›å»ºï¼Œä¼šé»˜è®¤ç”Ÿå­˜veth0/veth1 çš„è®¾å¤‡å¯¹root@ubuntu-xenial:~# ip link add type vethroot@ubuntu-xenial:~# ip add1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever4: xiemx-veth2@xiemx-veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether a6:76:6f:47:e1:f9 brd ff:ff:ff:ff:ff:ff5: xiemx-veth1@xiemx-veth2: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether 42:6a:cb:19:0d:2a brd ff:ff:ff:ff:ff:ff6: veth0@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether 3e:72:e3:48:25:69 brd ff:ff:ff:ff:ff:ff7: veth1@veth0: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether ea:37:ea:92:a5:c5 brd ff:ff:ff:ff:ff:ff ç»™è¿™å¯¹ veth pair é…ç½®ä¸Š ip åœ°å€ï¼Œå¹¶up 1234567891011121314151617181920212223242526272829303132root@ubuntu-xenial:~# ip netns exec xiemx1 bashroot@ubuntu-xenial:~# ip add add 10.0.0.1/24 dev xiemx-veth1root@ubuntu-xenial:~# ip add add 10.0.0.2/24 dev xiemx-veth2root@ubuntu-xenial:~# ip add show dev xiemx-veth1 uproot@ubuntu-xenial:~# ip add show dev xiemx-veth2 uproot@ubuntu-xenial:~# ip add1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever4: xiemx-veth2@xiemx-veth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether a6:76:6f:47:e1:f9 brd ff:ff:ff:ff:ff:ff inet 10.0.0.2/24 scope global xiemx-veth2 valid_lft forever preferred_lft forever inet6 fe80::a476:6fff:fe47:e1f9/64 scope link valid_lft forever preferred_lft forever5: xiemx-veth1@xiemx-veth2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 42:6a:cb:19:0d:2a brd ff:ff:ff:ff:ff:ff inet 10.0.0.1/24 scope global xiemx-veth1 valid_lft forever preferred_lft forever inet6 fe80::406a:cbff:fe19:d2a/64 scope link valid_lft forever preferred_lft forever6: veth0@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether 3e:72:e3:48:25:69 brd ff:ff:ff:ff:ff:ff7: veth1@veth0: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether ea:37:ea:92:a5:c5 brd ff:ff:ff:ff:ff:ffroot@ubuntu-xenial:~# ip route10.0.0.0/24 dev xiemx-veth1 proto kernel scope link src 10.0.0.110.0.0.0/24 dev xiemx-veth2 proto kernel scope link src 10.0.0.2 ç›®å‰æ‰€æœ‰çš„veth pairçš„ä¸¤ç«¯éƒ½åœ¨xiemx1è¿™ä¸ªnetns ä¸­ï¼Œç°åœ¨ç§»åŠ¨è®¾å¤‡çš„ä¸€æ®µåˆ°xiemx2 è¿™ä¸ªnetnsä¸­ï¼Œå®ç°ç½‘ç»œäº’è” 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849root@ubuntu-xenial:~# ip link set xiemx-veth2 netns xiemx2root@ubuntu-xenial:~# ip add1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever5: xiemx-veth1@if4: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state LOWERLAYERDOWN group default qlen 1000 link/ether 42:6a:cb:19:0d:2a brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 10.0.0.1/24 scope global xiemx-veth1 valid_lft forever preferred_lft forever inet6 fe80::406a:cbff:fe19:d2a/64 scope link valid_lft forever preferred_lft forever6: veth0@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether 3e:72:e3:48:25:69 brd ff:ff:ff:ff:ff:ff7: veth1@veth0: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether ea:37:ea:92:a5:c5 brd ff:ff:ff:ff:ff:ffroot@ubuntu-xenial:~# ip netns exec xiemx2 ip add1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:004: xiemx-veth2@if5: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether a6:76:6f:47:e1:f9 brd ff:ff:ff:ff:ff:ff link-netnsid 0root@ubuntu-xenial:~# ip netns exec xiemx2 ifconfig xiemx-veth2 uproot@ubuntu-xenial:~# ip netns exec xiemx2 ip add1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:004: xiemx-veth2@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether a6:76:6f:47:e1:f9 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::a476:6fff:fe47:e1f9/64 scope link valid_lft forever preferred_lft foreverroot@ubuntu-xenial:~# ip netns exec xiemx2 ip add add 10.0.0.2/24 dev xiemx-veth2root@ubuntu-xenial:~# ip netns exec xiemx2 ip add1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:004: xiemx-veth2@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether a6:76:6f:47:e1:f9 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 10.0.0.2/24 scope global xiemx-veth2 valid_lft forever preferred_lft forever inet6 fe80::a476:6fff:fe47:e1f9/64 scope link valid_lft forever preferred_lft foreverroot@ubuntu-xenial:~# ping 10.0.0.2PING 10.0.0.2 (10.0.0.2) 56(84) bytes of data.64 bytes from 10.0.0.2: icmp_seq=1 ttl=64 time=0.083 ms64 bytes from 10.0.0.2: icmp_seq=2 ttl=64 time=0.046 ms^C--- 10.0.0.2 ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 999msrtt min/avg/max/mdev = 0.046/0.064/0.083/0.020 ms bridge linux å†…æ ¸æ”¯æŒç½‘å£æ¡¥æ¥ï¼Œä½†æ˜¯å’Œä¼ ç»Ÿçš„ç¡¬ä»¶ç½‘æ¡¥ä¸åŒçš„æ˜¯ï¼Œlinux ä¸­çš„ç½‘æ¡¥è®¾å¤‡ä¸ä»…ä»…æ˜¯äºŒå±‚è®¾å¤‡ï¼Œåªæ˜¯å¯¹æŠ¥æ–‡è¿›è¡Œè½¬å‘ï¼Œç”±äºLinux ä¸»æœºä¸Šè¿è¡Œçš„ä¸Šå±‚åº”ç”¨æœ‰å¯èƒ½å°±æ˜¯æŠ¥æ–‡çš„ç»ˆç‚¹ï¼Œå› æ­¤è¿˜è¦æ±‚ç½‘æ¡¥èƒ½å¤Ÿå°†ä¿æ•°æ®åŒ…ä¼ é€’ç»™linuxç½‘ç»œåè®®æ ˆã€‚ Docker bridgeçš„ç½‘ç»œå°±å¯ä»¥çœ‹æˆæ˜¯é€šè¿‡bridge æ¥è®²vethçš„è®¾å¤‡å¯¹ä¸€ç«¯è¿›è¡Œèšåˆï¼Œå¦ä¸€ç«¯æ”¾åˆ°å®¹å™¨çš„è¿›ç¨‹ä¸­ï¼Œå®ç°ç½‘ç»œéš”ç¦»å’Œç½‘ç»œäº’è”ã€‚å†é€šè¿‡iptablesçš„æ•°æ®åŒ…è½¬å‘åŠŸèƒ½æ¥ä¼ é€’æ•°æ®åŒ…ï¼Œè¿™é‡Œä¸è®¨è®ºiptableså±‚é¢çš„é—®é¢˜ã€‚ æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸‹å¤§æ¦‚å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107###å¢åŠ ä¸€ä¸ªç½‘æ¡¥ï¼ˆå‡è®¾æ˜¯docker bridge)root@ubuntu-xenial:~# ip netns exec xiemx1 bashroot@ubuntu-xenial:~# brctl showbridge name bridge id STP enabled interfacesroot@ubuntu-xenial:~# brctl addbr xiemx-brroot@ubuntu-xenial:~# brctl showbridge name bridge id STP enabled interfacesxiemx-br 8000.000000000000 no###å°†vethè®¾å¤‡çš„ä¸€ç«¯ç»‘å®šåˆ°ç½‘æ¡¥ä¸Šï¼Œç”±äºä½¿ç”¨ç½‘æ¡¥è¿›è¡Œé€šè®¯ï¼Œæ‰€ä»¥vethè®¾å¤‡åœ¨è¿™é‡Œåªéœ€è¦å½“æˆäºŒå±‚è®¾å¤‡æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦IProot@ubuntu-xenial:~# brctl addif xiemx-br veth0root@ubuntu-xenial:~# brctl showbridge name bridge id STP enabled interfacesxiemx-br 8000.3e72e3482569 no veth0###å°†vethçš„å¦ä¸€ç«¯ç§»åŠ¨åˆ°å¦ä¸€ä¸ªnetnsä¸­ï¼Œå¯ä»¥ç†è§£ä¸ºå®¹å™¨å†…çš„eth0root@ubuntu-xenial:~# ip link set veth1 netns xiemx2root@ubuntu-xenial:~# ip add1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever5: xiemx-veth1@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 42:6a:cb:19:0d:2a brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 10.0.0.1/24 scope global xiemx-veth1 valid_lft forever preferred_lft forever inet6 fe80::406a:cbff:fe19:d2a/64 scope link valid_lft forever preferred_lft forever6: veth0@if7: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop master xiemx-br state DOWN group default qlen 1000 link/ether 3e:72:e3:48:25:69 brd ff:ff:ff:ff:ff:ff link-netnsid 08: xiemx-br: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000 link/ether 3e:72:e3:48:25:69 brd ff:ff:ff:ff:ff:ff inet 11.0.0.1/24 brd 11.0.0.255 scope global xiemx-br valid_lft forever preferred_lft foreverroot@ubuntu-xenial:~# ip netns exec xiemx2 bashroot@ubuntu-xenial:~# ip add1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:004: xiemx-veth2@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether a6:76:6f:47:e1:f9 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 10.0.0.2/24 scope global xiemx-veth2 valid_lft forever preferred_lft forever inet6 fe80::a476:6fff:fe47:e1f9/64 scope link valid_lft forever preferred_lft forever7: veth1@if6: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether ea:37:ea:92:a5:c5 brd ff:ff:ff:ff:ff:ff link-netnsid 0### ç»™veth1 åˆ†é…ip åœ°å€ï¼Œå¹¶å¼€å¯è®¾å¤‡root@ubuntu-xenial:~# ip add add 11.0.0.2/24 dev veth1root@ubuntu-xenial:~# ifconfig veth1 uproot@ubuntu-xenial:~# ip add1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:004: xiemx-veth2@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether a6:76:6f:47:e1:f9 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 10.0.0.2/24 scope global xiemx-veth2 valid_lft forever preferred_lft forever inet6 fe80::a476:6fff:fe47:e1f9/64 scope link valid_lft forever preferred_lft forever7: veth1@if6: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state LOWERLAYERDOWN group default qlen 1000 link/ether ea:37:ea:92:a5:c5 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 11.0.0.2/24 scope global veth1 valid_lft forever preferred_lft forever### ç»™ç½‘æ¡¥åˆ†é…IPï¼Œå¹¶å¼€å¯veth0è®¾å¤‡root@ubuntu-xenial:~# ip netns exec xiemx1 bashroot@ubuntu-xenial:~# ifconfig xiemx-br 11.0.0.1/24root@ubuntu-xenial:~# ifconfig veth0 uproot@ubuntu-xenial:~# ip add1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever5: xiemx-veth1@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 42:6a:cb:19:0d:2a brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 10.0.0.1/24 scope global xiemx-veth1 valid_lft forever preferred_lft forever inet6 fe80::406a:cbff:fe19:d2a/64 scope link valid_lft forever preferred_lft forever6: veth0@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master xiemx-br state UP group default qlen 1000 link/ether 3e:72:e3:48:25:69 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::3c72:e3ff:fe48:2569/64 scope link valid_lft forever preferred_lft forever8: xiemx-br: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 3e:72:e3:48:25:69 brd ff:ff:ff:ff:ff:ff inet 11.0.0.1/24 brd 11.0.0.255 scope global xiemx-br valid_lft forever preferred_lft forever inet6 fe80::3c72:e3ff:fe48:2569/64 scope link valid_lft forever preferred_lft forever ### æµ‹è¯•ç½‘ç»œè”é€šroot@ubuntu-xenial:~# ping 11.0.0.2PING 11.0.0.2 (11.0.0.2) 56(84) bytes of data.64 bytes from 11.0.0.2: icmp_seq=1 ttl=64 time=0.244 ms64 bytes from 11.0.0.2: icmp_seq=2 ttl=64 time=0.047 ms64 bytes from 11.0.0.2: icmp_seq=3 ttl=64 time=0.048 ms64 bytes from 11.0.0.2: icmp_seq=4 ttl=64 time=0.047 ms64 bytes from 11.0.0.2: icmp_seq=5 ttl=64 time=0.051 ms^C--- 11.0.0.2 ping statistics ---5 packets transmitted, 5 received, 0% packet loss, time 4005msrtt min/avg/max/mdev = 0.047/0.087/0.244/0.078 ms","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"network","slug":"network","permalink":"https://www.xiemx.com/tags/network/"},{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"docker","slug":"docker","permalink":"https://www.xiemx.com/tags/docker/"}],"author":"xiemx"},{"title":"k8s Flannel","slug":"k8s-fannel","date":"2020-01-21T02:01:04.000Z","updated":"2020-01-21T09:03:57.654Z","comments":true,"path":"/2020/01/21/k8s-fannel/","link":"","permalink":"https://www.xiemx.com/2020/01/21/k8s-fannel/","excerpt":"","text":"K8S FlannelFlannel çš„ç½‘ç»œä¸ªäººç†è§£ä¸ºï¼Œflannelæ¥ç®¡äº†æ‰€æœ‰k8s nodeèŠ‚ç‚¹ä¸Šçš„docker ç½‘ç»œçš„é…ç½®ï¼Œåœ¨docker å¯åŠ¨ä¹‹å‰ï¼Œflannelé€šè¿‡åœ¨etcd ä¸­å…±äº« flannelçš„subnetç­‰ç½‘æ®µä¿¡æ¯æ¥ç»™æ¯ä¸ªnodeçš„docker é¢„è®¾ç½‘ç»œä¿¡æ¯ï¼Œä»¥åŠåˆ†é…å­ç½‘æ®µå’Œbridgeåœ°å€ï¼Œä»¥ä¿è¯åœ¨åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸‹ä¸ä¼šå‡ºç°ç½‘ç»œå†²çªï¼Œå› æ­¤flannel å¯ä»¥çœ‹ä½œæ˜¯ä¾µå…¥äº†dockerå±‚é¢ï¼Œåœ¨åº•å±‚ç³»ç»Ÿå¯åŠ¨containerçš„æ—¶å€™å°±å¤„ç†äº†ç½‘ç»œç›¸å…³ï¼Œæ„å»ºäº†ä¸€ä¸ªå¤§å†…ç½‘ã€‚åœ¨å®¿ä¸»æœºçš„dockeræ§åˆ¶äº†æ‰€æœ‰èŠ‚ç‚¹çš„bridgeï¼Œå¹¶æ›´æ–°æ‰€æœ‰nodeä¸Šçš„ç½‘æ®µä¿¡æ¯çš„å¯¹åº”è·¯ç”±è¡¨ï¼Œåœ¨åŒä¸€ä¸ªå¤§ç½‘æ®µå†…ï¼Œæ¥ä¿è¯ç½‘ç»œè¿é€šæ€§ã€‚ ä»¥ä¸‹é…ç½®å‚è€ƒä¿¡æ¯è½¬è‡ªï¼šhttps://jimmysong.io/kubernetes-handbook/concepts/flannel.html 123456[root@node1 ~]# kubectl get nodes -o wideNAME STATUS ROLES AGE VERSION EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIMEnode1 Ready &lt;none&gt; 2d v1.9.1 &lt;none&gt; CentOS Linux 7 (Core) 3.10.0-693.11.6.el7.x86_64 docker://1.12.6node2 Ready &lt;none&gt; 2d v1.9.1 &lt;none&gt; CentOS Linux 7 (Core) 3.10.0-693.11.6.el7.x86_64 docker://1.12.6node3 Ready &lt;none&gt; 2d v1.9.1 &lt;none&gt; CentOS Linux 7 (Core) 3.10.0-693.11.6.el7.x86_64 docker://1.12.6Copy å½“å‰Kubernetesé›†ç¾¤ä¸­è¿è¡Œçš„æ‰€æœ‰Podä¿¡æ¯ï¼š 12345678[root@node1 ~]# kubectl get pods --all-namespaces -o wideNAMESPACE NAME READY STATUS RESTARTS AGE IP NODEkube-system coredns-5984fb8cbb-sjqv9 1/1 Running 0 1h 172.33.68.2 node1kube-system coredns-5984fb8cbb-tkfrc 1/1 Running 1 1h 172.33.96.3 node3kube-system heapster-v1.5.0-684c7f9488-z6sdz 4/4 Running 0 1h 172.33.31.3 node2kube-system kubernetes-dashboard-6b66b8b96c-mnm2c 1/1 Running 0 1h 172.33.31.2 node2kube-system monitoring-influxdb-grafana-v4-54b7854697-tw9cd 2/2 Running 2 1h 172.33.96.2 node3Copy å½“å‰etcdä¸­çš„æ³¨å†Œçš„å®¿ä¸»æœºçš„podåœ°å€ç½‘æ®µä¿¡æ¯ï¼š 12345[root@node1 ~]# etcdctl ls /kube-centos/network/subnets/kube-centos/network/subnets/172.33.68.0-24/kube-centos/network/subnets/172.33.31.0-24/kube-centos/network/subnets/172.33.96.0-24Copy è€Œæ¯ä¸ªnodeä¸Šçš„Podå­ç½‘æ˜¯æ ¹æ®æˆ‘ä»¬åœ¨å®‰è£…flannelæ—¶é…ç½®æ¥åˆ’åˆ†çš„ï¼Œåœ¨etcdä¸­æŸ¥çœ‹è¯¥é…ç½®ï¼š 123[root@node1 ~]# etcdctl get /kube-centos/network/config&#123;\"Network\":\"172.33.0.0/16\",\"SubnetLen\":24,\"Backend\":&#123;\"Type\":\"host-gw\"&#125;&#125;Copy æˆ‘ä»¬çŸ¥é“Kubernetesé›†ç¾¤å†…éƒ¨å­˜åœ¨ä¸‰ç±»IPï¼Œåˆ†åˆ«æ˜¯ï¼š Node IPï¼šå®¿ä¸»æœºçš„IPåœ°å€ Pod IPï¼šä½¿ç”¨ç½‘ç»œæ’ä»¶åˆ›å»ºçš„IPï¼ˆå¦‚flannelï¼‰ï¼Œä½¿è·¨ä¸»æœºçš„Podå¯ä»¥äº’é€š Cluster IPï¼šè™šæ‹ŸIPï¼Œé€šè¿‡iptablesè§„åˆ™è®¿é—®æœåŠ¡ åœ¨å®‰è£…nodeèŠ‚ç‚¹çš„æ—¶å€™ï¼ŒèŠ‚ç‚¹ä¸Šçš„è¿›ç¨‹æ˜¯æŒ‰ç…§flannel -&gt; docker -&gt; kubelet -&gt; kube-proxyçš„é¡ºåºå¯åŠ¨çš„ï¼Œæˆ‘ä»¬ä¸‹é¢ä¹Ÿä¼šæŒ‰ç…§è¯¥é¡ºåºæ¥è®²è§£ï¼Œflannelçš„ç½‘ç»œåˆ’åˆ†å’Œå¦‚ä½•ä¸dockeräº¤äº’ï¼Œå¦‚ä½•é€šè¿‡iptablesè®¿é—®serviceã€‚ FlannelFlannelæ˜¯ä½œä¸ºä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼éƒ¨ç½²åœ¨æ¯ä¸ªnodeä¸Šï¼Œä¸»è¦å®ç°ä¸¤ä¸ªåŠŸèƒ½ï¼š ä¸ºæ¯ä¸ªnodeåˆ†é…subnetï¼Œå®¹å™¨å°†è‡ªåŠ¨ä»è¯¥å­ç½‘ä¸­è·å–IPåœ°å€ å½“æœ‰nodeåŠ å…¥åˆ°ç½‘ç»œä¸­æ—¶ï¼Œä¸ºæ¯ä¸ªnodeå¢åŠ è·¯ç”±é…ç½® ä¸‹é¢æ˜¯ä½¿ç”¨host-gw backendçš„flannelç½‘ç»œæ¶æ„å›¾ï¼š å›¾ç‰‡ - flannelç½‘ç»œæ¶æ„ï¼ˆå›¾ç‰‡æ¥è‡ªopenshiftï¼‰ã€‚ä»¥ä¸ŠIPéæœ¬ç¤ºä¾‹ä¸­çš„IPã€‚ Node1ä¸Šçš„flannelé…ç½®å¦‚ä¸‹: 123456789101112131415161718192021[root@node1 ~]# cat /usr/lib/systemd/system/flanneld.service[Unit]Description=Flanneld overlay address etcd agentAfter=network.targetAfter=network-online.targetWants=network-online.targetAfter=etcd.serviceBefore=docker.service[Service]Type=notifyEnvironmentFile=/etc/sysconfig/flanneldEnvironmentFile=-/etc/sysconfig/docker-networkExecStart=/usr/bin/flanneld-start $FLANNEL_OPTIONSExecStartPost=/usr/libexec/flannel/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/dockerRestart=on-failure[Install]WantedBy=multi-user.targetRequiredBy=docker.serviceCopy å…¶ä¸­æœ‰ä¸¤ä¸ªç¯å¢ƒå˜é‡æ–‡ä»¶çš„é…ç½®å¦‚ä¸‹ï¼š 123456[root@node1 ~]# cat /etc/sysconfig/flanneld# Flanneld configuration optionsFLANNEL_ETCD_ENDPOINTS=\"http://172.17.8.101:2379\"FLANNEL_ETCD_PREFIX=\"/kube-centos/network\"FLANNEL_OPTIONS=\"-iface=eth2\"Copy ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä»…ä¾›flanneldä½¿ç”¨ã€‚ 1234[root@node1 ~]# cat /etc/sysconfig/docker-network# /etc/sysconfig/docker-networkDOCKER_NETWORK_OPTIONS=Copy è¿˜æœ‰ä¸€ä¸ªExecStartPost=/usr/libexec/flannel/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/dockerï¼Œå…¶ä¸­çš„/usr/libexec/flannel/mk-docker-opts.shè„šæœ¬æ˜¯åœ¨flanneldå¯åŠ¨åè¿è¡Œï¼Œå°†ä¼šç”Ÿæˆä¸¤ä¸ªç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼š /run/flannel/docker /run/flannel/subnet.env æˆ‘ä»¬å†æ¥çœ‹ä¸‹/run/flannel/dockerçš„é…ç½®ã€‚ 123456[root@node1 ~]# cat /run/flannel/dockerDOCKER_OPT_BIP=\"--bip=172.33.68.1/24\"DOCKER_OPT_IPMASQ=\"--ip-masq=true\"DOCKER_OPT_MTU=\"--mtu=1500\"DOCKER_NETWORK_OPTIONS=\" --bip=172.33.68.1/24 --ip-masq=true --mtu=1500\"Copy å¦‚æœä½ ä½¿ç”¨systemctlå‘½ä»¤å…ˆå¯åŠ¨flannelåå¯åŠ¨dockerçš„è¯ï¼Œdockerå°†ä¼šè¯»å–ä»¥ä¸Šç¯å¢ƒå˜é‡ã€‚ æˆ‘ä»¬å†æ¥çœ‹ä¸‹/run/flannel/subnet.envçš„é…ç½®ã€‚ 123456[root@node1 ~]# cat /run/flannel/subnet.envFLANNEL_NETWORK=172.33.0.0/16FLANNEL_SUBNET=172.33.68.1/24FLANNEL_MTU=1500FLANNEL_IPMASQ=falseCopy ä»¥ä¸Šç¯å¢ƒå˜é‡æ˜¯flannelå‘etcdä¸­æ³¨å†Œçš„ã€‚ DockerNode1çš„dockeré…ç½®å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142[root@node1 ~]# cat /usr/lib/systemd/system/docker.service[Unit]Description=Docker Application Container EngineDocumentation=http://docs.docker.comAfter=network.target rhel-push-plugin.socket registries.serviceWants=docker-storage-setup.serviceRequires=docker-cleanup.timer[Service]Type=notifyNotifyAccess=allEnvironmentFile=-/run/containers/registries.confEnvironmentFile=-/etc/sysconfig/dockerEnvironmentFile=-/etc/sysconfig/docker-storageEnvironmentFile=-/etc/sysconfig/docker-networkEnvironment=GOTRACEBACK=crashEnvironment=DOCKER_HTTP_HOST_COMPAT=1Environment=PATH=/usr/libexec/docker:/usr/bin:/usr/sbinExecStart=/usr/bin/dockerd-current \\ --add-runtime docker-runc=/usr/libexec/docker/docker-runc-current \\ --default-runtime=docker-runc \\ --exec-opt native.cgroupdriver=systemd \\ --userland-proxy-path=/usr/libexec/docker/docker-proxy-current \\ $OPTIONS \\ $DOCKER_STORAGE_OPTIONS \\ $DOCKER_NETWORK_OPTIONS \\ $ADD_REGISTRY \\ $BLOCK_REGISTRY \\ $INSECURE_REGISTRY\\ $REGISTRIESExecReload=/bin/kill -s HUP $MAINPIDLimitNOFILE=1048576LimitNPROC=1048576LimitCORE=infinityTimeoutStartSec=0Restart=on-abnormalMountFlags=slaveKillMode=process[Install]WantedBy=multi-user.targetCopy æŸ¥çœ‹Node1ä¸Šçš„dockerå¯åŠ¨å‚æ•°ï¼š 1234567891011[root@node1 ~]# systemctl status -l dockerâ— docker.service - Docker Application Container Engine Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled) Drop-In: /usr/lib/systemd/system/docker.service.d â””â”€flannel.conf Active: active (running) since Fri 2018-02-02 22:52:43 CST; 2h 28min ago Docs: http://docs.docker.com Main PID: 4334 (dockerd-current) CGroup: /system.slice/docker.service â€£ 4334 /usr/bin/dockerd-current --add-runtime docker-runc=/usr/libexec/docker/docker-runc-current --default-runtime=docker-runc --exec-opt native.cgroupdriver=systemd --userland-proxy-path=/usr/libexec/docker/docker-proxy-current --selinux-enabled --log-driver=journald --signature-verification=false --bip=172.33.68.1/24 --ip-masq=true --mtu=1500Copy æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨dockeråœ¨å¯åŠ¨æ—¶æœ‰å¦‚ä¸‹å‚æ•°ï¼š--bip=172.33.68.1/24 --ip-masq=true --mtu=1500ã€‚ä¸Šè¿°å‚æ•°flannelå¯åŠ¨æ—¶è¿è¡Œçš„è„šæœ¬ç”Ÿæˆçš„ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’è¿‡æ¥çš„ã€‚ æˆ‘ä»¬æŸ¥çœ‹ä¸‹node1å®¿ä¸»æœºä¸Šçš„ç½‘ç»œæ¥å£ï¼š 12345678910111213141516171819202122232425262728293031323334[root@node1 ~]# ip addr1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000 link/ether 52:54:00:00:57:32 brd ff:ff:ff:ff:ff:ff inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic eth0 valid_lft 85095sec preferred_lft 85095sec inet6 fe80::5054:ff:fe00:5732/64 scope link valid_lft forever preferred_lft forever3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000 link/ether 08:00:27:7b:0f:b1 brd ff:ff:ff:ff:ff:ff inet 172.17.8.101/24 brd 172.17.8.255 scope global eth1 valid_lft forever preferred_lft forever4: eth2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000 link/ether 08:00:27:ef:25:06 brd ff:ff:ff:ff:ff:ff inet 172.30.113.231/21 brd 172.30.119.255 scope global dynamic eth2 valid_lft 85096sec preferred_lft 85096sec inet6 fe80::a00:27ff:feef:2506/64 scope link valid_lft forever preferred_lft forever5: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP link/ether 02:42:d0:ae:80:ea brd ff:ff:ff:ff:ff:ff inet 172.33.68.1/24 scope global docker0 valid_lft forever preferred_lft forever inet6 fe80::42:d0ff:feae:80ea/64 scope link valid_lft forever preferred_lft forever7: veth295bef2@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP link/ether 6a:72:d7:9f:29:19 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::6872:d7ff:fe9f:2919/64 scope link valid_lft forever preferred_lft foreverCopy æˆ‘ä»¬åˆ†ç±»æ¥è§£é‡Šä¸‹è¯¥è™šæ‹Ÿæœºä¸­çš„ç½‘ç»œæ¥å£ã€‚ loï¼šå›ç¯ç½‘ç»œï¼Œ127.0.0.1 eth0ï¼šNATç½‘ç»œï¼Œè™šæ‹Ÿæœºåˆ›å»ºæ—¶è‡ªåŠ¨åˆ†é…ï¼Œä»…å¯ä»¥åœ¨å‡ å°è™šæ‹Ÿæœºä¹‹é—´è®¿é—® eth1ï¼šbridgeç½‘ç»œï¼Œä½¿ç”¨vagrantåˆ†é…ç»™è™šæ‹Ÿæœºçš„åœ°å€ï¼Œè™šæ‹Ÿæœºä¹‹é—´å’Œæœ¬åœ°ç”µè„‘éƒ½å¯ä»¥è®¿é—® eth2ï¼šbridgeç½‘ç»œï¼Œä½¿ç”¨DHCPåˆ†é…ï¼Œç”¨äºè®¿é—®äº’è”ç½‘çš„ç½‘å¡ docker0ï¼šbridgeç½‘ç»œï¼Œdockeré»˜è®¤ä½¿ç”¨çš„ç½‘å¡ï¼Œä½œä¸ºè¯¥èŠ‚ç‚¹ä¸Šæ‰€æœ‰å®¹å™¨çš„è™šæ‹Ÿäº¤æ¢æœº veth295bef2@if6ï¼šveth pairï¼Œè¿æ¥docker0å’ŒPodä¸­çš„å®¹å™¨ã€‚veth pairå¯ä»¥ç†è§£ä¸ºä½¿ç”¨ç½‘çº¿è¿æ¥å¥½çš„ä¸¤ä¸ªæ¥å£ï¼ŒæŠŠä¸¤ä¸ªç«¯å£æ”¾åˆ°ä¸¤ä¸ªnamespaceä¸­ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªnamespaceå°±èƒ½æ‰“é€šã€‚ 123456[root@node1 ~]# docker network lsNETWORK ID NAME DRIVER SCOPE940bb75e653b bridge bridge locald94c046e105d host host local2db7597fd546 none null localCopy å†æ£€æŸ¥ä¸‹bridgeç½‘ç»œ940bb75e653bçš„ä¿¡æ¯ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940[root@node1 ~]# docker network inspect 940bb75e653b[ &#123; \"Name\": \"bridge\", \"Id\": \"940bb75e653bfa10dab4cce8813c2b3ce17501e4e4935f7dc13805a61b732d2c\", \"Scope\": \"local\", \"Driver\": \"bridge\", \"EnableIPv6\": false, \"IPAM\": &#123; \"Driver\": \"default\", \"Options\": null, \"Config\": [ &#123; \"Subnet\": \"172.33.68.1/24\", \"Gateway\": \"172.33.68.1\" &#125; ] &#125;, \"Internal\": false, \"Containers\": &#123; \"944d4aa660e30e1be9a18d30c9dcfa3b0504d1e5dbd00f3004b76582f1c9a85b\": &#123; \"Name\": \"k8s_POD_coredns-5984fb8cbb-sjqv9_kube-system_c5a2e959-082a-11e8-b4cd-525400005732_0\", \"EndpointID\": \"7397d7282e464fc4ec5756d6b328df889cdf46134dbbe3753517e175d3844a85\", \"MacAddress\": \"02:42:ac:21:44:02\", \"IPv4Address\": \"172.33.68.2/24\", \"IPv6Address\": \"\" &#125; &#125;, \"Options\": &#123; \"com.docker.network.bridge.default_bridge\": \"true\", \"com.docker.network.bridge.enable_icc\": \"true\", \"com.docker.network.bridge.enable_ip_masquerade\": \"true\", \"com.docker.network.bridge.host_binding_ipv4\": \"0.0.0.0\", \"com.docker.network.bridge.name\": \"docker0\", \"com.docker.network.driver.mtu\": \"1500\" &#125;, \"Labels\": &#123;&#125; &#125;]Copy æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥ç½‘ç»œä¸­çš„Configä¸dockerçš„å¯åŠ¨é…ç½®ç›¸ç¬¦ã€‚ Node1ä¸Šè¿è¡Œçš„å®¹å™¨ï¼š 12345[root@node1 ~]# docker psCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMESa37407a234dd docker.io/coredns/coredns@sha256:adf2e5b4504ef9ffa43f16010bd064273338759e92f6f616dd159115748799bc \"/coredns -conf /etc/\" About an hour ago Up About an hour k8s_coredns_coredns-5984fb8cbb-sjqv9_kube-system_c5a2e959-082a-11e8-b4cd-525400005732_0944d4aa660e3 docker.io/openshift/origin-pod \"/usr/bin/pod\" About an hour ago Up About an hour k8s_POD_coredns-5984fb8cbb-sjqv9_kube-system_c5a2e959-082a-11e8-b4cd-525400005732_0Copy æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“å‰å·²ç»æœ‰2ä¸ªå®¹å™¨åœ¨è¿è¡Œã€‚ Node1ä¸Šçš„è·¯ç”±ä¿¡æ¯ï¼š 1234567891011[root@node1 ~]# route -nKernel IP routing tableDestination Gateway Genmask Flags Metric Ref Use Iface0.0.0.0 10.0.2.2 0.0.0.0 UG 100 0 0 eth00.0.0.0 172.30.116.1 0.0.0.0 UG 101 0 0 eth210.0.2.0 0.0.0.0 255.255.255.0 U 100 0 0 eth0172.17.8.0 0.0.0.0 255.255.255.0 U 100 0 0 eth1172.30.112.0 0.0.0.0 255.255.248.0 U 100 0 0 eth2172.33.68.0 0.0.0.0 255.255.255.0 U 0 0 0 docker0172.33.96.0 172.3.65 255.255.255.0 UG 0 0 0 eth2Copy ä»¥ä¸Šè·¯ç”±ä¿¡æ¯æ˜¯ç”±flannelæ·»åŠ çš„ï¼Œå½“æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥åˆ°Kubernetesé›†ç¾¤ä¸­åï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„è·¯ç”±è¡¨éƒ½å°†å¢åŠ ã€‚ æˆ‘ä»¬åœ¨nodeä¸Šæ¥tracerouteä¸‹node3ä¸Šçš„coredns-5984fb8cbb-tkfrcå®¹å™¨ï¼Œå…¶IPåœ°å€æ˜¯172.33.96.3ï¼Œçœ‹çœ‹å…¶è·¯ç”±ä¿¡æ¯ã€‚ 12345[root@node1 ~]# traceroute 172.33.96.3traceroute to 172.33.96.3 (172.33.96.3), 30 hops max, 60 byte packets 1 172.30.118.65 (172.30.118.65) 0.518 ms 0.367 ms 0.398 ms 2 172.33.96.3 (172.33.96.3) 0.451 ms 0.352 ms 0.223 msCopy æˆ‘ä»¬çœ‹åˆ°è·¯ç”±ç›´æ¥ç»è¿‡node3çš„å…¬ç½‘IPåå°±åˆ°è¾¾äº†node3èŠ‚ç‚¹ä¸Šçš„Podã€‚ Node1çš„iptablesä¿¡æ¯ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940[root@node1 ~]# iptables -LChain INPUT (policy ACCEPT)target prot opt source destinationKUBE-FIREWALL all -- anywhere anywhereKUBE-SERVICES all -- anywhere anywhere /* kubernetes service portals */Chain FORWARD (policy ACCEPT)target prot opt source destinationKUBE-FORWARD all -- anywhere anywhere /* kubernetes forward rules */DOCKER-ISOLATION all -- anywhere anywhereDOCKER all -- anywhere anywhereACCEPT all -- anywhere anywhere ctstate RELATED,ESTABLISHEDACCEPT all -- anywhere anywhereACCEPT all -- anywhere anywhereChain OUTPUT (policy ACCEPT)target prot opt source destinationKUBE-FIREWALL all -- anywhere anywhereKUBE-SERVICES all -- anywhere anywhere /* kubernetes service portals */Chain DOCKER (1 references)target prot opt source destinationChain DOCKER-ISOLATION (1 references)target prot opt source destinationRETURN all -- anywhere anywhereChain KUBE-FIREWALL (2 references)target prot opt source destinationDROP all -- anywhere anywhere /* kubernetes firewall for dropping marked packets */ mark match 0x8000/0x8000Chain KUBE-FORWARD (1 references)target prot opt source destinationACCEPT all -- anywhere anywhere /* kubernetes forwarding rules */ mark match 0x4000/0x4000ACCEPT all -- 10.254.0.0/16 anywhere /* kubernetes forwarding conntrack pod source rule */ ctstate RELATED,ESTABLISHEDACCEPT all -- anywhere 10.254.0.0/16 /* kubernetes forwarding conntrack pod destination rule */ ctstate RELATED,ESTABLISHEDChain KUBE-SERVICES (2 references)target prot opt source destinationCopy","categories":[{"name":"k8s","slug":"k8s","permalink":"https://www.xiemx.com/categories/k8s/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.xiemx.com/tags/k8s/"},{"name":"network","slug":"network","permalink":"https://www.xiemx.com/tags/network/"},{"name":"flannel","slug":"flannel","permalink":"https://www.xiemx.com/tags/flannel/"}],"author":"xiemx"},{"title":"k8s pause container","slug":"k8s-pause-container","date":"2020-01-20T04:01:52.000Z","updated":"2020-01-21T09:02:31.436Z","comments":true,"path":"/2020/01/20/k8s-pause-container/","link":"","permalink":"https://www.xiemx.com/2020/01/20/k8s-pause-container/","excerpt":"","text":"pause containerPauseå®¹å™¨ï¼Œä¹Ÿè¢«ç§°ä¸ºinfraå®¹å™¨ï¼Œkubelet å¯åŠ¨æ˜¯å¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šimage--pod-infra-container-image=gcr.io/google_containers/pause-amd64:3.0 åœ¨Unixç³»ç»Ÿä¸­ï¼ŒPIDä¸º1çš„è¿›ç¨‹ä¸ºinitè¿›ç¨‹ï¼Œå³æ‰€æœ‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚å®ƒä¼šç»´æŠ¤ä¸€å¼ è¿›ç¨‹è¡¨ï¼Œä¸æ–­åœ°æ£€æŸ¥è¿›ç¨‹çŠ¶æ€ï¼Œæ¥ç®¡ç†å­è¿›ç¨‹ã€‚init ä¸ä¼šå“åº”ç³»ç»Ÿä¿¡å·ï¼Œå¯ä»¥é˜²æ­¢initè¿›ç¨‹è¢«è¯¯æ€ã€‚ pauseå®¹å™¨çš„æ¶æ„å›¾ï¼š kubernetesä¸­çš„pauseå®¹å™¨çš„åŠŸèƒ½ï¼š åˆ›å»ºå‘½åç©ºé—´åŸºç¡€ï¼Œç»™äºˆåç»­å®¹å™¨ä½¿ç”¨ åˆ›å»ºinitè¿›ç¨‹ä½œä¸ºçˆ¶è¿›ç¨‹æ¥æ¥ç®¡åç»­å®¹å™¨çš„è¿›ç¨‹ï¼Œä¿è¯è¿›ç¨‹å®‰å…¨å’Œå›æ”¶ å‚è€ƒï¼šhttps://www.ianlewis.org/en/almighty-pause-container","categories":[{"name":"k8s","slug":"k8s","permalink":"https://www.xiemx.com/categories/k8s/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.xiemx.com/tags/k8s/"},{"name":"docker","slug":"docker","permalink":"https://www.xiemx.com/tags/docker/"}],"author":"xiemx"},{"title":"Nginx URIå‚æ•°%xxå­—ç¬¦è§£ç ","slug":"nginx-decode-uri","date":"2020-01-09T06:32:04.000Z","updated":"2020-01-09T06:32:20.152Z","comments":true,"path":"/2020/01/09/nginx-decode-uri/","link":"","permalink":"https://www.xiemx.com/2020/01/09/nginx-decode-uri/","excerpt":"","text":"Nginx URIå‚æ•°%xxå­—ç¬¦è§£ç å¯¹URIå‚æ•°å€¼ä¸­çš„%XXè¿™æ ·çš„ç¼–ç åºåˆ—è¿›è¡Œè§£ç ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹ ngx_set_misc æ¨¡å—æä¾›çš„ set_unescape_uri æŒ‡ä»¤ï¼š 123456789101112131415161718192021 location /decode &#123; set_unescape_uri $name $arg_name; set_unescape_uri $class $arg_class; echo \"name: $name\"; echo \"class: $class\"; &#125; location /test &#123; echo \"name: $arg_name\"; echo \"class: $arg_class\"; &#125;$ curl 'http://localhost/test?name=hello%20xiemx&amp;class=1'name: hello%20xiemxclass: 1$ curl 'http://localhost/decode?name=hello%20xiemx&amp;class=1'name: hello xiemxclass: 1","categories":[{"name":"nginx","slug":"nginx","permalink":"https://www.xiemx.com/categories/nginx/"}],"tags":[{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"},{"name":"nginx","slug":"nginx","permalink":"https://www.xiemx.com/tags/nginx/"}],"author":"xiemx"},{"title":"å¦‚ä½•åœ¨K8Sç¯å¢ƒä¸­æŠ“PODçš„åŒ…","slug":"k8s-tcpdump","date":"2019-12-12T02:01:04.000Z","updated":"2019-12-12T07:05:08.737Z","comments":true,"path":"/2019/12/12/k8s-tcpdump/","link":"","permalink":"https://www.xiemx.com/2019/12/12/k8s-tcpdump/","excerpt":"","text":"å¦‚ä½•åœ¨K8Sç¯å¢ƒä¸­æŠ“PODçš„åŒ… kubectl get pod -o wide è·å–podæ‰€åœ¨çš„nodeä¿¡æ¯ 12345678âœ Documents kubectl get pod -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODEinternal-nginx-ingress-controller-7fdf7f457d-bd59z 1/1 Running 0 42m 10.200.1.83 ip-10-200-1-202.ap-northeast-1.compute.internal &lt;none&gt;2. kubectl describe pod/podname è·å–podçš„containid```shellâœ Documents k get pod -o jsonpath='&#123;.status.containerStatuses[*].containerID&#125;' internal-nginx-ingress-controller-7fdf7f457d-bd59zdocker://ae9a6df60584e797e56cc64d0df02e64d7731a0d852026fab0a76c920c608cbe ç™»é™†nodeèŠ‚ç‚¹ï¼Œæ‰¾åˆ°containeræŸ¥çœ‹eth0ç½‘å¡çš„ID 12[ec2-user@ip-10-200-1-202 net]$ docker exec -it ae9a6df60584e797e56cc64d0df02e64d7731a0d852026fab0a76c920c608cbe cat /sys/class/net/eth0/iflink88 å®¿ä¸»æœºä¸ŠæŸ¥è¯¢å¯¹åº”IDçš„ç½‘å¡è®¾å¤‡å· 12345678910111213141516171819202122232425262728293031[ec2-user@ip-10-200-1-202 net]$ cd /sys/class/net; for i in $(ls);do echo $i ;grep 88 $i/ifindex;doneeni0143b083c86eni154a5470c40eni1c162323f07eni1d3e2ba2ce1eni3fbceb3330beni457702aeb41eni45f360a240eeni50431e3a94feni619e29d4baceni66339821adfeni6fe679d6356eni79708a78f8beni7cc26b0b7d2eni855ca0ba49beni8799376f27ceni90208382a7beni909411bbf11eni94c3d2bb833enia14f5f7c3e9enib70b44b2399enic2ad9523b38 ###å®¹å™¨æ‰€å±ç½‘å¡88enid60e48c6616enid8f13b5dd06enida858799e91enieee4f7696a1enif0d5e81d420eth0eth1lo tcpdump æŠ“åŒ…å³å¯ 12345678âœ ssh-keys git:(master) âœ— ssh -F ~/.matrix/jp/ssh.aux.config 10.200.1.202 -l ec2-user \"sudo tcpdump -vvv -i enic2ad9523b38 tcp port 80 -w -\" | wireshark -k -i -Warning: Permanently added '10.200.1.4' (ECDSA) to the list of known hosts.Warning: Permanently added '10.200.1.202' (ECDSA) to the list of known hosts.tcpdump: listening on eni86f5b593a42, link-type EN10MB (Ethernet), capture size 262144 bytestcpdump: pcap_loop: The interface went down7408 packets captured7408 packets received by filter0 packets dropped by kernel","categories":[{"name":"k8s","slug":"k8s","permalink":"https://www.xiemx.com/categories/k8s/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.xiemx.com/tags/k8s/"},{"name":"network","slug":"network","permalink":"https://www.xiemx.com/tags/network/"},{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"tcpdump","slug":"tcpdump","permalink":"https://www.xiemx.com/tags/tcpdump/"}],"author":"xiemx"},{"title":"nginx remote_portä¸ºç©º","slug":"nginx-remote-port-is-null","date":"2019-12-12T02:01:04.000Z","updated":"2019-12-12T07:06:52.916Z","comments":true,"path":"/2019/12/12/nginx-remote-port-is-null/","link":"","permalink":"https://www.xiemx.com/2019/12/12/nginx-remote-port-is-null/","excerpt":"","text":"nginx remote_portä¸ºç©ºç°è±¡ç”±äºç½‘å®‰è¦æ±‚è®°å½•ç”¨æˆ·è¯·æ±‚æ¥æºç«¯å£åˆ°æ—¥å¿—ä¸­ï¼Œå› æ­¤ä¸ºäº†å®ç°è¿™ä¸ªéœ€æ±‚åœ¨log_formatä¸­å¢åŠ äº†â€ngx_remote_port: $remote_portâ€å­—æ®µ(å¦‚ä¸‹)ï¼Œ ä½†å®é™…æ—¥å¿—ç³»ç»Ÿä¸­æ”¶å½•åˆ°çš„æ—¥å¿—ngx_remote_port:&quot;&quot;ä¸ºç©º 123456789101112131415161718192021222324log_format json '&#123; \"time\": \"$time_iso8601\", ' '\"ngx_true_client_ip\": \"$http_true_client_ip\", ' '\"ngx_x_real_ip\": \"$http_x_real_ip\", ' '\"ngx_cdn_src_ip\": \"$http_cdn_src_ip\", ' '\"ngx_geo_location_ip\": \"$client_ip\", ' '\"ngx_remote_addr\": \"$remote_addr\", ' '\"ngx_remote_port\": \"$remote_port\", ' '\"ngx_x_user_site_proxy\": \"$http_x_user_site_proxy\", ' '\"ngx_x_forwarded_for\": \"$http_x_forwarded_for\", ' '\"ngx_host\": \"$host\", ' '\"ngx_http_user_agent\": \"$http_user_agent\", ' '\"ngx_body_bytes_sent\": \"$body_bytes_sent\", ' '\"ngx_request_time\": \"$request_time\", ' '\"ngx_upstream_response_time\": \"$upstream_response_time\", ' '\"ngx_upstream_connect_time\": \"$upstream_connect_time\", ' '\"ngx_upstream_header_time:\": \"$upstream_header_time\", ' '\"ngx_upstream_addr\": \"$upstream_addr\", ' '\"ngx_upstream_content_length\": \"$sent_http_content_length\", ' '\"ngx_status_code\": \"$status\", ' '\"ngx_scheme\": \"$scheme\", ' '\"ngx_request_method\": \"$request_method\", ' '\"ngx_request_uri\": \"$request_uri\", ' '\"ngx_request\": \"$request\", ' '\"ngx_http_referrer\": \"$http_referer\" &#125;'; è§£å†³ç”±äº$remote_portè¿™ä¸ªå˜é‡æ˜¯nginxæ ¸å¿ƒæ¨¡å—æä¾›çš„ï¼Œå› æ­¤çŒœæµ‹æ˜¯ç”±ç¬¬ä¸‰æ–¹æ¨¡å—å†æ¬¡æ“ä½œå¯¼è‡´ä¸ºç©ºï¼Œç»è¿‡æµ‹è¯•å‘ç°é€šè¿‡proxyè¿›æ¥çš„è¯·æ±‚remote_portä¸ºç©ºï¼Œè€Œç›´æ¥è®¿é—®æœ¬åœ°nginxçš„è¯·æ±‚éƒ½èƒ½å¤Ÿæ­£ç¡®è·å–portä¿¡æ¯ï¼Œå¯¹äºä»¥ä¸Š2ä¸­æƒ…å†µçš„å¯¹æ¯”æ€€ç–‘æ˜¯ç”±äºç»è¿‡proxyä¹‹ç±»çš„ç»„å»ºrequest headerä¸­æœ‰x-forworder-forçš„å¤´ï¼Œä»è€Œè§¦å‘äº†realip æ¨¡å—ï¼ˆè¿™ä¸ªæ€€ç–‘æ²¡æœ‰å…·ä½“éªŒè¯ï¼‰ï¼Œè§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨realipæ¨¡å—æä¾›çš„å˜é‡â€™realip_remote_portâ€™æ¥è®°å½•æ¥æºport, ä¿®æ”¹log_format 1234567log_format json '&#123; \"time\": \"$time_iso8601\", ' '\"ngx_true_client_ip\": \"$http_true_client_ip\", ' '\"ngx_x_real_ip\": \"$http_x_real_ip\", ' '\"ngx_cdn_src_ip\": \"$http_cdn_src_ip\", ' '\"ngx_geo_location_ip\": \"$client_ip\", ' '\"ngx_remote_addr\": \"$remote_addr\", ' '\"ngx_remote_port\": \"$remote_port\", '","categories":[{"name":"nginx","slug":"nginx","permalink":"https://www.xiemx.com/categories/nginx/"}],"tags":[{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"},{"name":"nginx","slug":"nginx","permalink":"https://www.xiemx.com/tags/nginx/"}],"author":"xiemx"},{"title":"k8s ingress-nginxåŠ¨æ€balanceå®ç°è§£æ","slug":"k8s-ingress-nginx","date":"2019-09-15T23:09:52.000Z","updated":"2019-10-21T06:57:42.989Z","comments":true,"path":"/2019/09/16/k8s-ingress-nginx/","link":"","permalink":"https://www.xiemx.com/2019/09/16/k8s-ingress-nginx/","excerpt":"","text":"åªèŠ‚é€‰äº†æ¯”è¾ƒå…³é”®çš„ä»£ç ï¼Œåˆ é™¤äº†æ¯”è¾ƒå¤šçš„å¹²æ‰°é¡¹ã€‚çº¯å±ä¸ªäººç†è§£ï¼ï¼ï¼ 1. åˆå§‹åŒ–balancer.init_worker()ï¼Œä½¿ç”¨balancer.balance()åŠ¨æ€è·å–123456789101112131415161718192021http &#123; lua_package_path \"/etc/nginx/lua/?.lua;/etc/nginx/lua/vendor/?.lua;/usr/local/lib/lua/?.lua;;\"; init_by_lua_block &#123; ok, res = pcall(require, \"configuration\") &#125; init_worker_by_lua_block &#123; balancer.init_worker() #####åˆ›å»ºå®šæ—¶ä»»åŠ¡ ngx.timer.every(BACKENDS_SYNC_INTERVAL, sync_backends) &#125; ###upstream configureupstream upstream_balancer &#123; server 0.0.0.1; # placeholder balancer_by_lua_block &#123; balancer.balance() &#125; keepalive 32; keepalive_timeout 60s; keepalive_requests 100; &#125; 2. è·å–backendä¿¡æ¯ï¼Œbalancer.init_worker()12345678910111213141516171819202122232425####https://sourcegraph.com/github.com/kubernetes/ingress-nginx@dd0fe4b458cc5520f25eb8bba25bbe6f0c72ee98/-/blob/rootfs/etc/nginx/lua/balancer.lua?utm_source=share#L223local configuration = require(\"configuration\")function _M.init_worker() sync_backends() -- when worker starts, sync backends without delay local _, err = ngx.timer.every(BACKENDS_SYNC_INTERVAL, sync_backends) if err then ngx.log(ngx.ERR, string.format(\"error when setting up timer.every for sync_backends: %s\", tostring(err))) endendlocal function sync_backends() local backends_data = configuration.get_backends_data() local new_backends, err = cjson.decode(backends_data) local balancers_to_keep = &#123;&#125; for _, new_backend in ipairs(new_backends) do sync_backend(new_backend) balancers_to_keep[new_backend.name] = balancers[new_backend.name] endend 1234567891011121314151617181920212223242526272829303132333435363738394041424344####https://sourcegraph.com/github.com/kubernetes/ingress-nginx@dd0fe4b458cc5520f25eb8bba25bbe6f0c72ee98/-/blob/rootfs/etc/nginx/lua/configuration.lua?utm_source=share#L10:10local configuration_data = ngx.shared.configuration_datalocal certificate_data = ngx.shared.certificate_datalocal _M = &#123;&#125;function _M.get_backends_data() return configuration_data:get(\"backends\")endfunction _M.call() if ngx.var.request_method ~= \"POST\" and ngx.var.request_method ~= \"GET\" then ngx.status = ngx.HTTP_BAD_REQUEST ngx.print(\"Only POST and GET requests are allowed!\") return end if ngx.var.request_uri == \"/configuration/servers\" then handle_servers() return end if ngx.var.request_uri == \"/configuration/general\" then handle_general() return end if ngx.var.uri == \"/configuration/certs\" then handle_certs() return end if ngx.var.request_uri ~= \"/configuration/backends\" then ####åªæ¥å—ä»¥ä¸Š4ç±»å‹URL ngx.status = ngx.HTTP_NOT_FOUND ngx.print(\"Not found!\") return end local backends = fetch_request_body() local success, err = configuration_data:set(\"backends\", backends)end 12345678910111213141516171819### fetch_request_body()ï¼Œä»æ­¤å‡½æ•°å¯ä»¥çœ‹å‡ºæ­¤å‡½æ•°æ˜¯ä¸€ä¸ªå¤–éƒ¨è°ƒç”¨ï¼Œå¯ä»¥å¾—å‡ºåŸå§‹çš„æ•°æ®æ¥æºä¸ºå¤–éƒ¨è§¦å‘çš„POSTï¼Œå¯ä»¥æŸ¥è¯¢Call()å‡½æ•°çš„å¼•ç”¨ä½ç½®local function fetch_request_body() ngx.req.read_body() ###é˜²æ­¢ngx.req.get_body_data()è¿”å›nil,æ˜¾ç¤ºæ‰§è¡Œä¸€ä¸‹ local body = ngx.req.get_body_data() if not body then local file_name = ngx.req.get_body_file() ###è¯»å–cache file local file = io.open(file_name, \"rb\") if not file then return nil end body = file:read(\"*all\") file:close() end return bodyend 1234567891011121314151617181920####nginx.conf æŸ¥çœ‹nginxé…ç½®æ–‡ä»¶ä¸­æ˜¾ç¤ºè°ƒç”¨call()å‡½æ•°çš„ä½ç½®ä¸ºå½“å‰serveråˆ‡url /configuration ç¬¦åˆå‡½æ•°è¦æ±‚ï¼Œåœ¨æŸ¥æ‰¾å¤–éƒ¨è°ƒç”¨çš„ä»£ç ï¼ˆåŸºæœ¬å¯ä»¥å®šä½ä¸ºæ§åˆ¶å™¨çš„é€»è¾‘æ§åˆ¶ï¼‰ server &#123; listen unix:/tmp/nginx-status-server.sock; set $proxy_upstream_name \"internal\"; keepalive_timeout 0; gzip off; access_log off; location /configuration &#123; # this should be equals to configuration_data dict client_max_body_size 10m; client_body_buffer_size 10m; proxy_buffering off; content_by_lua_block &#123; configuration.call() &#125; &#125; 3. é€šè¿‡ä¸Šé¢çš„ä¿¡æ¯æ£€ç´¢ï¼Œåœ¨Ingressä¸­ç›‘å¬podå˜åŒ–ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒç”¨/configuration/backends, å‡½æ•°ä¸ºconfigureBackends()12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061####https://github.com/kubernetes/ingress-nginx/blob/ce3e3d51c397ff6a0cd6731cc64360ecdb69ea54/internal/ingress/controller/nginx.go#L982func configureBackends(rawBackends []*ingress.Backend) error &#123; backends := make([]*ingress.Backend, len(rawBackends)) for i, backend := range rawBackends &#123; var service *apiv1.Service if backend.Service != nil &#123; service = &amp;apiv1.Service&#123;Spec: backend.Service.Spec&#125; &#125; luaBackend := &amp;ingress.Backend&#123; Name: backend.Name, Port: backend.Port, SSLPassthrough: backend.SSLPassthrough, SessionAffinity: backend.SessionAffinity, UpstreamHashBy: backend.UpstreamHashBy, LoadBalancing: backend.LoadBalancing, Service: service, NoServer: backend.NoServer, TrafficShapingPolicy: backend.TrafficShapingPolicy, AlternativeBackends: backend.AlternativeBackends, &#125; var endpoints []ingress.Endpoint for _, endpoint := range backend.Endpoints &#123; endpoints = append(endpoints, ingress.Endpoint&#123; Address: endpoint.Address, Port: endpoint.Port, &#125;) &#125; luaBackend.Endpoints = endpoints backends[i] = luaBackend &#125; statusCode, _, err := nginx.NewPostStatusRequest(\"/configuration/backends\", \"application/json\", backends) ####backends ä¸ºrequest.body,å´å†…å®¹ä¸ºIP/PORTï¼Œä»¥ä¸‹ç»™å‡ºäº†backendçš„struct if err != nil &#123; return err &#125; if statusCode != http.StatusCreated &#123; return fmt.Errorf(\"unexpected error code: %d\", statusCode) &#125; return nil&#125;####Backend structtype Backend struct &#123; Name string `json:\"name\"` Service *apiv1.Service `json:\"service,omitempty\"` Port intstr.IntOrString `json:\"port\"` SecureCACert resolver.AuthSSLCert `json:\"secureCACert\"` SSLPassthrough bool `json:\"sslPassthrough\"` Endpoints []Endpoint `json:\"endpoints,omitempty\"` SessionAffinity SessionAffinityConfig `json:\"sessionAffinityConfig\"` UpstreamHashBy UpstreamHashByConfig `json:\"upstreamHashByConfig,omitempty\"` LoadBalancing string `json:\"load-balance,omitempty\"` NoServer bool `json:\"noServer\"` TrafficShapingPolicy TrafficShapingPolicy `json:\"trafficShapingPolicy,omitempty\"` AlternativeBackends []string `json:\"alternativeBackends,omitempty\"`&#125; 4. ngx_balancer.set_current_peer()è®¾ç½®backendä¿¡æ¯12345678910111213141516171819202122232425262728293031323334353637383940414243444546####https://sourcegraph.com/github.com/kubernetes/ingress-nginx@dd0fe4b458cc5520f25eb8bba25bbe6f0c72ee98/-/blob/rootfs/etc/nginx/lua/balancer.lua?utm_source=share#L232:13function _M.balance() local balancer = get_balancer() if not balancer then return end local peer = balancer:balance() if not peer then ngx.log(ngx.WARN, \"no peer was returned, balancer: \" .. balancer.name) return end ngx_balancer.set_more_tries(1) local ok, err = ngx_balancer.set_current_peer(peer) ####è®¾ç½®serverä¿¡æ¯ if not ok then ngx.log(ngx.ERR, string.format(\"error while setting current upstream peer %s: %s\", peer, err)) endendlocal function get_balancer() if ngx.ctx.balancer then return ngx.ctx.balancer end local backend_name = ngx.var.proxy_upstream_name ###è·å–å½“å‰requestä¸Šä¸‹æ–‡ä¸­å…±äº«çš„å˜é‡proxy_upstream_name local balancer = balancers[backend_name] ###è·å–balancersä¿¡æ¯ç”±sync_backend()å‡½æ•°å®šæ—¶è½®è¯¢ if not balancer then return end if route_to_alternative_balancer(balancer) then local alternative_backend_name = balancer.alternative_backends[1] ngx.var.proxy_alternative_upstream_name = alternative_backend_name balancer = balancers[alternative_backend_name] end ngx.ctx.balancer = balancer return balancerend 12345###nginx.confset $proxy_upstream_name \"dev-dev-auto-deploy-5000\";set $proxy_host $proxy_upstream_name;proxy_pass http://upstream_balancer;","categories":[{"name":"k8s","slug":"k8s","permalink":"https://www.xiemx.com/categories/k8s/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.xiemx.com/tags/k8s/"},{"name":"ingress","slug":"ingress","permalink":"https://www.xiemx.com/tags/ingress/"}],"author":"xiemx"},{"title":"PostgreSQLæŸ¥çœ‹å¤åˆ¶çŠ¶æ€","slug":"postgresql-replica-status","date":"2019-07-08T03:07:36.000Z","updated":"2019-10-19T09:40:34.388Z","comments":true,"path":"/2019/07/08/postgresql-replica-status/","link":"","permalink":"https://www.xiemx.com/2019/07/08/postgresql-replica-status/","excerpt":"","text":"postgresqlæŸ¥çœ‹å¤åˆ¶çŠ¶æ€ï¼Œmasterä¸Šæ‰§è¡Œ1234567891011121314151617181920212223242526272829#select * from pg_stat_replication; postgres=# select * from pg_stat_replication;-[ RECORD 1 ]----+------------------------------pid | 13321usesysid | 17019usename | replicationapplication_name | walreceiverclient_addr | 10.0.0.81client_hostname | client_port | 42809backend_start | 2016-08-11 10:57:35.856289+08backend_xmin | state | streaming --åŒæ­¥çŠ¶æ€sent_location | 1/E0CE9750write_location | 1/E0CE9750flush_location | 1/E0CE9750replay_location | 1/E0CE9750sync_priority | 0sync_state | async --åŒæ­¥æ¨¡å¼state: åŒæ­¥çŠ¶æ€ streaming : åŒæ­¥ startup : è¿æ¥ä¸­ catchup: åŒæ­¥ä¸­sync_state: åŒæ­¥æ¨¡å¼. async : å¼‚æ­¥ sync : åŒæ­¥ potential: è™½ç„¶ç°åœ¨æ˜¯å¼‚æ­¥,ä½†æœ‰å¯èƒ½æå‡åˆ°åŒæ­¥ æŸ¥çœ‹å¤åˆ¶çš„å»¶è¿Ÿæœ‰å¤šå°‘ï¼Œå­—èŠ‚å•ä½ï¼Œmasterä¸Šæ‰§è¡Œ1234567#select pg_xlog_location_diff(sent_location, replay_location) from pg_stat_replication; posrgresql=# select pg_xlog_location_diff(sent_location, replay_location) from pg_stat_replication; pg_xlog_location_diff ----------------------- 0(1 row) slaveä¸ŠæŸ¥çœ‹sqlæ»åæ—¶é—´12345678910111213SELECT CASE WHEN pg_last_xlog_receive_location() = pg_last_xlog_replay_location() THEN 0 ELSE EXTRACT (EPOCH FROM now() - pg_last_xact_replay_timestamp()) END AS log_delay;postgres=# SELECT CASE WHEN pg_last_xlog_receive_location() = pg_last_xlog_replay_location()postgres-# THEN 0postgres-# ELSE EXTRACT (EPOCH FROM now() - pg_last_xact_replay_timestamp())postgres-# END AS log_delay; log_delay----------- 0(1 row) slaveä¸ŠæŸ¥çœ‹æ˜¯å¦å¤„äºrecoveryæ¨¡å¼123456select pg_is_in_recovery();postgres=# select pg_is_in_recovery(); pg_is_in_recovery------------------- t(1 row) slaveä¸ŠæŸ¥çœ‹æœ€æ–°çš„reployæ—¶é—´æˆ³123456#select pg_last_xact_replay_timestamp();postgres=# select pg_last_xact_replay_timestamp(); pg_last_xact_replay_timestamp------------------------------- 2019-07-08 03:01:33.854131+00(1 row) slaveä¸ŠæŸ¥çœ‹æœ€æ–°çš„reployä½ç½®123456#select pg_last_xlog_replay_location();postgres=# select pg_last_xlog_replay_location(); pg_last_xlog_replay_location------------------------------ 220C/56EB4C10(1 row)","categories":[{"name":"postgresql","slug":"postgresql","permalink":"https://www.xiemx.com/categories/postgresql/"}],"tags":[{"name":"database","slug":"database","permalink":"https://www.xiemx.com/tags/database/"},{"name":"postgresql","slug":"postgresql","permalink":"https://www.xiemx.com/tags/postgresql/"}],"author":"xiemx"},{"title":"http cache","slug":"http-cache","date":"2019-05-13T03:05:02.000Z","updated":"2019-10-21T06:57:42.935Z","comments":true,"path":"/2019/05/13/http-cache/","link":"","permalink":"https://www.xiemx.com/2019/05/13/http-cache/","excerpt":"","text":"cacheæµç¨‹å›¾ â€œno-cacheâ€å’Œâ€œno-storeâ€â€œno-cacheâ€è¡¨ç¤ºå¿…é¡»å…ˆä¸æœåŠ¡å™¨ç¡®è®¤è¿”å›çš„å“åº”æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨è¯¥å“åº”æ¥æ»¡è¶³åç»­å¯¹åŒä¸€ç½‘å€çš„è¯·æ±‚ã€‚ å› æ­¤ï¼Œå¦‚æœå­˜åœ¨åˆé€‚çš„éªŒè¯ä»¤ç‰Œ (ETag)ï¼Œno-cache ä¼šå‘èµ·å¾€è¿”é€šä¿¡æ¥éªŒè¯ç¼“å­˜çš„å“åº”ï¼Œä½†å¦‚æœèµ„æºæœªå‘ç”Ÿå˜åŒ–ï¼Œåˆ™å¯é¿å…ä¸‹è½½ã€‚ â€œno-storeâ€ç¦æ­¢æµè§ˆå™¨ä»¥åŠæ‰€æœ‰ä¸­é—´ç¼“å­˜å­˜å‚¨ä»»ä½•ç‰ˆæœ¬çš„è¿”å›å“åº”ï¼Œä¾‹å¦‚ï¼ŒåŒ…å«ä¸ªäººéšç§æ•°æ®æˆ–é“¶è¡Œä¸šåŠ¡æ•°æ®çš„å“åº”ã€‚ æ¯æ¬¡ç”¨æˆ·è¯·æ±‚è¯¥èµ„äº§æ—¶ï¼Œéƒ½ä¼šå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¹¶ä¸‹è½½å®Œæ•´çš„å“åº”ã€‚ â€œpublicâ€ä¸ â€œprivateâ€â€œpublicâ€åˆ™å³ä½¿å®ƒæœ‰å…³è”çš„ HTTP èº«ä»½éªŒè¯ï¼Œç”šè‡³å“åº”çŠ¶æ€ä»£ç é€šå¸¸æ— æ³•ç¼“å­˜ï¼Œä¹Ÿå¯ä»¥ç¼“å­˜å“åº”ã€‚ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œâ€œpublicâ€ä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæ˜ç¡®çš„ç¼“å­˜ä¿¡æ¯ï¼ˆä¾‹å¦‚â€œmax-ageâ€ï¼‰å·²è¡¨ç¤ºå“åº”æ˜¯å¯ä»¥ç¼“å­˜çš„ã€‚ â€œprivateâ€æµè§ˆå™¨å¯ä»¥ç¼“å­˜å“åº”ï¼Œä¸å…è®¸ä»»ä½•ä¸­é—´ç¼“å­˜å¯¹å…¶è¿›è¡Œç¼“å­˜ã€‚ ä¾‹å¦‚ï¼Œç”¨æˆ·çš„æµè§ˆå™¨å¯ä»¥ç¼“å­˜åŒ…å«ç”¨æˆ·ç§äººä¿¡æ¯çš„ HTML ç½‘é¡µï¼Œä½† CDN å´ä¸èƒ½ç¼“å­˜ã€‚ â€œmax-ageâ€æŒ‡ä»¤æŒ‡å®šä»è¯·æ±‚çš„æ—¶é—´å¼€å§‹ï¼Œå…è®¸æå–çš„å“åº”è¢«é‡ç”¨çš„æœ€é•¿æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚ ä¾‹å¦‚ï¼Œâ€œmax-age=60â€è¡¨ç¤ºå¯åœ¨æ¥ä¸‹æ¥çš„ 60 ç§’ç¼“å­˜å’Œé‡ç”¨å“åº”ã€‚ é€šè¿‡ ETag éªŒè¯ç¼“å­˜çš„å“åº”åœ¨é¦–æ¬¡è¯·æ±‚èµ„æºæ—¶æœåŠ¡å™¨ç”Ÿæˆå¹¶è¿”å›â€ETagâ€ httpè¯·æ±‚å¤´(é€šå¸¸æ˜¯æ–‡ä»¶å†…å®¹çš„å“ˆå¸Œå€¼æˆ–æŸä¸ªå…¶ä»–æŒ‡çº¹)ã€‚ å½“120 ç§’åï¼Œæµè§ˆå™¨åˆå¯¹è¯¥èµ„æºå‘èµ·äº†æ–°çš„è¯·æ±‚ã€‚ é¦–å…ˆï¼Œæµè§ˆå™¨ä¼šæ£€æŸ¥æœ¬åœ°ç¼“å­˜å¹¶æ‰¾åˆ°ä¹‹å‰çš„å“åº”ã€‚å¦‚æœå‘ç°ç¼“å­˜è¶…è¿‡max-age, æµè§ˆå™¨å°†å‘èµ·ä¸€ä¸ªå¸¦æœ‰â€If-None-Matchâ€çš„httpè¯·æ±‚ã€‚ å¦‚æœEtagç›¸åŒï¼Œåˆ™è¿”å›304ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚ å‚è€ƒï¼š https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching","categories":[{"name":"http","slug":"http","permalink":"https://www.xiemx.com/categories/http/"}],"tags":[{"name":"http","slug":"http","permalink":"https://www.xiemx.com/tags/http/"},{"name":"cache","slug":"cache","permalink":"https://www.xiemx.com/tags/cache/"}],"author":"xiemx"},{"title":"Mysqldump error","slug":"mysqldump-error","date":"2019-05-06T03:05:56.000Z","updated":"2019-10-19T10:22:28.240Z","comments":true,"path":"/2019/05/06/mysqldump-error/","link":"","permalink":"https://www.xiemx.com/2019/05/06/mysqldump-error/","excerpt":"","text":"ç°è±¡1234[root@FCHK-instance ~]# mysqldump --host rm-xxxxxxxxxxx.mysql.rds.aliyuncs.com -u xxxx -p --databases visa &gt; hk.sqlEnter password:Warning: A partial dump from a server that has GTIDs will by default include the GTIDs of all transactions, even those that changed suppressed parts of the database. If you don't want to restore GTIDs, pass --set-gtid-purged=OFF. To make a complete dump, pass --all-databases --triggers --routines --events.mysqldump: Couldn't execute 'SELECT COLUMN_NAME, JSON_EXTRACT(HISTOGRAM, '$.\"number-of-buckets-specified\"') FROM information_schema.COLUMN_STATISTICS WHERE SCHEMA_NAME = 'visa' AND TABLE_NAME = 'admin';': Unknown table 'column_statistics' in information_schema (1109 åˆ†æ123456789[root@FCHK-instance ~]# mysql --versionmysql Ver 8.0.11 for Linux on x86_64 (MySQL Community Server - GPL)å¯èƒ½æ˜¯ç”±äºmysqldump 8ä¸­é»˜è®¤å¯ç”¨ï¼ˆCOLUMN_STATISTICSï¼‰å®˜æ–¹æ–‡æ¡£è§£é‡ŠMysql 8.0 The INFORMATION_SCHEMA COLUMN_STATISTICS Tablehttps://dev.mysql.com/doc/refman/8.0/en/column-statistics-table.html è§£å†³123[root@FCHK-instance ~]# mysqldump --host rm-xxxxxxxxxx2.mysql.rds.aliyuncs.com -u xxxx -p --databases visa --column-statistics=0 &gt; hk.sqlEnter password:Warning: A partial dump from a server that has GTIDs will by default include the GTIDs of all transactions, even those that changed suppressed parts of the database. If you don't want to restore GTIDs, pass --set-gtid-purged=OFF. To make a complete dump, pass --all-databases --triggers --routines --events.","categories":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/categories/mysql/"}],"tags":[{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"},{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/tags/mysql/"},{"name":"database","slug":"database","permalink":"https://www.xiemx.com/tags/database/"}],"author":"xiemx"},{"title":"redis-dumpä½¿ç”¨","slug":"redis-dump","date":"2019-05-06T03:05:33.000Z","updated":"2019-10-19T09:09:04.060Z","comments":true,"path":"/2019/05/06/redis-dump/","link":"","permalink":"https://www.xiemx.com/2019/05/06/redis-dump/","excerpt":"","text":"å®‰è£…redis-dump/redis-load 12#éœ€è¦ruby 2.2.2ä»¥ä¸Šç‰ˆæœ¬ï¼ˆå¯ä»¥ç›´æ¥ä½¿ç”¨ruby:2.2.3çš„docker imagesï¼‰gem install redis-dum dump redis 12345678910111213141516root@5dba1bd8fa77:/# redis-dump -h Try: /usr/local/bundle/bin/redis-dump show-commandsUsage: /usr/local/bundle/bin/redis-dump [global options] COMMAND [command options] -u, --uri=S Redis URI (e.g. redis://hostname[:port]) -d, --database=S Redis database (e.g. -d 15) -a, --password=S Redis password (e.g. -a 'my@pass/word') -s, --sleep=S Sleep for S seconds after dumping (for debugging) -c, --count=S Chunk size (default: 10000) -f, --filter=S Filter selected keys (passed directly to redis' KEYS command) -b, --base64 Encode key values as base64 (useful for binary values) -O, --without_optimizations Disable run time optimizations -V, --version Display version -D, --debug --nosaferoot@5dba1bd8fa77:/# redis-dump -u aux-redis.1uvkyf.0001.cnn1.cache.amazonaws.com.cn &gt; redis-uat.json load redis 123456789101112131415root@5dba1bd8fa77:/# redis-load -h Try: /usr/local/bundle/bin/redis-load show-commandsUsage: /usr/local/bundle/bin/redis-load [global options] COMMAND [command options] -u, --uri=S Redis URI (e.g. redis://hostname[:port]) -d, --database=S Redis database (e.g. -d 15) -a, --password=S Redis password (e.g. -a 'my@pass/word') -s, --sleep=S Sleep for S seconds after dumping (for debugging) -b, --base64 Decode key values from base64 (used with redis-dump -b) -n, --no_check_utf8 -V, --version Display version -D, --debug --nosaferoot@5dba1bd8fa77:/# redis-load -u aux-redis.1uvkyf.0001.cnn1.cache.amazonaws.com.cn:6379/0 &lt; redis-uat.json","categories":[{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/categories/redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/tags/redis/"}],"author":"xiemx"},{"title":"SSHçš„AuthorizedKeysCommandã€AuthorizedKeysCommandUser","slug":"ssh-authorizedkeyscommand","date":"2019-05-06T03:05:17.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2019/05/06/ssh-authorizedkeyscommand/","link":"","permalink":"https://www.xiemx.com/2019/05/06/ssh-authorizedkeyscommand/","excerpt":"","text":"AuthorizedKeysCommand å¯ä»¥æŒ‡å®šè¿è¡Œä¸€ä¸ªè„šæœ¬ï¼Œè€Œè¿™ä¸ªè„šæœ¬ä¸»è¦æ˜¯å¯»æ‰¾ç™»å½•ç”¨æˆ·çš„publickeyï¼Œé»˜è®¤ä¼ å‚ä¸ºç™»å½•ç”¨æˆ·åï¼Œè‹¥æœªè®¤è¯æˆåŠŸï¼Œå°†ç»§ç»­ä½¿ç”¨AuthorizedKeysFileæ–‡ä»¶æ¥åšè®¤è¯ã€‚ AuthorizedKeysCommandUserå°±æ˜¯æŒ‡å®šä»¥ä»€ä¹ˆç”¨æˆ·æ¥è¿è¡Œè¿™ä¸ªè„šæœ¬ã€‚ è¿™ä¸¤ä¸ªé…ç½®é€‰é¡¹çš„ä¸€ä¸ªç”¨å¤„å°±æ˜¯åœ¨ç”¨æˆ·ç®¡ç†ä¸Šå¯ä»¥ä¸å†ä¾é æœ¬åœ°ç®¡ç†ï¼Œè€Œå¯ä»¥é€šè¿‡è„šæœ¬è¯»å–è¿œç¨‹æ•°æ®åº“ç³»ç»Ÿä¸­çš„ç”¨æˆ·çš„publickeyè¿›è¡Œè®¤è¯ï¼Œä¾‹å¦‚MySQLæˆ–è€…LDAPï¼Œè¿™æ ·çš„è¯ï¼Œæ›´ä¾¿äºç”¨æˆ·çš„é›†ä¸­ç®¡ç†ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"ssh","slug":"ssh","permalink":"https://www.xiemx.com/tags/ssh/"}],"author":"xiemx"},{"title":"é€šè¿‡lambdaä¿®æ”¹AWS CloudFrontå›æºhost","slug":"aws-edge-lambda-modify-origin-host","date":"2018-10-10T19:10:17.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2018/10/11/aws-edge-lambda-modify-origin-host/","link":"","permalink":"https://www.xiemx.com/2018/10/11/aws-edge-lambda-modify-origin-host/","excerpt":"","text":"åœ¨ä½¿ç”¨aws cloudfrontæ—¶å‘ç°cloudfronté»˜è®¤ä¸å…è®¸è‡ªå®šä¹‰å›æºè¯·æ±‚å¤´çš„Hostå­—æ®µï¼Œå¯¹äºä¸€äº›æƒ…å†µæˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™ä¸ªhost+ipæ¥å›æºçš„æ—¶å€™å°±æœ‰ç‚¹å‘äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨awsçš„lambda@edgeï¼Œå»ä¿®æ”¹requestçš„headeræ¥å®ç°è‡ªå®šä¹‰hostæ¥å›æºã€‚ aws lambda@edgeæ–‡æ¡£ï¼šhttps://docs.aws.amazon.com/zh_cn/lambda/latest/dg/lambda-edge.html åœ¨åˆ›å»ºlambdaå‡½æ•°ï¼Œå¹¶å‘å¸ƒä¸€ä¸ªç‰ˆæœ¬æ³¨æ„åªèƒ½åœ¨us-east-1è¿™ä¸ªåŒºåˆ›å»ºï¼Œå¦åˆ™åœ¨é™„åŠ åˆ°cloudfrontçš„æ—¶å€™ä¼šæŠ¥é”™ä¸æ”¯æŒçš„åŒºåŸŸï¼Œä»£ç å¦‚ä¸‹ 123456789'use strict';// force a specific Host header to be sent to the originexports.handler = (event, context, callback) =&gt; &#123; const request = event.Records[0].cf.request; request.headers.host[0].value = 'www.xiemx.com'; return callback(null, request);&#125;; åœ¨cloudfrontçš„Behaviorèœå•ä¸­ é‡æ–°deploy cdnå’Œåˆ·æ–°ä¸€æ¬¡cdnç¼“å­˜","categories":[{"name":"aws","slug":"aws","permalink":"https://www.xiemx.com/categories/aws/"}],"tags":[{"name":"aws","slug":"aws","permalink":"https://www.xiemx.com/tags/aws/"},{"name":"lambda","slug":"lambda","permalink":"https://www.xiemx.com/tags/lambda/"},{"name":"cloudfront","slug":"cloudfront","permalink":"https://www.xiemx.com/tags/cloudfront/"}],"author":"xiemx"},{"title":"SLB 502æŠ¥é”™Debug","slug":"slb-502-debug","date":"2018-07-19T18:07:06.000Z","updated":"2019-10-19T08:11:47.770Z","comments":true,"path":"/2018/07/20/slb-502-debug/","link":"","permalink":"https://www.xiemx.com/2018/07/20/slb-502-debug/","excerpt":"","text":"ç”¨æˆ·è‡ªå®šä¹‰ç«™ç‚¹502é—®é¢˜åˆ†æ ç°è±¡ï¼šè‡ªå®šä¹‰åŸŸåç”¨æˆ·åé¦ˆï¼Œæ‰“å¼€ç½‘ç«™è¿”å›502ï¼Œå¦‚å›¾ æ ¹æ®response headeråˆ¤æ–­ï¼Œè¯·æ±‚åˆ°è¾¾captainï¼Œæ€€ç–‘captainè¿”å›çš„502é¡µé¢ã€‚æŸ¥çœ‹nginx proxy_passå¾—çŸ¥åç«¯çš„åœ°å€ä¸ºbobcat.sxldns.com. 12set $bobcat_backend \"bobcat.sxldns.com\";proxy_pass http://$bobcat_backend; ä½¿ç”¨curlæ¨¡æ‹Ÿè¯·æ±‚ï¼Œç›´æ¥è¯·æ±‚bobcat.sxldns.com,æ­£å¸¸è·å¾—è¿”å›å†…å®¹ï¼Œå…·ä½“é’ˆå¯¹æ¯ä¸ªæœåŠ¡å™¨çš„IPçš„curl,ä¸å†å•ç‹¬åˆ—å‡ºã€‚ é€šè¿‡ä¸Šè¿°è¿”å›åŸºæœ¬åˆ¤æ–­ï¼Œé—®é¢˜å‡ºåœ¨æˆ‘ä»¬çš„ä»£ç†å±‚ã€‚å…·ä½“æŸ¥çœ‹ä»£ç†å±‚çš„nginxé…ç½®å’Œç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡ã€‚ æŸ¥çœ‹å½“æ—¶ç³»ç»Ÿçš„èµ„æºçŠ¶æ€,æŸ¥çœ‹åˆ°å½“æ—¶çš„ç³»ç»Ÿç£ç›˜ç©ºé—´ä½¿ç”¨å®Œã€‚æŸ¥çœ‹nginxä¸Šæœ‰å…³äºproxyçš„cacheç›¸å…³é…ç½®,nginxä¼šcacheçš„responseçš„contentçš„å†…å®¹ã€‚æ€€ç–‘nginxè½¬å‘è¯·æ±‚ä¹‹åä½†æ˜¯backendè¿”å›å†…å®¹åï¼Œnginx cacheåˆ°æœ¬åœ°çš„æ—¶å€™æ— æ³•å†™å…¥diskå¯¼è‡´ä¼šè¯ç»“æŸï¼ŒSLBçš„è¯·æ±‚æ— è¿”å›åŒ…è®¤ä¸ºåç«¯å®•æœºæŠ›å‡º502ã€‚ 1proxy_cache_path /etc/nginx/china_cache levels=1:2 keys_zone=user_page_cache:100m max_size=20g inactive=60m use_temp_path=off; å…·ä½“DEBUGå¦‚ä¸‹ï¼š è·å–containerä¸­çš„nginx workerè¿›ç¨‹çš„PID straceæŸ¥çœ‹ä¸‹ç³»ç»Ÿè°ƒç”¨å…·ä½“ä¿¡æ¯ é€šè¿‡ä¸Šå›¾straceè¿½è¸ªæµç¨‹å¯ä»¥çœ‹åˆ°å·¦ä¾§æ˜¯ä¸€ä¸ªæ­£å¸¸çš„è¯·æ±‚çš„å…¨éƒ¨æµç¨‹ï¼Œå³ä¾§æ˜¯æ•…éšœçŠ¶æ€çš„straceçš„ç³»ç»Ÿè°ƒç”¨å…¨æµç¨‹ã€‚ é€šè¿‡å¯¹æ¯”å·¦å³ä¸¤ä¾§çš„ç³»ç»Ÿè°ƒç”¨æµç¨‹å¯ä»¥çœ‹åˆ°ï¼Œå½“nginx cacheçš„æ—¶å€™å†™å…¥/etc/nginx/china_cacheç›®å½•æ—¶æç¤ºno spaceåç»­çš„writev()å’Œsendfile()æ–¹æ³•å°±æ²¡æœ‰è°ƒç”¨ï¼Œå› æ­¤å¯¼è‡´SLBæ— æ³•è·å¾—è¿”å›åŒ…ï¼ŒæŠ›å‡ºbadgatewayçš„é”™è¯¯. PSï¼š ä¸ºä»€ä¹ˆå•ç‹¬è¯·æ±‚è¿”å›å¤´çš„æ—¶å€™æ­£å¸¸è¿”å›ï¼Ÿnginxè¿”å›è¯·æ±‚å¤´çš„æ—¶å€™å¹¶ä¸ä¼šèµ°proxyçš„cacheæµç¨‹ã€‚å› æ­¤æ²¡æœ‰è°ƒç”¨open()æ–¹æ³•è¯»å†™diskï¼Œæ­£å¸¸è¿”å›ï¼Œä½†æ˜¯å®é™…è¯·æ±‚æ•°æ®çš„æ—¶å€™cacheå†™ç£ç›˜ç›´æ¥å¤±è´¥ï¼Œåç»­ç›´æ¥é€€å‡ºã€‚ ä¸Šå›¾çš„ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ä¸ºäº†debugçš„æ–¹ä¾¿ä½¿ç”¨äº†éæŠ˜å æ¨¡å¼ã€‚å› æ­¤ä¸€äº›no spaceçš„ä¸€äº›æŠ¥é”™æœªæ˜¾ç¤ºå‡ºæ¥å¯ä»¥ã€‚å…¨éƒ¨æµç¨‹è§é™„å½•ã€‚ é™„å½•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031.å¼‚å¸¸è°ƒç”¨å †æ ˆ[root@iZ2ze2mzhjk3ou1vsnkthzZ rpm]# strace -p 3904 -vstrace: Process 3904 attachedepoll_wait(8, [&#123;EPOLLIN, &#123;u32=69025808, u64=140003117973520&#125;&#125;], 512, -1) = 1accept4(6, &#123;sa_family=AF_INET, sin_port=htons(59464), sin_addr=inet_addr(\"10.130.0.4\")&#125;, [16], SOCK_NONBLOCK) = 11epoll_ctl(8, EPOLL_CTL_ADD, 11, &#123;EPOLLIN|EPOLLRDHUP|EPOLLET, &#123;u32=69027249, u64=140003117974961&#125;&#125;) = 0epoll_wait(8, [&#123;EPOLLIN, &#123;u32=69027249, u64=140003117974961&#125;&#125;], 512, 60000) = 1recvfrom(11, \"GET /?key=testxxxx HTTP/1.1\\r\\nUse\"..., 1024, 0, NULL, NULL) = 88epoll_ctl(8, EPOLL_CTL_MOD, 11, &#123;EPOLLIN|EPOLLOUT|EPOLLRDHUP|EPOLLET, &#123;u32=69027249, u64=140003117974961&#125;&#125;) = 0open(\"/etc/nginx/china_cache/2/7d/2ac65d1f9080e2baff45a4332f9017d2\", O_RDONLY|O_NONBLOCK) = 14fstat(14, &#123;st_dev=makedev(253, 1), st_ino=655502, st_mode=S_IFREG|0600, st_nlink=1, st_uid=101, st_gid=101, st_blksize=4096, st_blocks=96, st_size=46750, st_atime=2018/07/17-16:34:43.967698739, st_mtime=2018/07/17-16:34:43.966698736, st_ctime=2018/07/17-16:34:43.967698739&#125;) = 0pread64(14, \"\\5\\0\\0\\0\\0\\0\\0\\0(\\252M[\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\"..., 636, 0) = 636getsockname(11, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(\"172.17.0.2\")&#125;, [16]) = 0sendto(13, \"nN\\1\\0\\0\\1\\0\\0\\0\\0\\0\\0\\6bobcat\\6sxldns\\3com\\0\\0\"..., 35, 0, NULL, 0) = 35sendto(13, \"\\375\\215\\1\\0\\0\\1\\0\\0\\0\\0\\0\\0\\6bobcat\\6sxldns\\3com\\0\\0\"..., 35, 0, NULL, 0) = 35epoll_wait(8, [&#123;EPOLLOUT, &#123;u32=69027249, u64=140003117974961&#125;&#125;, &#123;EPOLLIN, &#123;u32=69026288, u64=140003117974000&#125;&#125;], 512, 5000) = 2recvfrom(13, \"nN\\201\\200\\0\\1\\0\\3\\0\\0\\0\\0\\6bobcat\\6sxldns\\3com\\0\\0\"..., 4096, 0, NULL, NULL) = 147recvfrom(13, \"\\375\\215\\201\\200\\0\\1\\0\\1\\0\\1\\0\\0\\6bobcat\\6sxldns\\3com\\0\\0\"..., 4096, 0, NULL, NULL) = 168socket(AF_INET, SOCK_STREAM, IPPROTO_IP) = 15ioctl(15, FIONBIO, [1]) = 0epoll_ctl(8, EPOLL_CTL_ADD, 15, &#123;EPOLLIN|EPOLLOUT|EPOLLRDHUP|EPOLLET, &#123;u32=69027488, u64=140003117975200&#125;&#125;) = 0connect(15, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(\"54.222.148.216\")&#125;, 16) = -1 EINPROGRESS (Operation now in progress)recvfrom(13, 0x7ffd1f603790, 4096, 0, NULL, NULL) = -1 EAGAIN (Resource temporarily unavailable)epoll_wait(8, [&#123;EPOLLOUT, &#123;u32=69027488, u64=140003117975200&#125;&#125;], 512, 20000) = 1getsockopt(15, SOL_SOCKET, SO_ERROR, [0], [4]) = 0writev(15, [&#123;\"GET /?key=testxxxx HTTP/1.0\\r\\nHos\"..., 219&#125;], 1) = 219epoll_wait(8, [&#123;EPOLLIN|EPOLLOUT, &#123;u32=69027488, u64=140003117975200&#125;&#125;], 512, 60000) = 1recvfrom(15, \"HTTP/1.1 200 OK\\r\\nContent-Type: t\"..., 3723, 0, NULL, NULL) = 3723close(14) = 0readv(15, [&#123;\"a.qnssl.com/images/265818/Fntncr\"..., 4096&#125;], 1) = 4096readv(15, [&#123;\"w-card-price&#123;color: #004aa0;&#125;.s-\"..., 4096&#125;], 1) = 4096readv(15, [&#123;\" &#123;\\n font-family: \\\"Open Sans\"..., 4096&#125;], 1) = 373open(\"/etc/nginx/china_cache/2/7d/2ac65d1f9080e2baff45a4332f9017d2.0000014052\", O_RDWR|O_CREAT|O_EXCL, 0600) = 14pwritev(14, [&#123;\"\\5\\0\\0\\0\\0\\0\\0\\0\\356\\254M[\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\"..., 4096&#125;, &#123;\"a.qnssl.com/images/265818/Fntncr\"..., 4096&#125;, &#123;\"w-card-price&#123;color: #004aa0;&#125;.s-\"..., 4096&#125;], 3, 0) = -1 ENOSPC (No space left on device)gettid() = 7write(4, \"2018/07/17 08:46:33 [crit] 7#7: \"..., 328) = 328close(15) = 0unlink(\"/etc/nginx/china_cache/2/7d/2ac65d1f9080e2baff45a4332f9017d2.0000014052\") = 0write(5, \"&#123; \\\"time\\\": \\\"2018-07-17T08:46:33+0\"..., 382) = 382close(14) = 0close(11) = 02.æ­£å¸¸è°ƒç”¨å †æ ˆè¿‡ç¨‹[root@iZ2ze2mzhjk3ou1vsnkthzZ rpm]# strace -p 3904 -vstrace: Process 3904 attachedepoll_wait(8, [&#123;EPOLLIN, &#123;u32=69025808, u64=140003117973520&#125;&#125;], 512, -1) = 1accept4(6, &#123;sa_family=AF_INET, sin_port=htons(59360), sin_addr=inet_addr(\"10.130.0.4\")&#125;, [16], SOCK_NONBLOCK) = 11epoll_ctl(8, EPOLL_CTL_ADD, 11, &#123;EPOLLIN|EPOLLRDHUP|EPOLLET, &#123;u32=69027248, u64=140003117974960&#125;&#125;) = 0epoll_wait(8, [&#123;EPOLLIN, &#123;u32=69027248, u64=140003117974960&#125;&#125;], 512, 60000) = 1recvfrom(11, \"GET /?key=testxxxx HTTP/1.1\\r\\nUse\"..., 1024, 0, NULL, NULL) = 88epoll_ctl(8, EPOLL_CTL_MOD, 11, &#123;EPOLLIN|EPOLLOUT|EPOLLRDHUP|EPOLLET, &#123;u32=69027248, u64=140003117974960&#125;&#125;) = 0open(\"/etc/nginx/china_cache/2/7d/2ac65d1f9080e2baff45a4332f9017d2\", O_RDONLY|O_NONBLOCK) = 14fstat(14, &#123;st_dev=makedev(253, 1), st_ino=655504, st_mode=S_IFREG|0600, st_nlink=1, st_uid=101, st_gid=101, st_blksize=4096, st_blocks=96, st_size=46750, st_atime=2018/07/17-16:14:38.127407158, st_mtime=2018/07/17-16:14:38.127407158, st_ctime=2018/07/17-16:14:38.128407161&#125;) = 0pread64(14, \"\\5\\0\\0\\0\\0\\0\\0\\0s\\245M[\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\"..., 636, 0) = 636getsockname(11, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(\"172.17.0.2\")&#125;, [16]) = 0sendto(12, \"\\210V\\1\\0\\0\\1\\0\\0\\0\\0\\0\\0\\6bobcat\\6sxldns\\3com\\0\\0\"..., 35, 0, NULL, 0) = 35sendto(12, \"\\27\\1\\1\\0\\0\\1\\0\\0\\0\\0\\0\\0\\6bobcat\\6sxldns\\3com\\0\\0\"..., 35, 0, NULL, 0) = 35epoll_wait(8, [&#123;EPOLLOUT, &#123;u32=69027248, u64=140003117974960&#125;&#125;, &#123;EPOLLIN, &#123;u32=69027728, u64=140003117975440&#125;&#125;], 512, 5000) = 2recvfrom(12, \"\\210V\\201\\200\\0\\1\\0\\3\\0\\0\\0\\0\\6bobcat\\6sxldns\\3com\\0\\0\"..., 4096, 0, NULL, NULL) = 147recvfrom(12, \"\\27\\1\\201\\200\\0\\1\\0\\1\\0\\1\\0\\0\\6bobcat\\6sxldns\\3com\\0\\0\"..., 4096, 0, NULL, NULL) = 168socket(AF_INET, SOCK_STREAM, IPPROTO_IP) = 15ioctl(15, FIONBIO, [1]) = 0epoll_ctl(8, EPOLL_CTL_ADD, 15, &#123;EPOLLIN|EPOLLOUT|EPOLLRDHUP|EPOLLET, &#123;u32=69027489, u64=140003117975201&#125;&#125;) = 0connect(15, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(\"52.80.58.42\")&#125;, 16) = -1 EINPROGRESS (Operation now in progress)recvfrom(12, 0x7ffd1f603790, 4096, 0, NULL, NULL) = -1 EAGAIN (Resource temporarily unavailable)epoll_wait(8, [&#123;EPOLLOUT, &#123;u32=69027489, u64=140003117975201&#125;&#125;], 512, 20000) = 1getsockopt(15, SOL_SOCKET, SO_ERROR, [0], [4]) = 0writev(15, [&#123;\"GET /?key=testxxxx HTTP/1.0\\r\\nHos\"..., 219&#125;], 1) = 219epoll_wait(8, [&#123;EPOLLIN|EPOLLOUT, &#123;u32=69027489, u64=140003117975201&#125;&#125;], 512, 60000) = 1recvfrom(15, \"HTTP/1.1 200 OK\\r\\nContent-Type: t\"..., 3723, 0, NULL, NULL) = 3723close(14) = 0readv(15, [&#123;\"a.qnssl.com/images/265818/Fntncr\"..., 4096&#125;], 1) = 4096readv(15, [&#123;\"w-card-price&#123;color: #004aa0;&#125;.s-\"..., 4096&#125;], 1) = 4096readv(15, [&#123;\" &#123;\\n font-family: \\\"Open Sans\"..., 4096&#125;], 1) = 2565open(\"/etc/nginx/china_cache/2/7d/2ac65d1f9080e2baff45a4332f9017d2.0000014051\", O_RDWR|O_CREAT|O_EXCL, 0600) = 14pwritev(14, [&#123;\"\\5\\0\\0\\0\\0\\0\\0\\0(\\252M[\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\"..., 4096&#125;, &#123;\"a.qnssl.com/images/265818/Fntncr\"..., 4096&#125;, &#123;\"w-card-price&#123;color: #004aa0;&#125;.s-\"..., 4096&#125;], 3, 0) = 12288writev(11, [&#123;\"HTTP/1.1 200 OK\\r\\nServer: nginx/1\"..., 321&#125;], 1) = 321sendfile(11, 14, [636] =&gt; [12288], 11652) = 11652epoll_wait(8, [&#123;EPOLLOUT, &#123;u32=69027489, u64=140003117975201&#125;&#125;], 512, 59955) = 1epoll_wait(8, [&#123;EPOLLIN|EPOLLOUT, &#123;u32=69027489, u64=140003117975201&#125;&#125;], 512, 59953) = 1readv(15, [&#123;\"rc=\\\"//nzr2ybsda.qnssl.com/images\"..., 1531&#125;, &#123;\"lass=\\\"s-nav-item\\\" target=\\\"_self\\\"\"..., 4096&#125;, &#123;\"lign: left; font-size: 160%;\\\"&gt;\\302\\240\"..., 4096&#125;, &#123;\"OQswmpPvoA0.jpg?imageMogr2/strip\"..., 4096&#125;], 4) = 10136pwritev(14, [&#123;\" &#123;\\n font-family: \\\"Open Sans\"..., 4096&#125;, &#123;\"lass=\\\"s-nav-item\\\" target=\\\"_self\\\"\"..., 4096&#125;, &#123;\"lign: left; font-size: 160%;\\\"&gt;\\302\\240\"..., 4096&#125;], 3, 12288) = 12288sendfile(11, 14, [12288] =&gt; [24576], 12288) = 12288epoll_wait(8, [&#123;EPOLLIN|EPOLLOUT, &#123;u32=69027489, u64=140003117975201&#125;&#125;], 512, 59948) = 1readv(15, [&#123;\"olor-custom1\\\"&gt;\\347\\254\\254\\344\\270\\211\\346\\226\\271\\345\"..., 3683&#125;, &#123;\"container title-group-container\\\"\"..., 4096&#125;, &#123;\";cs=srgb&amp;s=f71a6adc1e5953a52\"..., 4096&#125;, &#123;\")\\\" data-bg=\\\"//nzr2ybsda.qnssl.co\"..., 4096&#125;], 4) = 15971readv(15, [&#123;\"\\230\\263\\345\\224\\257\\346\\231\\237\\\" title=\\\"\\346\\262\\210\\351\\230\\263\\345\\224\\257\\346\\231\\237\\345\\225\\206\"..., 4096&#125;], 1) = 2853pwritev(14, [&#123;\"OQswmpPvoA0.jpg?imageMogr2/strip\"..., 4096&#125;, &#123;\"container title-group-container\\\"\"..., 4096&#125;, &#123;\";cs=srgb&amp;s=f71a6adc1e5953a52\"..., 4096&#125;, &#123;\")\\\" data-bg=\\\"//nzr2ybsda.qnssl.co\"..., 4096&#125;], 4, 24576) = 16384sendfile(11, 14, [24576] =&gt; [40960], 16384) = 16384epoll_wait(8, [&#123;EPOLLIN|EPOLLOUT, &#123;u32=69027489, u64=140003117975201&#125;&#125;], 512, 59947) = 1readv(15, [&#123;\"&lt;d\"..., 1243&#125;, &#123;\"\\232\\204\\344\\270\\232\\347\\273\\251\\344\\271\\237\\345\\234\\250\\344\\270\\215\\346\\226\\255\\346\\224\\200\\345\\215\\207\\343\\200\\202&lt;/d\"..., 4096&#125;, &#123;\"\", 4096&#125;, &#123;\"\", 4096&#125;, &#123;\"\", 4096&#125;], 5) = 2937pwritev(14, [&#123;\"\\230\\263\\345\\224\\257\\346\\231\\237\\\" title=\\\"\\346\\262\\210\\351\\230\\263\\345\\224\\257\\346\\231\\237\\345\\225\\206\"..., 4096&#125;, &#123;\"\\232\\204\\344\\270\\232\\347\\273\\251\\344\\271\\237\\345\\234\\250\\344\\270\\215\\346\\226\\255\\346\\224\\200\\345\\215\\207\\343\\200\\202&lt;/d\"..., 1694&#125;], 2, 40960) = 5790 sendfile(11, 14, [40960] =&gt; [46750], 5790) = 5790chmod(\"/etc/nginx/china_cache/2/7d/2ac65d1f9080e2baff45a4332f9017d2.0000014051\", 0600) = 0rename(\"/etc/nginx/china_cache/2/7d/2ac65d1f9080e2baff45a4332f9017d2.0000014051\", \"/etc/nginx/china_cache/2/7d/2ac65d1f9080e2baff45a4332f9017d2\") = 0fstat(14, &#123;st_dev=makedev(253, 1), st_ino=655502, st_mode=S_IFREG|0600, st_nlink=1, st_uid=101, st_gid=101, st_blksize=4096, st_blocks=96, st_size=46750, st_atime=2018/07/17-16:34:43.967698739, st_mtime=2018/07/17-16:34:43.966698736, st_ctime=2018/07/17-16:34:43.967698739&#125;) = 0close(15) = 0write(5, \"&#123; \\\"time\\\": \\\"2018-07-17T08:34:43+0\"..., 386) = 386close(14) = 0setsockopt(11, SOL_TCP, TCP_NODELAY, [1], 4) = 0epoll_wait(8, [&#123;EPOLLIN|EPOLLOUT|EPOLLRDHUP, &#123;u32=69027248, u64=140003117974960&#125;&#125;], 512, 65000) = 1recvfrom(11, \"\", 1024, 0, NULL, NULL) = 0close(11) = 0","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"},{"name":"nginx","slug":"linux/nginx","permalink":"https://www.xiemx.com/categories/linux/nginx/"},{"name":"debug","slug":"linux/nginx/debug","permalink":"https://www.xiemx.com/categories/linux/nginx/debug/"}],"tags":[{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"},{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"nginx","slug":"nginx","permalink":"https://www.xiemx.com/tags/nginx/"}],"author":"xiemx"},{"title":"TCPçŠ¶æ€æœº","slug":"tcp-state","date":"2018-01-23T03:01:20.000Z","updated":"2019-10-21T06:57:42.714Z","comments":true,"path":"/2018/01/23/tcp-state/","link":"","permalink":"https://www.xiemx.com/2018/01/23/tcp-state/","excerpt":"","text":"TCPçŠ¶æ€åˆ†æ listenï¼close syn-sent/syn-revd established fin_wait_1/close_wait fin_wait_2/last_ack time_wait/close 12345678910LISTEN ç­‰å¾…æ¥è‡ªè¿œç¨‹TCPåº”ç”¨ç¨‹åºçš„è¯·æ±‚SYN_SENT å‘é€è¿æ¥è¯·æ±‚åç­‰å¾…æ¥è‡ªè¿œç¨‹ç«¯ç‚¹çš„ç¡®è®¤ã€‚TCPç¬¬ä¸€æ¬¡æ¡æ‰‹åå®¢æˆ·ç«¯æ‰€å¤„çš„çŠ¶æ€SYN-RECEIVED è¯¥ç«¯ç‚¹å·²ç»æ¥æ”¶åˆ°è¿æ¥è¯·æ±‚å¹¶å‘é€ç¡®è®¤ã€‚è¯¥ç«¯ç‚¹æ­£åœ¨ç­‰å¾…æœ€ç»ˆç¡®è®¤ã€‚TCPç¬¬äºŒæ¬¡æ¡æ‰‹åæœåŠ¡ç«¯æ‰€å¤„çš„çŠ¶æ€ESTABLISHED ä»£è¡¨è¿æ¥å·²ç»å»ºç«‹èµ·æ¥äº†ã€‚è¿™æ˜¯è¿æ¥æ•°æ®ä¼ è¾“é˜¶æ®µçš„æ­£å¸¸çŠ¶æ€FIN_WAIT_1 ç­‰å¾…æ¥è‡ªè¿œç¨‹TCPçš„ç»ˆæ­¢è¿æ¥è¯·æ±‚æˆ–ç»ˆæ­¢è¯·æ±‚çš„ç¡®è®¤FIN_WAIT_2 åœ¨æ­¤ç«¯ç‚¹å‘é€ç»ˆæ­¢è¿æ¥è¯·æ±‚åï¼Œç­‰å¾…æ¥è‡ªè¿œç¨‹TCPçš„è¿æ¥ç»ˆæ­¢è¯·æ±‚CLOSE_WAIT è¯¥ç«¯ç‚¹å·²ç»æ”¶åˆ°æ¥è‡ªè¿œç¨‹ç«¯ç‚¹çš„å…³é—­è¯·æ±‚ï¼Œæ­¤TCPæ­£åœ¨ç­‰å¾…æœ¬åœ°åº”ç”¨ç¨‹åºçš„è¿æ¥ç»ˆæ­¢è¯·æ±‚CLOSING ç­‰å¾…æ¥è‡ªè¿œç¨‹TCPçš„è¿æ¥ç»ˆæ­¢è¯·æ±‚ç¡®è®¤LAST_ACK ç­‰å¾…å…ˆå‰å‘é€åˆ°è¿œç¨‹TCPçš„è¿æ¥ç»ˆæ­¢è¯·æ±‚çš„ç¡®è®¤TIME_WAIT ç­‰å¾…è¶³å¤Ÿçš„æ—¶é—´æ¥ç¡®ä¿è¿œç¨‹TCPæ¥æ”¶åˆ°å…¶è¿æ¥ç»ˆæ­¢è¯·æ±‚çš„ç¡®è®¤ ä»¥ä¸Šå¤§è‡´ä¸ºä¸€ä¸ªTcpä»ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥åˆ°å››æ¬¡æŒ¥æ‰‹æ–­å¼€è¿æ¥çš„æ•´ä¸ªè¿‡ç¨‹C/Så¯¹åº”çš„TCPçŠ¶æ€ã€‚ è¯¦ç»†æµç¨‹12345678910111. å®¢æˆ·ç«¯(close)å‘é€synè¿æ¥è¯·æ±‚ç»™æœåŠ¡ç«¯(listen),å®¢æˆ·ç«¯ç­‰å¾…æœåŠ¡ç«¯ack(syn_sent)2. æœåŠ¡ç«¯æ”¶åˆ°synè¯·æ±‚,å‘é€ack/syn(syn_rec)3. å®¢æˆ·ç«¯æ”¶åˆ°ack(establelished)4. ä¼ è¾“æ•°æ®5. å®¢æˆ·ç«¯æ•°æ®äº¤äº’å®Œæˆè¯·æ±‚å…³é—­è¿æ¥ï¼Œå‘é€finè¯·æ±‚(fin_wait_1)6. æœåŠ¡ç«¯æ”¶åˆ°finè¯·æ±‚,å‘é€ack(close_wait)7. æœåŠ¡ç«¯æ•°æ®äº¤äº’å®Œæˆ,å‘é€finè¯·æ±‚å…³é—­è¿æ¥(last_ack)8. å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ackè¯·æ±‚(fin_wait_2)9. å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„finè¯·æ±‚,å‘é€ackç¡®è®¤æ–­å¼€(time_wait)10. æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ack,å…³é—­è¿æ¥(close)11. å®¢æˆ·ç«¯ç»´æŠ¤2ä¸ªmslæ—¶é—´åå›æ”¶socket å¼•ç”¨ç½‘ä¸Šçš„ä¸€å¼ å›¾ï¼š","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"tcp","slug":"tcp","permalink":"https://www.xiemx.com/tags/tcp/"}],"author":"xiemx"},{"title":"TCP TIME_WAIT","slug":"tcp-time_wait","date":"2018-01-23T02:01:21.000Z","updated":"2019-10-19T07:40:03.304Z","comments":true,"path":"/2018/01/23/tcp-time_wait/","link":"","permalink":"https://www.xiemx.com/2018/01/23/tcp-time_wait/","excerpt":"","text":"ç»´æŒTIME_WAITæœ‰ä¸¤ä¸ªåŸå› ï¼š å¯é åœ°å®ç°TCPçš„å…¨åŒå·¥è¿æ¥ç»ˆæ­¢ åœ¨å››æ¬¡æŒ¥æ‰‹ä¸­ï¼Œå‡è®¾æœ€åçš„ACKä¸¢å¤±äº†ï¼Œè¢«åŠ¨å…³é—­æ–¹ä¼šé‡å‘FINã€‚ä¸»åŠ¨å…³é—­ç«¯å¿…é¡»ç»´æŠ¤çŠ¶æ€ï¼Œæ¥å…è®¸è¢«åŠ¨å…³é—­æ–¹é‡å‘æœ€åçš„ACKï¼›å¦‚æœå®ƒæ²¡æœ‰ç»´æŠ¤è¿™ä¸ªçŠ¶æ€ï¼Œå°†ä¼šå¯¹é‡å‘FINè¿”å›RSTï¼Œè¢«åŠ¨å…³é—­æ–¹ä¼šè®¤ä¸ºè¿™æ˜¯ä¸ªé”™è¯¯ã€‚å¦‚æœTCPæ­£åœ¨æ‰§è¡Œå½»åº•ç»ˆæ­¢æ•°æ®æµçš„ä¸¤ä¸ªæ–¹å‘æ‰€éœ€çš„æ‰€æœ‰å·¥ä½œï¼ˆå³å…¨åŒå·¥å…³é—­ï¼‰ï¼Œåˆ™å¿…é¡»æ­£ç¡®å¤„ç†è¿™å››ä¸ªæ®µä¸­ä»»ä½•ä¸€ä¸ªçš„ä¸¢å¤±ã€‚æ‰€ä»¥æ‰§è¡Œä¸»åŠ¨å…³é—­çš„ä¸€æ–¹å¿…é¡»åœ¨ç»“æŸæ—¶ä¿æŒTIME_WAITçŠ¶æ€ï¼šå› ä¸ºå®ƒå¯èƒ½å¿…é¡»é‡ä¼ æœ€åçš„ACKã€‚ å…è®¸æ—§çš„é‡å¤æ•°æ®æ®µåœ¨ç½‘ç»œä¸­è¿‡æœŸ å‡è®¾åœ¨ä¸»æœº1.1.1.1çš„1111ç«¯å£å’Œ2.2.2.2çš„2222ç«¯å£ä¹‹é—´æœ‰ä¸€ä¸ªTCPè¿æ¥ã€‚æ­¤è¿æ¥å…³é—­åï¼Œç›¸åŒçš„åœ°å€å’Œç«¯å£å»ºç«‹äº†ä¸€ä¸ªæ–°è¿æ¥ã€‚ç”±äºIPåœ°å€å’Œç«¯å£ç›¸åŒï¼ŒTCPå¿…é¡»é˜²æ­¢æ—§è¿æ¥çš„æ•°æ®åŒ…å†æ¬¡å‡ºç°ï¼Œè¢«æ–°çš„è¿æ¥è¯¯æ”¶ã€‚ä¸ºæ­¤ï¼ŒTCPå°†ä¸ä¼šå¯åŠ¨å½“å‰å¤„äºTIME_WAITçŠ¶æ€çš„è¿æ¥ã€‚ç”±äºTIME_WAITçŠ¶æ€çš„æŒç»­æ—¶é—´æ˜¯ä¸¤å€çš„MSLï¼Œå› æ­¤TCPå…è®¸ä¸€ä¸ªæ–¹å‘çš„æ•°æ®åœ¨MSLç§’å†…ä¸¢å¤±ï¼Œä¹Ÿå…è®¸å›å¤åœ¨ä¸€ä¸ªMSLç§’å†…ä¸¢å¤±ã€‚é€šè¿‡æ­¤è§„åˆ™æ¥ä¿è¯å½“ä¸€ä¸ªTCPè¿æ¥æˆåŠŸå»ºç«‹æ—¶ï¼Œæ¥è‡ªå…ˆå‰è¿æ¥çš„æ‰€æœ‰æ—§çš„å‰¯æœ¬åœ¨ç½‘ç»œä¸­å·²è¿‡æœŸã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"tcp","slug":"tcp","permalink":"https://www.xiemx.com/tags/tcp/"}],"author":"xiemx"},{"title":"zabbix distrubuted monitor","slug":"zabbix-distrubuted-monitor","date":"2017-09-20T18:09:37.000Z","updated":"2019-10-21T06:57:42.570Z","comments":true,"path":"/2017/09/21/zabbix-distrubuted-monitor/","link":"","permalink":"https://www.xiemx.com/2017/09/21/zabbix-distrubuted-monitor/","excerpt":"","text":"zabbix åˆ†å¸ƒå¼ç›‘æ§2ç§æ¨¡å¼ nodeæ¨¡å¼ proxyæ¨¡å¼ PS: nodeæ¨¡å¼å®˜æ–¹åœ¨2.4ç‰ˆæœ¬ä¹‹åå·²ç»å¼ƒç”¨ï¼Œé‡ç‚¹è®¨è®ºproxyæ¨¡å¼ proxy æ¨¡å¼Zabbix proxyå¯ä»¥ä»£æ›¿ZabbixæœåŠ¡å™¨æ”¶é›†æ€§èƒ½å’Œå¯ç”¨æ€§æ•°æ®ï¼Œä¸€ä¸ªä»£ç†å¯ä»¥æ‰¿æ‹…ä¸€äº›æ”¶é›†æ•°æ®çš„è´Ÿè½½ã€‚ä½¿ç”¨ä»£ç†æ˜¯å®ç°é›†ä¸­å¼å’Œåˆ†å¸ƒå¼ç›‘æ§çš„æœ€ç®€å•æ–¹æ³•ã€‚proxyéœ€è¦ä½¿ç”¨å•ç‹¬çš„æ•°æ®åº“æ¥ç¼“å­˜agentæ•°æ®ï¼Œåœ¨å‘ç»™serveré˜²æ­¢å‡ºç°å› ç½‘ç»œé—®é¢˜é€ æˆçš„æ•°æ®ä¸¢å¤±ã€‚zabbix proxyåªæ˜¯ä¸€ä¸ªæ•°æ®æ”¶é›†ç»„ä»¶ï¼Œä¸ä¼šè§¦å‘ä»»ä½•triggerï¼alert. ä½¿ç”¨åœºæ™¯ Monitor remote locations Monitor locations having unreliable communications Offload the Zabbix server when monitoring thousands of devices Simplify the maintenance of distributed monitoring å®‰è£…é…ç½®1234567891011121314#åŒå®‰è£…zabbix server ç±»ä¼¼ï¼Œä¸èµ˜è¿°,éœ€è¦å…¶ä»–åŠŸèƒ½ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘æ—¶è‡ªè¡Œå¼€å¯ã€‚./configure --prefix=/opt/zabbix_proxy/ --enable-proxy --with-mysql --with-libcurlmake installcreate databases zabbixgrant all to zabbix.* to zabbix@'%' identified by \"zabbix\";#å¯¼å…¥schema.sql#é…ç½®æ–‡ä»¶ä¸­hostnameéœ€è¦å’Œzabbixä¸Šæ·»åŠ çš„ä¿æŒä¸€è‡´#å…¶å®ƒå‚è€ƒserverè®¾ç½®å‚æ•°#psï¼šè®¾ç½®é€‚å½“çš„é…ç½®åŒæ­¥æ—¶é—´ï¼Œé»˜è®¤ä¸€å°æ—¶ã€‚å»ºè®®è®¾ç½®çŸ­ä¸€ç‚¹ï¼Œè¿™æ ·å¦‚æœæœ‰æ–°æœºå™¨åŠ å…¥é…ç½®ä¿®æ”¹éƒ½å¯ä»¥å¿«é€ŸåŒæ­¥å¹¶ç›‘æ§ã€‚ConfigFrequency=600 zabbix server é…ç½® æ·»åŠ ä¸»æœºæ—¶é€‰æ‹©æŒ‡å®šçš„proxy","categories":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/categories/zabbix/"}],"tags":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/tags/zabbix/"}],"author":"xiemx"},{"title":"graphite_relay sharding","slug":"graphite_relay-sharding","date":"2017-09-07T22:09:47.000Z","updated":"2019-10-21T06:57:43.060Z","comments":true,"path":"/2017/09/08/graphite_relay-sharding/","link":"","permalink":"https://www.xiemx.com/2017/09/08/graphite_relay-sharding/","excerpt":"","text":"å½“statsdå‘é€è¶…é‡çš„metricsåˆ°graphiteä¸­ï¼Œgraphiteå•èŠ‚ç‚¹æ— æ³•è´Ÿè½½çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨consistent-hashingçš„æ¨¡å¼æ¥å°†æ•°æ®åˆ†ç‰‡åˆ°backendä¸­ã€‚åŒæ ·çš„consistent-hashingæ¨¡å¼ä¸‹å¯ä»¥è‡ªåŠ¨å‰”é™¤ï¼åŠ å…¥èŠ‚ç‚¹ã€‚ å®˜æ–¹æ–‡æ¡£ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657carbon-relay.py serves two distinct purposes: replication and sharding.When running with RELAY_METHOD = rules, a carbon-relay.py instance can run in place of a carbon-cache.py server and relay all incoming metrics to multiple backend carbon-cache.pyâ€˜s running on different ports or hosts.In RELAY_METHOD = consistent-hashing mode, a DESTINATIONS setting defines a sharding strategy across multiple carbon-cache.py backends. The same consistent hashing list can be provided to the graphite webapp via CARBONLINK_HOSTS to spread reads across the multiple backends.æœ¬ä¾‹æ¨¡æ‹Ÿä¸€ä¸ªåŒåç«¯çš„carbon-cache instance.å•æœºå™¨è¿è¡Œ,ä½¿ç”¨carbon-cache.py çš„instanceåŠŸèƒ½configæ–‡ä»¶ï¼š#####carbon.conf[cache:a]LINE_RECEIVER_PORT = 2203PICKLE_RECEIVER_PORT = 2204CACHE_QUERY_PORT = 7102LOCAL_DATA_DIR = /opt/graphite/storage/whisper_a/[cache:b]LINE_RECEIVER_PORT = 2205PICKLE_RECEIVER_PORT = 2206CACHE_QUERY_PORT = 7202LOCAL_DATA_DIR = /opt/graphite/storage/whisper_b/[relay]LINE_RECEIVER_INTERFACE = 0.0.0.0LINE_RECEIVER_PORT = 2003PICKLE_RECEIVER_INTERFACE = 0.0.0.0PICKLE_RECEIVER_PORT = 2004DESTINATIONS = 127.0.0.1:2204:a, 127.0.0.1:2206:b å¯åŠ¨æœåŠ¡ï¼šå¯åŠ¨instance:axmx@xiemx-test:/opt/graphisudo ./carbon-cache.py --instance=a --config=/opt/graphite/conf/carbon.conf startStarting carbon-cache (instance a)å¯åŠ¨instance:bxmx@xiemx-test:/opt/graphite/bin$ sudo ./carbon-cache.py --instance=b --config=/opt/graphite/conf/carbon.conf startStarting carbon-cache (instance b)å¯åŠ¨relay:xmx@xiemx-test:/opt/graphite/conf$ sudo /opt/graphite/bin/carbon-relay.py --debug --config=/opt/graphite/conf/carbon.conf startStarting carbon-relay (instance a)08/09/2017 16:02:16 :: [console] Using sorted write strategy for cache08/09/2017 16:02:16 :: [clients] connecting to carbon daemon at 127.0.0.1:2204:a08/09/2017 16:02:16 :: [clients] connecting to carbon daemon at 127.0.0.1:2206:b08/09/2017 16:02:16 :: [console] twistd 16.4.1 (/usr/bin/python 2.7.6) starting up.08/09/2017 16:02:16 :: [console] reactor class: twisted.internet.epollreactor.EPollReactor.08/09/2017 16:02:16 :: [console] Starting factory CarbonClientFactory(127.0.0.1:2206:b)08/09/2017 16:02:16 :: [clients] CarbonClientFactory(127.0.0.1:2206:b)::startedConnecting (127.0.0.1:2206)08/09/2017 16:02:16 :: [console] Starting factory CarbonClientFactory(127.0.0.1:2204:a)08/09/2017 16:02:16 :: [clients] CarbonClientFactory(127.0.0.1:2204:a)::startedConnecting (127.0.0.1:2204)08/09/2017 16:02:16 :: [console] CarbonReceiverFactory starting on 200308/09/2017 16:02:16 :: [console] Starting factory 08/09/2017 16:02:16 :: [console] CarbonReceiverFactory starting on 200408/09/2017 16:02:16 :: [console] Starting factory 08/09/2017 16:02:16 :: [clients] CarbonClientProtocol(127.0.0.1:2206:b)::connectionMade08/09/2017 16:02:16 :: [clients] CarbonClientFactory(127.0.0.1:2206:b)::connectionMade (CarbonClientProtocol(127.0.0.1:2206:b))08/09/2017 16:02:16 :: [clients] Destination is up: 127.0.0.1:2206:b08/09/2017 16:02:16 :: [clients] CarbonClientProtocol(127.0.0.1:2204:a)::connectionMade08/09/2017 16:02:16 :: [clients] CarbonClientFactory(127.0.0.1:2204:a)::connectionMade (CarbonClientProtocol(127.0.0.1:2204:a))08/09/2017 16:02:16 :: [clients] Destination is up: 127.0.0.1:2204:a æµ‹è¯•ï¼š æ¨¡æ‹Ÿ5ä¸ªå®¢æˆ·ç«¯åŒæ—¶å‘é€100ä¸ªkey æ¨¡æ‹Ÿnodeæ‰çº¿é‡è¿ graphite-webæ•°æ®èšåˆå±•ç¤º 12345ä¿®æ”¹local_settings.pyCARBONLINK_HOSTS = [\"127.0.0.1:7102:a\", \"127.0.0.1:7202:b\"]å¯åŠ¨djangosudo PYTHONPATH=/opt/graphite/webapp django-admin.py runserver 0.0.0.0:5000 --settings","categories":[{"name":"statsd","slug":"statsd","permalink":"https://www.xiemx.com/categories/statsd/"},{"name":"graphite","slug":"statsd/graphite","permalink":"https://www.xiemx.com/categories/statsd/graphite/"}],"tags":[],"author":"xiemx"},{"title":"statsd cluster proxy","slug":"statsd-cluster-proxy","date":"2017-09-07T21:09:37.000Z","updated":"2019-10-21T06:57:42.329Z","comments":true,"path":"/2017/09/08/statsd-cluster-proxy/","link":"","permalink":"https://www.xiemx.com/2017/09/08/statsd-cluster-proxy/","excerpt":"","text":"é€šè¿‡UDP proxyç¨‹åºå°†å‰ç«¯çš„æ•°æ®é€šè¿‡ä¸€å®šçš„hashç®—æ³•å°†ç›¸åŒçš„metricå‘é€çš„å›ºå®šçš„åaggregationæ•°æ®ã€‚proxyä»£ç†æ”¯æŒå¥åº·æ£€æµ‹è‡ªåŠ¨å‰”é™¤ï¼åŠ å…¥åç«¯statsdã€‚ 1.é…ç½®æœ¬ä¾‹å±•ç¤ºä¸€ä¸ª3èŠ‚ç‚¹çš„statsdåç«¯ä¸”å°†èšåˆæ•°æ®å‘é€åˆ°standoutæ–¹ä¾¿è§‚æµ‹ã€‚ 123456789101112node1######configæ–‡ä»¶ï¼š&#123; port: 8127, mgmt_port: 8227, backends: [ \"./backends/console\" ]&#125;å¯åŠ¨:xiemxâœ statsd : master âœ˜ :âœ¹âœ­ á… node stats.js config8127.js8 Sep 11:06:36 - [81604] reading config file: config8127.js8 Sep 11:06:36 - server is up INFO 123456789101112node2######configæ–‡ä»¶ï¼š&#123; port: 8128, mgmt_port: 8228, backends: [ \"./backends/console\" ]&#125;å¯åŠ¨ï¼šxiemxâœ statsd : master âœ˜ :âœ¹âœ­ á… node stats.js config8128.js8 Sep 11:07:09 - [81665] reading config file: config8128.js8 Sep 11:07:09 - server is up INFO 123456789101112node3######configæ–‡ä»¶ï¼š&#123; port: 8129, mgmt_port: 8229, backends: [ \"./backends/console\" ]&#125;å¯åŠ¨ï¼šxiemxâœ statsd : master âœ˜ :âœ¹âœ­ á… node stats.js config8129.js8 Sep 11:07:45 - [81723] reading config file: config8129.js8 Sep 11:07:45 - server is up INFO 12345678910111213141516171819202122proxy######configæ–‡ä»¶ï¼š&#123;nodes: [&#123;host: '127.0.0.1', port: 8127, adminport: 8227&#125;,&#123;host: '127.0.0.1', port: 8128, adminport: 8228&#125;,&#123;host: '127.0.0.1', port: 8129, adminport: 8229&#125;],server: './servers/udp',host: '0.0.0.0',port: 8125,mgmt_port: 8126,forkCount: 0,checkInterval: 1000,cacheSize: 10000,deleteIdleStats: true&#125;å¯åŠ¨ï¼šxiemxâœ statsd : master âœ˜ :âœ¹âœ­ á… node proxy.js proxyconfig.js8 Sep 11:09:02 - [81938] reading config file: proxyconfig.js8 Sep 11:09:02 - INFO: [81938] server is up æµ‹è¯•ï¼š5ä¸ªçº¿ç¨‹åŒæ—¶æ¨é€500ä¸ªmetricåˆ°ä»£ç†æŸ¥çœ‹åˆ†ç‰‡æƒ…å†µ 12æµ‹è¯•å‘½ä»¤ï¼šfor i in $(seq 1 500);do echo \"Ezbuy-$i:1|c\" | nc -u -w0 127.0.0.1 8125;done èŠ‚ç‚¹è‡ªåŠ¨å‰”é™¤å’ŒåŠ å…¥ï¼š","categories":[{"name":"statsd","slug":"statsd","permalink":"https://www.xiemx.com/categories/statsd/"},{"name":"graphite","slug":"statsd/graphite","permalink":"https://www.xiemx.com/categories/statsd/graphite/"}],"tags":[{"name":"database","slug":"database","permalink":"https://www.xiemx.com/tags/database/"},{"name":"statsd","slug":"statsd","permalink":"https://www.xiemx.com/tags/statsd/"},{"name":"graphite","slug":"graphite","permalink":"https://www.xiemx.com/tags/graphite/"},{"name":"monitor","slug":"monitor","permalink":"https://www.xiemx.com/tags/monitor/"}],"author":"xiemx"},{"title":"redis æ·˜æ±°ç­–ç•¥","slug":"redis-maxmemory-policy","date":"2017-07-14T02:07:44.000Z","updated":"2019-10-19T09:11:22.213Z","comments":true,"path":"/2017/07/14/redis-maxmemory-policy/","link":"","permalink":"https://www.xiemx.com/2017/07/14/redis-maxmemory-policy/","excerpt":"","text":"redis å†…å­˜æ•°æ®ä½¿ç”¨åˆ°maxmemoryçš„æ—¶å€™ï¼Œå°±ä¼šæ ¹æ®maxmemory_policyè®¾å®šçš„æ·˜æ±°ç­–ç•¥è¿›è¡Œå†…å­˜æ•´ç†æ•°æ®å›æ”¶ã€‚é€‰æ‹©ä¸åŒçš„ç­–ç•¥ï¼Œè¦æ ¹æ®redisçš„ç”¨é€”æ¥åŒºåˆ†ã€‚ redis æä¾› 6ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š volatile-lruï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° volatile-ttlï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±° volatile-randomï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±° allkeys-lruï¼šä»æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° allkeys-randomï¼šä»æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±° noenvictionï¼šç¦æ­¢åˆ é™¤æ•°æ®","categories":[{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/categories/redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/tags/redis/"}],"author":"xiemx"},{"title":"iptables countè®¡æ•°","slug":"iptables-count","date":"2017-04-10T21:04:23.000Z","updated":"2019-10-21T06:57:42.886Z","comments":true,"path":"/2017/04/11/iptables-count/","link":"","permalink":"https://www.xiemx.com/2017/04/11/iptables-count/","excerpt":"","text":"123456789101112131415161718192021222324252627282930313233343536373839404142434445ä¸¤ä¸ªå‚æ•°ï¼š --verbose -v verbose mode --zero -Z [chain [rulenum]] Zero counters in chain or all chainsp-hsg-cache-6% sudo iptables -nL -v -t natChain PREROUTING (policy ACCEPT 50741 packets, 2370K bytes) pkts bytes target prot opt in out source destination 436 22672 DNAT tcp -- * * 0.0.0.0/0 192.168.10.226 tcp dpt:6379 to:192.168.10.82:6379 0 0 DNAT tcp -- * * 0.0.0.0/0 192.168.10.226 tcp dpt:6380 to:192.168.10.81:6380 0 0 DNAT tcp -- * * 0.0.0.0/0 192.168.10.226 tcp dpt:6381 to:192.168.10.81:6381 0 0 DNAT tcp -- * * 0.0.0.0/0 192.168.10.226 tcp dpt:6382 to:192.168.10.81:6382 0 0 DNAT tcp -- * * 0.0.0.0/0 192.168.10.226 tcp dpt:6383 to:192.168.10.81:6383Chain INPUT (policy ACCEPT 18988 packets, 1082K bytes) pkts bytes target prot opt in out source destinationChain OUTPUT (policy ACCEPT 10532 packets, 549K bytes) pkts bytes target prot opt in out source destinationChain POSTROUTING (policy ACCEPT 0 packets, 0 bytes) pkts bytes target prot opt in out source destination10968 572K MASQUERADE all -- * * 0.0.0.0/0 0.0.0.0/0p-hsg-cache-6% sudo iptables -Z -t natp-hsg-cache-6% sudo iptables -nL -v -t natChain PREROUTING (policy ACCEPT 12 packets, 624 bytes) pkts bytes target prot opt in out source destination 1 52 DNAT tcp -- * * 0.0.0.0/0 192.168.10.226 tcp dpt:6379 to:192.168.10.82:6379 0 0 DNAT tcp -- * * 0.0.0.0/0 192.168.10.226 tcp dpt:6380 to:192.168.10.81:6380 0 0 DNAT tcp -- * * 0.0.0.0/0 192.168.10.226 tcp dpt:6381 to:192.168.10.81:6381 0 0 DNAT tcp -- * * 0.0.0.0/0 192.168.10.226 tcp dpt:6382 to:192.168.10.81:6382 0 0 DNAT tcp -- * * 0.0.0.0/0 192.168.10.226 tcp dpt:6383 to:192.168.10.81:6383Chain INPUT (policy ACCEPT 12 packets, 624 bytes) pkts bytes target prot opt in out source destinationChain OUTPUT (policy ACCEPT 6 packets, 312 bytes) pkts bytes target prot opt in out source destinationChain POSTROUTING (policy ACCEPT 0 packets, 0 bytes) pkts bytes target prot opt in out source destination 7 364 MASQUERADE all -- * * 0.0.0.0/0 0.0.0.0/0p-hsg-cache-6%","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"iptables","slug":"iptables","permalink":"https://www.xiemx.com/tags/iptables/"}],"author":"xiemx"},{"title":"iiså¤‡ä»½è¿˜åŸ","slug":"iis-backup-restore","date":"2017-03-31T02:03:43.000Z","updated":"2019-10-21T06:57:43.060Z","comments":true,"path":"/2017/03/31/iis-backup-restore/","link":"","permalink":"https://www.xiemx.com/2017/03/31/iis-backup-restore/","excerpt":"","text":"æ‰“å¼€æˆ‘ä»¬çš„IISç®¡ç†å™¨ï¼Œåœ¨åŠŸèƒ½è§†å›¾é‡Œæ‰¾åˆ°å…±äº«çš„é…ç½®è¿™ä¸ªåŠŸèƒ½ç„¶ååŒå‡»è¿›å…¥ã€‚ è¿›å…¥åå•æœºå³ä¸Šæ–¹çš„â€œå¯¼å‡ºé…ç½®â€é€‰é¡¹ï¼Œé€‰æ‹©å¯¼å‡ºé…ç½®æ–‡ä»¶çš„ç‰©ç†è·¯å¾„ï¼Œç„¶åè®¾ç½®ä¸€ä¸ªå¯†ç ï¼Œå¯†ç å¿…é¡»æ˜¯åŒ…å«æ•°å­—ã€ç¬¦å·ã€å¤§å°å†™å­—æ¯ç»„åˆå¹¶ä¸”è‡³å°‘ä¸º8ä¸ªå­—ç¬¦é•¿çš„å¼ºå¯†ç ï¼Œç¡®å®šå¯¼å‡ºåä¼šåœ¨ä½ å¯¼å‡ºé…ç½®æ–‡ä»¶ç›®å½•ä¸‹ç”Ÿæˆadministration.configã€applicationHost.configå’ŒconfigEncKey.keyå…±3ä¸ªæ–‡ä»¶ï¼Œè¿™3ä¸ªæ–‡ä»¶å°±æ˜¯æˆ‘ä»¬å¤‡ä»½çš„IISç«™ç‚¹é…ç½®ä¿¡æ¯æ–‡ä»¶ã€‚ ç°åœ¨æ˜¯è¿˜åŸIISçš„é…ç½®ä¿¡æ¯ï¼Œé¦–å…ˆå°†ä½ å¯¼å‡ºåçš„administration.configã€applicationHost.configå’ŒconfigEncKey.keyè¿™ä¸ª3ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°ä½ éœ€è¦æ¢å¤IISé…ç½®ä¿¡æ¯çš„ç”µè„‘æˆ–æœåŠ¡å™¨ä¸Šï¼Œç„¶åæ‰“å¼€IISï¼ŒåŒæ ·åœ¨åŠŸèƒ½è§†å›¾é‡Œæ‰¾åˆ°â€œå…±äº«çš„é…ç½®â€å¹¶æ‰“å¼€ã€‚ æŠŠâ€œå¯ç”¨å…±äº«çš„é…ç½®â€å‹¾é€‰ä¸Šï¼Œç‰©ç†è·¯å¾„å°±é€‰æ‹©ä½ å¤‡ä»½çš„æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œç”¨æˆ·åã€å¯†ç è¾“å…¥æ¡†éƒ½ä¸éœ€è¦å¡«å†™ï¼Œç›´æ¥ç‚¹å‡»å³ä¸Šæ–¹çš„åº”ç”¨ï¼Œç„¶åå®ƒè¦ä½ è¾“å…¥å¯†ç ï¼Œç¡®å®šåé‡å¯ä¸‹æˆ‘ä»¬çš„IIS å°±å¯ä»¥çœ‹åˆ°ä»¥å‰çš„ç«™ç‚¹ä¿¡æ¯éƒ½è¿˜åŸäº†ã€‚","categories":[{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/categories/windows/"},{"name":"iis","slug":"windows/iis","permalink":"https://www.xiemx.com/categories/windows/iis/"}],"tags":[{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"},{"name":"iis","slug":"iis","permalink":"https://www.xiemx.com/tags/iis/"},{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/tags/windows/"}],"author":"xiemx"},{"title":"è¿›ç¨‹çŠ¶æ€","slug":"linux-process-status","date":"2017-03-29T02:03:05.000Z","updated":"2019-10-21T06:57:42.805Z","comments":true,"path":"/2017/03/29/linux-process-status/","link":"","permalink":"https://www.xiemx.com/2017/03/29/linux-process-status/","excerpt":"","text":"123456789101112131415D ä¸èƒ½ä¸­æ–­çš„è¿›ç¨‹ï¼ˆé€šå¸¸ä¸ºIOï¼‰R æ­£åœ¨è¿è¡Œä¸­çš„è¿›ç¨‹S å·²ç»ä¸­æ–­çš„è¿›ç¨‹ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¸­å¤§éƒ¨åˆ†è¿›ç¨‹éƒ½æ˜¯è¿™ä¸ªçŠ¶æ€T å·²ç»åœæ­¢æˆ–è€…æš‚åœçš„è¿›ç¨‹ï¼Œå¦‚æœæˆ‘ä»¬æ­£åœ¨è¿è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œæ¯”å¦‚è¯´sleep 10ï¼Œå¦‚æœæˆ‘ä»¬æŒ‰ä¸€ä¸‹ctrl -z è®©ä»–æš‚åœï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨psæŸ¥çœ‹å°±ä¼šæ˜¾ç¤ºTè¿™ä¸ªçŠ¶æ€W è¿™ä¸ªå¥½åƒæ˜¯è¯´ï¼Œä»å†…æ ¸2.6xx ä»¥åï¼Œè¡¨ç¤ºä¸ºæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜é¡µåˆ†é…X å·²ç»æ­»æ‰çš„è¿›ç¨‹ï¼ˆè¿™ä¸ªå¥½åƒä»æ¥ä¸ä¼šå‡ºç°ï¼‰Z åƒµå°¸è¿›ç¨‹ä¸‹é¢ä¸€äº›æ˜¯BSDé£æ ¼çš„å‚æ•°&lt; é«˜ä¼˜å…ˆçº§è¿›ç¨‹N ä½ä¼˜å…ˆçº§è¿›ç¨‹L åœ¨å†…å­˜ä¸­è¢«é”äº†å†…å­˜åˆ†é¡µs ä¸»è¿›ç¨‹l å¤šçº¿ç¨‹è¿›ç¨‹+ ä»£è¡¨åœ¨å‰å°è¿è¡Œçš„è¿›ç¨‹","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"redis repl_diskless_replication","slug":"redis-repl_diskless_replication","date":"2017-03-05T20:03:55.000Z","updated":"2019-10-21T06:57:42.620Z","comments":true,"path":"/2017/03/06/redis-repl_diskless_replication/","link":"","permalink":"https://www.xiemx.com/2017/03/06/redis-repl_diskless_replication/","excerpt":"","text":"redis diskless replication 12345678910111213141516171819202122232425262728293031# Replicationrole:slavemaster_host:192.168.10.226master_port:6379master_link_status:downmaster_last_io_seconds_ago:-1master_sync_in_progress:1slave_repl_offset:1master_sync_left_bytes:-4022404224master_sync_last_io_seconds_ago:37master_link_down_since_seconds:1488785860slave_priority:100slave_read_only:1connected_slaves:0master_repl_offset:0repl_backlog_active:0repl_backlog_size:1048576repl_backlog_first_byte_offset:0repl_backlog_histlen:0# Replicationrole:masterconnected_slaves:2slave0:ip=192.168.10.192,port=6379,state=online,offset=1134556373255,lag=1slave1:ip=192.168.10.82,port=6379,state=wait_bgsave,offset=0,lag=0master_repl_offset:1134556812751repl_backlog_active:1repl_backlog_size:1048576repl_backlog_first_byte_offset:1134555764176repl_backlog_histlen:1048576 1234567891011121314151617181920212223246581:C 06 Mar 15:28:27.766 * DB saved on disk26581:C 06 Mar 15:28:27.990 * RDB: 212 MB of memory used by copy-on-write2251:M 06 Mar 15:28:28.379 * Background saving terminated with success2251:M 06 Mar 15:29:08.687 * Synchronization with slave 192.168.10.82:6379 succeeded2251:M 06 Mar 15:29:47.093 # Client id=314558845 addr=192.168.10.82:58002 fd=16 name= age=194 idle=1 flags=S db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=3617 omem=95797745 events=rw cmd=psync scheduled to be closed ASAP for overcoming of output buffer limits.2251:M 06 Mar 15:29:47.093 # Connection with slave 192.168.10.82:6379 lost.2251:M 06 Mar 15:30:15.999 * Slave 192.168.10.82:6379 asks for synchronization2251:M 06 Mar 15:30:15.999 * Unable to partial resync with slave 192.168.10.82:6379 for lack of backlog (Slave request was: 1134354232038).2251:M 06 Mar 15:30:15.999 * Starting BGSAVE for SYNC with target: disk2251:M 06 Mar 15:30:16.232 * Background saving started by pid 3049430494:C 06 Mar 15:31:52.413 * DB saved on disk30494:C 06 Mar 15:31:52.597 * RDB: 223 MB of memory used by copy-on-write2251:M 06 Mar 15:31:52.950 * Background saving terminated with success2251:M 06 Mar 15:32:33.375 * Synchronization with slave 192.168.10.82:6379 succeeded2251:M 06 Mar 15:33:08.106 # Client id=314561307 addr=192.168.10.82:38644 fd=16 name= age=173 idle=1 flags=S db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=4325 omem=102199438 events=rw cmd=psync scheduled to be closed ASAP for overcoming of output buffer limits.2251:M 06 Mar 15:33:08.106 # Connection with slave 192.168.10.82:6379 lost.2251:M 06 Mar 15:33:40.471 * Slave 192.168.10.82:6379 asks for synchronization2251:M 06 Mar 15:33:40.471 * Unable to partial resync with slave 192.168.10.82:6379 for lack of backlog (Slave request was: 1134453799057).2251:M 06 Mar 15:33:40.471 * Starting BGSAVE for SYNC with target: disk2251:M 06 Mar 15:33:40.715 * Background saving started by pid 14402251:M 06 Mar 15:35:14.354 # Connection with slave 192.168.10.82:6379 lost.1440:C 06 Mar 15:35:20.564 * DB saved on disk1440:C 06 Mar 15:35:20.743 * RDB: 296 MB of memory used by copy-on-write2251:M 06 Mar 15:35:21.013 * Background saving terminated with success åŸç†åˆ†æå¦‚æœè®¾ç½®äº†ä¸€ä¸ªslaveï¼Œä¸ç®¡æ˜¯åœ¨ç¬¬ä¸€æ¬¡é“¾æ¥è¿˜æ˜¯é‡æ–°é“¾æ¥masterçš„æ—¶å€™ï¼Œslaveä¼šå‘é€ä¸€ä¸ªåŒæ­¥å‘½ä»¤ç„¶åmasterå¼€å§‹åå°ä¿å­˜ï¼Œæ”¶é›†æ‰€æœ‰å¯¹ä¿®æ”¹æ•°æ®çš„å‘½ä»¤ã€‚å½“åå°ä¿å­˜å®Œæˆï¼Œmasterä¼šå°†è¿™ä¸ªæ•°æ®æ–‡ä»¶ä¼ é€åˆ°slaveï¼Œç„¶åä¿å­˜åœ¨ç£ç›˜ï¼ŒåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œmasteræ¥ç€å‘é€æ”¶é›†åˆ°çš„æ‰€æœ‰çš„ä¿®æ”¹æ•°æ®çš„å‘½ä»¤ã€‚ Redisä¸ºé¿å…è¾“å‡ºç¼“å†²åŒºè¿‡åº¦è€—ç”¨å†…å­˜ï¼Œä½¿ç”¨client-output-buffer-limitå‚æ•°é™åˆ¶å®¢æˆ·ç«¯è¾“å‡ºç¼“å†²åŒºå†…å­˜ä½¿ç”¨é‡ã€‚Redisæ•°æ®å¤åˆ¶è¿‡ç¨‹ä¸­ï¼ŒSlaveæœ‰ä¸ªflags=Sçš„å®¢æˆ·ç«¯è¿æ¥åˆ°Master; å®ƒå’Œå…¶ä»–å®¢æˆ·ç«¯ä¸€æ ·æœ‰è¾“å‡ºç¼“å†²åŒºå’Œç¼“å†²åŒºå¤§å°é™åˆ¶ã€‚client-output-buffer-limit slave 256mb 64mb 60å½“ç¼“å†²åŒºä½¿ç”¨è¶…è¿‡256mb,Masterä¼šå°½å¿«æ€æ‰å®ƒï¼›å½“ç¼“å†²åŒºä½¿ç”¨å¤§äº64mb,ä¸”å°äº256mbçš„soft limitå€¼æ—¶ï¼Œå¹¶æŒç»­æ—¶é—´è¾¾60ç§’ï¼Œä¹Ÿä¼šè¢«Masterå°½å¿«æ€æ‰ã€‚ é€šè¿‡ä»¥ä¸Šçš„åŸç†åˆ†ææˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªè§£å†³æ–¹æ³•ï¼šæ‰©å¤§bufferå’Œtimeoutï¼Œä½†å¯¹äºä¸€ä¸ªæ•°æ®é‡æ¯”è¾ƒå¤§çš„dbä¸”æœåŠ¡å™¨æœ¬èº«å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹ã€‚æˆ‘ä»¬å¯ä»¥é‡‡ç”¨diskless replicationï¼Œç›´æ¥é€šè¿‡ç½‘ç»œå°†æ•°æ®æ›´æ–°è¿‡å»ï¼Œä¸å†è®©æœåŠ¡å™¨å»åŒæ­¥åˆ°diskå†ä»diskè¾“å‡ºåˆ°å†…å­˜å¯¼è‡´outputæŠ¥é”™ è§£å†³å¼€å¯redis diskless replication 123127.0.0.1:6379&gt; CONFIG set repl-diskless-sync yesOK(1.97s) 1234567891011121314152251:M 06 Mar 15:35:34.896 * Slave 192.168.10.82:6379 asks for synchronization2251:M 06 Mar 15:35:34.896 * Full resync requested by slave 192.168.10.82:63792251:M 06 Mar 15:35:34.896 * Delay next BGSAVE for SYNC2251:M 06 Mar 15:35:40.203 * Starting BGSAVE for SYNC with target: slaves sockets2251:M 06 Mar 15:35:40.469 * Background RDB transfer started by pid 33513351:C 06 Mar 15:37:03.206 * RDB: 233 MB of memory used by copy-on-write2251:M 06 Mar 15:37:03.473 * Background RDB transfer terminated with success2251:M 06 Mar 15:37:03.473 # Slave 192.168.10.82:6379 correctly received the streamed RDB file.2251:M 06 Mar 15:37:03.473 * Streamed RDB transfer with slave 192.168.10.82:6379 succeeded (socket). Waiting for REPLCONF ACK from slave to enable streaming2251:M 06 Mar 15:37:24.848 * 50000 changes in 60 seconds. Saving...2251:M 06 Mar 15:37:25.097 * Background saving started by pid 59162251:M 06 Mar 15:38:10.510 * Synchronization with slave 192.168.10.82:6379 succeeded5916:C 06 Mar 15:39:06.535 * DB saved on disk5916:C 06 Mar 15:39:06.742 * RDB: 250 MB of memory used by copy-on-write2251:M 06 Mar 15:39:07.093 * Background saving terminated with success 123456789101112131415161718192021222324252627# Replicationrole:slavemaster_host:192.168.10.226master_port:6379master_link_status:upmaster_last_io_seconds_ago:1master_sync_in_progress:0slave_repl_offset:1134697190334slave_priority:100slave_read_only:1connected_slaves:0master_repl_offset:0repl_backlog_active:0repl_backlog_size:1048576repl_backlog_first_byte_offset:0repl_backlog_histlen:0# Replicationrole:masterconnected_slaves:2slave0:ip=192.168.10.192,port=6379,state=online,offset=1135553694283,lag=1slave1:ip=192.168.10.82,port=6379,state=online,offset=1135553653727,lag=1master_repl_offset:1135554186742repl_backlog_active:1repl_backlog_size:1048576repl_backlog_first_byte_offset:1135553138167repl_backlog_histlen:1048576","categories":[{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/categories/redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/tags/redis/"}],"author":"xiemx"},{"title":"redis-trib.rbå·¥å…·ä½¿ç”¨","slug":"redis-trib-rb","date":"2017-02-26T21:02:35.000Z","updated":"2019-10-21T06:57:42.989Z","comments":true,"path":"/2017/02/27/redis-trib-rb/","link":"","permalink":"https://www.xiemx.com/2017/02/27/redis-trib-rb/","excerpt":"","text":"redis-trib.rbæ˜¯rediså®˜æ–¹æ¨å‡ºçš„ç®¡ç†redisé›†ç¾¤çš„å·¥å…·ï¼Œé›†æˆåœ¨redisçš„æºç srcç›®å½•ä¸‹ï¼Œæ˜¯åŸºäºredisæä¾›çš„é›†ç¾¤å‘½ä»¤å°è£…æˆç®€å•ã€ä¾¿æ·ã€å®ç”¨çš„æ“ä½œå·¥å…·ã€‚redis-trib.rbæ˜¯redisä½œè€…ç”¨rubyå®Œæˆçš„ã€‚ 12345678910111213141516171819202122232425262728293031323334353637root@p-hsg-redis-1:~# redis-trib.rbUsage: redis-trib create host1:port1 ... hostN:portN --replicas check host:port info host:port fix host:port --timeout reshard host:port --from --to --slots --yes --timeout --pipeline rebalance host:port --weight --auto-weights --use-empty-masters --timeout --simulate --pipeline --threshold add-node new_host:new_port existing_host:existing_port --slave --master-id del-node host:port node_id set-timeout host:port milliseconds call host:port command arg arg .. arg import host:port --from --copy --replace help (show this help)For check, fix, reshard, del-node, set-timeout you can specify the host and port of any working node in the cluster. å¯ä»¥çœ‹åˆ°redis-trib.rbå…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š createï¼šåˆ›å»ºé›†ç¾¤ checkï¼šæ£€æŸ¥é›†ç¾¤ infoï¼šæŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ fixï¼šä¿®å¤é›†ç¾¤ reshardï¼šåœ¨çº¿è¿ç§»slot rebalanceï¼šå¹³è¡¡é›†ç¾¤èŠ‚ç‚¹slotæ•°é‡ add-nodeï¼šå°†æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ del-nodeï¼šä»é›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹ set-timeoutï¼šè®¾ç½®é›†ç¾¤èŠ‚ç‚¹é—´å¿ƒè·³è¿æ¥çš„è¶…æ—¶æ—¶é—´ callï¼šåœ¨é›†ç¾¤å…¨éƒ¨èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤ importï¼šå°†å¤–éƒ¨redisæ•°æ®å¯¼å…¥é›†ç¾¤ createåˆ›å»ºé›†ç¾¤createå‘½ä»¤å¯é€‰replicaså‚æ•°ï¼Œreplicasè¡¨ç¤ºéœ€è¦æœ‰å‡ ä¸ªslaveã€‚æœ€ç®€å•å‘½ä»¤ä½¿ç”¨å¦‚ä¸‹ï¼š 1$ruby redis-trib.rb create 10.180.157.199:6379 10.180.157.200:6379 10.180.157.201:6379 æœ‰ä¸€ä¸ªslaveçš„åˆ›å»ºå‘½ä»¤å¦‚ä¸‹ï¼š 1$ruby redis-trib.rb create --replicas 1 10.180.157.199:6379 10.180.157.200:6379 10.180.157.201:6379 10.180.157.202:6379 10.180.157.205:6379 10.180.157.208:6379 åˆ›å»ºæµç¨‹å¦‚ä¸‹ï¼š 123456789101112131415161718191ã€é¦–å…ˆä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºClusterNodeå¯¹è±¡ï¼ŒåŒ…æ‹¬è¿æ¥æ¯ä¸ªèŠ‚ç‚¹ã€‚æ£€æŸ¥æ¯ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºç‹¬ç«‹ä¸”dbä¸ºç©ºçš„èŠ‚ç‚¹ã€‚æ‰§è¡Œload_infoæ–¹æ³•å¯¼å…¥èŠ‚ç‚¹ä¿¡æ¯ã€‚2ã€æ£€æŸ¥ä¼ å…¥çš„masterèŠ‚ç‚¹æ•°é‡æ˜¯å¦å¤§äºç­‰äº3ä¸ªã€‚åªæœ‰å¤§äº3ä¸ªèŠ‚ç‚¹æ‰èƒ½ç»„æˆé›†ç¾¤ã€‚3ã€è®¡ç®—æ¯ä¸ªmasteréœ€è¦åˆ†é…çš„slotæ•°é‡ï¼Œä»¥åŠç»™masteråˆ†é…slaveã€‚åˆ†é…çš„ç®—æ³•å¤§è‡´å¦‚ä¸‹ï¼šå…ˆæŠŠèŠ‚ç‚¹æŒ‰ç…§hoståˆ†ç±»ï¼Œè¿™æ ·ä¿è¯masterèŠ‚ç‚¹èƒ½åˆ†é…åˆ°æ›´å¤šçš„ä¸»æœºä¸­ã€‚ä¸åœéå†éå†hoståˆ—è¡¨ï¼Œä»æ¯ä¸ªhoståˆ—è¡¨ä¸­å¼¹å‡ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ”¾å…¥interleavedæ•°ç»„ã€‚ç›´åˆ°æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å¼¹å‡ºä¸ºæ­¢ã€‚masterèŠ‚ç‚¹åˆ—è¡¨å°±æ˜¯interleavedå‰é¢çš„masteræ•°é‡çš„èŠ‚ç‚¹åˆ—è¡¨ã€‚ä¿å­˜åœ¨mastersæ•°ç»„ã€‚è®¡ç®—æ¯ä¸ªmasterèŠ‚ç‚¹è´Ÿè´£çš„slotæ•°é‡ï¼Œä¿å­˜åœ¨slots_per_nodeå¯¹è±¡ï¼Œç”¨slotæ€»æ•°é™¤ä»¥masteræ•°é‡å–æ•´å³å¯ã€‚éå†mastersæ•°ç»„ï¼Œæ¯ä¸ªmasteråˆ†é…slots_per_nodeä¸ªslotï¼Œæœ€åä¸€ä¸ªmasterï¼Œåˆ†é…åˆ°16384ä¸ªslotä¸ºæ­¢ã€‚æ¥ä¸‹æ¥ä¸ºmasteråˆ†é…slaveï¼Œåˆ†é…ç®—æ³•ä¼šå°½é‡ä¿è¯masterå’ŒslaveèŠ‚ç‚¹ä¸åœ¨åŒä¸€å°ä¸»æœºä¸Šã€‚å¯¹äºåˆ†é…å®ŒæŒ‡å®šslaveæ•°é‡çš„èŠ‚ç‚¹ï¼Œè¿˜æœ‰å¤šä½™çš„èŠ‚ç‚¹ï¼Œä¹Ÿä¼šä¸ºè¿™äº›èŠ‚ç‚¹å¯»æ‰¾masterã€‚åˆ†é…ç®—æ³•ä¼šéå†ä¸¤æ¬¡mastersæ•°ç»„ã€‚ç¬¬ä¸€æ¬¡éå†mastersæ•°ç»„ï¼Œåœ¨ä½™ä¸‹çš„èŠ‚ç‚¹åˆ—è¡¨æ‰¾åˆ°replicasæ•°é‡ä¸ªslaveã€‚æ¯ä¸ªslaveä¸ºç¬¬ä¸€ä¸ªå’ŒmasterèŠ‚ç‚¹hostä¸ä¸€æ ·çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰ä¸ä¸€æ ·çš„èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥å–å‡ºä½™ä¸‹åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ç¬¬äºŒæ¬¡éå†æ˜¯åœ¨å¯¹äºèŠ‚ç‚¹æ•°é™¤ä»¥replicasä¸ä¸ºæ•´æ•°ï¼Œåˆ™ä¼šå¤šä½™ä¸€éƒ¨åˆ†èŠ‚ç‚¹ã€‚éå†çš„æ–¹å¼è·Ÿç¬¬ä¸€æ¬¡ä¸€æ ·ï¼Œåªæ˜¯ç¬¬ä¸€æ¬¡ä¼šä¸€æ¬¡æ€§ç»™masteråˆ†é…replicasæ•°é‡ä¸ªslaveï¼Œè€Œç¬¬äºŒæ¬¡éå†åªåˆ†é…ä¸€ä¸ªï¼Œç›´åˆ°ä½™ä¸‹çš„èŠ‚ç‚¹è¢«å…¨éƒ¨åˆ†é…å‡ºå»ã€‚4ã€æ‰“å°å‡ºåˆ†é…ä¿¡æ¯ï¼Œå¹¶æç¤ºç”¨æˆ·è¾“å…¥â€œyesâ€ç¡®è®¤æ˜¯å¦æŒ‰ç…§æ‰“å°å‡ºæ¥çš„åˆ†é…æ–¹å¼åˆ›å»ºé›†ç¾¤ã€‚5ã€è¾“å…¥â€œyesâ€åï¼Œä¼šæ‰§è¡Œflush_nodes_configæ“ä½œï¼Œè¯¥æ“ä½œæ‰§è¡Œå‰é¢çš„åˆ†é…ç»“æœï¼Œç»™masteråˆ†é…slotï¼Œè®©slaveå¤åˆ¶masterï¼Œå¯¹äºè¿˜æ²¡æœ‰æ¡æ‰‹ï¼ˆcluster meetï¼‰çš„èŠ‚ç‚¹ï¼Œslaveå¤åˆ¶æ“ä½œæ— æ³•å®Œæˆï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œflush_nodes_configæ“ä½œå‡ºç°å¼‚å¸¸ä¼šå¾ˆå¿«è¿”å›ï¼Œåç»­æ¡æ‰‹åä¼šå†æ¬¡æ‰§è¡Œflush_nodes_configã€‚6ã€ç»™æ¯ä¸ªèŠ‚ç‚¹åˆ†é…epochï¼Œéå†èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹åˆ†é…çš„epochæ¯”ä¹‹å‰èŠ‚ç‚¹å¤§1ã€‚7ã€èŠ‚ç‚¹é—´å¼€å§‹ç›¸äº’æ¡æ‰‹ï¼Œæ¡æ‰‹çš„æ–¹å¼ä¸ºèŠ‚ç‚¹åˆ—è¡¨çš„å…¶ä»–èŠ‚ç‚¹è·Ÿç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ¡æ‰‹ã€‚8ã€ç„¶åæ¯éš”1ç§’æ£€æŸ¥ä¸€æ¬¡å„ä¸ªèŠ‚ç‚¹æ˜¯å¦å·²ç»æ¶ˆæ¯åŒæ­¥å®Œæˆï¼Œä½¿ç”¨ClusterNodeçš„get_config_signatureæ–¹æ³•ï¼Œæ£€æŸ¥çš„ç®—æ³•ä¸ºè·å–æ¯ä¸ªèŠ‚ç‚¹cluster nodesä¿¡æ¯ï¼Œæ’åºæ¯ä¸ªèŠ‚ç‚¹ï¼Œç»„è£…æˆnode_id1:slots|node_id2:slot2|...çš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ¯ä¸ªèŠ‚ç‚¹è·å¾—å­—ç¬¦ä¸²éƒ½ç›¸åŒï¼Œå³è®¤ä¸ºæ¡æ‰‹æˆåŠŸã€‚9ã€æ­¤åä¼šå†æ‰§è¡Œä¸€æ¬¡flush_nodes_configï¼Œè¿™æ¬¡ä¸»è¦æ˜¯ä¸ºäº†å®Œæˆslaveå¤åˆ¶æ“ä½œã€‚10ã€æœ€åå†æ‰§è¡Œcheck_clusterï¼Œå…¨é¢æ£€æŸ¥ä¸€æ¬¡é›†ç¾¤çŠ¶æ€ã€‚åŒ…æ‹¬å’Œå‰é¢æ¡æ‰‹æ—¶æ£€æŸ¥ä¸€æ ·çš„æ–¹å¼å†æ£€æŸ¥ä¸€éã€‚ç¡®è®¤æ²¡æœ‰è¿ç§»çš„èŠ‚ç‚¹ã€‚ç¡®è®¤æ‰€æœ‰çš„slotéƒ½è¢«åˆ†é…å‡ºå»äº†ã€‚11ã€è‡³æ­¤å®Œæˆäº†æ•´ä¸ªåˆ›å»ºæµç¨‹ï¼Œè¿”å›[OK] All 16384 slots covered.ã€‚ checkæ£€æŸ¥é›†ç¾¤æ£€æŸ¥é›†ç¾¤çŠ¶æ€çš„å‘½ä»¤ï¼Œæ²¡æœ‰å…¶ä»–å‚æ•°ï¼Œåªéœ€è¦é€‰æ‹©ä¸€ä¸ªé›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹å³å¯ã€‚æ‰§è¡Œå‘½ä»¤ä»¥åŠç»“æœå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324$ruby redis-trib.rb check 10.180.157.199:6379&gt;&gt;&gt; Performing Cluster Check (using node 10.180.157.199:6379)M: b2506515b38e6bbd3034d540599f4cd2a5279ad1 10.180.157.199:6379 slots:0-5460 (5461 slots) master 1 additional replica(s)S: d376aaf80de0e01dde1f8cd4647d5ac3317a8641 10.180.157.205:6379 slots: (0 slots) slave replicates e36c46dbe90960f30861af00786d4c2064e63df2M: 15126fb33796c2c26ea89e553418946f7443d5a5 10.180.157.201:6379 slots:10923-16383 (5461 slots) master 1 additional replica(s)S: 59fa6ee455f58a5076f6d6f83ddd74161fd7fb55 10.180.157.208:6379 slots: (0 slots) slave replicates 15126fb33796c2c26ea89e553418946f7443d5a5S: 460b3a11e296aafb2615043291b7dd98274bb351 10.180.157.202:6379 slots: (0 slots) slave replicates b2506515b38e6bbd3034d540599f4cd2a5279ad1M: e36c46dbe90960f30861af00786d4c2064e63df2 10.180.157.200:6379 slots:5461-10922 (5462 slots) master 1 additional replica(s)[OK] All nodes agree about slots configuration.&gt;&gt;&gt; Check for open slots...&gt;&gt;&gt; Check slots coverage...[OK] All 16384 slots covered. æ£€æŸ¥å‰ä¼šå…ˆæ‰§è¡Œload_cluster_info_from_nodeæ–¹æ³•ï¼ŒæŠŠæ‰€æœ‰èŠ‚ç‚¹æ•°æ®loadè¿›æ¥ã€‚loadçš„æ–¹å¼ä¸ºé€šè¿‡è‡ªå·±çš„cluster nodeså‘ç°å…¶ä»–èŠ‚ç‚¹ï¼Œç„¶åè¿æ¥æ¯ä¸ªèŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥nodesæ•°ç»„ã€‚æ¥ç€ç”ŸæˆèŠ‚ç‚¹é—´çš„å¤åˆ¶å…³ç³»ã€‚ loadå®Œæ•°æ®åï¼Œå¼€å§‹æ£€æŸ¥æ•°æ®ï¼Œæ£€æŸ¥çš„æ–¹å¼ä¹Ÿæ˜¯è°ƒç”¨åˆ›å»ºæ—¶å€™ä½¿ç”¨çš„check_clusterã€‚ infoæŸ¥çœ‹é›†ç¾¤ä¿¡æ¯infoå‘½ä»¤ç”¨æ¥æŸ¥çœ‹é›†ç¾¤çš„ä¿¡æ¯ã€‚infoå‘½ä»¤ä¹Ÿæ˜¯å…ˆæ‰§è¡Œload_cluster_info_from_nodeè·å–å®Œæ•´çš„é›†ç¾¤ä¿¡æ¯ã€‚ç„¶åæ˜¾ç¤ºClusterNodeçš„info_stringç»“æœï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š 123456$ruby redis-trib.rb info 10.180.157.199:637910.180.157.199:6379 (b2506515...) -&gt; 0 keys | 5461 slots | 1 slaves.10.180.157.201:6379 (15126fb3...) -&gt; 0 keys | 5461 slots | 1 slaves.10.180.157.200:6379 (e36c46db...) -&gt; 0 keys | 5462 slots | 1 slaves.[OK] 0 keys in 3 masters.0.00 keys per slot on average. fixä¿®å¤é›†ç¾¤fixå‘½ä»¤çš„æµç¨‹è·Ÿcheckçš„æµç¨‹å¾ˆåƒï¼Œæ˜¾ç¤ºåŠ è½½é›†ç¾¤ä¿¡æ¯ï¼Œç„¶ååœ¨check_clusteræ–¹æ³•å†…ä¼ å…¥fixä¸ºtrueçš„å˜é‡ï¼Œä¼šåœ¨é›†ç¾¤æ£€æŸ¥å‡ºç°å¼‚å¸¸çš„æ—¶å€™æ‰§è¡Œä¿®å¤æµç¨‹ã€‚ç›®å‰fixå‘½ä»¤èƒ½ä¿®å¤ä¸¤ç§å¼‚å¸¸ï¼Œä¸€ç§æ˜¯é›†ç¾¤æœ‰å¤„äºè¿ç§»ä¸­çš„slotçš„èŠ‚ç‚¹ï¼Œä¸€ç§æ˜¯slotæœªå®Œå…¨åˆ†é…çš„å¼‚å¸¸ã€‚ fix_open_slotæ–¹æ³•æ˜¯ä¿®å¤é›†ç¾¤æœ‰å¤„äºè¿ç§»ä¸­çš„slotçš„èŠ‚ç‚¹å¼‚å¸¸ã€‚ 12345678910111ã€å…ˆæ£€æŸ¥è¯¥slotæ˜¯è°è´Ÿè´£çš„ï¼Œè¿ç§»çš„æºèŠ‚ç‚¹å¦‚æœæ²¡å®Œæˆè¿ç§»ï¼Œownerè¿˜æ˜¯è¯¥èŠ‚ç‚¹ã€‚æ²¡æœ‰ownerçš„slotæ— æ³•å®Œæˆä¿®å¤åŠŸèƒ½ã€‚2ã€éå†æ¯ä¸ªèŠ‚ç‚¹ï¼Œè·å–å“ªäº›èŠ‚ç‚¹æ ‡è®°è¯¥slotä¸ºmigratingçŠ¶æ€ï¼Œå“ªäº›èŠ‚ç‚¹æ ‡è®°è¯¥slotä¸ºimportingçŠ¶æ€ã€‚å¯¹äºownerä¸æ˜¯è¯¥èŠ‚ç‚¹ï¼Œä½†æ˜¯é€šè¿‡cluster countkeysinslotè·å–åˆ°è¯¥èŠ‚ç‚¹æœ‰æ•°æ®çš„æƒ…å†µï¼Œä¹Ÿè®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸ºimportingçŠ¶æ€ã€‚3ã€å¦‚æœmigratingå’ŒimportingçŠ¶æ€çš„èŠ‚ç‚¹å‡åªæœ‰1ä¸ªï¼Œè¿™å¯èƒ½æ˜¯è¿ç§»è¿‡ç¨‹ä¸­redis-trib.rbè¢«ä¸­æ–­æ‰€è‡´ï¼Œç›´æ¥æ‰§è¡Œmove_slotç»§ç»­å®Œæˆè¿ç§»ä»»åŠ¡å³å¯ã€‚ä¼ é€’dotså’Œfixä¸ºtrueã€‚4ã€å¦‚æœmigratingä¸ºç©ºï¼ŒimportingçŠ¶æ€çš„èŠ‚ç‚¹å¤§äº0ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µæ‰§è¡Œå›æ»šæµç¨‹ï¼Œå°†importingçŠ¶æ€çš„èŠ‚ç‚¹æ•°æ®é€šè¿‡move_slotæ–¹æ³•å¯¼ç»™slotçš„ownerèŠ‚ç‚¹ï¼Œä¼ é€’dotsã€fixå’Œcoldä¸ºtrueã€‚æ¥ç€å¯¹importingçš„èŠ‚ç‚¹æ‰§è¡Œcluster stableå‘½ä»¤æ¢å¤ç¨³å®šã€‚5ã€å¦‚æœimportingçŠ¶æ€çš„èŠ‚ç‚¹ä¸ºç©ºï¼Œæœ‰ä¸€ä¸ªmigratingçŠ¶æ€çš„èŠ‚ç‚¹ï¼Œè€Œä¸”è¯¥èŠ‚ç‚¹åœ¨å½“å‰slotæ²¡æœ‰æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥æŠŠè¿™ä¸ªslotè®¾ä¸ºstableã€‚6ã€å¦‚æœmigratingå’ŒimportingçŠ¶æ€ä¸æ˜¯ä¸Šè¿°æƒ…å†µï¼Œç›®å‰redis-trib.rbå·¥å…·æ— æ³•ä¿®å¤ï¼Œä¸Šè¿°çš„ä¸‰ç§æƒ…å†µä¹Ÿå·²ç»è¦†ç›–äº†é€šè¿‡redis-trib.rbå·¥å…·è¿ç§»å‡ºç°å¼‚å¸¸çš„å„ä¸ªæ–¹é¢ï¼Œäººä¸ºçš„å¼‚å¸¸æƒ…å½¢å¤ªå¤šï¼Œå¾ˆéš¾è€ƒè™‘å®Œå…¨ã€‚fix_slots_coverageæ–¹æ³•èƒ½ä¿®å¤slotæœªå®Œå…¨åˆ†é…çš„å¼‚å¸¸ã€‚æœªåˆ†é…çš„slotæœ‰ä¸‰ç§çŠ¶æ€ã€‚1ã€æ‰€æœ‰èŠ‚ç‚¹çš„è¯¥slotéƒ½æ²¡æœ‰æ•°æ®ã€‚è¯¥çŠ¶æ€redis-trib.rbå·¥å…·ç›´æ¥é‡‡ç”¨éšæœºåˆ†é…çš„æ–¹å¼ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘èŠ‚ç‚¹çš„å‡è¡¡ã€‚æœ¬äººå°è¯•å¯¹æ²¡æœ‰åˆ†é…slotçš„é›†ç¾¤é€šè¿‡fixä¿®å¤é›†ç¾¤ï¼Œç»“æœslotè¿˜æ˜¯èƒ½æ¯”è¾ƒå¹³å‡çš„åˆ†é…ï¼Œä½†æ˜¯æ²¡æœ‰äº†è¿ç»­æ€§ï¼Œæ‰“å°çš„slotä¿¡æ¯éå¸¸ç¦»æ•£ã€‚2ã€æœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„è¯¥slotæœ‰æ•°æ®ã€‚è¯¥çŠ¶æ€ä¸‹ï¼Œç›´æ¥æŠŠslotåˆ†é…ç»™è¯¥slotæœ‰æ•°æ®çš„èŠ‚ç‚¹ã€‚3ã€æœ‰å¤šä¸ªèŠ‚ç‚¹çš„è¯¥slotæœ‰æ•°æ®ã€‚æ­¤ç§æƒ…å†µç›®å‰è¿˜å¤„äºTODOçŠ¶æ€ï¼Œä¸è¿‡redisä½œè€…åˆ—å‡ºäº†ä¿®å¤çš„æ­¥éª¤ï¼Œå¯¹è¿™äº›èŠ‚ç‚¹ï¼Œé™¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰§è¡Œcluster migratingå‘½ä»¤ï¼Œç„¶åæŠŠè¿™äº›èŠ‚ç‚¹çš„æ•°æ®è¿ç§»åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚æ¸…é™¤migratingçŠ¶æ€ï¼Œç„¶åæŠŠslotåˆ†é…ç»™ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ reshardåœ¨çº¿è¿ç§»slotreshardå‘½ä»¤å¯ä»¥åœ¨çº¿æŠŠé›†ç¾¤çš„ä¸€äº›slotä»é›†ç¾¤åŸæ¥slotè´Ÿè´£èŠ‚ç‚¹è¿ç§»åˆ°æ–°çš„èŠ‚ç‚¹ï¼Œåˆ©ç”¨reshardå¯ä»¥å®Œæˆé›†ç¾¤çš„åœ¨çº¿æ¨ªå‘æ‰©å®¹å’Œç¼©å®¹ã€‚ reshardçš„å‚æ•°å¾ˆå¤šï¼Œä¸‹é¢æ¥ä¸€ä¸€è§£é‡Šä¸€ç•ªï¼š 1234567891011121314reshard host:port --from --to --slots --yes --timeout --pipeline host:portï¼šè¿™ä¸ªæ˜¯å¿…ä¼ å‚æ•°ï¼Œç”¨æ¥ä»ä¸€ä¸ªèŠ‚ç‚¹è·å–æ•´ä¸ªé›†ç¾¤ä¿¡æ¯ï¼Œç›¸å½“äºè·å–é›†ç¾¤ä¿¡æ¯çš„å…¥å£ã€‚--from ï¼šéœ€è¦ä»å“ªäº›æºèŠ‚ç‚¹ä¸Šè¿ç§»slotï¼Œå¯ä»å¤šä¸ªæºèŠ‚ç‚¹å®Œæˆè¿ç§»ï¼Œä»¥é€—å·éš”å¼€ï¼Œä¼ é€’çš„æ˜¯èŠ‚ç‚¹çš„node idï¼Œè¿˜å¯ä»¥ç›´æ¥ä¼ é€’--from allï¼Œè¿™æ ·æºèŠ‚ç‚¹å°±æ˜¯é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¸ä¼ é€’è¯¥å‚æ•°çš„è¯ï¼Œåˆ™ä¼šåœ¨è¿ç§»è¿‡ç¨‹ä¸­æç¤ºç”¨æˆ·è¾“å…¥ã€‚--to ï¼šslotéœ€è¦è¿ç§»çš„ç›®çš„èŠ‚ç‚¹çš„node idï¼Œç›®çš„èŠ‚ç‚¹åªèƒ½å¡«å†™ä¸€ä¸ªï¼Œä¸ä¼ é€’è¯¥å‚æ•°çš„è¯ï¼Œåˆ™ä¼šåœ¨è¿ç§»è¿‡ç¨‹ä¸­æç¤ºç”¨æˆ·è¾“å…¥ã€‚--slots ï¼šéœ€è¦è¿ç§»çš„slotæ•°é‡ï¼Œä¸ä¼ é€’è¯¥å‚æ•°çš„è¯ï¼Œåˆ™ä¼šåœ¨è¿ç§»è¿‡ç¨‹ä¸­æç¤ºç”¨æˆ·è¾“å…¥ã€‚--yesï¼šè®¾ç½®è¯¥å‚æ•°ï¼Œå¯ä»¥åœ¨æ‰“å°æ‰§è¡Œreshardè®¡åˆ’çš„æ—¶å€™ï¼Œæç¤ºç”¨æˆ·è¾“å…¥yesç¡®è®¤åå†æ‰§è¡Œreshardã€‚--timeout ï¼šè®¾ç½®migrateå‘½ä»¤çš„è¶…æ—¶æ—¶é—´ã€‚--pipeline ï¼šå®šä¹‰cluster getkeysinslotå‘½ä»¤ä¸€æ¬¡å–å‡ºçš„keyæ•°é‡ï¼Œä¸ä¼ çš„è¯ä½¿ç”¨é»˜è®¤å€¼ä¸º10ã€‚ è¿ç§»çš„æµç¨‹å¦‚ä¸‹ï¼š 12345678910111213141516171ã€é€šè¿‡load_cluster_info_from_nodeæ–¹æ³•è£…è½½é›†ç¾¤ä¿¡æ¯ã€‚2ã€æ‰§è¡Œcheck_clusteræ–¹æ³•æ£€æŸ¥é›†ç¾¤æ˜¯å¦å¥åº·ã€‚åªæœ‰å¥åº·çš„é›†ç¾¤æ‰èƒ½è¿›è¡Œè¿ç§»ã€‚3ã€è·å–éœ€è¦è¿ç§»çš„slotæ•°é‡ï¼Œç”¨æˆ·æ²¡ä¼ é€’--slotså‚æ•°ï¼Œåˆ™æç¤ºç”¨æˆ·æ‰‹åŠ¨è¾“å…¥ã€‚4ã€è·å–è¿ç§»çš„ç›®çš„èŠ‚ç‚¹ï¼Œç”¨æˆ·æ²¡ä¼ é€’--toå‚æ•°ï¼Œåˆ™æç¤ºç”¨æˆ·æ‰‹åŠ¨è¾“å…¥ã€‚æ­¤å¤„ä¼šæ£€æŸ¥ç›®çš„èŠ‚ç‚¹å¿…é¡»ä¸ºmasterèŠ‚ç‚¹ã€‚5ã€è·å–è¿ç§»çš„æºèŠ‚ç‚¹ï¼Œç”¨æˆ·æ²¡ä¼ é€’--fromå‚æ•°ï¼Œåˆ™æç¤ºç”¨æˆ·æ‰‹åŠ¨è¾“å…¥ã€‚æ­¤å¤„ä¼šæ£€æŸ¥æºèŠ‚ç‚¹å¿…é¡»ä¸ºmasterèŠ‚ç‚¹ã€‚--from allçš„è¯ï¼ŒæºèŠ‚ç‚¹å°±æ˜¯é™¤äº†ç›®çš„èŠ‚ç‚¹å¤–çš„å…¨éƒ¨masterèŠ‚ç‚¹ã€‚è¿™é‡Œä¸ºäº†ä¿è¯é›†ç¾¤slotåˆ†é…çš„å¹³å‡ï¼Œå»ºè®®ä¼ é€’--from allã€‚6ã€æ‰§è¡Œcompute_reshard_tableæ–¹æ³•ï¼Œè®¡ç®—éœ€è¦è¿ç§»çš„slotæ•°é‡å¦‚ä½•åˆ†é…åˆ°æºèŠ‚ç‚¹åˆ—è¡¨ï¼Œé‡‡ç”¨çš„ç®—æ³•æ˜¯æŒ‰ç…§èŠ‚ç‚¹è´Ÿè´£slotæ•°é‡ç”±å¤šåˆ°å°‘æ’åºï¼Œè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹éœ€è¦è¿ç§»çš„slotçš„æ–¹æ³•ä¸ºï¼šè¿ç§»slotæ•°é‡ * (è¯¥æºèŠ‚ç‚¹è´Ÿè´£çš„slotæ•°é‡ / æºèŠ‚ç‚¹åˆ—è¡¨è´Ÿè´£çš„slotæ€»æ•°)ã€‚è¿™æ ·ç®—å‡ºçš„æ•°é‡å¯èƒ½ä¸ä¸ºæ•´æ•°ï¼Œè¿™é‡Œä»£ç ç”¨äº†ä¸‹é¢çš„æ–¹å¼å¤„ç†ï¼šn = (numslots/source_tot_slots*s.slots.length)if i == 0 n = n.ceilelse n = n.floorè¿™æ ·çš„å¤„ç†æ–¹å¼ä¼šå¸¦æ¥æœ€ç»ˆåˆ†é…çš„slotä¸è¯·æ±‚è¿ç§»çš„slotæ•°é‡ä¸ä¸€è‡´ï¼Œè¿™ä¸ªBUGå·²ç»åœ¨githubä¸Šæç»™ä½œè€…ï¼Œhttps://github.com/antirez/redis/issues/2990ã€‚7ã€æ‰“å°å‡ºreshardè®¡åˆ’ï¼Œå¦‚æœç”¨æˆ·æ²¡ä¼ --yesï¼Œå°±æç¤ºç”¨æˆ·ç¡®è®¤è®¡åˆ’ã€‚8ã€æ ¹æ®reshardè®¡åˆ’ï¼Œä¸€ä¸ªä¸ªslotçš„è¿ç§»åˆ°æ–°èŠ‚ç‚¹ä¸Šï¼Œè¿ç§»ä½¿ç”¨move_slotæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¢«å¾ˆå¤šå‘½ä»¤ä½¿ç”¨ï¼Œå…·ä½“å¯ä»¥å‚è§ä¸‹é¢çš„è¿ç§»æµç¨‹ã€‚move_slotæ–¹æ³•ä¼ é€’dotsä¸ºtrueå’Œpipelineæ•°é‡ã€‚9ã€è‡³æ­¤ï¼Œå°±å®Œæˆäº†å…¨éƒ¨çš„è¿ç§»ä»»åŠ¡ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465ruby redis-trib.rb reshard --from all --to 80b661ecca260c89e3d8ea9b98f77edaeef43dcd --slots 11 10.180.157.199:6379&gt;&gt;&gt; Performing Cluster Check (using node 10.180.157.199:6379)S: b2506515b38e6bbd3034d540599f4cd2a5279ad1 10.180.157.199:6379 slots: (0 slots) slave replicates 460b3a11e296aafb2615043291b7dd98274bb351S: d376aaf80de0e01dde1f8cd4647d5ac3317a8641 10.180.157.205:6379 slots: (0 slots) slave replicates e36c46dbe90960f30861af00786d4c2064e63df2M: 15126fb33796c2c26ea89e553418946f7443d5a5 10.180.157.201:6379 slots:10923-16383 (5461 slots) master 1 additional replica(s)S: 59fa6ee455f58a5076f6d6f83ddd74161fd7fb55 10.180.157.208:6379 slots: (0 slots) slave replicates 15126fb33796c2c26ea89e553418946f7443d5a5M: 460b3a11e296aafb2615043291b7dd98274bb351 10.180.157.202:6379 slots:0-5460 (5461 slots) master 1 additional replica(s)M: 80b661ecca260c89e3d8ea9b98f77edaeef43dcd 10.180.157.200:6380 slots: (0 slots) master 0 additional replica(s)M: e36c46dbe90960f30861af00786d4c2064e63df2 10.180.157.200:6379 slots:5461-10922 (5462 slots) master 1 additional replica(s)[OK] All nodes agree about slots configuration.&gt;&gt;&gt; Check for open slots...&gt;&gt;&gt; Check slots coverage...[OK] All 16384 slots covered.Ready to move 11 slots. Source nodes: M: 15126fb33796c2c26ea89e553418946f7443d5a5 10.180.157.201:6379 slots:10923-16383 (5461 slots) master 1 additional replica(s) M: 460b3a11e296aafb2615043291b7dd98274bb351 10.180.157.202:6379 slots:0-5460 (5461 slots) master 1 additional replica(s) M: e36c46dbe90960f30861af00786d4c2064e63df2 10.180.157.200:6379 slots:5461-10922 (5462 slots) master 1 additional replica(s) Destination node: M: 80b661ecca260c89e3d8ea9b98f77edaeef43dcd 10.180.157.200:6380 slots: (0 slots) master 0 additional replica(s) Resharding plan: Moving slot 5461 from e36c46dbe90960f30861af00786d4c2064e63df2 Moving slot 5462 from e36c46dbe90960f30861af00786d4c2064e63df2 Moving slot 5463 from e36c46dbe90960f30861af00786d4c2064e63df2 Moving slot 5464 from e36c46dbe90960f30861af00786d4c2064e63df2 Moving slot 0 from 460b3a11e296aafb2615043291b7dd98274bb351 Moving slot 1 from 460b3a11e296aafb2615043291b7dd98274bb351 Moving slot 2 from 460b3a11e296aafb2615043291b7dd98274bb351 Moving slot 10923 from 15126fb33796c2c26ea89e553418946f7443d5a5 Moving slot 10924 from 15126fb33796c2c26ea89e553418946f7443d5a5 Moving slot 10925 from 15126fb33796c2c26ea89e553418946f7443d5a5Do you want to proceed with the proposed reshard plan (yes/no)? yesMoving slot 5461 from 10.180.157.200:6379 to 10.180.157.200:6380:Moving slot 5462 from 10.180.157.200:6379 to 10.180.157.200:6380:Moving slot 5463 from 10.180.157.200:6379 to 10.180.157.200:6380:Moving slot 5464 from 10.180.157.200:6379 to 10.180.157.200:6380:Moving slot 0 from 10.180.157.202:6379 to 10.180.157.200:6380:Moving slot 1 from 10.180.157.202:6379 to 10.180.157.200:6380:Moving slot 2 from 10.180.157.202:6379 to 10.180.157.200:6380:Moving slot 10923 from 10.180.157.201:6379 to 10.180.157.200:6380:Moving slot 10924 from 10.180.157.201:6379 to 10.180.157.200:6380:Moving slot 10925 from 10.180.157.201:6379 to 10.180.157.200:6380: move_slotæ–¹æ³•å¯ä»¥åœ¨çº¿å°†ä¸€ä¸ªslotçš„å…¨éƒ¨æ•°æ®ä»æºèŠ‚ç‚¹è¿ç§»åˆ°ç›®çš„èŠ‚ç‚¹ï¼Œfixã€reshardã€rebalanceéƒ½éœ€è¦è°ƒç”¨è¯¥æ–¹æ³•è¿ç§»slotã€‚ move_slotæ¥å—ä¸‹é¢å‡ ä¸ªå‚æ•°ï¼Œ 123451ã€pipelineï¼šè®¾ç½®ä¸€æ¬¡ä»slotä¸Šè·å–å¤šå°‘ä¸ªkeyã€‚2ã€quietï¼šè¿ç§»ä¼šæ‰“å°ç›¸å…³ä¿¡æ¯ï¼Œè®¾ç½®quietå‚æ•°ï¼Œå¯ä»¥ä¸ç”¨æ‰“å°è¿™äº›ä¿¡æ¯ã€‚3ã€coldï¼šè®¾ç½®coldï¼Œä¼šå¿½ç•¥æ‰§è¡Œimportingå’Œmigratingã€‚4ã€dotsï¼šè®¾ç½®dotsï¼Œåˆ™ä¼šåœ¨è¿ç§»è¿‡ç¨‹æ‰“å°è¿ç§»keyæ•°é‡çš„è¿›åº¦ã€‚5ã€updateï¼šè®¾ç½®updateï¼Œåˆ™ä¼šæ›´æ–°å†…å­˜ä¿¡æ¯ï¼Œæ–¹ä¾¿ä»¥åçš„æ“ä½œã€‚ move_slotæµç¨‹å¦‚ä¸‹ï¼š 123456781ã€å¦‚æœæ²¡æœ‰è®¾ç½®coldï¼Œåˆ™å¯¹æºèŠ‚ç‚¹æ‰§è¡Œcluster importingå‘½ä»¤ï¼Œå¯¹ç›®çš„èŠ‚ç‚¹æ‰§è¡Œmigratingå‘½ä»¤ã€‚fixçš„æ—¶å€™æœ‰å¯èƒ½importingå’Œmigratingå·²ç»æ‰§è¡Œè¿‡æ¥ï¼Œæ‰€ä»¥æ­¤ç§åœºæ™¯ä¼šè®¾ç½®coldã€‚2ã€é€šè¿‡cluster getkeysinslotå‘½ä»¤ï¼Œä¸€æ¬¡æ€§è·å–è¿œèŠ‚ç‚¹è¿ç§»slotçš„pipelineä¸ªkeyçš„æ•°é‡.3ã€å¯¹è¿™äº›keyæ‰§è¡Œmigrateå‘½ä»¤ï¼Œå°†æ•°æ®ä»æºèŠ‚ç‚¹è¿ç§»åˆ°ç›®çš„èŠ‚ç‚¹ã€‚4ã€å¦‚æœmigrateå‡ºç°å¼‚å¸¸ï¼Œåœ¨fixæ¨¡å¼ä¸‹ï¼ŒBUSYKEYçš„å¼‚å¸¸ï¼Œä¼šä½¿ç”¨migrateçš„replaceæ¨¡å¼å†æ‰§è¡Œä¸€æ¬¡ï¼ŒBUSYKEYè¡¨ç¤ºç›®çš„èŠ‚ç‚¹å·²ç»æœ‰è¯¥keyäº†ï¼Œreplaceæ¨¡å¼å¯ä»¥å¼ºåˆ¶æ›¿æ¢ç›®çš„èŠ‚ç‚¹çš„keyã€‚ä¸æ˜¯fixæ¨¡å¼å°±ç›´æ¥è¿”å›é”™è¯¯äº†ã€‚5ã€å¾ªç¯æ‰§è¡Œcluster getkeysinslotå‘½ä»¤ï¼Œç›´åˆ°è¿”å›çš„keyæ•°é‡ä¸º0ï¼Œå°±é€€å‡ºå¾ªç¯ã€‚6ã€å¦‚æœæ²¡æœ‰è®¾ç½®coldï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œcluster setslotå‘½ä»¤ï¼ŒæŠŠslotèµ‹ç»™ç›®çš„èŠ‚ç‚¹ã€‚7ã€å¦‚æœè®¾ç½®updateï¼Œåˆ™ä¿®æ”¹æºèŠ‚ç‚¹å’Œç›®çš„èŠ‚ç‚¹çš„slotä¿¡æ¯ã€‚8ã€è‡³æ­¤å®Œæˆäº†è¿ç§»slotçš„æµç¨‹ã€‚ rebalanceå¹³è¡¡é›†ç¾¤èŠ‚ç‚¹slotæ•°é‡rebalanceå‘½ä»¤å¯ä»¥æ ¹æ®ç”¨æˆ·ä¼ å…¥çš„å‚æ•°å¹³è¡¡é›†ç¾¤èŠ‚ç‚¹çš„slotæ•°é‡ï¼ŒrebalanceåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¯ä»¥ä¼ å…¥çš„å‚æ•°å¾ˆå¤šï¼Œä»¥ä¸‹æ˜¯rebalanceçš„å‚æ•°åˆ—è¡¨å’Œå‘½ä»¤ç¤ºä¾‹ã€‚ 1234567891011121314151617181920rebalance host:port --weight --auto-weights --threshold --use-empty-masters --timeout --simulate --pipeline $ruby redis-trib.rb rebalance --threshold 1 --weight b31e3a2e=5 --weight 60b8e3a1=5 --use-empty-masters --simulate 10.180.157.199:6379ä¸‹é¢ä¹Ÿå…ˆä¸€ä¸€è§£é‡Šä¸‹æ¯ä¸ªå‚æ•°çš„ç”¨æ³•ï¼šhost:portï¼šè¿™ä¸ªæ˜¯å¿…ä¼ å‚æ•°ï¼Œç”¨æ¥ä»ä¸€ä¸ªèŠ‚ç‚¹è·å–æ•´ä¸ªé›†ç¾¤ä¿¡æ¯ï¼Œç›¸å½“äºè·å–é›†ç¾¤ä¿¡æ¯çš„å…¥å£ã€‚--weight ï¼šèŠ‚ç‚¹çš„æƒé‡ï¼Œæ ¼å¼ä¸ºnode_id=weightï¼Œå¦‚æœéœ€è¦ä¸ºå¤šä¸ªèŠ‚ç‚¹åˆ†é…æƒé‡çš„è¯ï¼Œéœ€è¦æ·»åŠ å¤šä¸ª--weight å‚æ•°ï¼Œå³--weight b31e3a2e=5 --weight 60b8e3a1=5ï¼Œnode_idå¯ä¸ºèŠ‚ç‚¹åç§°çš„å‰ç¼€ï¼Œåªè¦ä¿è¯å‰ç¼€ä½æ•°èƒ½å”¯ä¸€åŒºåˆ†è¯¥èŠ‚ç‚¹å³å¯ã€‚æ²¡æœ‰ä¼ é€’â€“weightçš„èŠ‚ç‚¹çš„æƒé‡é»˜è®¤ä¸º1ã€‚--auto-weightsï¼šè¿™ä¸ªå‚æ•°åœ¨rebalanceæµç¨‹ä¸­å¹¶æœªç”¨åˆ°ã€‚--threshold ï¼šåªæœ‰èŠ‚ç‚¹éœ€è¦è¿ç§»çš„sloté˜ˆå€¼è¶…è¿‡thresholdï¼Œæ‰ä¼šæ‰§è¡Œrebalanceæ“ä½œã€‚å…·ä½“è®¡ç®—æ–¹æ³•å¯ä»¥å‚è€ƒä¸‹é¢çš„rebalanceå‘½ä»¤æµç¨‹çš„ç¬¬å››æ­¥ã€‚--use-empty-mastersï¼šrebalanceæ˜¯å¦è€ƒè™‘æ²¡æœ‰èŠ‚ç‚¹çš„masterï¼Œé»˜è®¤æ²¡æœ‰åˆ†é…slotèŠ‚ç‚¹çš„masteræ˜¯ä¸å‚ä¸rebalanceçš„ï¼Œè®¾ç½®--use-empty-masterså¯ä»¥è®©æ²¡æœ‰åˆ†é…slotçš„èŠ‚ç‚¹å‚ä¸rebalanceã€‚--timeout ï¼šè®¾ç½®migrateå‘½ä»¤çš„è¶…æ—¶æ—¶é—´ã€‚--simulateï¼šè®¾ç½®è¯¥å‚æ•°ï¼Œå¯ä»¥æ¨¡æ‹Ÿrebalanceæ“ä½œï¼Œæç¤ºç”¨æˆ·ä¼šè¿ç§»å“ªäº›slotsï¼Œè€Œä¸ä¼šçœŸæ­£æ‰§è¡Œè¿ç§»æ“ä½œã€‚--pipeline ï¼šä¸resharçš„pipelineå‚æ•°ä¸€æ ·ï¼Œå®šä¹‰cluster getkeysinslotå‘½ä»¤ä¸€æ¬¡å–å‡ºçš„keyæ•°é‡ï¼Œä¸ä¼ çš„è¯ä½¿ç”¨é»˜è®¤å€¼ä¸º10ã€‚ rebalanceå‘½ä»¤æµç¨‹å¦‚ä¸‹ï¼š 1234567891011121314151ã€load_cluster_info_from_nodeæ–¹æ³•å…ˆåŠ è½½é›†ç¾¤ä¿¡æ¯ã€‚2ã€è®¡ç®—æ¯ä¸ªmasterçš„æƒé‡ï¼Œæ ¹æ®å‚æ•°--weight ï¼Œä¸ºæ¯ä¸ªè®¾ç½®çš„èŠ‚ç‚¹åˆ†é…æƒé‡ï¼Œæ²¡æœ‰è®¾ç½®çš„èŠ‚ç‚¹ï¼Œåˆ™æƒé‡é»˜è®¤ä¸º1ã€‚3ã€æ ¹æ®æ¯ä¸ªmasterçš„æƒé‡ï¼Œä»¥åŠæ€»çš„æƒé‡ï¼Œè®¡ç®—è‡ªå·±æœŸæœ›è¢«åˆ†é…å¤šå°‘ä¸ªslotã€‚è®¡ç®—çš„æ–¹å¼ä¸ºï¼šæ€»slotæ•°é‡ * ï¼ˆè‡ªå·±çš„æƒé‡ / æ€»æƒé‡ï¼‰ã€‚4ã€è®¡ç®—æ¯ä¸ªmasteræœŸæœ›åˆ†é…çš„slotæ˜¯å¦è¶…è¿‡è®¾ç½®çš„é˜ˆå€¼ï¼Œå³--threshold è®¾ç½®çš„é˜ˆå€¼æˆ–è€…é»˜è®¤çš„é˜ˆå€¼ã€‚è®¡ç®—çš„æ–¹å¼ä¸ºï¼šå…ˆè®¡ç®—æœŸæœ›ç§»åŠ¨èŠ‚ç‚¹çš„é˜ˆå€¼ï¼Œç®—æ³•ä¸ºï¼š(100-(100.0*expected/n.slots.length)).absï¼Œå¦‚æœè®¡ç®—å‡ºçš„é˜ˆå€¼æ²¡æœ‰è¶…å‡ºè®¾ç½®é˜ˆå€¼ï¼Œåˆ™ä¸éœ€è¦ä¸ºè¯¥èŠ‚ç‚¹ç§»åŠ¨slotã€‚åªè¦æœ‰ä¸€ä¸ªmasterçš„ç§»åŠ¨èŠ‚ç‚¹è¶…è¿‡é˜ˆå€¼ï¼Œå°±ä¼šè§¦å‘rebalanceæ“ä½œã€‚5ã€å¦‚æœè§¦å‘äº†rebalanceæ“ä½œã€‚é‚£ä¹ˆå°±å¼€å§‹æ‰§è¡Œrebalanceæ“ä½œï¼Œå…ˆå°†æ¯ä¸ªèŠ‚ç‚¹å½“å‰åˆ†é…çš„slotsæ•°é‡å‡å»æœŸæœ›åˆ†é…çš„slotæ•°é‡è·å¾—balanceå€¼ã€‚å°†æ¯ä¸ªèŠ‚ç‚¹çš„balanceä»å°åˆ°å¤§è¿›è¡Œæ’åºè·å¾—snæ•°ç»„ã€‚6ã€ç”¨dst_idxå’Œsrc_idxæ¸¸æ ‡åˆ†åˆ«ä»snæ•°ç»„çš„å¤´éƒ¨å’Œå°¾éƒ¨å¼€å§‹éå†ã€‚ç›®çš„æ˜¯ä¸ºäº†æŠŠå°¾éƒ¨èŠ‚ç‚¹çš„slotåˆ†é…ç»™å¤´éƒ¨èŠ‚ç‚¹ã€‚snæ•°ç»„ä¿å­˜çš„balanceåˆ—è¡¨æ’åºåï¼Œè´Ÿæ•°åœ¨å‰é¢ï¼Œæ­£æ•°åœ¨åé¢ã€‚è´Ÿæ•°è¡¨ç¤ºéœ€è¦æœ‰slotè¿å…¥ï¼Œæ‰€ä»¥ä½¿ç”¨dst_idxæ¸¸æ ‡ï¼Œæ­£æ•°è¡¨ç¤ºéœ€è¦æœ‰slotè¿å‡ºï¼Œæ‰€ä»¥ä½¿ç”¨src_idxæ¸¸æ ‡ã€‚ç†è®ºä¸Šsnæ•°ç»„å„èŠ‚ç‚¹çš„balanceå€¼åŠ èµ·æ¥åº”è¯¥ä¸º0ï¼Œä¸è¿‡ç”±äºåœ¨è®¡ç®—æœŸæœ›åˆ†é…çš„slotçš„æ—¶å€™åªæ˜¯ä½¿ç”¨ç›´æ¥å–æ•´çš„æ–¹å¼ï¼Œæ‰€ä»¥å¯èƒ½å‡ºç°balanceå€¼ä¹‹å’Œä¸ä¸º0çš„æƒ…å†µï¼Œbalanceå€¼ä¹‹å’Œä¸ä¸º0å³ä¸ºèŠ‚ç‚¹ä¸å¹³è¡¡çš„slotæ•°é‡ï¼Œç”±äºslotæ€»æ•°æœ‰16384ä¸ªï¼Œä¸å¹³è¡¡æ•°é‡ç›¸å¯¹äºæ€»æ•°ï¼ŒåŸºæ•°å¾ˆå°ï¼Œæ‰€ä»¥å¯¹rebalanceæµç¨‹å½±å“ä¸å¤§ã€‚7ã€è·å–sn[dst_idx]å’Œsn[src_idx]çš„balanceå€¼è¾ƒå°çš„é‚£ä¸ªå€¼ï¼Œè¯¥å€¼å³ä¸ºéœ€è¦ä»sn[src_idx]èŠ‚ç‚¹è¿ç§»åˆ°sn[dst_idx]èŠ‚ç‚¹çš„slotæ•°é‡ã€‚8ã€æ¥ç€é€šè¿‡compute_reshard_tableæ–¹æ³•è®¡ç®—æºèŠ‚ç‚¹çš„slotå¦‚ä½•åˆ†é…åˆ°æºèŠ‚ç‚¹åˆ—è¡¨ã€‚è¿™ä¸ªæ–¹æ³•åœ¨reshardæµç¨‹ä¸­ä¹Ÿæœ‰è°ƒç”¨ï¼Œå…·ä½“æ­¥éª¤å¯ä»¥å‚è€ƒreshardæµç¨‹çš„ç¬¬å…­æ­¥ã€‚9ã€å¦‚æœæ˜¯simulateæ¨¡å¼ï¼Œåˆ™åªæ˜¯æ‰“å°å‡ºè¿ç§»åˆ—è¡¨ã€‚10ã€å¦‚æœæ²¡æœ‰è®¾ç½®simulateï¼Œåˆ™æ‰§è¡Œmove_slotæ“ä½œï¼Œè¿ç§»slotï¼Œä¼ å…¥çš„å‚æ•°ä¸º:quiet=&gt;true,:dots=&gt;false,:update=&gt;trueã€‚11ã€è¿ç§»å®Œæˆåæ›´æ–°sn[dst_idx]å’Œsn[src_idx]çš„balanceå€¼ã€‚å¦‚æœbalanceå€¼ä¸º0åï¼Œæ¸¸æ ‡å‘å‰è¿›1ã€‚12ã€ç›´åˆ°dst_idxåˆ°è¾¾src_idxæ¸¸æ ‡ï¼Œå®Œæˆæ•´ä¸ªrebalanceæ“ä½œã€‚ add-nodeå°†æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤add-nodeå‘½ä»¤å¯ä»¥å°†æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼ŒèŠ‚ç‚¹å¯ä»¥ä¸ºmasterï¼Œä¹Ÿå¯ä»¥ä¸ºæŸä¸ªmasterèŠ‚ç‚¹çš„slaveã€‚ 1234567add-node new_host:new_port existing_host:existing_port --slave --master-id add-nodeæœ‰ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼š--slaveï¼šè®¾ç½®è¯¥å‚æ•°ï¼Œåˆ™æ–°èŠ‚ç‚¹ä»¥slaveçš„è§’è‰²åŠ å…¥é›†ç¾¤--master-idï¼šè¿™ä¸ªå‚æ•°éœ€è¦è®¾ç½®äº†--slaveæ‰èƒ½ç”Ÿæ•ˆï¼Œ--master-idç”¨æ¥æŒ‡å®šæ–°èŠ‚ç‚¹çš„masterèŠ‚ç‚¹ã€‚å¦‚æœä¸è®¾ç½®è¯¥å‚æ•°ï¼Œåˆ™ä¼šéšæœºä¸ºèŠ‚ç‚¹é€‰æ‹©masterèŠ‚ç‚¹ã€‚ å¯ä»¥çœ‹ä¸‹add-nodeå‘½ä»¤çš„æ‰§è¡Œç¤ºä¾‹ï¼š 1234567891011121314151617181920$ruby redis-trib.rb add-node --slave --master-id dcb792b3e85726f012e83061bf237072dfc45f99 10.180.157.202:6379 10.180.157.199:6379&gt;&gt;&gt; Adding node 10.180.157.202:6379 to cluster 10.180.157.199:6379&gt;&gt;&gt; Performing Cluster Check (using node 10.180.157.199:6379)M: dcb792b3e85726f012e83061bf237072dfc45f99 10.180.157.199:6379 slots:0-5460 (5461 slots) master 0 additional replica(s)M: 464d740bf48953ebcf826f4113c86f9db3a9baf3 10.180.157.201:6379 slots:10923-16383 (5461 slots) master 0 additional replica(s)M: befa7e17b4e5f239e519bc74bfef3264a40f96ae 10.180.157.200:6379 slots:5461-10922 (5462 slots) master 0 additional replica(s)[OK] All nodes agree about slots configuration.&gt;&gt;&gt; Check for open slots...&gt;&gt;&gt; Check slots coverage...[OK] All 16384 slots covered.&gt;&gt;&gt; Send CLUSTER MEET to node 10.180.157.202:6379 to make it join the cluster.Waiting for the cluster to join.&gt;&gt;&gt; Configure node as replica of 10.180.157.199:6379.[OK] New node added correctly. add-nodeæµç¨‹å¦‚ä¸‹ï¼š 123451ã€é€šè¿‡load_cluster_info_from_nodeæ–¹æ³•è½¬è½½é›†ç¾¤ä¿¡æ¯ï¼Œcheck_clusteræ–¹æ³•æ£€æŸ¥é›†ç¾¤æ˜¯å¦å¥åº·ã€‚2ã€å¦‚æœè®¾ç½®äº†--slaveï¼Œåˆ™éœ€è¦ä¸ºè¯¥èŠ‚ç‚¹å¯»æ‰¾masterèŠ‚ç‚¹ã€‚è®¾ç½®äº†--master-idï¼Œåˆ™ä»¥è¯¥èŠ‚ç‚¹ä½œä¸ºæ–°èŠ‚ç‚¹çš„masterï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®--master-idï¼Œåˆ™è°ƒç”¨get_master_with_least_replicasæ–¹æ³•ï¼Œå¯»æ‰¾slaveæ•°é‡æœ€å°‘çš„masterèŠ‚ç‚¹ã€‚å¦‚æœslaveæ•°é‡ä¸€è‡´ï¼Œåˆ™é€‰å–load_cluster_info_from_nodeé¡ºåºå‘ç°çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚load_cluster_info_from_nodeé¡ºåºçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯add-nodeè®¾ç½®çš„existing_host:existing_portèŠ‚ç‚¹ï¼Œåé¢çš„é¡ºåºæ ¹æ®åœ¨è¯¥èŠ‚ç‚¹æ‰§è¡Œcluster nodesè¿”å›çš„ç»“æœè¿”å›çš„èŠ‚ç‚¹é¡ºåºã€‚3ã€è¿æ¥æ–°çš„èŠ‚ç‚¹å¹¶ä¸é›†ç¾¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ¡æ‰‹ã€‚4ã€å¦‚æœæ²¡è®¾ç½®â€“slaveå°±ç›´æ¥è¿”å›okï¼Œè®¾ç½®äº†â€“slaveï¼Œåˆ™éœ€è¦ç­‰å¾…ç¡®è®¤æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼Œç„¶åæ‰§è¡Œcluster replicateå‘½ä»¤å¤åˆ¶masterèŠ‚ç‚¹ã€‚5ã€è‡³æ­¤ï¼Œå®Œæˆäº†å…¨éƒ¨çš„å¢åŠ èŠ‚ç‚¹çš„æµç¨‹ã€‚ del-nodeä»é›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹del-nodeå¯ä»¥æŠŠæŸä¸ªèŠ‚ç‚¹ä»é›†ç¾¤ä¸­åˆ é™¤ã€‚del-nodeåªèƒ½åˆ é™¤æ²¡æœ‰åˆ†é…slotçš„èŠ‚ç‚¹ã€‚åˆ é™¤å‘½ä»¤ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼š 12host:portï¼šä»è¯¥èŠ‚ç‚¹è·å–é›†ç¾¤ä¿¡æ¯ã€‚node_idï¼šéœ€è¦åˆ é™¤çš„èŠ‚ç‚¹idã€‚ del-nodeæ‰§è¡Œç»“æœç¤ºä¾‹å¦‚ä¸‹ï¼š 1234$ruby redis-trib.rb del-node 10.180.157.199:6379 d5f6d1d17426bd564a6e309f32d0f5b96962fe53&gt;&gt;&gt; Removing node d5f6d1d17426bd564a6e309f32d0f5b96962fe53 from cluster 10.180.157.199:6379&gt;&gt;&gt; Sending CLUSTER FORGET messages to the cluster...&gt;&gt;&gt; SHUTDOWN the node. del-nodeæµç¨‹å¦‚ä¸‹ï¼š 123451ã€é€šè¿‡load_cluster_info_from_nodeæ–¹æ³•è½¬è½½é›†ç¾¤ä¿¡æ¯ã€‚2ã€æ ¹æ®ä¼ å…¥çš„node idè·å–èŠ‚ç‚¹ï¼Œå¦‚æœèŠ‚ç‚¹æ²¡æ‰¾åˆ°ï¼Œåˆ™ç›´æ¥æç¤ºé”™è¯¯å¹¶é€€å‡ºã€‚3ã€å¦‚æœèŠ‚ç‚¹åˆ†é…çš„slotä¸ä¸ºç©ºï¼Œåˆ™ç›´æ¥æç¤ºé”™è¯¯å¹¶é€€å‡ºã€‚4ã€éå†é›†ç¾¤å†…çš„å…¶ä»–èŠ‚ç‚¹ï¼Œæ‰§è¡Œcluster forgetå‘½ä»¤ï¼Œä»æ¯ä¸ªèŠ‚ç‚¹ä¸­å»é™¤è¯¥èŠ‚ç‚¹ã€‚å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æ˜¯masterï¼Œè€Œä¸”å®ƒæœ‰slaveçš„è¯ï¼Œè¿™äº›slaveä¼šå»å¤åˆ¶å…¶ä»–masterï¼Œè°ƒç”¨çš„æ–¹æ³•æ˜¯get_master_with_least_replicasï¼Œä¸add-nodeæ²¡è®¾ç½®--master-idå¯»æ‰¾masterçš„æ–¹æ³•ä¸€æ ·ã€‚5ã€ç„¶åå…³é—­è¯¥èŠ‚ç‚¹ã€‚ set-timeoutè®¾ç½®é›†ç¾¤èŠ‚ç‚¹é—´å¿ƒè·³è¿æ¥çš„è¶…æ—¶æ—¶é—´set-timeoutç”¨æ¥è®¾ç½®é›†ç¾¤èŠ‚ç‚¹é—´å¿ƒè·³è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼Œä¸å¾—å°äº100æ¯«ç§’ï¼Œå› ä¸º100æ¯«ç§’å¯¹äºå¿ƒè·³æ—¶é—´æ¥è¯´å¤ªçŸ­äº†ã€‚è¯¥å‘½ä»¤ä¿®æ”¹æ˜¯èŠ‚ç‚¹é…ç½®å‚æ•°cluster-node-timeoutï¼Œé»˜è®¤æ˜¯15000æ¯«ç§’ã€‚é€šè¿‡è¯¥å‘½ä»¤ï¼Œå¯ä»¥ç»™æ¯ä¸ªèŠ‚ç‚¹è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè®¾ç½®çš„æ–¹å¼ä½¿ç”¨config setå‘½ä»¤åŠ¨æ€è®¾ç½®ï¼Œç„¶åæ‰§è¡Œconfig rewriteå‘½ä»¤å°†é…ç½®æŒä¹…åŒ–ä¿å­˜åˆ°ç¡¬ç›˜ã€‚ä»¥ä¸‹æ˜¯ç¤ºä¾‹ï¼š 12345678ruby redis-trib.rb set-timeout 10.180.157.199:6379 30000&gt;&gt;&gt; Reconfiguring node timeout in every cluster node...*** New timeout set for 10.180.157.199:6379*** New timeout set for 10.180.157.205:6379*** New timeout set for 10.180.157.201:6379*** New timeout set for 10.180.157.200:6379*** New timeout set for 10.180.157.208:6379&gt;&gt;&gt; New node timeout set. 5 OK, 0 ERR. callåœ¨é›†ç¾¤å…¨éƒ¨èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤callå‘½ä»¤å¯ä»¥ç”¨æ¥åœ¨é›†ç¾¤çš„å…¨éƒ¨èŠ‚ç‚¹æ‰§è¡Œç›¸åŒçš„å‘½ä»¤ã€‚callå‘½ä»¤ä¹Ÿæ˜¯éœ€è¦é€šè¿‡é›†ç¾¤çš„ä¸€ä¸ªèŠ‚ç‚¹åœ°å€ï¼Œè¿ä¸Šæ•´ä¸ªé›†ç¾¤ï¼Œç„¶ååœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œè¯¥å‘½ä»¤ã€‚ 1234567$ruby redis-trib.rb call 10.180.157.199:6379 get key&gt;&gt;&gt; Calling GET key10.180.157.199:6379: MOVED 12539 10.180.157.201:637910.180.157.205:6379: MOVED 12539 10.180.157.201:637910.180.157.201:6379:10.180.157.200:6379: MOVED 12539 10.180.157.201:637910.180.157.208:6379: MOVED 12539 10.180.157.201:6379 importå°†å¤–éƒ¨redisæ•°æ®å¯¼å…¥é›†ç¾¤importå‘½ä»¤å¯ä»¥æŠŠå¤–éƒ¨çš„redisèŠ‚ç‚¹æ•°æ®å¯¼å…¥é›†ç¾¤ã€‚å¯¼å…¥çš„æµç¨‹å¦‚ä¸‹ï¼š 123456781ã€é€šè¿‡load_cluster_info_from_nodeæ–¹æ³•è½¬è½½é›†ç¾¤ä¿¡æ¯ï¼Œcheck_clusteræ–¹æ³•æ£€æŸ¥é›†ç¾¤æ˜¯å¦å¥åº·ã€‚2ã€è¿æ¥å¤–éƒ¨redisèŠ‚ç‚¹ï¼Œå¦‚æœå¤–éƒ¨èŠ‚ç‚¹å¼€å¯äº†cluster_enabledï¼Œåˆ™æç¤ºé”™è¯¯ã€‚3ã€é€šè¿‡scanå‘½ä»¤éå†å¤–éƒ¨èŠ‚ç‚¹ï¼Œä¸€æ¬¡è·å–1000æ¡æ•°æ®ã€‚4ã€éå†è¿™äº›keyï¼Œè®¡ç®—å‡ºkeyå¯¹åº”çš„slotã€‚5ã€æ‰§è¡Œmigrateå‘½ä»¤,æºèŠ‚ç‚¹æ˜¯å¤–éƒ¨èŠ‚ç‚¹,ç›®çš„èŠ‚ç‚¹æ˜¯é›†ç¾¤slotå¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¦‚æœè®¾ç½®äº†--copyå‚æ•°ï¼Œåˆ™ä¼ é€’copyå‚æ•°ï¼Œå¦‚æœè®¾ç½®äº†--replaceï¼Œåˆ™ä¼ é€’replaceå‚æ•°ã€‚6ã€ä¸åœæ‰§è¡Œscanå‘½ä»¤ï¼Œç›´åˆ°éå†å®Œå…¨éƒ¨çš„keyã€‚7ã€è‡³æ­¤å®Œæˆæ•´ä¸ªè¿ç§»æµç¨‹è¿™ä¸­é—´å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œç¨‹åºå°±ä¼šåœæ­¢ã€‚æ²¡ä½¿ç”¨--copyæ¨¡å¼ï¼Œåˆ™å¯ä»¥é‡æ–°æ‰§è¡Œimportå‘½ä»¤ï¼Œä½¿ç”¨--copyçš„è¯ï¼Œæœ€å¥½æ¸…ç©ºæ–°çš„é›†ç¾¤å†å¯¼å…¥ä¸€æ¬¡ã€‚ importå‘½ä»¤æ›´é€‚åˆç¦»çº¿çš„æŠŠå¤–éƒ¨redisæ•°æ®å¯¼å…¥ï¼Œåœ¨çº¿å¯¼å…¥çš„è¯æœ€å¥½ä½¿ç”¨æ›´ä¸“ä¸šçš„å¯¼å…¥å·¥å…·ï¼Œä»¥slaveçš„æ–¹å¼è¿æ¥redisèŠ‚ç‚¹å»åŒæ­¥èŠ‚ç‚¹æ•°æ®åº”è¯¥æ˜¯æ›´å¥½çš„æ–¹å¼ã€‚","categories":[{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/categories/redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/tags/redis/"}],"author":"xiemx"},{"title":"redis-trib.rbæ„å»ºredisé›†ç¾¤","slug":"redis-trib-rb-create-cluster","date":"2017-02-26T20:02:11.000Z","updated":"2019-10-21T06:57:42.922Z","comments":true,"path":"/2017/02/27/redis-trib-rb-create-cluster/","link":"","permalink":"https://www.xiemx.com/2017/02/27/redis-trib-rb-create-cluster/","excerpt":"","text":"redis-cluster ä½¿ç”¨å®˜æ–¹çš„redis-trib.rbæ„å»ºredisé›†ç¾¤,è¦è®©redis clusteré›†ç¾¤æ­£å¸¸å·¥ä½œéœ€è¦æœ‰ä¸‰ä¸ªä¸»èŠ‚ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ä¸‰å°æœºå™¨ä¸Šéƒ¨ç½²6ä¸ªèŠ‚ç‚¹ï¼Œæ¯å°æœºå™¨ä¸€ä¸ªmasterä¸€ä¸ªslaveã€‚ ç¯å¢ƒï¼šp-hsg-redis-1 192.168.10.81 7000/7001p-hsg-redis-2 192.168.10.82 7000/7001p-hsg-redis-3 192.168.10.83 7000/7001 éƒ¨ç½²æµç¨‹ï¼š 1.å®‰è£…redisï¼server æˆ‘è¿™é‡Œå·²ç»æœ‰saltstackçš„è‡ªåŠ¨åŒ–æ„å»ºè„šæœ¬ï¼Œå› æ­¤ä½¿ç”¨saltå®‰è£…è½¯ä»¶ã€‚å…·ä½“rediså®‰è£…æ–¹æ³•ä¸å†èµ˜è¿°ã€‚salt-call state.sls redis.cluster 2.ä¿®æ”¹é…ç½®æ–‡ä»¶ 123456789root@p-hsg-redis-1:/etc/redis# cat /etc/redis/7000.confprotected-mode nodaemonize yesport 7000cluster-enabled yescluster-config-file nodes-7000.confcluster-node-timeout 15000appendonly yesdir /var/lib/redis/7000 3.å¯åŠ¨redisèŠ‚ç‚¹ 1234root@p-hsg-redis-3:/etc/redis# ps -ef | grep redisroot 30431 1 0 15:12 ? 00:00:00 /usr/local/bin/redis-server *:7001 [cluster]root 30446 1 0 15:12 ? 00:00:00 /usr/local/bin/redis-server *:7000 [cluster]root 30450 11073 0 15:12 pts/1 00:00:00 grep --color=auto redis 4.åˆ›å»ºé›†ç¾¤ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950redis-trib.rb create --replicas 1 192.168.10.81:7001 192.168.10.81:7000 192.168.10.82:7000 192.168.10.82:7001 192.168.10.83:7000 192.168.10.83:7001&gt;&gt;&gt; Creating cluster&gt;&gt;&gt; Performing hash slots allocation on 6 nodes...Using 3 masters:192.168.10.81:7001192.168.10.82:7000192.168.10.83:7000Adding replica 192.168.10.82:7001 to 192.168.10.81:7001Adding replica 192.168.10.81:7000 to 192.168.10.82:7000Adding replica 192.168.10.83:7001 to 192.168.10.83:7000M: 5fd250591aa474d6370e1df547959c5895716192 192.168.10.81:7001 slots:0-5460 (5461 slots) masterS: ef8bf8a326894fee37a398d3f88de3120fc71ea5 192.168.10.81:7000 replicates dc62f19b8894db1816f7b92e3fe05b8244832d3eM: dc62f19b8894db1816f7b92e3fe05b8244832d3e 192.168.10.82:7000 slots:5461-10922 (5462 slots) masterS: eb2c7cc3cb56bb5ee124d80e353a91331d092042 192.168.10.82:7001 replicates 5fd250591aa474d6370e1df547959c5895716192M: 1773d96052f573361a13b5e9015f947b340d45cd 192.168.10.83:7000 slots:10923-16383 (5461 slots) masterS: 670f158355b93b4a7ac30d69dc3e1e8c4c484a9f 192.168.10.83:7001 replicates 1773d96052f573361a13b5e9015f947b340d45cdCan I set the above configuration? (type 'yes' to accept): yes&gt;&gt;&gt; Nodes configuration updated&gt;&gt;&gt; Assign a different config epoch to each node&gt;&gt;&gt; Sending CLUSTER MEET messages to join the clusterWaiting for the cluster to join...&gt;&gt;&gt; Performing Cluster Check (using node 192.168.10.81:7001)M: 5fd250591aa474d6370e1df547959c5895716192 192.168.10.81:7001 slots:0-5460 (5461 slots) master 1 additional replica(s)M: 1773d96052f573361a13b5e9015f947b340d45cd 192.168.10.83:7000 slots:10923-16383 (5461 slots) master 1 additional replica(s)S: ef8bf8a326894fee37a398d3f88de3120fc71ea5 192.168.10.81:7000 slots: (0 slots) slave replicates dc62f19b8894db1816f7b92e3fe05b8244832d3eS: 670f158355b93b4a7ac30d69dc3e1e8c4c484a9f 192.168.10.83:7001 slots: (0 slots) slave replicates 1773d96052f573361a13b5e9015f947b340d45cdM: dc62f19b8894db1816f7b92e3fe05b8244832d3e 192.168.10.82:7000 slots:5461-10922 (5462 slots) master 1 additional replica(s)S: eb2c7cc3cb56bb5ee124d80e353a91331d092042 192.168.10.82:7001 slots: (0 slots) slave replicates 5fd250591aa474d6370e1df547959c5895716192[OK] All nodes agree about slots configuration.&gt;&gt;&gt; Check for open slots...&gt;&gt;&gt; Check slots coverage...[OK] All 16384 slots covered.","categories":[{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/categories/redis/"}],"tags":[{"name":"cluster","slug":"cluster","permalink":"https://www.xiemx.com/tags/cluster/"},{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/tags/redis/"}],"author":"xiemx"},{"title":"magentæ„å»ºmemcacheé›†ç¾¤","slug":"magent-create-memcache-cluster","date":"2017-02-08T23:02:18.000Z","updated":"2019-10-21T06:57:42.620Z","comments":true,"path":"/2017/02/09/magent-create-memcache-cluster/","link":"","permalink":"https://www.xiemx.com/2017/02/09/magent-create-memcache-cluster/","excerpt":"","text":"magentåŠŸèƒ½ç›¸å½“äºä¸€ä¸ªproxyè°ƒåº¦å™¨ï¼Œé€šè¿‡ä¸€å®šçš„ç®—æ³•å°†æ•°æ®å­˜åˆ°ä¸åŒåç«¯ã€‚magentåªæ˜¯ä¸€ä¸ªè°ƒåº¦å™¨ï¼Œä¸å¤„ç†æ•°æ®åŒæ­¥é—®é¢˜ã€‚ï¼ˆå¦å¤–ä¸€ä¸ªç”±twitterå¼€æºçš„twemproxyï¼ŒåŠŸèƒ½ä½œç”¨ç±»ä¼¼ã€‚å¯å‚è€ƒï¼štwemproxyå®‰è£…é…ç½®ï¼‰ éƒ¨ç½²ï¼š memcachedéƒ¨ç½²è‡ªè¡Œç™¾åº¦ã€‚ magentå‚è€ƒï¼šrepcacheï¼‹magentæ„å»ºé«˜å¯ç”¨memcache å¯åŠ¨3ä¸ªMemcachedè¿›ç¨‹,ç«¯å£11221ã€11222ã€11223. 123# memcached -u xiemx -d -p 11221# memcached -u xiemx -d -p 11222# memcached -u xiemx -d -p 11223 å¯åŠ¨magentè¿›ç¨‹ï¼Œç«¯å£11211ï¼Œ11221ã€11222ä¸ºmasterï¼Œ11223ä¸ºbackupï¼› 1magent -p 12000 -s 127.0.0.1:11221 -s127.0.0.1:11222 -b 127.0.0.1:11223 telnet 11211çš„magentï¼Œset key1å’Œset key2ï¼Œæ ¹æ®ç®—æ³•ï¼Œkey1/key2å°†è¢«åˆ†é…åˆ°11221/11222å’Œ11213ç«¯å£çš„Memcachedï¼› 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758[root@memcache ~]# telnet 127.0.0.1 11211Trying 127.0.0.1...Connected to 127.0.0.1.Escape character is '^]'.statsmemcached agent v0.4matrix 1 -&gt; 127.0.0.1:11221, pool size 0matrix 2 -&gt; 127.0.0.1:11222, pool size 0ENDset key1 0 0 11STOREDset key2 0 0 12STOREDquitConnection closed by foreign host.[root@memcache ~]# telnet 127.0.0.1 11221Trying 127.0.0.1...Connected to 127.0.0.1.Escape character is '^]'.get key1ENDget key2VALUE key2 0 12ENDquitConnection closed by foreign host.[root@memcache ~]# telnet 127.0.0.1 11222Trying 127.0.0.1...Connected to 127.0.0.1.Escape character is '^]'.get key1VALUE key1 0 11ENDget key2ENDquitConnection closed by foreign host.[root@memcache ~]# telnet 127.0.0.1 11223Trying 127.0.0.1...Connected to 127.0.0.1.Escape character is '^]'.get key1VALUE key1 0 11ENDget key2VALUE key2 0 12ENDquitConnection closed by foreign host. æ¨¡æ‹Ÿ11211ã€11212ç«¯å£çš„MemcachedæŒ‚æ‰ 123456789101112131415161718192021[root@memcache ~]# ps -ef | grep memcachedroot 6589 1 0 01:25 ? 00:00:00 memcached -u xiemx -d -p 11221root 6591 1 0 01:25 ? 00:00:00 memcached -u xiemx -d -p 11222root 6593 1 0 01:25 ? 00:00:00 memcached -u xiemx -d -p 11223root 6609 6509 001:44 pts/0 00:00:00 grep memcached[root@memcache ~]# kill -9 6589[root@memcache ~]# kill -9 6591[root@memcache ~]# telnet 127.0.0.1 11211Trying 127.0.0.1...Connected to 127.0.0.1.Escape character is '^]'.get key1 VALUE key1 0 11ENDget key2VALUE key2 0 12ENDquitConnection closed by foreign host. æ¨¡æ‹Ÿ11211ã€11212ç«¯å£çš„Memcachedé‡å¯å¤æ´»(æ¢å¤åçš„memcacheæ˜¯æ²¡æœ‰æ•°æ®çš„ï¼Œéœ€è¦é€»è¾‘å¤„ç†å¯åŠ¨åå¯¼å…¥æ•°æ®) 123456789101112[root@memcache ~]# memcached -m 1 -u root -d -l 127.0.0.1 -p 11221[root@memcache ~]# memcached -m 1 -u root -d -l 127.0.0.1 -p 11222[root@memcache ~]# telnet 127.0.0.1 11211Trying 127.0.0.1...Connected to 127.0.0.1.Escape character is '^]'.get key1ENDget key2ENDquitConnection closed by foreign host.","categories":[{"name":"memcached","slug":"memcached","permalink":"https://www.xiemx.com/categories/memcached/"}],"tags":[{"name":"cluster","slug":"cluster","permalink":"https://www.xiemx.com/tags/cluster/"},{"name":"memcached","slug":"memcached","permalink":"https://www.xiemx.com/tags/memcached/"},{"name":"database","slug":"database","permalink":"https://www.xiemx.com/tags/database/"}],"author":"xiemx"},{"title":"repcacheï¼‹magentæ„å»ºé«˜å¯ç”¨memcache","slug":"repcache-magent","date":"2017-02-08T22:02:53.000Z","updated":"2019-10-21T06:57:42.570Z","comments":true,"path":"/2017/02/09/repcache-magent/","link":"","permalink":"https://www.xiemx.com/2017/02/09/repcache-magent/","excerpt":"","text":"repcache+magnet magentï¼šä¸€æ¬¾å¼€æºçš„Memcachedä»£ç†æœåŠ¡å™¨è½¯ä»¶ï¼ŒåŠŸèƒ½å’Œmysql-proxyç±»ä¼¼ã€‚ repcacheï¼šæ—¥æœ¬å¼€å‘çš„ä¸€æ¬¾å¼€æºå·¥å…·ï¼Œä½¿memcacheèƒ½å¤Ÿåšä¸»ä»å¤åˆ¶ã€‚å¯ä»¥é€šè¿‡patchåŒ…å‡çº§memcacheï¼Œä¹Ÿå¯ä»¥ä¸‹è½½åŒ…å«replicationçš„memcacheç‰ˆæœ¬ å…ˆå°†master/slaveé€šè¿‡replicationæ„å»ºè‡ªåŠ¨å¤åˆ¶çš„ä¸»ä¸»ï¼Œé€šè¿‡magentå°†Kï¼Vï¼Œå†™å…¥åˆ°masterå’Œbackupä¸­ï¼Œå½“masterå®•æœºæ—¶ï¼Œmagentå°†æ‰€æœ‰è¯»å†™è¯·æ±‚äº¤ç»™slaveï¼Œslaveç­‰å¾…masterå¯åŠ¨ï¼Œé»˜è®¤æƒ…å†µä¸‹masterå®•æœºé‡å¯åå†…å­˜ä¸­çš„æ•°æ®å›ä¸¢å¤±ï¼Œä½†ç”±äºrepcacheçš„è‡ªåŠ¨ä¸»ä¸»ï¼Œmasterå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨ä»salveç«¯å¤åˆ¶æ‰€æœ‰æ•°æ®ã€‚ å®‰è£…éƒ¨ç½²123456789101112131415161718libevent: apt-get install -y libevent-devmagentï¼š wget http://memagent.googlecode.com/files/magent-0.5.tar.gz tar zxvf magent-0.5.tar.gz /sbin/ldconfig sed -i \"s#LIBS = -levent#LIBS = -levent -lm#g\" Makefile make cp magent /usr/bin/magent repcache: wget http://downloads.sourceforge.net/repcached/memcached-1.2.8-repcached-2.2.tar.gz tar xf memcached-1.2.8-repcached-2.2.tar.gz cd memcached-1.2.8-repcached-2.2/ ./configure --prefix=/opt/repcached/ --enable-replication --program-transform-name=s/memcached/repcached/ make&amp;&amp;make install ln -s /opt/repcached/bin/repcached /usr/bin/ ç¼–è¯‘é”™è¯¯æ±‡æ€»1234567891011121314151617181920212223242526272829### magent[root@test magent]# make gcc -Wall -g -O2 -I/usr/local/include -m64 -c -o magent.o magent.cmagent.c: In function â€˜writev_listâ€™:magent.c:729: error: â€˜SSIZE_MAXâ€™ undeclared (first use in this function)magent.c:729: error: (Each undeclared identifier is reported only oncemagent.c:729: error: for each function it appears in.)make: *** [magent.o] Error 1è§£å†³æ–¹æ³•:[root@test magent]# vim ketama.h#ifndef SSIZE_MAX#define SSIZE_MAX 32767#endif#ifndef _KETAMA_H#define _KETAMA_H[root@test magent]# make gcc -Wall -O2 -g -c -o magent.o magent.cgcc -Wall -O2 -g -c -o ketama.o ketama.cgcc -Wall -O2 -g -o magent magent.o ketama.o -leventketama.o: In function `create_ketama':/opt/root/magent-0.5/ketama.c:399: undefined reference to `floorf'collect2: ld returned 1 exit statusmake: *** [magent] Error 1ä¿®æ”¹MakefileLIBS = -levent ä¸ºLIBS = -levent -lm#sed -i \"s#LIBS = -levent#LIBS = -levent -lm#g\" Makefile 123456789101112131415161718192021222324252627282930313233343536373839### repcached[root@test magent]# make make all-recursive make[1]: Entering directory `/usr/local/memcached' Making all in doc make[2]: Entering directory `/usr/local/memcached/doc' make[2]: Nothing to be done for `all'. make[2]: Leaving directory `/usr/local/memcached/doc' make[2]: Entering directory `/usr/local/memcached' gcc -DHAVE_CONFIG_H -I. -DNDEBUG -m64 -g -O2 -MT memcached-memcached.o -MD MP -MF .deps/memcached-memcached.Tpo -c -o memcached-memcached.o `test -f memcached.c' || echo './'`memcached.c memcached.c: In function â€˜add_iovâ€™: memcached.c:697: error: â€˜IOV_MAXâ€™ undeclared (first use in this function) memcached.c:697: error: (Each undeclared identifier is reported only once memcached.c:697: error: for each function it appears in.) make[2]: *** [memcached-memcached.o] Error 1 make[2]: Leaving directory `/usr/local/memcached' make[1]: *** [all-recursive] Error 1 make[1]: Leaving directory `/usr/local/memcached' make: *** [all] Error 2 è§£å†³æ–¹æ¡ˆï¼š vi memcached.c å°†ä¸‹é¢çš„å‡ è¡Œ /* FreeBSD 4.x doesn't have IOV_MAX exposed. */ #ifndef IOV_MAX #if defined(__FreeBSD__) || defined(__APPLE__) # define IOV_MAX 1024 #endif #endif ä¿®æ”¹ä¸º/* FreeBSD 4.x doesn't have IOV_MAX exposed. */ #ifndef IOV_MAX # define IOV_MAX 1024 #endif å¯åŠ¨æœåŠ¡12345678910111213### å¯åŠ¨repcachedå¯åŠ¨masterï¼šrepcached -d -v -x 127.0.0.1 -u vagrant å¯åŠ¨slaveï¼šrepcached -d -v -x 127.0.0.1 -u vagrant -p 11222å‚æ•°è¯´æ˜ï¼š -x è®¾ç½®ä»å“ªä¸ªIPä¸Šè¿›è¡ŒåŒæ­¥ã€‚ -X æŒ‡å®šæ•°æ®åŒæ­¥çš„ç«¯å£ã€‚ Memcachedé»˜è®¤æœåŠ¡ç«¯å£æ˜¯11211ï¼Œé»˜è®¤åŒæ­¥ç›‘å¬ç«¯å£æ˜¯11212ã€‚### å¯åŠ¨magentmagent -u root -p 11233 -s 127.0.0.1:11211 -s 127.0.0.1:11222","categories":[{"name":"memcached","slug":"memcached","permalink":"https://www.xiemx.com/categories/memcached/"}],"tags":[{"name":"memcached","slug":"memcached","permalink":"https://www.xiemx.com/tags/memcached/"},{"name":"repcache","slug":"repcache","permalink":"https://www.xiemx.com/tags/repcache/"},{"name":"magent","slug":"magent","permalink":"https://www.xiemx.com/tags/magent/"}],"author":"xiemx"},{"title":"vagrantåˆ›å»ºå¤šä¸ªè™šæ‹Ÿæœº","slug":"vagrant-mulit-vm","date":"2017-02-08T22:02:30.000Z","updated":"2019-10-21T06:57:42.570Z","comments":true,"path":"/2017/02/09/vagrant-mulit-vm/","link":"","permalink":"https://www.xiemx.com/2017/02/09/vagrant-mulit-vm/","excerpt":"","text":"å»ºç«‹å¤šå°VMï¼Œä¸¦ä¸”è®©ä»–ä»¬ä¹‹é—´èƒ½å¤Ÿç›¸é€šä¿¡ï¼Œä¸€å°æ˜¯åº”ç”¨æœåŠ¡å™¨ã€ä¸€å°æ˜¯DBæœåŠ¡å™¨,å‚è€ƒå¦‚ä¸‹ 12345678910111213141516171819Vagrant.configure(\"2\") do |config| config.vm.define :web do |web| web.vm.provider \"virtualbox\" do |v| v.customize [\"modifyvm\", :id, \"--name\", \"web\", \"--memory\", \"512\"] end web.vm.box = \"base\" web.vm.hostname = \"xiemx-website\" web.vm.network :private_network, ip: \"10.11.1.1\" end config.vm.define :db do |db| db.vm.provider \"virtualbox\" do |v| v.customize [\"modifyvm\", :id, \"--name\", \"db\", \"--memory\", \"512\"] end db.vm.box = \"base\" db.vm.hostname = \"xiemx-db\" db.vm.network :private_network, ip: \"10.11.1.2\" endend","categories":[{"name":"vagrant","slug":"vagrant","permalink":"https://www.xiemx.com/categories/vagrant/"}],"tags":[],"author":"xiemx"},{"title":"vagrantä½¿ç”¨","slug":"vagrant","date":"2017-02-08T21:02:54.000Z","updated":"2019-10-21T06:57:42.697Z","comments":true,"path":"/2017/02/09/vagrant/","link":"","permalink":"https://www.xiemx.com/2017/02/09/vagrant/","excerpt":"","text":"åˆ é™¤æ–‡æ¡£ï¼Œå‚è€ƒå®˜æ–¹ï¼šhttps://www.vagrantup.com/docs/cli/","categories":[{"name":"vagrant","slug":"vagrant","permalink":"https://www.xiemx.com/categories/vagrant/"}],"tags":[{"name":"vagrant","slug":"vagrant","permalink":"https://www.xiemx.com/tags/vagrant/"}],"author":"xiemx"},{"title":"twemproxyé…ç½®æ–‡ä»¶è¯¦è§£","slug":"twemproxy-configure","date":"2017-02-08T21:02:29.000Z","updated":"2019-10-21T06:57:42.989Z","comments":true,"path":"/2017/02/09/twemproxy-configure/","link":"","permalink":"https://www.xiemx.com/2017/02/09/twemproxy-configure/","excerpt":"","text":"é…ç½®æ–‡ä»¶è¯¦è§£ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263listentwemproxyç›‘å¬çš„ç«¯å£ã€‚å¯ä»¥ä»¥ip:portæˆ–name:portçš„å½¢å¼æ¥ä¹¦å†™ã€‚ hashå¯ä»¥é€‰æ‹©çš„keyå€¼çš„hashç®—æ³•ï¼š&gt; one_at_a_time&gt; md5&gt; crc16&gt; crc32(crc32 implementation compatible with libmemcached)&gt; crc32a(correct crc32 implementation as per the spec)&gt; fnv1_64&gt; fnv1a_64&gt; fnv1_32&gt; fnv1a_32&gt; hsieh&gt; murmur&gt; jenkinså¦‚æœæ²¡é€‰æ‹©ï¼Œé»˜è®¤æ˜¯fnv1a_64ã€‚hash_taghash_tagå…è®¸æ ¹æ®keyçš„ä¸€ä¸ªéƒ¨åˆ†æ¥è®¡ç®—keyçš„hashå€¼ã€‚hash_tagç”±ä¸¤ä¸ªå­—ç¬¦ç»„æˆï¼Œä¸€ä¸ªæ˜¯hash_tagçš„å¼€å§‹ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯hash_tagçš„ç»“æŸï¼Œåœ¨hash_tagçš„å¼€å§‹å’Œç»“æŸä¹‹é—´ï¼Œæ˜¯å°†ç”¨äºè®¡ç®—keyçš„hashå€¼çš„éƒ¨åˆ†ï¼Œè®¡ç®—çš„ç»“æœä¼šç”¨äºé€‰æ‹©æœåŠ¡å™¨ã€‚ ä¾‹å¦‚ï¼šå¦‚æœhash_tagè¢«å®šä¹‰ä¸ºâ€&#123;&#125;â€ï¼Œé‚£ä¹ˆkeyå€¼ä¸º&quot;user:&#123;user1&#125;:ids&quot;å’Œ&quot;user:&#123;user1&#125;:tweets&quot;çš„hashå€¼éƒ½æ˜¯åŸºäºâ€user1â€ï¼Œæœ€ç»ˆä¼šè¢«æ˜ å°„åˆ°ç›¸åŒçš„æœåŠ¡å™¨ã€‚è€Œ&quot;user:user1:ids&quot;å°†ä¼šä½¿ç”¨æ•´ä¸ªkeyæ¥è®¡ç®—hashï¼Œå¯èƒ½ä¼šè¢«æ˜ å°„åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚ distributionå­˜åœ¨ketamaã€modulaå’Œrandom3ç§å¯é€‰çš„é…ç½®ã€‚å…¶å«ä¹‰å¦‚ä¸‹ï¼š (1)ketama ketamaä¸€è‡´æ€§hashç®—æ³•ï¼Œä¼šæ ¹æ®æœåŠ¡å™¨æ„é€ å‡ºä¸€ä¸ªhash ringï¼Œå¹¶ä¸ºringä¸Šçš„èŠ‚ç‚¹åˆ†é…hashèŒƒå›´ã€‚ketamaçš„ä¼˜åŠ¿åœ¨äºå•ä¸ªèŠ‚ç‚¹æ·»åŠ ã€åˆ é™¤ä¹‹åï¼Œä¼šæœ€å¤§ç¨‹åº¦ä¸Šä¿æŒæ•´ä¸ªç¾¤é›†ä¸­ç¼“å­˜çš„keyå€¼å¯ä»¥è¢«é‡ç”¨ã€‚ (2)modula modulaéå¸¸ç®€å•ï¼Œå°±æ˜¯æ ¹æ®keyå€¼çš„hashå€¼å–æ¨¡ï¼Œæ ¹æ®å–æ¨¡çš„ç»“æœé€‰æ‹©å¯¹åº”çš„æœåŠ¡å™¨ã€‚ (3)random randomæ˜¯æ— è®ºkeyå€¼çš„hashæ˜¯ä»€ä¹ˆï¼Œéƒ½éšæœºçš„é€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨ä½œä¸ºkeyå€¼æ“ä½œçš„ç›®æ ‡ã€‚ timeoutå•ä½æ˜¯æ¯«ç§’ï¼Œæ˜¯è¿æ¥åˆ°serverçš„è¶…æ—¶å€¼ã€‚é»˜è®¤æ˜¯æ°¸ä¹…ç­‰å¾…ã€‚ backlogç›‘å¬TCP çš„backlogï¼ˆè¿æ¥ç­‰å¾…é˜Ÿåˆ—ï¼‰çš„é•¿åº¦ï¼Œé»˜è®¤æ˜¯512ã€‚ preconnectæ˜¯ä¸€ä¸ªbooleanå€¼ï¼ŒæŒ‡ç¤ºtwemproxyæ˜¯å¦åº”è¯¥é¢„è¿æ¥poolä¸­çš„serverã€‚é»˜è®¤æ˜¯falseã€‚ redisæ˜¯ä¸€ä¸ªbooleanå€¼ï¼Œç”¨æ¥è¯†åˆ«åˆ°æœåŠ¡å™¨çš„é€šè®¯åè®®æ˜¯redisè¿˜æ˜¯memcachedã€‚é»˜è®¤æ˜¯falseã€‚ server_connectionsæ¯ä¸ªserverå¯ä»¥è¢«æ‰“å¼€çš„è¿æ¥æ•°ã€‚é»˜è®¤ï¼Œæ¯ä¸ªæœåŠ¡å™¨å¼€ä¸€ä¸ªè¿æ¥ã€‚ auto_eject_hostsæ˜¯ä¸€ä¸ªbooleanå€¼ï¼Œç”¨äºæ§åˆ¶twemproxyæ˜¯å¦åº”è¯¥æ ¹æ®serverçš„è¿æ¥çŠ¶æ€é‡å»ºç¾¤é›†ã€‚è¿™ä¸ªè¿æ¥çŠ¶æ€æ˜¯ç”±server_failure_limit é˜€å€¼æ¥æ§åˆ¶ã€‚é»˜è®¤æ˜¯falseã€‚ server_retry_timeoutå•ä½æ˜¯æ¯«ç§’ï¼Œæ§åˆ¶æœåŠ¡å™¨è¿æ¥çš„æ—¶é—´é—´éš”ï¼Œåœ¨auto_eject_hostè¢«è®¾ç½®ä¸ºtrueçš„æ—¶å€™äº§ç”Ÿä½œç”¨ã€‚é»˜è®¤æ˜¯30000 æ¯«ç§’ã€‚ server_failure_limitæ§åˆ¶è¿æ¥æœåŠ¡å™¨çš„æ¬¡æ•°ï¼Œåœ¨auto_eject_hostè¢«è®¾ç½®ä¸ºtrueçš„æ—¶å€™äº§ç”Ÿä½œç”¨ã€‚é»˜è®¤æ˜¯2ã€‚ serversä¸€ä¸ªpoolä¸­çš„æœåŠ¡å™¨çš„åœ°å€ã€ç«¯å£å’Œæƒé‡çš„åˆ—è¡¨ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå¯é€‰çš„æœåŠ¡å™¨çš„åå­—ï¼Œå¦‚æœæä¾›æœåŠ¡å™¨çš„åå­—ï¼Œå°†ä¼šä½¿ç”¨å®ƒå†³å®šserverçš„æ¬¡åºï¼Œä»è€Œæä¾›å¯¹åº”çš„ä¸€è‡´æ€§hashçš„hash ringã€‚å¦åˆ™ï¼Œå°†ä½¿ç”¨serverè¢«å®šä¹‰çš„æ¬¡åº","categories":[{"name":"memcached","slug":"memcached","permalink":"https://www.xiemx.com/categories/memcached/"},{"name":"redis","slug":"memcached/redis","permalink":"https://www.xiemx.com/categories/memcached/redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/tags/redis/"},{"name":"twemproxy","slug":"twemproxy","permalink":"https://www.xiemx.com/tags/twemproxy/"},{"name":"memcache","slug":"memcache","permalink":"https://www.xiemx.com/tags/memcache/"}],"author":"xiemx"},{"title":"twemproxyæ„å»ºredis/memcacheé›†ç¾¤","slug":"twemproxu","date":"2017-02-08T21:02:12.000Z","updated":"2019-10-21T06:57:42.606Z","comments":true,"path":"/2017/02/09/twemproxu/","link":"","permalink":"https://www.xiemx.com/2017/02/09/twemproxu/","excerpt":"","text":"twemproxyæ„å»ºmemcacheé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æ„å»ºreidsé›†ç¾¤ã€‚æ–¹æ³•ç±»ä¼¼åªæ˜¯é…ç½®æ–‡ä»¶ä¸åŒã€‚ å®˜ç½‘æè¿°ï¼š A fast, light-weight proxy for memcached and redis å®‰è£…é…ç½®123456789101112131415161718192021222324252627282930$ apt-get install libtool automake -y$ git clone https://github.com/twitter/twemproxy.git$ cd twemproxy$ autoreconf -fvi$ ./configure$ make$ src/nutcracker -hroot@vagrant-ubuntu-trusty-64:~# nutcracker -hThis is nutcracker-0.4.1Usage: nutcracker [-?hVdDt] [-v verbosity level] [-o output file] [-c conf file] [-s stats port] [-a stats addr] [-i stats interval] [-p pid file] [-m mbuf size]Options: -h, --help : this help -V, --version : show version and exit -t, --test-conf : test configuration for syntax errors and exit -d, --daemonize : run as a daemon -D, --describe-stats : print stats description and exit -v, --verbose=N : set logging level (default: 5, min: 0, max: 11) -o, --output=S : set logging file (default: stderr) -c, --conf-file=S : set configuration file (default: conf/nutcracker.yml) -s, --stats-port=N : set stats monitoring port (default: 22222) -a, --stats-addr=S : set stats monitoring ip (default: 0.0.0.0) -i, --stats-interval=N : set stats aggregation interval in msec (default: 30000 msec) -p, --pid-file=S : set pid file (default: off) -m, --mbuf-size=N : set size of mbuf chunk in bytes (default: 16384 bytes) åˆ›å»ºé›†ç¾¤12345678910111213141516171819202122232425262728293031323334#ç”¨tweaproxyå¯åŠ¨ä»£ç†ä¸€ç»„memcachedï¼rediséå¸¸ç®€å•ï¼Œåªéœ€è¦æŒ‡å®šé…ç½®æ–‡ä»¶å³å¯ï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†èŒƒæœ¬åœ¨ä»“åº“çš„conf/ä¸‹vagrant@memcache-server:~$ cat nutcracker.ymlmemcache: listen: 127.0.0.1:11211 hash: fnv1a_64 distribution: ketama auto_eject_hosts: true server_retry_timeout: 2000 server_failure_limit: 1 servers: - 127.0.0.1:11221:1 - 127.0.0.1:11222:1 - 127.0.0.1:11223:1#å¯åŠ¨åç«¯çš„memcachedvagrant@memcache-server:~$ ps -ef | grep memcachevagrant 17934 1 0 09:07 ? 00:00:00 memcached -d -p 11221vagrant 17942 1 0 09:07 ? 00:00:00 memcached -d -p 11222vagrant 17950 1 0 09:07 ? 00:00:00 memcached -d -p 11223vagrant 18295 18083 0 09:20 pts/0 00:00:00 grep --color=auto memcachevagrant@memcache-server:~$ nutcracker -c nutcracker.yml -dvagrant@memcache-server:~$ telnet localhost 11211Trying 127.0.0.1...Connected to localhost.Escape character is '^]'.set test 0 0 11STOREDget testVALUE test 0 11END","categories":[{"name":"memcached","slug":"memcached","permalink":"https://www.xiemx.com/categories/memcached/"},{"name":"redis","slug":"memcached/redis","permalink":"https://www.xiemx.com/categories/memcached/redis/"}],"tags":[{"name":"cluster","slug":"cluster","permalink":"https://www.xiemx.com/tags/cluster/"},{"name":"memcached","slug":"memcached","permalink":"https://www.xiemx.com/tags/memcached/"},{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/tags/redis/"},{"name":"twemproxy","slug":"twemproxy","permalink":"https://www.xiemx.com/tags/twemproxy/"}],"author":"xiemx"},{"title":"Vagrantfileé…ç½®","slug":"vagrantfile","date":"2017-02-08T21:02:02.000Z","updated":"2019-10-21T06:57:42.922Z","comments":true,"path":"/2017/02/09/vagrantfile/","link":"","permalink":"https://www.xiemx.com/2017/02/09/vagrantfile/","excerpt":"","text":"åˆ é™¤åŸå§‹æ–‡æ¡£ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://www.vagrantup.com/docs/vagrantfile/","categories":[{"name":"vagrant","slug":"vagrant","permalink":"https://www.xiemx.com/categories/vagrant/"}],"tags":[{"name":"vagrant","slug":"vagrant","permalink":"https://www.xiemx.com/tags/vagrant/"}],"author":"xiemx"},{"title":"vcenteræ‰©å®¹Linuxè™šæ‹Ÿæœºç£ç›˜","slug":"vcenter-expand-disk-to-linux","date":"2017-01-19T03:01:34.000Z","updated":"2019-10-21T06:57:42.697Z","comments":true,"path":"/2017/01/19/vcenter-expand-disk-to-linux/","link":"","permalink":"https://www.xiemx.com/2017/01/19/vcenter-expand-disk-to-linux/","excerpt":"","text":"ç£ç›˜æ‰©å®¹100G1.vcenteræ‰©å®¹ç£ç›˜vcenterå¢åŠ æ­¥éª¤å‚è€ƒï¼švcenteræ‰©å®¹windowç£ç›˜ 2.Linuxéœ€è¦rescanç£ç›˜ï¼Œé‡æ–°è¯»åˆ°å¤§å° 1234æ–¹æ³•1:rebootæ–¹æ³•2:[root@localhost ~]# echo 1 &gt; /sys/block/sdc/device/rescan 3.fdiskåˆ›å»ºæ–°åˆ†åŒº æ³¨æ„åˆ›å»ºæ–°çš„ç£ç›˜åå†…æ ¸å¯èƒ½æ— æ³•è¯†åˆ«åˆ°åˆ†åŒºè¡¨ï¼Œéœ€è¦è¿è¡Œpartprobeåˆ·æ–°ä¸‹åˆ†åŒºè¡¨ä¿¡æ¯ 4.lvmåŠ¨æ€æ‰©å®¹lvmå‚è€ƒï¼šlvmåŠ¨æ€ç£ç›˜ç®¡ç† å®Œæˆåï¼š","categories":[{"name":"vcenter","slug":"vcenter","permalink":"https://www.xiemx.com/categories/vcenter/"}],"tags":[{"name":"vcenter","slug":"vcenter","permalink":"https://www.xiemx.com/tags/vcenter/"}],"author":"xiemx"},{"title":"nginx server_name_hash_bucket_size","slug":"nginx-server_name_hash_bucket_size","date":"2017-01-18T03:01:15.000Z","updated":"2019-10-21T06:57:43.017Z","comments":true,"path":"/2017/01/18/nginx-server_name_hash_bucket_size/","link":"","permalink":"https://www.xiemx.com/2017/01/18/nginx-server_name_hash_bucket_size/","excerpt":"","text":"nginxé»˜è®¤çš„ server_name_hash_bucket_size ä¸€èˆ¬ä¸º32/64ï¼Œå¦‚æœé…ç½®äº†è¶…é•¿çš„server_nameå»ºè®®é€‚å½“å¢å¤§æ­¤å‚æ•° 123http &#123; server_names_hash_bucket_size 512;&#125;","categories":[{"name":"nginx","slug":"nginx","permalink":"https://www.xiemx.com/categories/nginx/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://www.xiemx.com/tags/nginx/"}],"author":"xiemx"},{"title":"nginxé˜²ç›—é“¾é…ç½®","slug":"nginx-referer","date":"2017-01-17T18:01:18.000Z","updated":"2019-10-19T10:12:29.779Z","comments":true,"path":"/2017/01/18/nginx-referer/","link":"","permalink":"https://www.xiemx.com/2017/01/18/nginx-referer/","excerpt":"","text":"123456location ~* \\.(gif|jpg|jpeg|png|ico)$ &#123; valid_referers none blocked server_names *.xiemx.com; if ($invalid_referer) &#123; return 444 &#125;&#125;","categories":[{"name":"nginx","slug":"nginx","permalink":"https://www.xiemx.com/categories/nginx/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://www.xiemx.com/tags/nginx/"}],"author":"xiemx"},{"title":"docker privileged","slug":"docker-privileged","date":"2017-01-17T17:01:49.000Z","updated":"2019-10-21T06:57:43.060Z","comments":true,"path":"/2017/01/18/docker-privileged/","link":"","permalink":"https://www.xiemx.com/2017/01/18/docker-privileged/","excerpt":"","text":"docker ç‰¹æƒæ¨¡å¼1234$ docker help run ...--privileged=false Give extended privileges to this container... ä½¿ç”¨è¯¥å‚æ•°ï¼Œcontainerå†…çš„rootæ‹¥æœ‰çœŸæ­£çš„rootæƒé™ã€‚å¦åˆ™ï¼Œcontainerå†…çš„rootåªæ˜¯å¤–éƒ¨çš„ä¸€ä¸ªæ™®é€šç”¨æˆ·æƒé™ã€‚privilegedå¯åŠ¨çš„å®¹å™¨ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šhostä¸Šçš„è®¾å¤‡ï¼Œå¹¶ä¸”å¯ä»¥æ‰§è¡Œmount,iptablesç­‰æ“ä½œã€‚ç”šè‡³å…è®¸ä½ åœ¨dockerå®¹å™¨ä¸­å¯åŠ¨dockerå®¹å™¨ã€‚ æœªè®¾ç½®privilegedå¯åŠ¨çš„å®¹å™¨ï¼š 1234567[root@localhost ~]# docker run -t -i centos:latest bash[root@65acccbba42f /]# ls /devconsole fd full fuse kcore null ptmx pts random shm stderr stdin stdout tty urandom zero[root@65acccbba42f /]# mkdir /home/test/[root@65acccbba42f /]# mkdir /home/test2/[root@65acccbba42f /]# mount -o bind /home/test /home/test2mount: permission denied è®¾ç½®privilegedå¯åŠ¨çš„å®¹å™¨ï¼š 1234567891011121314[root@localhost ~]# docker run -t -i --privileged centos:latest bash[root@c39330902b45 /]# ls /dev/autofs dm-1 hidraw0 loop1 null ptp3 sg0 shm tty10 tty19 tty27 tty35 tty43 tty51 tty6 ttyS1 usbmon3 vcs5 vfiobsg dm-2 hidraw1 loop2 nvram pts sg1 snapshot tty11 tty2 tty28 tty36 tty44 tty52 tty60 ttyS2 usbmon4 vcs6 vga_arbiterbtrfs-control dm-3 hpet loop3 oldmem random sg2 snd tty12 tty20 tty29 tty37 tty45 tty53 tty61 ttyS3 usbmon5 vcsa vhost-netbus dm-4 input mapper port raw sg3 stderr tty13 tty21 tty3 tty38 tty46 tty54 tty62 uhid usbmon6 vcsa1 watchdogconsole dm-5 kcore mcelog ppp rtc0 sg4 stdin tty14 tty22 tty30 tty39 tty47 tty55 tty63 uinput vcs vcsa2 watchdog0cpu dm-6 kmsg mem ptmx sda sg5 stdout tty15 tty23 tty31 tty4 tty48 tty56 tty7 urandom vcs1 vcsa3 zerocpu_dma_latency fd kvm net ptp0 sda1 sg6 tty tty16 tty24 tty32 tty40 tty49 tty57 tty8 usbmon0 vcs2 vcsa4crash full loop-control network_latency ptp1 sda2 sg7 tty0 tty17 tty25 tty33 tty41 tty5 tty58 tty9 usbmon1 vcs3 vcsa5dm-0 fuse loop0 network_throughput ptp2 sda3 sg8 tty1 tty18 tty26 tty34 tty42 tty50 tty59 ttyS0 usbmon2 vcs4 vcsa6[root@c39330902b45 /]# mkdir /home/test/[root@c39330902b45 /]# mkdir /home/test2/[root@c39330902b45 /]# mount -o bind /home/test /home/test2","categories":[{"name":"docker","slug":"docker","permalink":"https://www.xiemx.com/categories/docker/"}],"tags":[],"author":"xiemx"},{"title":"iis7å¦‚ä½•æŸ¥çœ‹è¿›ç¨‹å·å¯¹åº”çš„ç½‘ç«™","slug":"iis-get-pid","date":"2017-01-16T21:01:45.000Z","updated":"2019-10-21T06:57:42.478Z","comments":true,"path":"/2017/01/17/iis-get-pid/","link":"","permalink":"https://www.xiemx.com/2017/01/17/iis-get-pid/","excerpt":"","text":"1.è·å–pid 2.æŸ¥è¯¢ç¨‹åºæ± å¯¹åº”çš„pidï¼Œæ ¹æ®applicationpoolæ¥æŸ¥æ‰¾å¯¹åº”ç½‘ç«™ 1%windir%/system32/inetsrv/appcmd list wp","categories":[{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/categories/windows/"},{"name":"iis","slug":"windows/iis","permalink":"https://www.xiemx.com/categories/windows/iis/"}],"tags":[{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"},{"name":"iis","slug":"iis","permalink":"https://www.xiemx.com/tags/iis/"},{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/tags/windows/"}],"author":"xiemx"},{"title":"vcenteræ‰©å®¹windowç£ç›˜","slug":"vcenter-expand-disk-to-windows","date":"2017-01-11T19:01:41.000Z","updated":"2019-10-21T06:57:42.593Z","comments":true,"path":"/2017/01/12/vcenter-expand-disk-to-windows/","link":"","permalink":"https://www.xiemx.com/2017/01/12/vcenter-expand-disk-to-windows/","excerpt":"","text":"1.vcenterä¸­å¢åŠ ç£ç›˜å¤§å°ï¼ŒåŸæœ¬æ˜¯80Gç°åœ¨æ‰©å®¹100G 2.Linuxç³»ç»Ÿä¸­é‡æ–°æ‰«æç£ç›˜","categories":[{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/categories/windows/"},{"name":"vcenter","slug":"windows/vcenter","permalink":"https://www.xiemx.com/categories/windows/vcenter/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/tags/windows/"},{"name":"vcenter","slug":"vcenter","permalink":"https://www.xiemx.com/tags/vcenter/"}],"author":"xiemx"},{"title":"start-stop-daemon ç”¨æ³•","slug":"linux-start-stop-daemon","date":"2017-01-07T03:01:59.000Z","updated":"2019-10-21T06:57:42.835Z","comments":true,"path":"/2017/01/07/linux-start-stop-daemon/","link":"","permalink":"https://www.xiemx.com/2017/01/07/linux-start-stop-daemon/","excerpt":"","text":"start-stop-daemonï¼Œç”¨æ¥å¯åŠ¨åœæ­¢ç³»ç»Ÿä¸­çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œ/etc/init.d/ä¸‹çš„è„šæœ¬ä¸­ä¼šç”¨åˆ°è¿™ä¸ªå‘½ä»¤å»å¯åŠ¨ã€åœæ­¢ã€æŸ¥è¯¢è¿™ä¸ªå‘½ä»¤ã€‚å¯ä»¥æŸ¥è¯¢å­¦ä¹ ä¸‹é«˜ç©çš„ç”¨æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233å‚æ•°ï¼š-S|--start -- &lt;argument&gt; ... å¼€å¯ä¸€ä¸ªç³»ç»Ÿå®ˆæŠ¤ç¨‹åºï¼Œå¹¶ä¼ é€’å‚æ•°ç»™å®ƒ -K|--stop åœæ­¢ä¸€ä¸ªç¨‹åº -T|--status å¾—åˆ°ç¨‹åºçš„çŠ¶æ€ -H|--help æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ -V|--version æ‰“å°ç‰ˆæœ¬ä¿¡æ¯ Matching options (at least one is required): -p|--pidfile &lt;pid-file&gt; pid file to check -x|--exec &lt;executable&gt; program to start/check if it is running -n|--name &lt;process-name&gt; process name to check -u|--user &lt;username|uid&gt; process owner to check Options: -g|--group &lt;group|gid&gt; æŒ‰æŒ‡å®šç”¨æˆ·ç»„æƒé™è¿è¡Œç¨‹åº -c|--chuid &lt;name|uid[:group|gid]&gt; æŒ‰æŒ‡å®šç”¨æˆ·ã€ç”¨æˆ·ç»„æƒé™è¿è¡Œç¨‹åº -s|--signal &lt;signal&gt; signal to send (default TERM) -a|--startas &lt;pathname&gt; program to start (default is &lt;executable&gt;) -r|--chroot &lt;directory&gt; chroot to &lt;directory&gt; before starting -d|--chdir &lt;directory&gt; change to &lt;directory&gt; (default is /) -N|--nicelevel &lt;incr&gt; add incr to the process' nice level -P|--procsched &lt;policy[:prio]&gt; use &lt;policy&gt; with &lt;prio&gt; for the kernel process scheduler (default prio is 0) -I|--iosched &lt;class[:prio]&gt; use &lt;class&gt; with &lt;prio&gt; to set the IO scheduler (default prio is 4) -k|--umask &lt;mask&gt; åœ¨å¼€å§‹è¿è¡Œå‰è®¾ç½®&lt;mask&gt; -b|--background åå°è¿è¡Œ -m|--make-pidfile å½“å‘½ä»¤æœ¬èº«ä¸åˆ›å»ºpidfileæ—¶ï¼Œç”±start-stop-daemonåˆ›å»º -R|--retry &lt;schedule&gt; ç­‰å¾…timeoutçš„æ—¶é—´ï¼Œæ£€æŸ¥è¿›ç¨‹æ˜¯å¦åœæ­¢ï¼Œå¦‚æœæ²¡æœ‰å‘é€KILLä¿¡å·ï¼› -t|--test æµ‹è¯•æ¨¡å¼ -o|--oknodo exit status 0 (not 1) if nothing done -q|--quiet ä¸è¦è¾“å‡ºè­¦å‘Š -v|--verbose æ˜¾ç¤ºè¿è¡Œè¿‡ç¨‹ä¿¡æ¯ å¼€å¯ä¸€ä¸ªdaemonè¿›ç¨‹ 12start-stop-daemon --start --background --exec /test.py -- -c /test.conf # -- åçš„å‚æ•°ä¼šä¼ é€’ç»™ /test.py,ç›¸å½“äº/test.py -c /test.conf å…³é—­ä¸€ä¸ªdaemonè¿›ç¨‹ 1start-stop-daemon --stop --name proxy.py","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"nf_conntrackä¸¢åŒ…","slug":"linux-nf-conntrack-drop-package","date":"2016-12-19T17:12:44.000Z","updated":"2019-10-21T06:57:42.328Z","comments":true,"path":"/2016/12/20/linux-nf-conntrack-drop-package/","link":"","permalink":"https://www.xiemx.com/2016/12/20/linux-nf-conntrack-drop-package/","excerpt":"","text":"ç°è±¡ nf_conntrack/ip_conntrack è·Ÿ nat æœ‰å…³ï¼Œç”¨æ¥è·Ÿè¸ªè¿æ¥æ¡ç›®ï¼Œå®ƒä¼šä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨æ¥è®°å½• established çš„è®°å½•ã€‚å¦‚æœè¯¥å“ˆå¸Œè¡¨æ»¡äº†ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚ åŸå› æ˜¯nf_conntrack: table full, dropping packetï¼ŒCONNTRACK_MAX å…è®¸çš„æœ€å¤§è·Ÿè¸ªè¿æ¥æ¡ç›®è¶…è¿‡äº†æˆ‘ä»¬è®¾ç½®çš„é˜€å€¼65535 è§£å†³ï¼š1echo \"net.nf_conntrack_max=655350\" &gt;&gt; /etc/sysctl.conf&amp;&amp;sysctl -p","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"},{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"zabbixç›‘æ§redis","slug":"zabbix-monitor-redis","date":"2016-12-18T21:12:43.000Z","updated":"2019-10-21T06:57:42.697Z","comments":true,"path":"/2016/12/19/zabbix-monitor-redis/","link":"","permalink":"https://www.xiemx.com/2016/12/19/zabbix-monitor-redis/","excerpt":"","text":"å¯é…åˆzabbixè‡ªåŠ¨å‘ç°ï¼Œæ¥å®Œæˆè‡ªåŠ¨ç›‘æ§ scripts1234567891011121314151617181920212223242526cat redis.sh#!/bin/bashredis_conn=\"/usr/local/bin/redis-cli\"port=$1case $2 in \"used_memory\") used_memory=`$redis_conn -p $port info | grep used_memory:|awk -F':' '&#123;print $2&#125;'` echo $used_memory ;; \"ops_sec\") ops=`$redis_conn -p $port info|grep instantaneous_ops_per_sec:|awk -F':' '&#123;print $2&#125;'` echo $ops ;; \"connected_clients\") connected_clients=`$redis_conn -p $port info|grep connected_clients: | awk -F ':' '&#123;print $2&#125;'` echo $connected_clients ;; \"blocked_clients\") blocked_clients=`$redis_conn -p $port info|grep blocked_clients:|awk -F':' '&#123;print $2&#125;'` echo $blocked_clients ;; *) echo \"please input used_memory|ops_sec|connected_clients|blocked_clients\" ;; esac confæ–‡ä»¶123cat zabbix_redis.confUserParameter=redis[*],/opt/script/zabbix/redis.sh $1 $2","categories":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/categories/zabbix/"}],"tags":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/tags/zabbix/"},{"name":"scripts","slug":"scripts","permalink":"https://www.xiemx.com/tags/scripts/"}],"author":"xiemx"},{"title":"zabbixç›‘æ§mongo","slug":"zabbix-monitor-mongo","date":"2016-12-18T21:12:27.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2016/12/19/zabbix-monitor-mongo/","link":"","permalink":"https://www.xiemx.com/2016/12/19/zabbix-monitor-mongo/","excerpt":"","text":"å¯é…åˆzabbixè‡ªåŠ¨å‘ç°ï¼Œè‡ªåŠ¨ç›‘æ§æœåŠ¡ script12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485cat mongo.sh#!/bin/bashcase $1 in # use_memory)# used_memory=`echo \"db.serverStatus().mem\"|mongo admin|grep resident|awk -F':' '&#123;print $2&#125;'|tr -d \" ,\"`# echo $used_memory# ;;# # use_vmemory)# used_vmemory=`echo \"db.serverStatus().mem\"|mongo admin|grep virtual|awk -F':' '&#123;print $2&#125;'|tr -d \" ,\"`# echo $used_vmemory# ;;# # used_conn)# used_conn=`echo \"db.serverStatus().connections\"|mongo admin|grep current|awk -F':' '&#123;print $2&#125;'|tr -d ' ,'`# echo $used_conn# ;;# # available_conn)# available=`echo \"db.serverStatus().connections\"|mongo admin|grep available|awk -F':' '&#123;print $2&#125;'|tr -d ' ,'`# echo $availabe# ;; insert) insert=`mongostat -n1 | tail -n 1|awk '&#123;print $1&#125;'|tr -d ' *,'` echo $insert ;; query) query=`mongostat -n1 | tail -n 1|awk '&#123;print $2&#125;'|tr -d ' *,'` echo $query ;; update) update=`mongostat -n1 | tail -n 1|awk '&#123;print $3&#125;'|tr -d ' *,'` echo $update ;; delete) delete=`mongostat -n1 | tail -n 1|awk '&#123;print $4&#125;'|tr -d ' *,'` echo $delete ;; getmore) getmore=`mongostat -n1 | tail -n 1|awk '&#123;print $5&#125;'|tr -d ' *,'` echo $getmore ;; command) command=`mongostat -n1 | tail -n 1|awk '&#123;print $6&#125;'|awk -F'|' '&#123;print $1&#125;'|tr -d ' *,'` echo $command ;; vsize) vsize=`mongostat -n1 | tail -n 1|awk '&#123;print $10&#125;'|tr -d ' *,G'` echo $vsize ;; res) res=`mongostat -n1 | tail -n 1|awk '&#123;print $11&#125;'|tr -d ' *,G'` echo $res ;; qr) qr=`mongostat -n1 | tail -n 1|awk '&#123;print $12&#125;'|awk -F'|' '&#123;print $1&#125;'|tr -d ' *,'` echo $qr ;; qw) qw=`mongostat -n1 | tail -n 1|awk '&#123;print $12&#125;'|awk -F'|' '&#123;print $2&#125;'|tr -d ' *,'` echo $qw ;; ar) ar=`mongostat -n1 | tail -n 1|awk '&#123;print $13&#125;'|awk -F'|' '&#123;print $1&#125;'|tr -d ' *,'` echo $ar ;; aw) aw=`mongostat -n1 | tail -n 1|awk '&#123;print $13&#125;'|awk -F'|' '&#123;print $2&#125;'|tr -d ' *,'` echo $aw ;; conn) conn=`mongostat -n1 | tail -n 1|awk '&#123;print $16&#125;'|tr -d ' *,'` echo $conn ;; *) echo \"please input insert|query|update|delete\" ;;esac confé…ç½®æ–‡ä»¶12cat zabbix_mongo.confUserParameter=mongo[*],/opt/script/zabbix/mongo.sh $1","categories":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/categories/zabbix/"}],"tags":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/tags/zabbix/"},{"name":"mongo","slug":"mongo","permalink":"https://www.xiemx.com/tags/mongo/"}],"author":"xiemx"},{"title":"zabbixç›‘æ§memcache","slug":"zabbix-monitor-memcache","date":"2016-12-18T21:12:02.000Z","updated":"2019-10-21T06:57:42.702Z","comments":true,"path":"/2016/12/19/zabbix-monitor-memcache/","link":"","permalink":"https://www.xiemx.com/2016/12/19/zabbix-monitor-memcache/","excerpt":"","text":"script12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152cat memcached.sh#!/bin/bashport=$1mem_conn=\"/bin/nc 127.0.0.1 $port\"case $2 in conn) conn=`echo -e \"stats\\nquit\"|$mem_conn|grep curr_connections | awk '&#123;print $3&#125;' ` echo $conn ;; bytes) bytes=`echo -e \"stats\\nquit\"|$mem_conn|grep bytes|awk '&#123;print $3&#125;'` echo `echo $bytes |tr -d \" \"` ;; cmd_get) cmd_get=`echo -e \"stats\\nquit\"|$mem_conn|grep cmd_get| awk '&#123;print $3&#125;' ` echo $cmd_get ;; cmd_set) cmd_set=`echo -e \"stats\\nquit\"|$mem_conn|grep cmd_set| awk '&#123;print $3&#125;' ` echo $cmd_set ;; get_hits) get_hits=`echo -e \"stats\\nquit\"|$mem_conn|grep get_hits| awk '&#123;print $3&#125;' ` echo $get_hits ;; read_qps_sec) count1=`echo -e \"stats\\nquit\"|$mem_conn|grep cmd_get| awk '&#123;print $3&#125;'|tr -d '\\r' ` sleep 1 count2=`echo -e \"stats\\nquit\"|$mem_conn|grep cmd_get| awk '&#123;print $3&#125;'|tr -d '\\r' ` count=` expr $count2 - $count1` echo $count ;; write_qps_sec) count1=`echo -e \"stats\\nquit\"|$mem_conn|grep cmd_set| awk '&#123;print $3&#125;' ` sleep 1 count2=`echo -e \"stats\\nquit\"|$mem_conn|grep cmd_set| awk '&#123;print $3&#125;' ` count=`echo $count2 $count1|awk '&#123;printf($1-$2)&#125;'` echo $count ;; hit_target) cmd_get=`echo -e \"stats\\nquit\"|$mem_conn|grep cmd_get| awk '&#123;print $3&#125;' ` get_hits=`echo -e \"stats\\nquit\"|$mem_conn|grep get_hits| awk '&#123;print $3&#125;' ` hit_target=`echo $get_hits $cmd_get|awk '&#123;printf($1*100/$2)&#125;'` echo $hit_target ;; *) echo \"please input conn|bytes|cmd_get|cmd_set|get_hits|read_qps_sec|write_qps_sec|hit_target\" ;;esac é…ç½®æ–‡ä»¶æ”¾åˆ°zabbixçš„conf.d/ç›®å½•ä¸‹ï¼Œ12cat zabbix_memcache.confUserParameter=memcache[*],/opt/script/zabbix/memcached.sh $1 $2","categories":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/categories/zabbix/"}],"tags":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/tags/zabbix/"},{"name":"monitor","slug":"monitor","permalink":"https://www.xiemx.com/tags/monitor/"},{"name":"memcache","slug":"memcache","permalink":"https://www.xiemx.com/tags/memcache/"}],"author":"xiemx"},{"title":"nginx websocket proxying","slug":"nginx-websocket-proxying","date":"2016-12-13T17:12:43.000Z","updated":"2019-10-21T06:57:42.989Z","comments":true,"path":"/2016/12/14/nginx-websocket-proxying/","link":"","permalink":"https://www.xiemx.com/2016/12/14/nginx-websocket-proxying/","excerpt":"","text":"server { ... location /chat/ { proxy_pass http://backend; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; } } å®˜æ–¹å…³äºwebsocket proxyingçš„æ–‡æ¡£ï¼šhttp://nginx.org/en/docs/http/websocket.html","categories":[{"name":"nginx","slug":"nginx","permalink":"https://www.xiemx.com/categories/nginx/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://www.xiemx.com/tags/nginx/"},{"name":"websocket","slug":"websocket","permalink":"https://www.xiemx.com/tags/websocket/"}],"author":"xiemx"},{"title":"zabbix ç›‘æ§sslè¯ä¹¦è¿‡æœŸæ—¶é—´","slug":"zabbix-monitor-ssl-cert","date":"2016-12-05T02:12:45.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2016/12/05/zabbix-monitor-ssl-cert/","link":"","permalink":"https://www.xiemx.com/2016/12/05/zabbix-monitor-ssl-cert/","excerpt":"","text":"è„šæœ¬æ˜¯å‚è€ƒç½‘ä¸Šä¿®æ”¹è¿‡çš„ç‰ˆæœ¬ï¼Œæ³¨æ„è¦æŒ‡å®šservernameå‚æ•°ï¼Œä»¥å…æŠ“å–åˆ°å…¶å®ƒç«™ç‚¹çš„è¯ä¹¦ã€‚ 123456789mingxu.xie@t-slq-ops-1:/opt/script/zabbix# cat check_ssl_cert.sh #/bin/bashhost=1port=2end_date=openssl s_client -host $host -port $port -servername $host -showcerts &amp;lt;/dev/null 2&gt;/dev/null|sed -n '/BEGIN CERTIFICATE/,/END CERT/p' |openssl x509 -text 2&gt;/dev/null |sed -n 's/ *Not After : *//p'if [ -n \"end_date\" ];then end_date_seconds=`date '+%s' --date \"end_date\"now_seconds=date '+%s'` echo \"(end_date_seconds-now_seconds)/24/3600\" | bcfi","categories":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/categories/zabbix/"}],"tags":[],"author":"xiemx"},{"title":"zabbixè§¦å‘å™¨å‡½æ•°","slug":"zabbix-trigger-function","date":"2016-12-05T01:12:36.000Z","updated":"2019-10-21T06:57:42.328Z","comments":true,"path":"/2016/12/05/zabbix-trigger-function/","link":"","permalink":"https://www.xiemx.com/2016/12/05/zabbix-trigger-function/","excerpt":"","text":"ä¸å†ä¸€ä¸€åˆ—å‡ºï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ https://www.zabbix.com/documentation/4.0/manual/appendix/triggers/functions","categories":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/categories/zabbix/"}],"tags":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/tags/zabbix/"}],"author":"xiemx"},{"title":"Zabbixè‡ªå®šä¹‰Item Not Supported,é¡µé¢å‡ºç°ä¸æ”¯æŒè§£å†³\n","slug":"fix-zabbix-item-not-supported","date":"2016-11-22T20:11:59.000Z","updated":"2019-10-21T06:57:42.898Z","comments":true,"path":"/2016/11/23/fix-zabbix-item-not-supported/","link":"","permalink":"https://www.xiemx.com/2016/11/23/fix-zabbix-item-not-supported/","excerpt":"","text":"ä½¿ç”¨Zabbixçš„æ—¶å€™å¾€å¾€ä¼šè‡ªå®šä¹‰Itemã€‚ä½†æ˜¯ç»å¸¸ä¼šé‡åˆ°è‡ªå®šä¹‰çš„Item Not Supportedäº†ã€‚Zabbix Agenté»˜è®¤çš„è¶…æ—¶æ—¶é—´æ˜¯3ç§’ã€‚å¾€å¾€æˆ‘ä»¬è‡ªå®šä¹‰çš„Itemç”±äºå„ç§åŸå› è¿”å›æ—¶é—´ä¼šæ¯”è¾ƒé•¿ã€‚å»ºè®®ä¿®æ”¹ä¸€ä¸ªé€‚åˆè‡ªå·±å®é™…çš„å€¼ã€‚ 123456vim /etc/zabbix/zabbix_agent.conf#Range: 1-30Timeout=8###ä¿®æ”¹å®Œæ¯•åé‡å¯zabbix-agent/etc/init.d/zabbix-agent restart","categories":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/categories/zabbix/"},{"name":"issue","slug":"zabbix/issue","permalink":"https://www.xiemx.com/categories/zabbix/issue/"}],"tags":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/tags/zabbix/"}],"author":"xiemx"},{"title":"djangoé‡ç½®ç®¡ç†å‘˜å¯†ç ","slug":"django-reset-admin-password","date":"2016-09-28T19:09:37.000Z","updated":"2019-10-21T06:57:42.570Z","comments":true,"path":"/2016/09/29/django-reset-admin-password/","link":"","permalink":"https://www.xiemx.com/2016/09/29/django-reset-admin-password/","excerpt":"","text":"å¿˜è®°Djangoå¯†ç ï¼Œä½¿ç”¨å¦‚ä¸‹æ“ä½œå³å¯æ‰¾å› 1234567&gt; cd /you/project/path # è¿›å…¥ä½ çš„é¡¹ç›®ç›®å½•&gt; python manage.py shell # è¿›å…¥django shell&gt; from django.contrib.auth.models import User&gt; user =User.objects.get(username='admin')&gt; user.set_password('123456')&gt; user.save() å†ä½¿ç”¨123456å¯†ç ç™»å½•å³å¯","categories":[{"name":"python","slug":"python","permalink":"https://www.xiemx.com/categories/python/"}],"tags":[{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"},{"name":"python","slug":"python","permalink":"https://www.xiemx.com/tags/python/"},{"name":"django","slug":"django","permalink":"https://www.xiemx.com/tags/django/"}],"author":"xiemx"},{"title":"zabbix-server.confæ–‡ä»¶è¯¦è§£","slug":"zabbix-server-configure","date":"2016-08-31T21:09:48.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2016/09/01/zabbix-server-configure/","link":"","permalink":"https://www.xiemx.com/2016/09/01/zabbix-server-configure/","excerpt":"","text":"123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101AlertScriptsPath é»˜è®¤å€¼ï¼š/usr/local/share/zabbix/alertscripts è¯´æ˜ï¼šå‘Šè­¦è„šæœ¬ç›®å½•AllowRoot é»˜è®¤å€¼ï¼š0 è¯´æ˜ï¼šæ˜¯å¦å…è®¸ä½¿ç”¨rootå¯åŠ¨ï¼Œ0:ä¸å…è®¸ï¼Œ1:å…è®¸ï¼Œé»˜è®¤æƒ…å†µä¸‹å¥¹ä¼šä½¿ç”¨zabbixç”¨æˆ·æ¥å¯åŠ¨zabbixè¿›ç¨‹ï¼Œä¸æ¨èä½¿ç”¨rootCacheSize å–å€¼èŒƒå›´ï¼š 128K-8G é»˜è®¤å€¼ï¼š8M è¯´æ˜ï¼šé…ç½®ç¼“å­˜ï¼Œç”¨äºå­˜å‚¨hostï¼Œitemï¼Œtriggeræ•°æ®ï¼Œ2.2.3ç‰ˆæœ¬ä¹‹å‰æœ€å¤§æ”¯æŒ2Gï¼Œç›®å‰æœ€å¤§æ”¯æŒ8Gï¼Œä¸€èˆ¬ç”¨ä¸äº†å¤šå°‘çš„ã€‚CacheUpdateFrequency å–å€¼èŒƒå›´ï¼š1-3600 é»˜è®¤å€¼ï¼š60 è¯´æ˜ï¼šå¤šå°‘ç§’æ›´æ–°ä¸€æ¬¡é…ç½®ç¼“å­˜DBHost é»˜è®¤å€¼ï¼šlocalhost è¯´æ˜ï¼šæ•°æ®åº“ä¸»æœºåœ°å€DBName é»˜è®¤å€¼ï¼šæ—  å¿…å¡«ï¼šæ˜¯DBPasswordï¼š é»˜è®¤å€¼ï¼šç©º è¯´æ˜ï¼šæ•°æ®åº“å¯†ç DBPort å–å€¼èŒƒå›´ï¼š1024-65535 é»˜è®¤å€¼:3306 è¯´æ˜ï¼šSQLiteä½œä¸ºDBï¼Œè¿™ä¸ªé€‰é¡¹è¯·å¿½ç•¥ï¼Œå¦‚æœä½¿ç”¨socketé“¾æ¥ï¼Œä¹Ÿè¯·å¿½ç•¥ã€‚DBSchema è¯´æ˜ï¼šSchemaåç§°. ç”¨äº IBM DB2 ã€ PostgreSQL.DBSocket é»˜è®¤å€¼ï¼š/tmp/mysql.sock è¯´æ˜ï¼šmysql sockæ–‡ä»¶è·¯å¾„DebugLevel å–å€¼èŒƒå›´ï¼š0-5 é»˜è®¤å€¼ï¼š3 è¯´æ˜: æŒ‡å®šdebugçº§åˆ« 0 - åŸºæœ¬ä¿¡æ¯ 1 - criticalä¿¡æ¯ 2 - errorä¿¡æ¯ 3 - warningsä¿¡æ¯ 4 - è°ƒè¯•æ—¥å¿—ï¼Œæ—¥å¿—å†…å®¹å¾ˆå¤šï¼Œæ…é‡ä½¿ç”¨ 5 - ç”¨äºè°ƒè¯•webå’Œvmwareç›‘æ§ExternalScripts é»˜è®¤å€¼ï¼š /usr/local/share/zabbix/externalscripts è¯´æ˜ï¼š å¤–éƒ¨è„šæœ¬ç›®å½•Fping6Location é»˜è®¤å€¼ï¼š/usr/sbin/fping6 è¯´æ˜ï¼šfping6è·¯å¾„ï¼Œä¸æ‡‚fpingçš„äººå¯ä»¥ç™¾åº¦ä¸€ä¸‹ï¼Œå¦‚æœzabbixérootå¯åŠ¨ï¼Œè¯·ç»™fping6 SUIDFpingLocation é»˜è®¤å€¼ï¼š/usr/sbin/fping è¯´æ˜:å’Œä¸Šé¢çš„ä¸€æ ·HistoryCacheSize å–å€¼èŒƒå›´ï¼š128K-2G é»˜è®¤å€¼ï¼š8M è¯´æ˜ï¼š å†å²è®°å½•ç¼“å­˜å¤§å°ï¼Œç”¨äºå­˜å‚¨å†å²è®°å½•HistoryTextCacheSize å–å€¼èŒƒå›´ï¼š128K-2G é»˜è®¤å€¼ï¼š16M è¯´æ˜ï¼šæ–‡æœ¬ç±»å‹å†å²è®°å½•çš„ç¼“å­˜å¤§å°ï¼Œå­˜å‚¨character, text ã€logå†å²è®°å½•.HousekeepingFrequency å–å€¼èŒƒå›´ï¼š0-24 é»˜è®¤å€¼ï¼š1 è¯´æ˜ï¼šhousekeepæ‰§è¡Œé¢‘ç‡ï¼Œé»˜è®¤æ¯å°æ—¶å›å»åˆ é™¤ä¸€äº›è¿‡æœŸæ•°æ®ã€‚å¦‚æœserveré‡å¯ï¼Œé‚£ä¹ˆ30åˆ†é’Ÿä¹‹åæ‰æ‰§è¡Œä¸€æ¬¡ï¼Œæ¥ä¸‹æ¥ï¼Œæ¯éš”ä¸€å°æ—¶åœ¨æ‰§è¡Œä¸€æ¬¡ã€‚Include è¯´æ˜ï¼šincludeé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š/usr/local/zabbix-2.4.4/conf/ttlsa.com/*.confJavaGateway è¯´æ˜ï¼šZabbix Java gatewayçš„ä¸»æœºåï¼Œéœ€è¦å¯åŠ¨Java pollersJavaGatewayPort å–å€¼èŒƒå›´ï¼š1024-32767 é»˜è®¤å€¼ï¼š10052 Zabbix Java gatewayç›‘å¬ç«¯å£ListenIP é»˜è®¤å€¼ï¼š0.0.0.0 è¯´æ˜ï¼šç›‘å¬åœ°å€ï¼Œç•™ç©ºåˆ™ä¼šåœ¨æ‰€æœ‰çš„åœ°å€ä¸Šç›‘å¬ï¼Œå¯ä»¥ç›‘å¬å¤šä¸ªIPåœ°å€ï¼Œipä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š127.0.0.1,10.10.0.2ListenPort å–å€¼èŒƒå›´ï¼š1024-32767 é»˜è®¤å€¼ï¼š10051 è¯´æ˜ï¼šç›‘å¬ç«¯å£LoadModule è¯´æ˜ï¼šåŠ è½½æ¨¡å—ï¼Œæ ¼å¼: LoadModule=ï¼Œæ–‡ä»¶å¿…é¡»åœ¨æŒ‡å®šçš„LoadModulePathç›®å½•ä¸‹ï¼Œå¦‚æœéœ€è¦åŠ è½½å¤šä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆå†™å¤šä¸ªå³å¯ã€‚LoadModulePath æ¨¡å—ç›®å½•ï¼Œå‚è€ƒä¸Šé¢LogFile æ—¥å¿—æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š/data/logs/zabbix/zabbix-server.logLogFileSize å–å€¼èŒƒå›´ï¼š0-1024 é»˜è®¤å€¼ï¼š1 0è¡¨ç¤ºç¦ç”¨æ—¥å¿—è‡ªåŠ¨rotationï¼Œå¦‚æœæ—¥å¿—è¾¾åˆ°äº†é™åˆ¶ï¼Œå¹¶ä¸”rotationå¤±è´¥ï¼Œè€æ—¥å¿—æ–‡ä»¶å°†ä¼šè¢«æ¸…ç©ºæ‰ï¼Œé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°æ—¥å¿—ã€‚LogSlowQueries å–å€¼èŒƒå›´ï¼š0-3600000 é»˜è®¤å€¼ï¼š0 å¤šæ…¢çš„æ•°æ®åº“æŸ¥è¯¢å°†ä¼šè¢«è®°å½•ï¼Œå•ä½ï¼šæ¯«ç§’ï¼Œ0è¡¨ç¤ºä¸è®°å½•æ…¢æŸ¥è¯¢ã€‚åªæœ‰åœ¨DebugLevel=3æ—¶ï¼Œè¿™ä¸ªé…ç½®æ‰æœ‰æ•ˆã€‚MaxHousekeeperDelete å–å€¼èŒƒå›´ï¼š 0-1000000 é»˜è®¤å€¼ï¼š5000 housekeepingä¸€æ¬¡åˆ é™¤çš„æ•°æ®ä¸èƒ½å¤§äºMaxHousekeeperDeletePidFile é»˜è®¤å€¼ï¼š/tmp/zabbix_server.pid PIDæ–‡ä»¶ProxyConfigFrequency å–å€¼èŒƒå›´ï¼š1-604800 é»˜è®¤å€¼ï¼š3600 proxyè¢«åŠ¨æ¨¡å¼ä¸‹ï¼Œserverå¤šå°‘ç§’åŒæ­¥é…ç½®æ–‡ä»¶è‡³proxyã€‚ProxyDataFrequency å–å€¼èŒƒå›´ï¼š1-3600 é»˜è®¤å€¼:1 è¢«åŠ¨æ¨¡å¼ä¸‹ï¼Œzabbix serveré—´éš”å¤šå°‘ç§’å‘proxyè¯·æ±‚å†å²æ•°æ®SenderFrequency å–å€¼èŒƒå›´ï¼š5-3600 é»˜è®¤å€¼ï¼š30 é—´éš”å¤šå°‘ç§’ï¼Œå†å°è¯•å‘é€ä¸ºå‘é€çš„æŠ¥è­¦SNMPTrapperFile é»˜è®¤å€¼ï¼š/tmp/zabbix_traps.tmp SNMP trapå‘é€åˆ°serverçš„æ•°æ®ä¸´æ—¶å­˜æ”¾æ–‡ä»¶ã€‚SourceIP å‡ºå£IPåœ°å€SSHKeyLocation SSHå…¬é’¥ç§é’¥è·¯å¾„SSLCertLocation SSLè¯ä¹¦ç›®å½•ï¼Œç”¨äºwebç›‘æ§SSLKeyLocation SSLè®¤è¯ç§é’¥è·¯å¾„ã€ç”¨äºwebç›‘æ§SSLCALocation SSLè®¤è¯,CAè·¯å¾„ï¼Œå¦‚æœä¸ºç©ºï¼Œå°†ä¼šä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„CAStartDBSyncers å–å€¼èŒƒå›´ï¼š1-100 é»˜è®¤å€¼ï¼š4 é¢„å…ˆfoke DB Syncersçš„æ•°é‡ï¼Œ1.8.5ä»¥å‰æœ€å¤§å€¼ä¸º64StartDiscoverers å–å€¼èŒƒå›´ï¼š0-250 é»˜è®¤å€¼ï¼š1 pre-forked discoverersçš„æ•°é‡ï¼Œ1.8.5ç‰ˆæœ¬ä»¥å‰æœ€å¤§å¯ä¸º255StartHTTPPollers å–å€¼èŒƒå›´ï¼š0-1000 é»˜è®¤å€¼ï¼š1 pre-forked HTTP pollersçš„æ•°é‡ï¼Œ1.8.5ä»¥å‰æœ€å¤§255StartIPMIPollers å–å€¼èŒƒå›´ï¼š0-1000 é»˜è®¤å€¼ï¼š0 pre-forked IPMI pollersçš„æ•°é‡ï¼Œ1.8.5ä¹‹å‰ï¼Œæœ€å¤§ä¸º255Timeout å–å€¼èŒƒå›´ï¼š1-30 é»˜è®¤å€¼ï¼š3 agentï¼Œsnmpï¼Œexternal checkçš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’TmpDir é»˜è®¤å€¼ï¼š/tmpTrapperTimeout å–å€¼èŒƒå›´ï¼š1-300 é»˜è®¤å€¼ï¼š300 å¤„ç†trapperæ•°æ®çš„è¶…æ—¶æ—¶é—´TrendCacheSize å–å€¼èŒƒå›´ï¼š128K-2G é»˜è®¤å€¼ï¼š4M å†å²æ•°æ®ç¼“å­˜å¤§å°UnavailableDelay å–å€¼èŒƒå›´ï¼š1-3600 é»˜è®¤å€¼ï¼š60 é—´éš”å¤šå°‘ç§’å†æ¬¡æ£€æµ‹ä¸»æœºæ˜¯å¦å¯ç”¨UnreachableDelay å–å€¼èŒƒå›´ï¼š1-3600 é»˜è®¤å€¼ï¼š15 é—´éš”å¤šå°‘ç§’å†æ¬¡æ£€æµ‹ä¸»æœºæ˜¯å¦å¯è¾¾ã€‚UnreachablePeriod å–å€¼èŒƒå›´ï¼š1-3600 é»˜è®¤å€¼ï¼š45 æ£€æµ‹åˆ°ä¸»æœºä¸å¯ç”¨ï¼Œå¤šä¹…å°†å®ƒç½®ä¸ºä¸å¯è¾¾User é»˜è®¤å€¼ï¼šzabbix å¯åŠ¨zabbix serverçš„ç”¨æˆ·ï¼Œåœ¨é…ç½®ç¦æ­¢rootå¯åŠ¨ï¼Œå¹¶ä¸”å½“å‰shellç”¨æˆ·æ˜¯rootå¾—æƒ…å†µä¸‹æœ‰æ•ˆã€‚å¦‚æœå½“å‰ç”¨æˆ·æ˜¯xiemxï¼Œé‚£ä¹ˆzabbix serverçš„è¿è¡Œç”¨æˆ·æ˜¯xiemxValueCacheSize å–å€¼èŒƒå›´ï¼š0,128K-64G é»˜è®¤å€¼ï¼š8M 0è¡¨ç¤ºç¦ç”¨ï¼Œhistory valueç¼“å­˜å¤§å°ï¼Œå½“ç¼“å­˜è¶…æ ‡äº†ï¼Œå°†ä¼šæ¯éš”5åˆ†é’Ÿå¾€serveræ—¥å¿—é‡Œé¢è®°å½•ã€‚å…»æˆçœ‹æ—¥å¿—çš„å¥½ä¹ æƒ¯ã€‚","categories":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/categories/zabbix/"}],"tags":[],"author":"xiemx"},{"title":"keepalivedä¸æ”¯æŒIPVS","slug":"keepalived-not-support-IPVS","date":"2016-08-23T21:08:21.000Z","updated":"2019-10-21T06:57:42.989Z","comments":true,"path":"/2016/08/24/keepalived-not-support-IPVS/","link":"","permalink":"https://www.xiemx.com/2016/08/24/keepalived-not-support-IPVS/","excerpt":"","text":"ç¼–è¯‘keepalivedæ˜¯é‡åˆ°keepalivedæ— æ³•æ”¯æŒip_vsï¼Œæƒ…å†µå¦‚ä¸‹ï¼š keepalivedé»˜è®¤ç¼–è¯‘æ—¶æ˜¯åœ¨/usr/src/linuxä¸‹æ‰¾å†…æ ¸æºä»£ç ã€‚é»˜è®¤å®‰è£…çš„æºç åœ¨/usr/src/kernels/$(uname -r)/ç›®å½•ä¸‹ï¼ˆå¦‚æœæ²¡æœ‰è¿™ä¸ªç›®å½•å¯ä»¥å®‰è£…ä¸‹kernel-develåŒ…)ã€‚ è§£å†³åŠæ³•ï¼š 123ln -s /usr/src/kernels/`uname -r`/ /usr/src/linuxæˆ–è€…ç¼–è¯‘æ—¶æŒ‡å®š --with-kernel-dir=/usr/src/kernels/`uname -r`/ç„¶åé‡æ–°ç¼–è¯‘keepalivedï¼Œç°åœ¨å®˜æ–¹çš„æœ€æ–°ç‰ˆå·²ç»å¾ˆå°‘å‡ºç°è¿™ç§æƒ…å†µï¼Œæš‚æ—¶ä¸çŸ¥é“æ˜¯ä¸æ˜¯ç‰ˆæœ¬é—®é¢˜ã€‚","categories":[{"name":"keepalived","slug":"keepalived","permalink":"https://www.xiemx.com/categories/keepalived/"}],"tags":[{"name":"keepalived","slug":"keepalived","permalink":"https://www.xiemx.com/tags/keepalived/"},{"name":"cluster","slug":"cluster","permalink":"https://www.xiemx.com/tags/cluster/"}],"author":"xiemx"},{"title":"keepalivedé…ç½®å¤šå®ä¾‹","slug":"keepalived-multi-server","date":"2016-08-23T20:08:05.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2016/08/24/keepalived-multi-server/","link":"","permalink":"https://www.xiemx.com/2016/08/24/keepalived-multi-server/","excerpt":"","text":"å®‰è£…keepalived 1ã€ ä¸‹è½½ wget http://www.keepalived.org/software/keepalived-1.2.23.tar.gz 2ã€ è§£åŒ… tar xf keepalived-1.2.23.tar.gz 3ã€ åˆ‡æ¢ç›®å½• cd keepalived-1.2.23 4ã€ é…ç½® ./configure â€“prefix=/opt/keepalived å› ä¸ºkeepalived è¿è¡Œåœ¨ipvs ä¹‹ä¸Šï¼Œå› æ­¤è¿™ä¸¤ ä¸ªè½¯ä»¶ä¸€å®šè¦å®‰è£…åœ¨ä¸€ä¸ªç³»ç»Ÿé‡Œé¢ã€‚å¦‚æœconfigure æ“ä½œèƒ½æ­£å¸¸è¿›è¡Œï¼Œè¿è¡Œå®Œæ¯•åå°†æœ‰å¦‚ä¸‹çš„æ±‡æ€»è¾“å‡ºï¼š 1234567891011Keepalived configuration------------------------Keepalived version : 1.2.23Compiler : gccCompiler flags : -g -O2Extra Lib : -lpopt -lssl -lcryptoUse IPVS Framework : YesIPVS sync daemon support : YesUse VRRP Framework : YesUse LinkWatch : NoUse Debug flags : No 5ã€ ç¼–è¯‘å’Œå®‰è£…make&amp;&amp;make install6ã€ ç¯å¢ƒé…ç½® 123456cd /opt/keepalived/mkdir /etc/keepalived/cp sbin/keepalived /usr/sbin/cp etc/keepalived/keepalived.conf /etc/keepalived/cp etc/sysconfig/keepalived /etc/sysconfig/cp etc/rc.d/init.d/keepalived /etc/init.d/ 7ã€å¯åŠ¨keepalivedæŸ¥çœ‹æ˜¯å¦æ­£å¸¸ 1234567[root@cluster-node1 keepalived]# /etc/init.d/keepalived startStarting keepalived (via systemctl): [ OK ][root@cluster-node1 keepalived]# ps -ef | grep keepalivedroot 4662 1 0 01:22 ? 00:00:00 keepalived -Droot 4664 4662 0 01:22 ? 00:00:00 keepalived -Droot 4665 4662 0 01:22 ? 00:00:00 keepalived -Droot 16435 2705 0 01:37 pts/0 00:00:00 grep --color=auto keepalived 8ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647[root@cluster-node1 keepalived]# cat /etc/keepalived/keepalived.conf ! Configuration File for keepalivedglobal_defs &#123; notification_email &#123; acassen@firewall.loc failover@firewall.loc sysadmin@firewall.loc &#125; notification_email_from Alexandre.Cassen@firewall.loc smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id node1 vrrp_skip_check_adv_addr vrrp_strict vrrp_garp_interval 0 vrrp_gna_interval 0&#125;vrrp_instance VI_1 &#123; state MASTER interface eno16777736 virtual_router_id 51 priority 100 advert_int 1 authentication &#123; auth_type PASS auth_pass 1111 &#125; virtual_ipaddress &#123; 10.0.0.1/24 &#125;&#125;vrrp_instance VI_2 &#123; state BACKUP interface eno16777736 virtual_router_id 52 priority 50 advert_int 1 authentication &#123; auth_type PASS auth_pass 1111 &#125; virtual_ipaddress &#123; 10.0.1.1/24 &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647[root@cluster-node2 keepalived]# cat /etc/keepalived/keepalived.conf ! Configuration File for keepalivedglobal_defs &#123; notification_email &#123; acassen@firewall.loc failover@firewall.loc sysadmin@firewall.loc &#125; notification_email_from Alexandre.Cassen@firewall.loc smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id node2 vrrp_skip_check_adv_addr vrrp_strict vrrp_garp_interval 0 vrrp_gna_interval 0&#125;vrrp_instance VI_1 &#123; state BACKUP interface eno16777736 virtual_router_id 51 priority 50 advert_int 1 authentication &#123; auth_type PASS auth_pass 1111 &#125; virtual_ipaddress &#123; 10.0.0.1/24 &#125;&#125;vrrp_instance VI_2 &#123; state MASTER interface eno16777736 virtual_router_id 52 priority 100 advert_int 1 authentication &#123; auth_type PASS auth_pass 1111 &#125; virtual_ipaddress &#123; 10.0.1.1/24 &#125;&#125; 9ã€é‡å¯keepalivedï¼ŒæŸ¥çœ‹vipæ˜¯å¦æ­£å¸¸ç»‘å®š 12345678[root@cluster-node1 keepalived]# ip add | egrep \"0.1|1.1\" inet 127.0.0.1/8 scope host lo inet6 ::1/128 scope host inet 10.0.0.1/24 scope global eno16777736[root@cluster-node2 keepalived]# ip add | egrep \"0.1|1.1\" inet 127.0.0.1/8 scope host lo inet6 ::1/128 scope host inet 10.0.1.1/24 scope global eno16777736","categories":[{"name":"keepalived","slug":"keepalived","permalink":"https://www.xiemx.com/categories/keepalived/"}],"tags":[{"name":"keepalived","slug":"keepalived","permalink":"https://www.xiemx.com/tags/keepalived/"},{"name":"cluster","slug":"cluster","permalink":"https://www.xiemx.com/tags/cluster/"}],"author":"xiemx"},{"title":"Tomcatä¿®æ”¹ç½‘ç«™æ ¹ç›®å½•","slug":"tomcat-change-webroot","date":"2016-08-17T20:08:40.000Z","updated":"2019-10-19T07:24:46.748Z","comments":true,"path":"/2016/08/18/tomcat-change-webroot/","link":"","permalink":"https://www.xiemx.com/2016/08/18/tomcat-change-webroot/","excerpt":"","text":"1.tomcatåŸæ¥çš„é»˜è®¤æ ¹ç›®å½•æ˜¯http://localhost:8080ï¼Œå¦‚æœæƒ³ä¿®æ”¹è®¿é—®çš„æ ¹ç›®å½•ï¼Œå¯ä»¥è¿™æ ·ï¼š æ‰¾åˆ°tomcatçš„server.xmlï¼ˆåœ¨confç›®å½•ä¸‹ï¼‰ï¼Œæ‰¾åˆ°: 123&lt;Host name=\"localhost\" appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\" xmlValidation=\"false\" xmlNamespaceAware=\"false\"&gt;&lt;/Host&gt; åœ¨å‰æ’å…¥: 1&lt;Context path=\"\" docBase=\"/home/tomcat/\" debug=\"0\"/&gt; å…¶ä¸­/home/tomcat/å°±æ˜¯æˆ‘æƒ³è®¾ç½®çš„ç½‘ç«™æ ¹ç›®å½•ï¼Œç„¶åé‡å¯tomcatã€‚å†æ¬¡è®¿é—®http://localhost:8080æ—¶ï¼Œå°±æ˜¯ç›´æ¥è®¿é—®/home/tomcat/ç›®å½•ä¸‹çš„æ–‡ä»¶äº†ã€‚ 2.tomcatçš„web.xmlï¼ˆåœ¨confç›®å½•ä¸‹ï¼‰ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­æ‰¾åˆ° 12345&lt;welcome-file-list&gt; &lt;welcome-file&gt;index.html&lt;/welcome-file&gt; &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt; &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;&lt;/welcome-file-list&gt; è¿™æ˜¯tomcaté»˜è®¤çš„3ä¸ªæ–‡ä»¶ï¼Œå½“ä½ è¾“å…¥æŒ‡å®šè·¯å¾„åï¼Œtomcatä¼šè‡ªåŠ¨æŸ¥æ‰¾è¿™3ä¸ªé¡µé¢ã€‚å¦‚æœä½ æƒ³è®©tomcatè‡ªåŠ¨æ‰¾åˆ°è‡ªå·±çš„é¡µé¢ï¼Œæ¯”å¦‚main.jspã€‚å¯ä»¥ä¿®æ”¹ä¸Šé¢ä¿¡æ¯ä¸ºï¼š 123456&lt;welcome-file-list&gt; &lt;welcome-file&gt;main.jsp&lt;/welcome-file&gt; &lt;welcome-file&gt;index.html&lt;/welcome-file&gt; &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt; &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;&lt;/welcome-file-list&gt;","categories":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.xiemx.com/categories/tomcat/"}],"tags":[{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"},{"name":"http","slug":"http","permalink":"https://www.xiemx.com/tags/http/"},{"name":"tomcat","slug":"tomcat","permalink":"https://www.xiemx.com/tags/tomcat/"}],"author":"xiemx"},{"title":"apachetop â€“ å±•ç¤ºwebæœåŠ¡å™¨å®æ—¶ç»Ÿè®¡æ•°æ®","slug":"apachetop","date":"2016-08-14T20:08:47.000Z","updated":"2019-10-21T03:19:52.562Z","comments":true,"path":"/2016/08/15/apachetop/","link":"","permalink":"https://www.xiemx.com/2016/08/15/apachetop/","excerpt":"","text":"apachetop â€“ å±•ç¤ºwebæœåŠ¡å™¨å®æ—¶ç»Ÿè®¡æ•°æ® Apachetopå±•ç¤ºApache webæœåŠ¡å™¨ä¸Šå…³äºhttpè¯·æ±‚çš„å®æ—¶è¡¨ã€‚ å®ƒæ˜¾ç¤ºç»Ÿè®¡ï¼ˆstatsï¼‰, ç‚¹å‡»ï¼ˆhitsï¼‰, è¯·æ±‚ï¼ˆrequestsï¼‰, è¯·æ±‚ç»†èŠ‚ï¼ˆrequest detailsï¼‰ï¼Œä¸”èƒ½å¤Ÿè·å¾—å½“å‰ä½ çš„webæœåŠ¡å™¨æ­£åœ¨è¿è¡Œç¨‹åºçš„æ¦‚è²Œï¼Œè¿™ä¸€ç‚¹å¾ˆèµã€‚ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Nginxï¼Œä¹Ÿæœ‰ä¸€äº›ç›¸ä¼¼çš„å·¥å…·ï¼Œä½†ä¼¼ä¹æ²¡æœ‰apachetopé‚£ä¹ˆè¯¦ç»†ã€‚ å®‰è£…è¯¥å‘½ä»¤å¹¶å°è¯•è¿è¡Œï¼š 1$ sudo apt-get install apachetop æˆªå›¾å¦‚ä¸‹ï¼š","categories":[{"name":"apache","slug":"apache","permalink":"https://www.xiemx.com/categories/apache/"}],"tags":[{"name":"apache","slug":"apache","permalink":"https://www.xiemx.com/tags/apache/"},{"name":"command","slug":"command","permalink":"https://www.xiemx.com/tags/command/"}],"author":"xiemx"},{"title":"watché‡å¤æ‰§è¡ŒæŸä¸ªå‘½ä»¤","slug":"shell-command-watch","date":"2016-08-10T20:08:29.000Z","updated":"2019-10-21T06:57:42.819Z","comments":true,"path":"/2016/08/11/shell-command-watch/","link":"","permalink":"https://www.xiemx.com/2016/08/11/shell-command-watch/","excerpt":"","text":"å½“éœ€è¦é‡å¤æ‰§è¡Œä¸€ä¸ªå‘½ä»¤æ—¶ï¼Œå¯ä½¿ç”¨watch 123456789101112131415161718192021222324âœ ~ watchUsage: watch [options] commandOptions: -b, --beep beep if command has a non-zero exit -c, --color interpret ANSI color and style sequences -d, --differences[=&lt;permanent&gt;] highlight changes between updates -e, --errexit exit if command has a non-zero exit -g, --chgexit exit when output from command changes -n, --interval &lt;secs&gt; seconds to wait between updates -p, --precise attempt run command in precise intervals -t, --no-title turn off header -x, --exec pass command to exec instead of \"sh -c\" -h, --help display this help and exit -v, --version output version information and exitFor more details see watch(1).###æ¯ç§’æ‰§è¡Œä¸€æ¬¡lså‘½ä»¤watch -n 1 ls","categories":[{"name":"command","slug":"command","permalink":"https://www.xiemx.com/categories/command/"}],"tags":[{"name":"command","slug":"command","permalink":"https://www.xiemx.com/tags/command/"},{"name":"shell","slug":"shell","permalink":"https://www.xiemx.com/tags/shell/"}],"author":"xiemx"},{"title":"arp_ignoreå’Œarp_announceå‚æ•°è¯´æ˜","slug":"linux-disable-arp","date":"2016-08-10T20:08:15.000Z","updated":"2019-10-21T06:57:42.477Z","comments":true,"path":"/2016/08/11/linux-disable-arp/","link":"","permalink":"https://www.xiemx.com/2016/08/11/linux-disable-arp/","excerpt":"","text":"lvsDRæ¨¡å¼ä¸­éœ€è¦å¯¹real serverè¿›è¡ŒarpæŠ‘åˆ¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨sysctl.confæ–‡ä»¶ä¸­ä¿®æ”¹å¦‚ä¸‹å†…æ ¸å‚æ•°ï¼š 123456789101112131415161718net.ipv4.conf.lo.arp_ignore = 1net.ipv4.conf.lo.arp_announce = 2net.ipv4.conf.all.arp_ignore = 1net.ipv4.conf.all.arp_announce = 2arp_ignore:å®šä¹‰å¯¹ç›®æ ‡åœ°å€ä¸ºæœ¬åœ°IPçš„ARPè¯¢é—®ä¸åŒçš„åº”ç­”æ¨¡å¼0 0 - (é»˜è®¤å€¼): å›åº”ä»»ä½•ç½‘ç»œæ¥å£ä¸Šå¯¹ä»»ä½•æœ¬åœ°IPåœ°å€çš„arpæŸ¥è¯¢è¯·æ±‚ 1 - åªå›ç­”ç›®æ ‡IPåœ°å€æ˜¯æ¥è®¿ç½‘ç»œæ¥å£æœ¬åœ°åœ°å€çš„ARPæŸ¥è¯¢è¯·æ±‚ 2 -åªå›ç­”ç›®æ ‡IPåœ°å€æ˜¯æ¥è®¿ç½‘ç»œæ¥å£æœ¬åœ°åœ°å€çš„ARPæŸ¥è¯¢è¯·æ±‚,ä¸”æ¥è®¿IPå¿…é¡»åœ¨è¯¥ç½‘ç»œæ¥å£çš„å­ç½‘æ®µå†… 3 - ä¸å›åº”è¯¥ç½‘ç»œç•Œé¢çš„arpè¯·æ±‚ï¼Œè€Œåªå¯¹è®¾ç½®çš„å”¯ä¸€å’Œè¿æ¥åœ°å€åšå‡ºå›åº” 4-7 - ä¿ç•™æœªä½¿ç”¨ 8 -ä¸å›åº”æ‰€æœ‰ï¼ˆæœ¬åœ°åœ°å€ï¼‰çš„arpæŸ¥è¯¢arp_announce:å¯¹ç½‘ç»œæ¥å£ä¸Šï¼Œæœ¬åœ°IPåœ°å€çš„å‘å‡ºçš„ï¼ŒARPå›åº”ï¼Œä½œå‡ºç›¸åº”çº§åˆ«çš„é™åˆ¶: ç¡®å®šä¸åŒç¨‹åº¦çš„é™åˆ¶,å®£å¸ƒå¯¹æ¥è‡ªæœ¬åœ°æºIPåœ°å€å‘å‡ºArpè¯·æ±‚çš„æ¥å£ 0 - (é»˜è®¤) åœ¨ä»»æ„ç½‘ç»œæ¥å£ï¼ˆeth0,eth1ï¼Œloï¼‰ä¸Šçš„ä»»ä½•æœ¬åœ°åœ°å€ 1 -å°½é‡é¿å…ä¸åœ¨è¯¥ç½‘ç»œæ¥å£å­ç½‘æ®µçš„æœ¬åœ°åœ°å€åšå‡ºarpå›åº”. å½“å‘èµ·ARPè¯·æ±‚çš„æºIPåœ°å€æ˜¯è¢«è®¾ç½®åº”è¯¥ç»ç”±è·¯ç”±è¾¾åˆ°æ­¤ç½‘ç»œæ¥å£çš„æ—¶å€™å¾ˆæœ‰ç”¨.æ­¤æ—¶ä¼šæ£€æŸ¥æ¥è®¿IPæ˜¯å¦ä¸ºæ‰€æœ‰æ¥å£ä¸Šçš„å­ç½‘æ®µå†…ipä¹‹ä¸€.å¦‚æœæ”¹æ¥è®¿IPä¸å±äºå„ä¸ªç½‘ç»œæ¥å£ä¸Šçš„å­ç½‘æ®µå†…,é‚£ä¹ˆå°†é‡‡ç”¨çº§åˆ«2çš„æ–¹å¼æ¥è¿›è¡Œå¤„ç†. 2 - å¯¹æŸ¥è¯¢ç›®æ ‡ä½¿ç”¨æœ€é€‚å½“çš„æœ¬åœ°åœ°å€.åœ¨æ­¤æ¨¡å¼ä¸‹å°†å¿½ç•¥è¿™ä¸ªIPæ•°æ®åŒ…çš„æºåœ°å€å¹¶å°è¯•é€‰æ‹©ä¸èƒ½ä¸è¯¥åœ°å€é€šä¿¡çš„æœ¬åœ°åœ°å€.é¦–è¦æ˜¯é€‰æ‹©æ‰€æœ‰çš„ç½‘ç»œæ¥å£çš„å­ç½‘ä¸­å¤–å‡ºè®¿é—®å­ç½‘ä¸­åŒ…å«è¯¥ç›®æ ‡IPåœ°å€çš„æœ¬åœ°åœ°å€. å¦‚æœæ²¡æœ‰åˆé€‚çš„åœ°å€è¢«å‘ç°,å°†é€‰æ‹©å½“å‰çš„å‘é€ç½‘ç»œæ¥å£æˆ–å…¶ä»–çš„æœ‰å¯èƒ½æ¥å—åˆ°è¯¥ARPå›åº”çš„ç½‘ç»œæ¥å£æ¥è¿›è¡Œå‘é€.","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"arp","slug":"arp","permalink":"https://www.xiemx.com/tags/arp/"}],"author":"xiemx"},{"title":"zabbix Less than 25% free in the configuration cacheè§£å†³","slug":"zabbix-less-than-25-free-in-the-configuration-cache","date":"2016-08-08T19:08:20.000Z","updated":"2019-10-21T06:57:42.921Z","comments":true,"path":"/2016/08/09/zabbix-less-than-25-free-in-the-configuration-cache/","link":"","permalink":"https://www.xiemx.com/2016/08/09/zabbix-less-than-25-free-in-the-configuration-cache/","excerpt":"","text":"åœ¨zabbix serveré»˜è®¤é…ç½®ä¸‹ï¼Œå‡ºç°å‘Šè­¦ 1Less than 25% free in the configuration cache å¯å¢åŠ zabbixé…ç½®ç¼“å­˜è§£å†³ 123456vim zabbix_server.conf##å°†ç¼“å­˜ä»8Mæå‡åˆ°16Mï¼Œå¯ä»¥è°ƒåˆ°æœ€é«˜8GCacheSize=16M##é‡å¯zabbix serverservice zabbix_server restart","categories":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/categories/zabbix/"}],"tags":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/tags/zabbix/"},{"name":"issue","slug":"issue","permalink":"https://www.xiemx.com/tags/issue/"}],"author":"xiemx"},{"title":"mysqlé”è¡¨è§£å†³","slug":"mysql-lock-table","date":"2016-08-01T18:08:56.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2016/08/02/mysql-lock-table/","link":"","permalink":"https://www.xiemx.com/2016/08/02/mysql-lock-table/","excerpt":"","text":"1ã€æŸ¥è¯¢æ˜¯å¦é”è¡¨ 1show OPEN TABLES where In_use &gt; 0; 2ã€æŸ¥è¯¢è¿›ç¨‹ 1show processlist æŸ¥è¯¢åˆ°ç›¸å¯¹åº”çš„ID 3ã€æ€æ­»è¿›ç¨‹ 1kill id other: 12345æŸ¥çœ‹æ­£åœ¨é”çš„äº‹åŠ¡SELECT * FROMINFORMATION_SCHEMA.INNODB_LOCKS; æŸ¥çœ‹ç­‰å¾…é”çš„äº‹åŠ¡SELECT * FROMINFORMATION_SCHEMA.INNODB_LOCK_WAITS;","categories":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/categories/mysql/"}],"tags":[{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"},{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/tags/mysql/"},{"name":"database","slug":"database","permalink":"https://www.xiemx.com/tags/database/"}],"author":"xiemx"},{"title":"åŸŸåçŠ¶æ€å«ä¹‰","slug":"domain-status-code","date":"2016-07-27T03:07:26.000Z","updated":"2019-10-21T06:57:43.047Z","comments":true,"path":"/2016/07/27/domain-status-code/","link":"","permalink":"https://www.xiemx.com/2016/07/27/domain-status-code/","excerpt":"","text":"æ–°æ³¨å†Œçš„åŸŸåï¼Œå¯èƒ½å‡ºç°ä»¥ä¸‹çŠ¶æ€ï¼š åŸŸåçŠ¶æ€ å«ä¹‰ addPeriod æ³¨å†Œå±€è®¾ç½®åŸŸåæ–°æ³¨å†ŒæœŸï¼ˆåŸŸåæ–°æ³¨å†Œ 5 å¤©å†…ä¼šå‡ºç°çš„çŠ¶æ€ï¼Œä¸å½±å“åŸŸåä½¿ç”¨ï¼Œ5 å¤©åè‡ªåŠ¨è§£é™¤ï¼‰ã€‚ Â·ok æ™®é€šçŠ¶æ€ï¼ˆå¯æ­£å¸¸ä½¿ç”¨ã€‚æ²¡æœ‰éœ€è¦ç«‹å³è¿›è¡Œçš„æ“ä½œï¼Œä¹Ÿæ²¡æœ‰è®¾ç½®ä»»ä½•ä¿æŠ¤æªæ–½ã€‚æœ‰å…¶ä»–çŠ¶æ€æ—¶ï¼ŒOK çŠ¶æ€ä¸æ˜¾ç¤ºï¼Œä½†å¹¶ä¸ä»£è¡¨ä¸æ­£å¸¸ã€‚ å‡ºäºå¯¹åŸŸåæ³¨å†Œä¿¡æ¯çš„ä¿æŠ¤ï¼ŒåŸŸååœ¨è¿›è¡ŒæŸäº›å®‰å…¨é”å®šåï¼Œä¼šå‡ºç°ä»¥ä¸‹çŠ¶æ€ï¼š åŸŸåçŠ¶æ€ å«ä¹‰ Â·clientDeleteProhibited æ³¨å†Œå•†è®¾ç½®ç¦æ­¢åˆ é™¤ï¼ˆä¿æŠ¤åŸŸåçš„ä¸€ç§çŠ¶æ€ï¼ŒåŸŸåä¸èƒ½è¢«åˆ é™¤ï¼‰ã€‚ serverDeleteProhibited æ³¨å†Œå±€è®¾ç½®ç¦æ­¢åˆ é™¤ï¼ˆä¿æŠ¤åŸŸåçš„ä¸€ç§çŠ¶æ€ï¼ŒåŸŸåä¸èƒ½è¢«åˆ é™¤ï¼‰ã€‚ Â·clientUpdateProhibited æ³¨å†Œå•†è®¾ç½®ç¦æ­¢æ›´æ–°ï¼ˆåŸŸåä¿¡æ¯ï¼ŒåŒ…æ‹¬æ³¨å†Œäºº/ç®¡ç†è”ç³»äºº/æŠ€æœ¯è”ç³»äºº/ä»˜è´¹è”ç³»äºº/DNS ç­‰ä¸èƒ½è¢«ä¿®æ”¹ï¼Œä½†å¯è®¾ç½®æˆ–ä¿®æ”¹è§£æè®°å½•ï¼‰ã€‚ Â·serverUpdateProhibited æ³¨å†Œå±€è®¾ç½®ç¦æ­¢æ›´æ–°ï¼ˆåŸŸåä¿¡æ¯ï¼ŒåŒ…æ‹¬æ³¨å†Œäºº/ç®¡ç†è”ç³»äºº/æŠ€æœ¯è”ç³»äºº/ä»˜è´¹è”ç³»äºº/DNS ç­‰ä¸èƒ½è¢«ä¿®æ”¹ï¼Œä½†å¯è®¾ç½®æˆ–ä¿®æ”¹è§£æè®°å½•ï¼‰ã€‚ Â·clientTransferProhibited æ³¨å†Œå•†è®¾ç½®ç¦æ­¢è½¬ç§»ï¼ˆä¿æŠ¤åŸŸåçš„ä¸€ç§çŠ¶æ€ï¼ŒåŸŸåä¸èƒ½è½¬ç§»æ³¨å†Œå•†ï¼‰ã€‚ Â·serverTransferProhibited æ³¨å†Œå±€è®¾ç½®ç¦æ­¢è½¬ç§»ï¼ˆä¿æŠ¤åŸŸåçš„ä¸€ç§çŠ¶æ€ï¼ŒåŸŸåä¸èƒ½è½¬ç§»æ³¨å†Œå•†ã€‚æœ‰çš„åŸŸåæ–°æ³¨å†ŒåŠè½¬ç§»æ³¨å†Œå•† 60 å¤©å†…ä¼šè¢«æ³¨å†Œå±€è®¾ç½®æˆè¯¥çŠ¶æ€ï¼Œ60 å¤©åè‡ªåŠ¨è§£é™¤ï¼›æœ‰çš„åˆ™ä¸ºåŸŸåæ¶‰åŠä»²è£æˆ–è¯‰è®¼æ¡ˆè¢«æ³¨å†Œå±€è®¾ç½®ï¼Œä»²è£æˆ–è¯‰è®¼æ¡ˆç»“æŸä¼šè¢«è§£é™¤ï¼‰ã€‚ å…¶ä»–ç¦æ­¢è§£æã€ç¦æ­¢ç»­è´¹çš„çŠ¶æ€ï¼š åŸŸåçŠ¶æ€ å«ä¹‰ Â·pendingVerification æ³¨å†Œä¿¡æ¯å®¡æ ¸æœŸï¼ˆè¯¥åŸŸåæ³¨å†Œåæœªè¿›è¡Œå®åå®¡æ ¸ï¼Œéœ€å°½æ—©åœ¨åŸŸåä»˜è´¹å 5 å¤©å†…æäº¤èµ„æ–™å®¡æ ¸ï¼Œ5 å¤©åä»æœªå®åå®¡æ ¸çš„ï¼Œå°†è¿›å…¥ ServerHold çŠ¶æ€ï¼‰ã€‚ Â·clientHold æ³¨å†Œå•†è®¾ç½®æš‚åœè§£æï¼ˆå¤„äºè¯¥çŠ¶æ€åŸŸåè§£ææš‚åœï¼Œéœ€è”ç³»æ³¨å†Œå•†è§£é™¤è¯¥çŠ¶æ€ï¼‰ã€‚ Â·serverHold æ³¨å†Œå±€è®¾ç½®æš‚åœè§£æï¼ˆå¤„äºè¯¥çŠ¶æ€åŸŸåè§£ææš‚åœï¼Œ.cn å›½å†…ä¸­è‹±æ–‡åŸŸåæ³¨å†ŒæˆåŠŸåæœªé€šè¿‡å®åå®¡æ ¸æ—¶å¤šå‡ºç°è¯¥ç§çŠ¶æ€ï¼Œéœ€åœ¨åŸŸåæœ‰æ•ˆæœŸå†…å®Œæˆå®åå®¡æ ¸åè§£é™¤ï¼‰ã€‚ Â·inactive éæ¿€æ´»çŠ¶æ€ï¼ˆæ³¨å†Œæ—¶æœªå¡«å†™åŸŸå DNSï¼Œä¸èƒ½è¿›è¡Œè§£æï¼Œéœ€åœ¨æ³¨å†Œå•†å¤„è®¾ç½®åŸŸå DNSï¼‰ã€‚ Â·clientRenewProhibited/serverRenewProhibited æ³¨å†Œå•†æˆ–æ³¨å†Œå±€è®¾ç½®ç¦æ­¢ç»­è´¹ï¼ˆåŸŸåä¸èƒ½ç»­è´¹ï¼Œå¤„äºè¯¥çŠ¶æ€é€šå¸¸è¡¨ç¤ºè¯¥åŸŸåå¤„äºä»²è£æˆ–æ³•é™¢äº‰è®®æœŸï¼Œéœ€è”ç³»æ³¨å†Œå•†ç¡®è®¤åŸå› ï¼‰ã€‚ Â·pendingTransfer æ³¨å†Œå±€è®¾ç½®è½¬ç§»è¿‡ç¨‹ä¸­ï¼ˆåŸŸåæ­£åœ¨è½¬ç§»æ³¨å†Œå•†è¿‡ç¨‹ä¸­ï¼‰ã€‚ Â·redemptionPeriod æ³¨å†Œå±€è®¾ç½®èµå›æœŸï¼ˆåŸŸåå¤„äºèµå›æœŸï¼Œå¯è”ç³»æ³¨å†Œå•†é«˜ä»·èµå›ï¼‰ã€‚ Â·pendingDelete æ³¨å†Œå±€è®¾ç½®å¾…åˆ é™¤/èµå›æœŸï¼ˆå¯¹äºå›½é™…åŸŸåï¼Œè¯¥çŠ¶æ€è¡¨ç¤ºåŸŸåå·²è¿‡èµå›æœŸç­‰å¾…è¢«åˆ é™¤ï¼Œåˆ é™¤åå¼€æ”¾é‡æ–°æ³¨å†Œï¼›å¯¹äºå›½å†…åŸŸåï¼Œè¯¥çŠ¶æ€è¡¨ç¤ºåŸŸåå¤„äºèµå›æœŸï¼Œå¯è”ç³»æ³¨å†Œå•†é«˜ä»·èµå›ï¼‰ã€‚","categories":[{"name":"domain","slug":"domain","permalink":"https://www.xiemx.com/categories/domain/"}],"tags":[{"name":"domain","slug":"domain","permalink":"https://www.xiemx.com/tags/domain/"},{"name":"statusCode","slug":"statusCode","permalink":"https://www.xiemx.com/tags/statusCode/"}],"author":"xiemx"},{"title":"uwsgi æŠ¥é”™ invalid option --â€œxâ€ getopt_long() error","slug":"uwsgi-invalid-option-x-getopt_long-error","date":"2016-07-26T03:07:34.000Z","updated":"2019-10-21T06:57:42.571Z","comments":true,"path":"/2016/07/26/uwsgi-invalid-option-x-getopt_long-error/","link":"","permalink":"https://www.xiemx.com/2016/07/26/uwsgi-invalid-option-x-getopt_long-error/","excerpt":"","text":"æŠ¥é”™ï¼š12uwsgi: invalid option â€” â€˜xâ€™getopt_long() error è§£å†³è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºç¼–è¯‘uwsgiçš„æ—¶å€™å°‘äº†libxml2åº“å¯¼è‡´çš„ï¼Œåº”è¯¥å…ˆå®‰è£…åº“å†ç¼–è¯‘ï¼Œå¦åˆ™ä¼šå°‘äº†xmlçš„æ”¯æŒã€‚ uninstall uwsgi install libxml* install uwsgi","categories":[{"name":"uwsgi","slug":"uwsgi","permalink":"https://www.xiemx.com/categories/uwsgi/"},{"name":"python","slug":"uwsgi/python","permalink":"https://www.xiemx.com/categories/uwsgi/python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://www.xiemx.com/tags/python/"},{"name":"uwsgi","slug":"uwsgi","permalink":"https://www.xiemx.com/tags/uwsgi/"},{"name":"issue","slug":"issue","permalink":"https://www.xiemx.com/tags/issue/"}],"author":"xiemx"},{"title":"nginx+uwsgiéƒ¨ç½²djangoé¡¹ç›®","slug":"nginx-uwsgi-deploy-django","date":"2016-07-25T22:07:48.000Z","updated":"2019-10-21T06:57:42.570Z","comments":true,"path":"/2016/07/26/nginx-uwsgi-deploy-django/","link":"","permalink":"https://www.xiemx.com/2016/07/26/nginx-uwsgi-deploy-django/","excerpt":"","text":"å®‰è£…åŸºæœ¬è½¯ä»¶12sudo apt-get install python-dev nginxpip install uwsgi é…ç½®uwsgiå’Œdjangoçš„é›†æˆ1234567891011vim test.py åˆ›å»ºtest.py,æ·»åŠ å¦‚ä¸‹ä»£ç def application(env, start_response): start_response('200 OK', [('Content-Type','text/html')]) return \"Hello World\"ç„¶åæ‰§è¡Œshellå‘½ä»¤ï¼šuwsgi â€“http :8001 â€“wsgi-file test.pyè®¿é—®ç½‘é¡µï¼šcurl http://127.0.0.1:8001/Hello World #ç¼–å†™django_wsgi.pyæ–‡ä»¶ï¼Œå°†å…¶æ”¾åœ¨ä¸æ–‡ä»¶manage.pyåŒä¸€ä¸ªç›®å½•ä¸‹ï¼š 12345678910111213### vim django_wsgi.py æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š#!/usr/bin/env python# coding: utf-8import osimport sys# å°†ç³»ç»Ÿçš„ç¼–ç è®¾ç½®ä¸ºUTF8reload(sys)sys.setdefaultencoding('utf8')os.environ.setdefault(\"DJANGO_SETTINGS_MODULE\", \"yoursite.settings\")from django.core.handlers.wsgi import WSGIHandlerapplication = WSGIHandler() è¿æ¥djangoå’Œuwsgiï¼Œå®ç°ç®€å•çš„WEBæœåŠ¡å™¨ã€‚æˆ‘ä»¬å‡è®¾ä½ çš„Djangoé¡¹ç›®çš„åœ°å€æ˜¯/home/work/src/sites/testdjango1/testdjango/mysiteï¼Œ ç„¶åï¼Œå°±å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šuwsgi â€“http :8000 â€“chdir /home/work/src/sites/testdjango1/testdjango/mysite â€“module django_wsgiè¿™æ ·ï¼Œä½ å°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®ä½ çš„Djangoç¨‹åºäº†ã€‚æ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯ç»è¿‡uwsgiä¼ é€’ç»™Djangoç¨‹åºçš„ã€‚ é›†æˆdjango,uwsgiå’Œnginxéƒ¨ç½²ï¼š åœ¨djangoé¡¹ç›®æ ¹ç›®å½•åˆ›å»ºå¯åŠ¨uwsgiçš„xmlæ–‡ä»¶ï¼š 1234567&lt;uwsgi&gt; &lt;socket&gt;:8077&lt;/socket&gt; &lt;chdir&gt;/home/work/src/sites/testdjango1/testdjango/mysite&lt;/chdir&gt; &lt;module&gt;django_wsgi&lt;/module&gt; &lt;processes&gt;4&lt;/processes&gt; &lt;!-- è¿›ç¨‹æ•° --&gt; &lt;daemonize&gt;uwsgi.log&lt;/daemonize&gt;&lt;/uwsgi&gt; é…ç½®NginxæœåŠ¡å™¨ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041#å¤‡ä»½nginxé…ç½®æ–‡ä»¶ï¼šsudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bakvim /etc/nginx/sites-available/default ä¿®æ”¹å¦‚ä¸‹ï¼šserver &#123; listen 80; server_name localhost; access_log /var/log/nginx/access.log; error_log /var/log/nginx/error.log; #charset koi8-r; #access_log logs/host.access.log main; location / &#123; include uwsgi_params; uwsgi_pass 127.0.0.1:8077; &#125; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; #method first location ~ ^/static/ &#123; root /home/hz/PycharmProjects/myscrapy/check_ip/; expires 24h; access_log off; &#125; #method second #location ~* ^.+\\.(css|js|json|ttf|woff|map|woff2)$&#123; # root /home/hz/PycharmProjects/myscrapy/check_ip/; # access_log off; # expires 24h; #&#125; &#125; å¦‚æœä¸èƒ½è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼Œä¿®æ”¹ç›¸å…³æ–‡ä»¶çš„æƒé™å³å¯ éªŒè¯æµ‹è¯•å„æ­¥éª¤ç»“æœ 123456789é‡å¯NginxæœåŠ¡å™¨ï¼Œä»¥ä½¿Nginxçš„é…ç½®ç”Ÿæ•ˆã€‚nginx -s reloadé‡å¯åæ£€æŸ¥Nginxæ—¥å¿—æ˜¯å¦æœ‰å¼‚å¸¸ã€‚å¯åŠ¨uWSGIæœåŠ¡å™¨cd /home/work/src/sites/testdjango1/testdjango/mysiteuwsgi -x djangochina_socket.xml djangoæœé›†é™æ€æ–‡ä»¶ 1234settings.pyæ–‡ä»¶ä¸­æŒ‡å®šSTATIC_ROOTè·¯å¾„python manage.py collectstaticä¿®æ”¹nginxé…ç½®æ–‡ä»¶æŒ‡å®šç›®å½•åˆ°STATIC_ROOT","categories":[{"name":"python","slug":"python","permalink":"https://www.xiemx.com/categories/python/"},{"name":"uwsgi","slug":"python/uwsgi","permalink":"https://www.xiemx.com/categories/python/uwsgi/"}],"tags":[{"name":"python","slug":"python","permalink":"https://www.xiemx.com/tags/python/"},{"name":"django","slug":"django","permalink":"https://www.xiemx.com/tags/django/"},{"name":"nginx","slug":"nginx","permalink":"https://www.xiemx.com/tags/nginx/"},{"name":"uwsgi","slug":"uwsgi","permalink":"https://www.xiemx.com/tags/uwsgi/"}],"author":"xiemx"},{"title":"linuxè‡ªå¸¦çš„é™åˆ¶ç­–ç•¥","slug":"linux-limit-tools","date":"2016-07-11T01:07:34.000Z","updated":"2019-10-21T06:57:42.327Z","comments":true,"path":"/2016/07/11/linux-limit-tools/","link":"","permalink":"https://www.xiemx.com/2016/07/11/linux-limit-tools/","excerpt":"","text":"[root@iZ11eqvuvnqZ ~]# cat /etc/security/limits.conf # /etc/security/limits.conf # #This file sets the resource limits for the users logged in via PAM. #It does not affect resource limits of the system services. # #Also note that configuration files in /etc/security/limits.d directory, #which are read in alphabetical order, override the settings in this #file in case the domain is the same or more specific. #That means for example that setting a limit for wildcard domain here #can be overriden with a wildcard setting in a config file in the #subdirectory, but a user specific setting here can be overriden only #with a user specific setting in the subdirectory. # #Each line describes a limit for a user in the form: # #domain&gt; type&gt; item&gt; value&gt; # #Where: #domain&gt; can be: # - a user name # - a group name, with @group syntax # - the wildcard *, for default entry # - the wildcard %, can be also used with %group syntax, # for maxlogin limit # #type&gt; can have the two values: # - &quot;soft&quot; for enforcing the soft limits # - &quot;hard&quot; for enforcing hard limits # #item&gt; can be one of the following: # - core - limits the core file size (KB) # - data - max data size (KB) # - fsize - maximum filesize (KB) # - memlock - max locked-in-memory address space (KB) # - nofile - max number of open files # - rss - max resident set size (KB) # - stack - max stack size (KB) # - cpu - max CPU time (MIN) # - nproc - max number of processes # - as - address space limit (KB) # - maxlogins - max number of logins for this user # - maxsyslogins - max number of logins on the system # - priority - the priority to run user process with # - locks - max number of file locks the user can hold # - sigpending - max number of pending signals # - msgqueue - max memory used by POSIX message queues (bytes) # - nice - max nice priority allowed to raise to values: [-20, 19] # - rtprio - max realtime priority # #domain&gt; &amp;lt;type&gt; &amp;lt;item&gt; &amp;lt;value&gt; # #* soft core 0 #* hard rss 10000 #@student hard nproc 20 #@faculty soft nproc 20 #@faculty hard nproc 50 #ftp hard nproc 0 #@student - maxlogins 4 # End of file * soft nofile 65535 * hard nofile 65535","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"command","slug":"command","permalink":"https://www.xiemx.com/tags/command/"},{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"é™åˆ¶è¿›ç¨‹çš„CPUåˆ©ç”¨ç‡","slug":"cpulimit","date":"2016-07-06T02:07:20.000Z","updated":"2019-10-21T06:57:42.386Z","comments":true,"path":"/2016/07/06/cpulimit/","link":"","permalink":"https://www.xiemx.com/2016/07/06/cpulimit/","excerpt":"","text":"cpulimitå®‰è£… 123apt-get install cpulimityum install cpulimit### è¯·å…ˆå®‰è£…epelæºï¼Œåœ¨æ‰§è¡Œyumå‘½ä»¤. cpulimitå®ä¾‹ 1234567### æ ¹æ®è¿›ç¨‹IDé™å€¼cpulimit -p 1234 -l 40è¿›ç¨‹IDä¸º1234çš„ç¨‹åºåªèƒ½ä½¿ç”¨40%çš„cpu### æ ¹æ®è¿›ç¨‹è·¯å¾„é™å€¼cpulimit -e nginx -l 50nginxåªèƒ½ä½¿ç”¨50%çš„cpu æ³¨æ„äº‹é¡¹è¿™è¾¹è¦ç•™æ„ä¸€ç‚¹ï¼Œ-låé¢é»˜è®¤å€¼æ˜¯ç™¾åˆ†æ¯”ï¼Œè€Œä¸”åœ¨åŒæ ¸æƒ…å†µä¸‹è¦å‡åŠã€‚ä¾‹å¦‚nginxçš„ä¾‹å­ï¼Œåœ¨åŒæ ¸cpuæƒ…å†µä¸‹ä»–å¯ä»¥åˆ©ç”¨25%çš„cpuï¼Œåœ¨4æ ¸çš„æƒ…å†µä¸‹ï¼Œåªèƒ½ä½¿ç”¨12.5%çš„cpu.rootç”¨æˆ·å¯ä»¥é™å€¼æ‰€æœ‰çš„è¿›ç¨‹ï¼Œæ™®é€šç”¨æˆ·åªèƒ½é™å€¼è‡ªå·±ç¨‹åº. é¡¹ç›®åœ°å€ï¼šhttp://cpulimit.sourceforge.net/","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"command","slug":"command","permalink":"https://www.xiemx.com/tags/command/"},{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"cpulimit","slug":"cpulimit","permalink":"https://www.xiemx.com/tags/cpulimit/"}],"author":"xiemx"},{"title":"PHP_CURL ä½¿ç”¨ä»£ç†è®¿é—®æœåŠ¡å™¨","slug":"php_curl","date":"2016-07-05T19:07:24.000Z","updated":"2019-10-21T06:57:42.702Z","comments":true,"path":"/2016/07/06/php_curl/","link":"","permalink":"https://www.xiemx.com/2016/07/06/php_curl/","excerpt":"","text":"12345678910111213141516171819202122#ä½¿ç”¨ä»£ç æ—¶è¯·åŠ ä¸Šphpæ–‡ä»¶çš„æ‹¬å·function curl_string ($url,$user_agent,$proxy)&#123; $ch = curl_init(); curl_setopt ($ch, CURLOPT_PROXY, $proxy); curl_setopt ($ch, CURLOPT_URL, $url); curl_setopt ($ch, CURLOPT_USERAGENT, $user_agent); curl_setopt ($ch, CURLOPT_HEADER, 1); curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt ($ch, CURLOPT_FOLLOWLOCATION, 1); curl_setopt ($ch, CURLOPT_TIMEOUT, 120); $result = curl_exec ($ch); curl_close($ch); return $result;&#125;$url_page = \"http://www.google.com\";$user_agent = \"Mozilla/4.0\";$proxy = \"http://192.11.222.124:8000\";$string = curl_string($url_page,$user_agent,$proxy);echo $string;","categories":[{"name":"php","slug":"php","permalink":"https://www.xiemx.com/categories/php/"}],"tags":[{"name":"php","slug":"php","permalink":"https://www.xiemx.com/tags/php/"}],"author":"xiemx"},{"title":"zabbixå¾®ä¿¡æŠ¥è­¦è„šæœ¬","slug":"zabbix-alert-to-wechat-script","date":"2016-06-29T02:06:55.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2016/06/29/zabbix-alert-to-wechat-script/","link":"","permalink":"https://www.xiemx.com/2016/06/29/zabbix-alert-to-wechat-script/","excerpt":"","text":"123456789101112131415161718192021222324252627282930313233343536373839404142#!/usr/bin/python__author__ = 'xiemx'import sysimport json,requestsimport osimport loggingclass Weixin(object): def get_token(self): CorpID = '-------4fa4' Secret = 'Aew6oxx-----------FaTClkjXlmw_zH' token_url = 'https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=&#123;&#125;&amp;corpsecret=&#123;&#125;'.format(CorpID, Secret) response = requests.get(token_url, verify=False).content p = json.loads(response) token = p['access_token'] return token def send_msg(self, user_id, msg): token = self.get_token() url = 'https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&#123;&#125;'.format(token) send_content=&#123; \"touser\": user_id, \"msgtype\": \"text\", \"agentid\": \"2\", \"text\": &#123; \"content\": msg &#125;, \"safe\":\"0\" &#125; p = requests.post(url, verify=False, data=json.dumps(send_content)) print p.content logging.debug(\"weixin send success\")if __name__ == \"__main__\": user_id = sys.argv[1] msg = sys.argv[2] + '\\n' + sys.argv[3] weixin = Weixin() weixin.send_msg(user_id, msg)","categories":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/categories/zabbix/"}],"tags":[],"author":"xiemx"},{"title":"zabbixç›‘æ§æŒ‡å®šç«¯å£","slug":"zabbix-monitor-port","date":"2016-06-29T02:06:32.000Z","updated":"2019-10-21T06:57:42.819Z","comments":true,"path":"/2016/06/29/zabbix-monitor-port/","link":"","permalink":"https://www.xiemx.com/2016/06/29/zabbix-monitor-port/","excerpt":"","text":"1.ç™»é™†zabbixä¸»ç•Œé¢ é€‰æ‹©ï¼šé…ç½®-æ¨¡æ¿ é€‰æ‹©æ¨¡æ¿ç»„ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯Template App Agentlessï¼ŒåŸå› è¯¥è‡ªå¸¦æ¨¡æ¿ç»„å†…åŒ…å«å„ç§å¸¸ç”¨æœåŠ¡çš„æ¨¡æ¿ å•å‡»è¯¥æ¨¡æ¿ç»„ é¡¹ç›® ç‚¹å‡»å³ä¸Šè§’çš„ åˆ›å»ºé¡¹ç›® è¿™é‡Œæ·»åŠ çš„æ˜¯mysqlæœåŠ¡ï¼ŒæŒ‰ç…§å¦‚å›¾é…ç½® å•å‡»ä¸‹æ–¹ å­˜æ¡£ ä¿å­˜ã€‚ å¦‚å›¾ç‚¹å‡» è§¦å‘å™¨ å¦‚å›¾ï¼Œç‚¹å‡»å³ä¸Šæ–¹ åˆ›å»ºè§¦å‘å™¨ æŒ‰ç…§å¦‚å›¾é…ç½® ç‚¹å‡» å­˜æ¡£ ä¿å­˜ï¼Œå®Œæ¯•ã€‚ ä»¥ä¸Šæ˜¯å°†è‡ªå®šä¹‰æ¨¡æ¿æœåŠ¡æ·»åŠ åˆ°Template App Agentlessæ¨¡æ¿ç»„ æœ€åå°†Template App Agentlessæ¨¡æ¿ç»„æ·»åŠ åˆ°ä½ éœ€è¦ç›‘æ§çš„å®¢æˆ·ç«¯ä¸»æœºå†…","categories":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/categories/zabbix/"}],"tags":[],"author":"xiemx"},{"title":"shell å˜é‡ç‰¹æ®Šæ“ä½œ","slug":"shell-advance-variable","date":"2016-06-29T02:06:08.000Z","updated":"2019-10-21T06:57:42.989Z","comments":true,"path":"/2016/06/29/shell-advance-variable/","link":"","permalink":"https://www.xiemx.com/2016/06/29/shell-advance-variable/","excerpt":"","text":"æ›¿æ¢è¿ç®—ç¬¦1234$&#123;var:-word&#125; å¦‚æœvarå­˜åœ¨ä¸”énullï¼Œè¿”å›å®ƒçš„å€¼ï¼›å¦åˆ™è¿”å›word$&#123;var:=word&#125; å¦‚æœvarå­˜åœ¨ä¸”énullï¼Œè¿”å›å®ƒçš„å€¼ï¼›å¦åˆ™å°†wordèµ‹å€¼ç»™varï¼Œå¹¶è¿”å›varçš„å€¼$&#123;var:?word&#125; å¦‚æœvarå­˜åœ¨ä¸”énullï¼Œè¿”å›å®ƒçš„å€¼ï¼›å¦åˆ™æ˜¾ç¤ºvar:word$&#123;var:+word&#125; å¦‚æœvarå­˜åœ¨ä¸”énullï¼Œè¿”å›wordï¼›å¦åˆ™è¿”å›null æ¨¡å¼åŒ¹é…è¿ç®—ç¬¦1234$&#123;var#pattern&#125; åŒ¹é…å‰ç¼€ï¼ˆæœ€å°åŒ¹é…ï¼‰ï¼Œå¹¶è¿”å›ä½™ä¸‹å†…å®¹$&#123;var##pattern&#125; åŒ¹é…å‰ç¼€ï¼ˆæœ€å¤§åŒ¹é…ï¼‰ï¼Œå¹¶è¿”å›ä½™ä¸‹å†…å®¹$&#123;var%pattern&#125; åŒ¹é…ç»“å°¾ï¼ˆæœ€å°åŒ¹é…ï¼‰ï¼Œå¹¶è¿”å›ä½™ä¸‹å†…å®¹$&#123;var%%pattern&#125; åŒ¹é…ç»“å°¾ï¼ˆæœ€å¤§åŒ¹é…ï¼‰ï¼Œå¹¶è¿”å›ä½™ä¸‹å†…å®¹ æ³¨ï¼špatternä¸ºæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…","categories":[{"name":"shell","slug":"shell","permalink":"https://www.xiemx.com/categories/shell/"},{"name":"linux","slug":"shell/linux","permalink":"https://www.xiemx.com/categories/shell/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"shell","slug":"shell","permalink":"https://www.xiemx.com/tags/shell/"}],"author":"xiemx"},{"title":"shell ç‰¹æ®Šå˜é‡","slug":"shell-special-env-variable","date":"2016-06-29T01:06:36.000Z","updated":"2019-10-19T08:06:22.355Z","comments":true,"path":"/2016/06/29/shell-special-env-variable/","link":"","permalink":"https://www.xiemx.com/2016/06/29/shell-special-env-variable/","excerpt":"","text":"ç‰¹æ®Šå˜é‡ 12345678910111213141516$# è¡¨ç¤ºå˜é‡çš„ä¸ªæ•°ï¼Œå¸¸ç”¨äºå¾ªç¯$@ å½“å‰å‘½ä»¤è¡Œæ‰€æœ‰å‚æ•°$* å½“å‰å‘½ä»¤è¡Œæ‰€æœ‰å‚æ•°ï¼Œå°†å‘½ä»¤è¡Œæ‰€æœ‰å‚æ•°å½“ä¸€ä¸ªå•ç‹¬å‚æ•°è·å–$? è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤é€€å‡ºçš„çŠ¶æ€$$ è¡¨ç¤ºå½“å‰è¿›ç¨‹ç¼–å·$0 è¡¨ç¤ºå½“å‰ç¨‹åºåç§°$! è¡¨ç¤ºæœ€è¿‘ä¸€ä¸ªåå°å‘½ä»¤çš„è¿›ç¨‹ç¼–å·$IFS è¡¨ç¤ºå†…éƒ¨çš„å­—æ®µåˆ†éš”ç¬¦$?çš„å‚è€ƒå€¼0 æˆåŠŸé€€å‡º&gt;0 é€€å‡ºå¤±è´¥1-125 å‘½ä»¤é€€å‡ºå¤±è´¥ï¼Œå¤±è´¥è¿”å›çš„ç›¸å…³å€¼ç”±ç¨‹åºå®šä¹‰ï¼ˆè­¬å¦‚ï¼Œç¨‹åºå†…é€€å‡ºåªæ‰§è¡Œ exit 2ï¼Œåˆ™è¿”å›ä¸º2ï¼‰126 å‘½ä»¤æ‰¾åˆ°äº†ï¼Œä½†æ— æ³•æ‰§è¡Œ127 å‘½ä»¤æ‰¾ä¸åˆ°&gt;128 å‘½ä»¤å› å—åˆ°ä¿¡å·è€Œæ­»äº¡","categories":[{"name":"shell","slug":"shell","permalink":"https://www.xiemx.com/categories/shell/"},{"name":"linux","slug":"shell/linux","permalink":"https://www.xiemx.com/categories/shell/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"shell","slug":"shell","permalink":"https://www.xiemx.com/tags/shell/"}],"author":"xiemx"},{"title":"rbashåˆ›å»ºåªè¯»ç”¨æˆ·","slug":"rbash-add-readonly-user","date":"2016-06-01T18:06:03.000Z","updated":"2019-10-21T06:57:42.831Z","comments":true,"path":"/2016/06/02/rbash-add-readonly-user/","link":"","permalink":"https://www.xiemx.com/2016/06/02/rbash-add-readonly-user/","excerpt":"","text":"ç½‘ä¸Šçœ‹åˆ°ä¸€ç¯‡ç”¨rbashæ¥åˆ›å»ºå—é™ç”¨æˆ·çš„æ–‡ç« ï¼Œæ¥æºå¿˜è®°äº†ï¼Œmarkåœ¨è¿™é‡Œ å—é™bashå¦‚æœ bash ä»¥ rbash ä¸ºç¨‹åºåå¯åŠ¨æˆ–è€…å‘½ä»¤è¡Œå‚æ•°æœ‰ -r é€‰é¡¹ï¼Œåˆ™å¯åŠ¨çš„è¿™ä¸ª shell ä¼šåœ¨æŸäº›åŠŸèƒ½ä¸Šå—é™åˆ¶ï¼å…·ä½“è¡¨ç°ä¸ºå¦‚ä¸‹æ“ä½œéƒ½ä¸èƒ½åšï¼š 12345678910111213é€šè¿‡ cd æ¥æ”¹å˜å·¥ä½œç›®å½•è®¾ç½®æˆ–å–æ¶ˆç¯å¢ƒå˜é‡ï¼š SHELLï¼Œ PATHï¼Œ ENVï¼Œ BASH_ENVå‘½ä»¤åä¸­ä¸èƒ½åŒ…å«ç›®å½•åˆ†éš”ç¬¦ â€˜/â€™åŒ…å«æœ‰ â€˜/â€™ çš„æ–‡ä»¶åä½œä¸ºå†…ç½®å‘½ä»¤ â€˜.â€™ çš„å‚æ•°hash å†…ç½®å‘½ä»¤æœ‰ -p é€‰é¡¹æ—¶çš„æ–‡ä»¶åå‚æ•°åŒ…å« '/'åœ¨å¯åŠ¨æ—¶é€šè¿‡ shell ç¯å¢ƒå¯¼å…¥å‡½æ•°å®šä¹‰åœ¨å¯åŠ¨æ—¶é€šè¿‡ shell ç¯å¢ƒè§£æ SHELLOPTS çš„å€¼ä½¿ç”¨ &gt;ï¼Œ&gt;|ï¼Œ &lt;&gt;ï¼Œ &gt;&amp;ï¼Œ &amp;&gt;ï¼Œ &gt;&gt; ç­‰é‡å®šå‘æ“ä½œç¬¦ä½¿ç”¨ exec å†…ç½®å‘½ä»¤é€šè¿‡ enable å†…ç½®å‘½ä»¤çš„ -f å’Œ -d é€‰é¡¹å¢åŠ æˆ–åˆ é™¤å†…ç½®å‘½ä»¤ä½¿ç”¨ enable å†…ç½®å‘½ä»¤æ¥ç¦ç”¨æˆ–å¯ç”¨ shell å†…ç½®å‘½ä»¤æ‰§è¡Œ command å†…ç½®å‘½ä»¤æ—¶åŠ ä¸Š -p é€‰é¡¹é€šè¿‡ set +r æˆ– set +o restricted å…³é—­å—é™æ¨¡å¼ æ­¥éª¤123456789101112131415161718ln -s /bin/bash /bin/rbashuseradd -s /bin/rbash rttlsapasswd rttlsamkdir /home/rttlsa/binchown root. /home/rttlsa/.bash_profile chmod 755 /home/rttlsa/.bash_profilevi /home/rttlsa/.bash_profile .bash_profile# Get the aliases and functionsif [ -f ~/.bashrc ]; then . ~/.bashrcfi# User specific environment and startup programsPATH=$HOME/binexport PATHln -s /bin/cat /home/rttlsa/bin/cat å°†å…è®¸æ‰§è¡Œçš„å‘½ä»¤é“¾æ¥åˆ°$HOME/binç›®å½• å¦‚æ­¤å³å¯åˆ›å»ºåªå…è®¸æŸ¥çœ‹æ—¥å¿—çš„åªè¯»ç”¨æˆ·ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"command","slug":"command","permalink":"https://www.xiemx.com/tags/command/"},{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"rbash","slug":"rbash","permalink":"https://www.xiemx.com/tags/rbash/"},{"name":"bash","slug":"bash","permalink":"https://www.xiemx.com/tags/bash/"}],"author":"xiemx"},{"title":"é”™è¯¯Could not run curl-config: [Errno 2] No such file or directoryè§£å†³","slug":"cloud-not-run-curl-config","date":"2016-05-26T21:05:22.000Z","updated":"2019-10-21T06:57:43.013Z","comments":true,"path":"/2016/05/27/cloud-not-run-curl-config/","link":"","permalink":"https://www.xiemx.com/2016/05/27/cloud-not-run-curl-config/","excerpt":"","text":"12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667root@06f95000953c:~/phantomjs# pip install pycurlDownloading/unpacking pycurl Downloading pycurl-7.43.0.tar.gz (182kB): 182kB downloaded Running setup.py (path:/tmp/pip-build-XGZuU8/pycurl/setup.py) egg_info for package pycurl Traceback (most recent call last): File \"\", line 17, in File \"/tmp/pip-build-XGZuU8/pycurl/setup.py\", line 823, in ext = get_extension(sys.argv, split_extension_source=split_extension_source) File \"/tmp/pip-build-XGZuU8/pycurl/setup.py\", line 497, in get_extension ext_config = ExtensionConfiguration(argv) File \"/tmp/pip-build-XGZuU8/pycurl/setup.py\", line 71, in __init__ self.configure() File \"/tmp/pip-build-XGZuU8/pycurl/setup.py\", line 107, in configure_unix raise ConfigurationError(msg) __main__.ConfigurationError: Could not run curl-config: [Errno 2] No such file or directory Complete output from command python setup.py egg_info: Traceback (most recent call last): File \"\", line 17, in File \"/tmp/pip-build-XGZuU8/pycurl/setup.py\", line 823, in ext = get_extension(sys.argv, split_extension_source=split_extension_source) File \"/tmp/pip-build-XGZuU8/pycurl/setup.py\", line 497, in get_extension ext_config = ExtensionConfiguration(argv) File \"/tmp/pip-build-XGZuU8/pycurl/setup.py\", line 71, in __init__ self.configure() File \"/tmp/pip-build-XGZuU8/pycurl/setup.py\", line 107, in configure_unix raise ConfigurationError(msg)__main__.ConfigurationError: Could not run curl-config: [Errno 2] No such file or directory----------------------------------------Cleaning up...Command python setup.py egg_info failed with error code 1 in /tmp/pip-build-XGZuU8/pycurlStoring debug log for failure in /root/.pip/pip.logroot@06f95000953c:~/phantomjs# apt-get install libcurl4-openssl-devReading package lists... DoneBuilding dependency tree Reading state information... DoneSuggested packages: libcurl4-doc libcurl3-dbg libidn11-dev libkrb5-dev libldap2-dev librtmp-devThe following NEW packages will be installed: libcurl4-openssl-dev0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.Need to get 253 kB of archives.After this operation, 1262 kB of additional disk space will be used.Get:1 http://mirrors.163.com/ubuntu/ vivid-security/main libcurl4-openssl-dev amd64 7.38.0-3ubuntu2.2 [253 kB]Fetched 253 kB in 5s (47.1 kB/s) debconf: delaying package configuration, since apt-utils is not installedSelecting previously unselected package libcurl4-openssl-dev:amd64.(Reading database ... 25480 files and directories currently installed.)Preparing to unpack .../libcurl4-openssl-dev_7.38.0-3ubuntu2.2_amd64.deb ...Unpacking libcurl4-openssl-dev:amd64 (7.38.0-3ubuntu2.2) ...Setting up libcurl4-openssl-dev:amd64 (7.38.0-3ubuntu2.2) ...root@06f95000953c:~/phantomjs# root@06f95000953c:~/phantomjs# root@06f95000953c:~/phantomjs# curlcurl curl-config root@06f95000953c:~/phantomjs# å®‰è£…libcurl4-openssl-devæ­¤å¼€å‘åŒ…å³å¯ 1sudo apt-get install libcurl4-openssl-dev","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"},{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"dedecmsç»‡æ¢¦éªŒè¯ç æ— æ³•æ­£å¸¸æ˜¾ç¤º","slug":"dedecms-yanzhenma","date":"2016-05-25T18:05:40.000Z","updated":"2019-10-21T06:57:42.669Z","comments":true,"path":"/2016/05/26/dedecms-yanzhenma/","link":"","permalink":"https://www.xiemx.com/2016/05/26/dedecms-yanzhenma/","excerpt":"","text":"æ–¹æ¡ˆä¸€ï¼šèµ‹äºˆsessionsè¯»ã€å†™ã€å¯æ‰§è¡Œçš„æƒé™ ä¿®æ”¹æ ¹ç›®å½•ä¸‹/data/sessions/çš„sess_***æ–‡ä»¶ä¿®æ”¹æƒé™ä¸º777ï¼ˆå‘½ä»¤ï¼šchmod 777 filenameï¼‰ã€‚ æ–¹æ¡ˆäºŒï¼šå°†vdimgck.phpæ›¿æ¢æ³• æ›¿æ¢å‰è¯·å°†å½“å‰çš„vdimgck.phpå¤‡ä»½ã€‚æ‰¾å›ç›¸åŒç‰ˆæœ¬çš„DEDEå®‰è£…åŒ…ï¼Œæ‰¾åˆ°/include/vdimgck.php æ–‡ä»¶ï¼Œå¹¶ç”¨å…¶æ›¿æ¢å½“å‰ç«™ç‚¹çš„vdimgck.phpæ–‡ä»¶ã€‚ æ–¹æ¡ˆä¸‰ï¼šå»æ‰ç™»é™†éªŒè¯ç ä»£ç  å¦‚æœä¸Šé¢çš„ä¸¤ç§è§£å†³åŠæ³•éƒ½è§£å†³ä¸äº†ï¼Œé‚£å°±ç›´æ¥å»æ‰éªŒè¯ç åŠŸèƒ½ã€‚æ˜¯ä¿®æ”¹data\\safe\\inc_safe_config.php é…ç½®æ–‡ä»¶ã€‚ æ–¹æ³•ï¼š$safe_gdopen = â€™1,2,3,5,6â€²; è¿™ä¸ªå°±æ˜¯ç³»ç»Ÿå“ªäº›åœ°æ–¹å¼€å¯éªŒè¯ç ã€‚ä¸[éªŒè¯ç å®‰å…¨è®¾ç½®]ç•Œé¢æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚ æ‰€ä»¥ï¼Œå¦‚æœå½“æˆ‘ä»¬ç®¡ç†åå°æƒ³å…³é—­éªŒè¯ç (å¦‚æœéªŒè¯ç æ— æ³•æ­£ç¡®è¾“å…¥ï¼Œä¸æ”¯æŒGBåº“)çš„æ—¶å€™ï¼Œåªéœ€è¦æ‰“å¼€data\\safe\\inc_safe_config.php å°†$safe_gdopen = â€™1,2,3,5,6â€²; ä¸­çš„6åˆ é™¤å³å¯ã€‚","categories":[{"name":"php","slug":"php","permalink":"https://www.xiemx.com/categories/php/"}],"tags":[{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"},{"name":"php","slug":"php","permalink":"https://www.xiemx.com/tags/php/"},{"name":"dedecms","slug":"dedecms","permalink":"https://www.xiemx.com/tags/dedecms/"}],"author":"xiemx"},{"title":"redisä¸»ä»å¤åˆ¶","slug":"redis-slave-replica","date":"2016-05-23T03:05:17.000Z","updated":"2019-10-19T08:43:41.709Z","comments":true,"path":"/2016/05/23/redis-slave-replica/","link":"","permalink":"https://www.xiemx.com/2016/05/23/redis-slave-replica/","excerpt":"","text":"redisä¸»ä»å¤åˆ¶ç‰¹ç‚¹: masterå¯ä»¥æ‹¥æœ‰å¤šä¸ªslave å¤šä¸ªslaveå¯ä»¥è¿æ¥åŒä¸€ä¸ªmasterå¤–ï¼Œè¿˜å¯ä»¥è¿æ¥åˆ°å…¶ä»–slave ä¸»ä»å¤åˆ¶ä¸ä¼šé˜»å¡masterï¼Œåœ¨åŒæ­¥æ•°æ®æ—¶ï¼Œmasterå¯ä»¥ç»§ç»­å¤„ç†clientè¯·æ±‚ æé«˜ç³»ç»Ÿçš„ä¼¸ç¼©æ€§ å¯ä»¥åœ¨masterç¦ç”¨æ•°æ®æŒä¹…åŒ–ï¼Œæ³¨é‡Šæ‰masteré…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰saveé…ç½®ï¼Œåªéœ€åœ¨slaveä¸Šé…ç½®æ•°æ®æŒä¹…åŒ– redisä¸»ä»å¤åˆ¶è¿‡ç¨‹: å½“é…ç½®å¥½slaveåï¼Œslaveä¸masterå»ºç«‹è¿æ¥ï¼Œç„¶åå‘é€syncå‘½ä»¤ã€‚æ— è®ºæ˜¯ç¬¬ä¸€æ¬¡è¿æ¥è¿˜æ˜¯é‡æ–°è¿æ¥ï¼Œmasteréƒ½ä¼šå¯åŠ¨ä¸€ä¸ªåå°è¿›ç¨‹ï¼Œå°†æ•°æ®åº“å¿«ç…§ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶masterä¸»è¿›ç¨‹ä¼šå¼€å§‹æ”¶é›†æ–°çš„å†™å‘½ä»¤å¹¶ç¼“å­˜ã€‚åå°è¿›ç¨‹å®Œæˆå†™æ–‡ä»¶åï¼Œmasterå°±å‘é€æ–‡ä»¶ç»™slaveï¼Œslaveå°†æ–‡ä»¶ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šï¼Œå†åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ¥ç€masterå°±ä¼šæŠŠç¼“å­˜çš„å‘½ä»¤è½¬å‘ç»™slaveï¼Œåç»­masterå°†æ”¶åˆ°çš„å†™å‘½ä»¤å‘é€ç»™slaveã€‚å¦‚æœmasteråŒæ—¶æ”¶åˆ°å¤šä¸ªslaveå‘æ¥çš„åŒæ­¥è¿æ¥å‘½ä»¤ï¼Œmasteråªä¼šå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ¥å†™æ•°æ®åº“é•œåƒï¼Œç„¶åå‘é€ç»™æ‰€æœ‰çš„slaveã€‚ redisä¸»ä»é…ç½®:1234567891011121314151617181920212223242526272829303132### masterdaemonize yespidfile /var/run/redis.pidport 6379timeout 300loglevel verboselogfile /usr/local/xiemx-redis/var/log/redis.logdatabases 16save 900 1save 300 10save 60 10000rdbcompression yesdbfilename dump.rdbdir /usr/local/xiemx-redis/var/datarequirepass redisappendonly noappendfsync everysecno-appendfsync-on-rewrite noslowlog-log-slower-than 10000slowlog-max-len 1024vm-enabled novm-swap-file /tmp/redis.swapvm-max-memory 0vm-page-size 32vm-pages 134217728vm-max-threads 4hash-max-zipmap-entries 512hash-max-zipmap-value 64list-max-ziplist-entries 512list-max-ziplist-value 64set-max-intset-entries 512activerehashing yes 123456789101112131415161718192021222324252627282930313233### slavedaemonize yespidfile /var/run/redis.pidport 6379timeout 300loglevel verboselogfile /usr/local/xiemx-redis/var/log/redis.logdatabases 16save 900 1save 300 10save 60 10000rdbcompression yesdbfilename dump.rdbdir /usr/local/xiemx-redis/var/dataappendonly noappendfsync everysecno-appendfsync-on-rewrite noslowlog-log-slower-than 10000slowlog-max-len 1024vm-enabled novm-swap-file /tmp/redis.swapvm-max-memory 0vm-page-size 32vm-pages 134217728vm-max-threads 4hash-max-zipmap-entries 512hash-max-zipmap-value 64list-max-ziplist-entries 512list-max-ziplist-value 64set-max-intset-entries 512activerehashing yesslaveof 192.168.1.189 6379masterauth redis rediså¤åˆ¶æµ‹è¯• 12345678910111213141516171819æŸ¥çœ‹masterç«¯æ—¥å¿—:[8930] 31 Jul 19:16:09 - Accepted 192.168.1.136:54774[8930] 31 Jul 19:16:09 * Slave ask for synchronization[8930] 31 Jul 19:16:09 * Starting BGSAVE for SYNC[8930] 31 Jul 19:16:09 * Background saving started by pid 10782[10782] 31 Jul 19:16:09 * DB saved on disk[8930] 31 Jul 19:16:09 * Background saving terminated with success[8930] 31 Jul 19:16:09 * Synchronization with slave succeeded[8930] 31 Jul 19:16:14 - DB 0: 1 keys (0 volatile) in 4 slots HT.[8930] 31 Jul 19:16:14 - 1 clients connected (1 slaves), 807320 bytes in useæŸ¥çœ‹slaveç«¯æ—¥å¿—:[24398] 01 Aug 10:16:10 * Connecting to MASTER...[24398] 01 Aug 10:16:10 * MASTER SLAVE sync started: SYNC sent[24398] 01 Aug 10:16:10 * MASTER SLAVE sync: receiving 25 bytes from master[24398] 01 Aug 10:16:10 * MASTER SLAVE sync: Loading DB in memory[24398] 01 Aug 10:16:10 * MASTER SLAVE sync: Finished with success[24398] 01 Aug 10:16:15 - DB 0: 1 keys (0 volatile) in 4 slots HT.[24398] 01 Aug 10:16:15 - 1 clients connected (0 slaves), 798960 bytes in use 1234567masterç«¯æ“ä½œ:redis 127.0.0.1:6379&gt; set k_m masterOKslaveç«¯æ“ä½œ:redis 127.0.0.1:6379&gt; get k_m\"master\"","categories":[{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/categories/redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://www.xiemx.com/tags/redis/"}],"author":"xiemx"},{"title":"Linuxå†…æ ¸è°ƒä¼˜éƒ¨åˆ†å‚æ•°è¯´æ˜","slug":"linux-kernal-paramenter","date":"2016-05-23T03:05:07.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2016/05/23/linux-kernal-paramenter/","link":"","permalink":"https://www.xiemx.com/2016/05/23/linux-kernal-paramenter/","excerpt":"","text":"#æ¥æ”¶å¥—æ¥å­—ç¼“å†²åŒºå¤§å°çš„é»˜è®¤å€¼(ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚net.core.rmem_default = 262144 #æ¥æ”¶å¥—æ¥å­—ç¼“å†²åŒºå¤§å°çš„æœ€å¤§å€¼(ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚ net.core.rmem_max = 16777216 #å‘é€å¥—æ¥å­—ç¼“å†²åŒºå¤§å°çš„é»˜è®¤å€¼(ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚ net.core.wmem_default = 262144 #å‘é€å¥—æ¥å­—ç¼“å†²åŒºå¤§å°çš„æœ€å¤§å€¼(ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚ net.core.wmem_max = 16777216 #ç”¨æ¥é™åˆ¶ç›‘å¬(LISTEN)é˜Ÿåˆ—æœ€å¤§æ•°æ®åŒ…çš„æ•°é‡ï¼Œè¶…è¿‡è¿™ä¸ªæ•°é‡å°±ä¼šå¯¼è‡´é“¾æ¥è¶…æ—¶æˆ–è€…è§¦å‘é‡ä¼ æœºåˆ¶ã€‚ net.core.somaxconn = 262144 #å½“ç½‘å¡æ¥æ”¶æ•°æ®åŒ…çš„é€Ÿåº¦å¤§äºå†…æ ¸å¤„ç†çš„é€Ÿåº¦æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªé˜Ÿåˆ—ä¿å­˜è¿™äº›æ•°æ®åŒ…ã€‚è¿™ä¸ªå‚æ•°è¡¨ç¤ºè¯¥é˜Ÿåˆ—çš„æœ€å¤§å€¼ã€‚ net.core.netdev_max_backlog = 262144 #è¡¨ç¤ºç³»ç»Ÿä¸­æœ€å¤šæœ‰å¤šå°‘TCPå¥—æ¥å­—ä¸è¢«å…³è”åˆ°ä»»ä½•ä¸€ä¸ªç”¨æˆ·æ–‡ä»¶å¥æŸ„ä¸Šã€‚å¦‚æœè¶…è¿‡è¿™é‡Œè®¾ç½®çš„æ•°å­—ï¼Œè¿æ¥å°±ä¼šå¤ä½å¹¶è¾“å‡ºè­¦å‘Šä¿¡æ¯ã€‚è¿™ä¸ªé™åˆ¶ä»…ä»…æ˜¯ä¸ºäº†é˜²æ­¢ç®€å•çš„DoSæ”»å‡»ã€‚æ­¤å€¼ä¸èƒ½å¤ªå°ã€‚ net.ipv4.tcp_max_orphans = 262144 #è¡¨ç¤ºé‚£äº›å°šæœªæ”¶åˆ°å®¢æˆ·ç«¯ç¡®è®¤ä¿¡æ¯çš„è¿æ¥ï¼ˆSYNæ¶ˆæ¯ï¼‰é˜Ÿåˆ—çš„é•¿åº¦ï¼Œé»˜è®¤ä¸º1024ï¼ŒåŠ å¤§é˜Ÿåˆ—é•¿åº¦ä¸º262144ï¼Œå¯ä»¥å®¹çº³æ›´å¤šç­‰å¾…è¿æ¥çš„ç½‘ç»œè¿æ¥æ•°ã€‚ net.ipv4.tcp_max_syn_backlog = 262144 #è¡¨ç¤ºç³»ç»ŸåŒæ—¶ä¿æŒTIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡ã€‚å¦‚æœè¶…è¿‡æ­¤æ•°ï¼ŒTIME_WAITå¥—æ¥å­—ä¼šè¢«ç«‹åˆ»æ¸…é™¤å¹¶ä¸”æ‰“å°è­¦å‘Šä¿¡æ¯ã€‚ä¹‹æ‰€ä»¥è¦è®¾å®šè¿™ä¸ªé™åˆ¶ï¼Œçº¯ç²¹ä¸ºäº†æŠµå¾¡é‚£äº›ç®€å•çš„DoSæ”»å‡»ï¼Œä¸è¿‡ï¼Œè¿‡å¤šçš„TIME_WAITå¥—æ¥å­—ä¹Ÿä¼šæ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Œç”šè‡³æ­»æœºã€‚ net.ipv4.tcp_max_tw_buckets = 10000 #è¡¨ç¤ºå…è®¸ç³»ç»Ÿæ‰“å¼€çš„ç«¯å£èŒƒå›´ã€‚ net.ipv4.ip_local_port_range = 1024 65500 #ä»¥ä¸‹ä¸¤å‚æ•°å¯è§£å†³ç”Ÿäº§åœºæ™¯ä¸­å¤§é‡è¿æ¥çš„æœåŠ¡å™¨ä¸­TIME_WAITè¿‡å¤šé—®é¢˜ã€‚ #è¡¨ç¤ºå¼€å¯TCPè¿æ¥ä¸­TIME_WAITå¥—æ¥å­—çš„å¿«é€Ÿå›æ”¶ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ã€‚ net.ipv4.tcp_tw_recycle = 1 #è¡¨ç¤ºå…è®¸é‡ç”¨TIME_WAITçŠ¶æ€çš„å¥—æ¥å­—ç”¨äºæ–°çš„TCPè¿æ¥,é»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ã€‚ net.ipv4.tcp_tw_reuse = 1 #å½“å‡ºç°SYNç­‰å¾…é˜Ÿåˆ—æº¢å‡ºæ—¶ï¼Œå¯ç”¨cookiesæ¥å¤„ç†ï¼Œå¯é˜²èŒƒå°‘é‡SYNæ”»å‡»ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ã€‚ net.ipv4.tcp_syncookies = 1 #è¡¨ç¤ºç³»ç»Ÿå…è®¸SYNè¿æ¥çš„é‡è¯•æ¬¡æ•°ã€‚ä¸ºäº†æ‰“å¼€å¯¹ç«¯çš„è¿æ¥ï¼Œå†…æ ¸éœ€è¦å‘é€ä¸€ä¸ªSYNå¹¶é™„å¸¦ä¸€ä¸ªå›åº”å‰é¢ä¸€ä¸ªSYNçš„ACKåŒ…ã€‚ä¹Ÿå°±æ˜¯æ‰€è°“ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„ç¬¬äºŒæ¬¡æ¡æ‰‹ã€‚è¿™ä¸ªè®¾ç½®å†³å®šäº†å†…æ ¸æ”¾å¼ƒè¿æ¥ä¹‹å‰å‘é€SYN+ACKåŒ…çš„æ•°é‡ã€‚ net.ipv4.tcp_synack_retries = 1 #è¡¨ç¤ºåœ¨å†…æ ¸æ”¾å¼ƒå»ºç«‹è¿æ¥ä¹‹å‰å‘é€SYNåŒ…çš„æ•°é‡ã€‚ net.ipv4.tcp_syn_retries = 1 #å‡å°‘å¤„äºFIN-WAIT-2è¿æ¥çŠ¶æ€çš„æ—¶é—´ï¼Œä½¿ç³»ç»Ÿå¯ä»¥å¤„ç†æ›´å¤šçš„è¿æ¥ã€‚ net.ipv4.tcp_fin_timeout = 30 #è¿™ä¸ªå‚æ•°è¡¨ç¤ºå½“keepaliveå¯ç”¨æ—¶ï¼ŒTCPå‘é€keepaliveæ¶ˆæ¯çš„é¢‘åº¦ã€‚é»˜è®¤æ˜¯2å°æ—¶ï¼Œè‹¥å°†å…¶è®¾ç½®å¾—å°ä¸€äº›ï¼Œå¯ä»¥æ›´å¿«åœ°æ¸…ç†æ— æ•ˆçš„è¿æ¥ã€‚ net.ipv4.tcp_keepalive_time = 600 #æ¢æµ‹æ¶ˆæ¯æœªè·å¾—å“åº”æ—¶ï¼Œé‡å‘è¯¥æ¶ˆæ¯çš„é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰ã€‚ç³»ç»Ÿé»˜è®¤75ç§’ã€‚ net.ipv4.tcp_keepalive_intvl = 30 #åœ¨è®¤å®šè¿æ¥å¤±æ•ˆä¹‹å‰ï¼Œå‘é€å¤šå°‘ä¸ªTCPçš„keepaliveæ¢æµ‹åŒ…ã€‚ç³»ç»Ÿé»˜è®¤å€¼æ˜¯9ã€‚è¿™ä¸ªå€¼ä¹˜ä»¥tcp_keepalive_intvlä¹‹åå†³å®šäº†ï¼Œä¸€ä¸ªè¿æ¥å‘é€äº†keepaliveæ¢æµ‹åŒ…ä¹‹åå¯ä»¥æœ‰å¤šå°‘æ—¶é—´æ²¡æœ‰å›åº”ã€‚ net.ipv4.tcp_keepalive_probes = 3 #ç¡®å®šTCPæ ˆåº”è¯¥å¦‚ä½•åæ˜ å†…å­˜ä½¿ç”¨ï¼Œæ¯ä¸ªå€¼çš„å•ä½éƒ½æ˜¯å†…å­˜é¡µï¼ˆé€šå¸¸æ˜¯4KBï¼‰ã€‚ç¬¬ä¸€ä¸ªå€¼æ˜¯å†…å­˜ä½¿ç”¨çš„ä¸‹é™ï¼›ç¬¬äºŒä¸ªå€¼æ˜¯å†…å­˜å‹åŠ›æ¨¡å¼å¼€å§‹å¯¹ç¼“å†²åŒºä½¿ç”¨åº”ç”¨å‹åŠ›çš„ä¸Šé™ï¼›ç¬¬ä¸‰ä¸ªå€¼æ˜¯å†…å­˜ä½¿ç”¨çš„ä¸Šé™ã€‚åœ¨è¿™ä¸ªå±‚æ¬¡ä¸Šå¯ä»¥å°†æŠ¥æ–‡ä¸¢å¼ƒï¼Œä»è€Œå‡å°‘å¯¹å†…å­˜çš„ä½¿ç”¨ã€‚ç¤ºä¾‹ä¸­ç¬¬ä¸€ä¸ªå€¼ä¸º7864324/1024/1024=3Gï¼Œç¬¬äºŒä¸ªå€¼ä¸º10485764/1024/1024=4Gï¼Œç¬¬ä¸‰ä¸ªå€¼ä¸º1572864*4/1024/1024=6Gã€‚ net.ipv4.tcp_mem = 786432 1048576 1572864 #æ­¤å‚æ•°é™åˆ¶å¹¶å‘æœªå®Œæˆçš„å¼‚æ­¥è¯·æ±‚æ•°ç›®ï¼Œåº”è¯¥è®¾ç½®é¿å…I/Oå­ç³»ç»Ÿæ•…éšœã€‚ fs.aio-max-nr = 1048576 #è¯¥å‚æ•°å†³å®šäº†ç³»ç»Ÿä¸­æ‰€å…è®¸çš„æ–‡ä»¶å¥æŸ„æœ€å¤§æ•°ç›®ï¼Œæ–‡ä»¶å¥æŸ„è®¾ç½®ä»£è¡¨linuxç³»ç»Ÿä¸­å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶çš„æ•°é‡ã€‚ fs.file-max = 6815744 #è¡¨ç¤ºå°½é‡ä½¿ç”¨å†…å­˜ï¼Œå‡å°‘ä½¿ç”¨ç£ç›˜swapäº¤æ¢åˆ†åŒºï¼Œå†…å­˜é€Ÿåº¦æ˜æ˜¾é«˜äºç£ç›˜ä¸€ä¸ªæ•°é‡çº§ã€‚ vm.swappiness = 0","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"kernal","slug":"kernal","permalink":"https://www.xiemx.com/tags/kernal/"}],"author":"xiemx"},{"title":"é‚®ä»¶å‘é€è„šæœ¬","slug":"python-send-mail","date":"2016-04-27T19:04:48.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2016/04/28/python-send-mail/","link":"","permalink":"https://www.xiemx.com/2016/04/28/python-send-mail/","excerpt":"","text":"pythonè°ƒç”¨å¤–éƒ¨smtpæœåŠ¡å™¨å‘é€é‚®ä»¶ 12345678910111213141516171819202122232425262728293031323334353637383940414243#!/usr/bin/env pythonfrom email.MIMEText import MIMETextfrom email.MIMEMultipart import MIMEMultipartfrom email.MIMEBase import MIMEBasefrom email import Utils,Encodersimport mimetypes,sysimport smtplibdef send_mail(user,passwd,host,context,sub,to_user): self_user = user self_pass = passwd self_smtp = host self_sub = sub self_context = context self_touser = to_user msg = MIMEMultipart() msg[\"To\"] = self_touser msg[\"From\"] = \"xxxx@unxn.com\" msg[\"Subject\"] = self_sub msg[\"Data\"] = Utils.formatdate(localtime = 1) body = MIMEText(self_context,_subtype = \"plain\") msg.attach(body) send = smtplib.SMTP(self_smtp) send.login(self_user,self_pass) send.sendmail(self_user,self_touser,msg.as_string()) send.close()if __name__=='__main__': host= \"smtp.qq.com\" user= \"xxxxxxxx@qq.com\" passwd= \"xxxxxxxx\" to_user = \"xxxxxxxxx@163.com\" sub = \"Log anaylse result!\" f = open(\"log\",\"r\") context = f.read() f.close() send_mail(user,passwd,host,context,sub,to_user)","categories":[{"name":"python","slug":"python","permalink":"https://www.xiemx.com/categories/python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://www.xiemx.com/tags/python/"},{"name":"mail","slug":"mail","permalink":"https://www.xiemx.com/tags/mail/"}],"author":"xiemx"},{"title":"python socketç¼–ç¨‹","slug":"python-code-socket","date":"2016-04-27T18:04:14.000Z","updated":"2019-10-21T06:57:42.386Z","comments":true,"path":"/2016/04/28/python-code-socket/","link":"","permalink":"https://www.xiemx.com/2016/04/28/python-code-socket/","excerpt":"","text":"éœ€è¦åœ¨å¤šå°æœåŠ¡å™¨ä¸Šè¿è¡Œæ—¥å¿—åˆ†æè„šæœ¬ï¼Œåˆ†æå®Œæˆåæ¯å°æœºå™¨ç›´æ¥å‘é€é‚®ä»¶ä¼šå‡ºç°å¤§é‡é‚®ä»¶åŒæ—¶è¿‡æ¥ï¼Œç°åœ¨æƒ³å°†å¤šå°æœºå™¨çš„åˆ†æç»“æœæ”¶é›†èµ·æ¥ï¼Œé€šè¿‡ç½‘ç»œå‘é€åˆ°æœåŠ¡ç«¯ï¼Œåœ¨æœåŠ¡ç«¯æ”¶é›†æ‰€æœ‰çš„æ—¥å¿—ï¼Œåœ¨ç»Ÿä¸€å‘é€ä¸€å°é‚®ä»¶ï¼Œå®ç°çš„socketä»£ç å¦‚ä¸‹ã€‚ æ¥æ”¶ç«¯ï¼ˆserverï¼‰123456789101112131415161718192021222324#!/usr/bin/env pythonimport socketdef socket_server(host,port): self_host = host self_port = port s = socket.socket(socket.AF_INET,socket.SOCK_STREAM) s.bind((self_host,self_port)) s.listen(4) f = open(\"log\", \"a\") while True: conn,addr=s.accept() data = conn.recv(1024) print 'data:', data f.write(data) f.close() s.close()if __name__ == \"__main__\": host = '127.0.0.1' port = 65530 socket_server(host,port) å‘é€ç«¯ï¼ˆclientï¼‰12345678910111213141516171819202122#!/usr/bin/env pythonimport socketdef socket_client(host,port,content): self_host = host self_port = port self_content = content s = socket.socket(socket.AF_INET,socket.SOCK_STREAM) s.connect((self_host,self_port)) s.sendall(content) s.close()if __name__ == \"__main__\": host = \"127.0.0.1\" port = 65530 f = open(\"sendfile\",\"r\") content = f.read() f.close() socket_client(host, port, content)","categories":[{"name":"python","slug":"python","permalink":"https://www.xiemx.com/categories/python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://www.xiemx.com/tags/python/"},{"name":"socket","slug":"socket","permalink":"https://www.xiemx.com/tags/socket/"}],"author":"xiemx"},{"title":"windowç³»ç»Ÿä¸Šéƒ¨ç½²Zabbix_agent","slug":"deploy-zabbix_agent-to-windows","date":"2016-04-13T01:04:53.000Z","updated":"2019-10-21T06:57:43.013Z","comments":true,"path":"/2016/04/13/deploy-zabbix_agent-to-windows/","link":"","permalink":"https://www.xiemx.com/2016/04/13/deploy-zabbix_agent-to-windows/","excerpt":"","text":"1.è·å–windowsçš„agentå®¢æˆ·ç«¯ï¼Œè§£å‹æ–‡ä»¶è‡³æŒ‡å®šä½ç½® ![img](/images/img_570da13048078.png)2.ä¿®æ”¹confæ–‡ä»¶ä¸­çš„ 12345Server=serverç«¯çš„IPåœ°å€ServerActive=serverç«¯çš„IPåœ°å€HostName=æœåŠ¡å™¨åœ¨ç›‘æ§ç«¯ä¸Šçš„ç›‘æ§åï¼Œå¯è§åç§°å¯ä»¥ä¸å†™é»˜è®¤ä¸ºä¸»æœºåç§° 3.å‘½ä»¤è¡Œæ¨¡å¼ä¸‹å®‰è£…Zabbix_agentç›‘æ§ç¨‹åº 1234567891011# è¿›å…¥è§£å‹åçš„æ–‡ä»¶å¤¹ä¸‹cd C:\\zabbix_agents\\bin\\win64#å®‰è£…ç¨‹åºzabbix_agentd.exe â€“c c:\\zabbix\\zabbix_agentd.conf -i#å¯åŠ¨ç¨‹åºzabbix_agentd.exe â€“c c:\\zabbix\\zabbix_agentd.conf -s 123456å‚æ•°å«ä¹‰ï¼š-c æŒ‡å®šé…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®-i å®‰è£…å®¢æˆ·ç«¯-s å¯åŠ¨å®¢æˆ·ç«¯-x åœæ­¢å®¢æˆ·ç«¯-d å¸è½½å®¢æˆ·ç«¯ 4.ç›‘æ§ç«¯æ·»åŠ agentæœåŠ¡å™¨æ³¨æ„ä¸»æœºåä¸ºconfæ–‡ä»¶ä¸­å®šä¹‰çš„åç§°ï¼Œå¦åˆ™ä¼šå¯¼è‡´æŸäº›ç›‘æ§é¡¹ç›®å¼‚å¸¸","categories":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/categories/zabbix/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/tags/windows/"},{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/tags/zabbix/"}],"author":"xiemx"},{"title":"Tomcatè™šæ‹Ÿä¸»æœºåˆ«åè®¾ç½®","slug":"tomcat-server-name-alias","date":"2016-04-13T01:04:35.000Z","updated":"2019-10-21T06:57:42.989Z","comments":true,"path":"/2016/04/13/tomcat-server-name-alias/","link":"","permalink":"https://www.xiemx.com/2016/04/13/tomcat-server-name-alias/","excerpt":"","text":"ä¸€ä¸ªè™šæ‹Ÿç©ºé—´éœ€è¦ç»‘å®šå¤šä¸ªåŸŸåæ—¶å¯ä»¥é€šè¿‡aliasæ ‡ç­¾æ¥è®¾ç½®åˆ«åï¼Œè¯¦è§å¦‚ä¸‹é…ç½®æ–‡ä»¶éƒ¨åˆ†æˆªå›¾ 123456789101112131415161718192021222324&lt;Engine name=\"Catalina\" defaultHost=\"localhost\"&gt; &lt;!--For clustering, please take a look at documentation at: /docs/cluster-howto.html (simple how to) /docs/config/cluster.html (reference documentation) --&gt; &lt;!-- &lt;Cluster className=\"org.apache.catalina.ha.tcp.SimpleTcpCluster\"/&gt; --&gt; &lt;!-- Use the LockOutRealm to prevent attempts to guess user passwords via a brute-force attack --&gt; &lt;Realm className=\"org.apache.catalina.realm.LockOutRealm\"&gt; &lt;!-- This Realm uses the UserDatabase configured in the global JNDI resources under the key \"UserDatabase\". Any edits that are performed against this UserDatabase are immediately available for use by the Realm. --&gt; &lt;Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\" resourceName=\"UserDatabase\"/&gt; &lt;/Realm&gt; &lt;Host name=\"www.xiemx.com\" debug=\"0\" appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\" xmlValidation=\"false\" xmlNamespaceAware=\"false\"&gt; &lt;Alias&gt;xiemx.com&lt;/Alias&gt; &lt;Alias&gt;xx.xiemx.com&lt;/Alias&gt; &lt;Alias&gt;yy.xiemx.com&lt;/Alias&gt; &lt;/Host&gt; &lt;/Engine&gt;","categories":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.xiemx.com/categories/tomcat/"}],"tags":[{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"},{"name":"http","slug":"http","permalink":"https://www.xiemx.com/tags/http/"},{"name":"tomcat","slug":"tomcat","permalink":"https://www.xiemx.com/tags/tomcat/"}],"author":"xiemx"},{"title":"tomcatå‡ºç°PermGen Spaceé—®é¢˜","slug":"tomcat-permgen-space","date":"2016-03-28T21:03:32.000Z","updated":"2019-10-21T06:57:42.570Z","comments":true,"path":"/2016/03/29/tomcat-permgen-space/","link":"","permalink":"https://www.xiemx.com/2016/03/29/tomcat-permgen-space/","excerpt":"","text":"ç°è±¡tomcatæœåŠ¡å™¨è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œæ€»æ˜¯ä¼šè‡ªåŠ¨æŠ¥å¼‚å¸¸ï¼šjava.lang.OutOfmemoryError:PermGen Spaceçš„é”™è¯¯ï¼Œå¯¼è‡´é¡¹ç›®æ— æ³•æ­£å¸¸è¿è¡Œã€‚ å‡ºç°è¿™ä¸ªé”™è¯¯æ˜¯ç”±äºå†…å­˜æ³„æ¼ã€‚PermGen SpaceæŒ‡çš„æ˜¯å†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºï¼Œè¯¥å—å†…å­˜ä¸»è¦æ˜¯è¢«JVMå­˜æ”¾classå’Œmeteä¿¡æ¯çš„ï¼Œå½“classè¢«åŠ è½½loaderçš„æ—¶å€™å°±ä¼šè¢«å­˜å‚¨åˆ°è¯¥å†…å­˜åŒºä¸­ï¼Œä¸å­˜æ”¾ç±»çš„å®ä¾‹çš„heapåŒºä¸åŒï¼Œjavaä¸­çš„åƒåœ¾å›æ”¶å™¨GCä¸ä¼šåœ¨ä¸»ç¨‹åºè¿è¡ŒæœŸå¯¹PermGen spaceè¿›è¡Œæ¸…ç†ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬çš„åº”ç”¨ä¸­æœ‰å¾ˆå¤šçš„classæ—¶ï¼Œå¾ˆå¯èƒ½å°±ä¼šå‡ºç°PermGen spaceçš„é”™è¯¯ã€‚ è§£å†³æ–¹æ³•æ‰‹åŠ¨è®¾ç½®MaxPermSizeçš„å¤§å° ä¿®æ”¹ TOMCAT_HOME/bin/catalina.bat(Linuxä¸Šä¸ºcatalina.sh)æ–‡ä»¶ï¼Œåœ¨echo â€œusing CATALINA_BASEï¼š$CATALINA_BASEâ€ä¸Šé¢åŠ å…¥è¿™ä¸€è¡Œå†…å®¹ï¼š 1set JAVA_OPTS=%JAVA_OPTS% -server -XX:PermSize=128m -XX:MaxPermSize=512m","categories":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.xiemx.com/categories/tomcat/"}],"tags":[{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"},{"name":"http","slug":"http","permalink":"https://www.xiemx.com/tags/http/"},{"name":"tomcat","slug":"tomcat","permalink":"https://www.xiemx.com/tags/tomcat/"}],"author":"xiemx"},{"title":"pythonä¸­iså’Œ==çš„åŒºåˆ«","slug":"python-is","date":"2016-03-28T18:03:08.000Z","updated":"2019-10-21T06:57:42.910Z","comments":true,"path":"/2016/03/29/python-is/","link":"","permalink":"https://www.xiemx.com/2016/03/29/python-is/","excerpt":"","text":"Pythonä¸­çš„å¯¹è±¡åŒ…å«ä¸‰è¦ç´ ï¼šidã€typeã€value idç”¨æ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå¯¹è±¡ typeæ ‡è¯†å¯¹è±¡çš„ç±»å‹ valueæ˜¯å¯¹è±¡çš„å€¼ã€‚ is é€šè¿‡idæ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦ç›¸ç­‰ == é€šè¿‡valueæ¥åˆ¤æ–­å€¼æ˜¯å¦ç›¸ç­‰ ä¾‹ï¼š 1234567&gt;&gt;&gt; a = &#123;1:2&#125;&gt;&gt;&gt; b = a.copy()&gt;&gt;&gt; a is bFalse&gt;&gt;&gt; a == bTrue&gt;&gt;&gt;","categories":[{"name":"python","slug":"python","permalink":"https://www.xiemx.com/categories/python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://www.xiemx.com/tags/python/"}],"author":"xiemx"},{"title":"Zentaopmséƒ¨ç½²","slug":"zentaopms-deployment","date":"2016-03-25T03:03:57.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2016/03/25/zentaopms-deployment/","link":"","permalink":"https://www.xiemx.com/2016/03/25/zentaopms-deployment/","excerpt":"","text":"è·å–è½¯ä»¶ 1wget http://sourceforge.net/projects/zentao/files/8.1.3/ZenTaoPMS.8.1.3.zip/download å°†è½¯ä»¶è§£å‹æ”¾åˆ°webæœåŠ¡å™¨çš„ç›®å½•ä¸‹ åˆ›å»ºæ•°æ®åº“ï¼Œæˆæƒç”¨æˆ· 1create database zentao;grant all zentao.* to zentao@localhost identified by 'zentap'; Webè®¿é—®é¡µé¢å¼€å¯å®‰è£…è¿›ç¨‹ è®¿é—®http://localhost/zentaopms/www/install.phpï¼ŒåŒdzç­‰ç¨‹åºå®‰è£…ç›¸åŒæ³¨æ„é…ç½®æ—¶ä½¿ç”¨æˆæƒçš„è´¦æˆ·å¯†ç å’Œæ•°æ®åº“ å®‰è£…å®Œæˆåéœ€è¦ç ´è§£zentaopmsæ–¹å¯æ­£å¸¸ç™»å½• é€šè¿‡ä¸‹é¢çš„åœ°å€ä¸‹è½½loader-wizardï¼šhttp://www.ioncube.com/loader-wizard/loader-wizard.zip ä¸‹è½½ä¹‹åï¼Œå°†å…¶è§£å‹ç¼©ï¼Œåˆ°webæœåŠ¡å™¨çš„DocumentRootä¸‹ã€‚ ä½¿ç”¨æµè§ˆå™¨è®¿é—®loader-wizard.phpæ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ä¼šæ£€æµ‹å½“å‰ç¯å¢ƒï¼Œç»™å‡ºæç¤ºè§£å†³æ–¹æ³•ä¾ç…§æ­¥éª¤å¤„ç† é‡æ–°webæœåŠ¡å¯åŠ¨ä¹‹åï¼Œå†æ¬¡è®¿é—®loader.phpï¼Œå¦‚æœå®‰è£…æˆåŠŸï¼Œç³»ç»Ÿä¼šæç¤ºã€‚ çœ‹åˆ°è¿™ä¸ªç•Œé¢ï¼Œå°±è¡¨ç¤ºè§£å¯†è½¯ä»¶å·²ç»å®‰è£…æˆåŠŸäº†ã€‚ å†æ¬¡è®¿é—®zentaopmsçš„é¦–é¡µæµ‹è¯•æ˜¯å¦å¯ä»¥æ­£å¸¸ç™»å½•","categories":[{"name":"zentaopms","slug":"zentaopms","permalink":"https://www.xiemx.com/categories/zentaopms/"},{"name":"deployment","slug":"zentaopms/deployment","permalink":"https://www.xiemx.com/categories/zentaopms/deployment/"}],"tags":[{"name":"zentaopms","slug":"zentaopms","permalink":"https://www.xiemx.com/tags/zentaopms/"},{"name":"deployment","slug":"deployment","permalink":"https://www.xiemx.com/tags/deployment/"}],"author":"xiemx"},{"title":"zabbixç›‘æ§ç‰¹å®šè¿›ç¨‹","slug":"zabbix-monitor-process","date":"2016-03-25T03:03:04.000Z","updated":"2019-10-21T06:57:42.493Z","comments":true,"path":"/2016/03/25/zabbix-monitor-process/","link":"","permalink":"https://www.xiemx.com/2016/03/25/zabbix-monitor-process/","excerpt":"","text":"åœ¨ç‰¹å®šæœºå™¨æˆ–æ¨¡æ¿ä¸Šåˆ›å»ºæ–°çš„ç›‘æ§é¡¹ï¼Œç‚¹å‡»Key åé¢çš„Select æŒ‰é’®ï¼Œé€‰æ‹©å¦‚ä¸‹ä¸¤é¡¹ï¼Œä¸€é¡¹æ˜¯ç”¨æ¥ç›‘æ§ç‰¹å®šè¿›ç¨‹çš„æ•°é‡ï¼Œå¦ä¸€é¡¹æ˜¯ç”¨æ¥ç›‘æ§è¿›ç¨‹ä½¿ç”¨å†…å­˜çš„å¤§å°ã€‚ ä»¥ä¸‹æ˜¯å¯¹squidè¿›ç¨‹çš„ç›‘æ§é…ç½®ï¼Œkeyä¸­çš„å‚æ•°è¯´æ˜ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¿›ç¨‹åå­—ï¼Œæ²¡å¿…è¦å¡«å†™ï¼Œå¡«äº†åè€Œä¼šä½¿ç›‘æ§ä¸å¤ªå‡†ç¡®ï¼ˆä»…ä¸ªäººæµ‹è¯•ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¿è¡Œè¿›ç¨‹çš„ç”¨æˆ·åï¼Œç¬¬ä¸‰ä¸ªä¸ºè¿›ç¨‹çš„çŠ¶æ€ ï¼ŒåŒ…æ‹¬ï¼šall(default),run,sleep,zombï¼Œç¬¬å››ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šè¿›ç¨‹åä¸­åŒ…å«çš„å­—ç¬¦ï¼Œå¯¹è¿›ç¨‹è¿›è¡Œè¿‡æ»¤ã€‚ é…ç½®å¥½ç›‘æ§é¡¹åï¼Œæ·»åŠ è§¦å‘å™¨ï¼Œå¦‚ä¸‹è§¦å‘å™¨è¡¨ç¤ºæœ€åä¸¤æ¬¡çš„å€¼éƒ½æ˜¯0ï¼Œè¯´æ˜æ²¡æœ‰squidè¿›ç¨‹åœ¨è¿è¡Œï¼Œåˆ™å‡ºå‘æŠ¥è­¦ã€‚ å½“æˆ‘ä»¬killæ‰è¿›ç¨‹tomcatä¼šå¦‚ä¸‹æŠ¥è­¦","categories":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/categories/zabbix/"}],"tags":[{"name":"zabbix","slug":"zabbix","permalink":"https://www.xiemx.com/tags/zabbix/"}],"author":"xiemx"},{"title":"python tabè‡ªåŠ¨è¡¥å…¨æ¨¡å—","slug":"python-tab","date":"2016-03-03T23:03:49.000Z","updated":"2019-10-19T09:27:16.679Z","comments":true,"path":"/2016/03/04/python-tab/","link":"","permalink":"https://www.xiemx.com/2016/03/04/python-tab/","excerpt":"","text":"12345678910111213141516171819#vi tab.py#!/usr/bin/env python # python startup file import sysimport readlineimport rlcompleterimport atexitimport os# tab completion readline.parse_and_bind('tab: complete')# history file histfile = os.path.join(os.environ['HOME'], '.pythonhistory')try: readline.read_history_file(histfile)except IOError: passatexit.register(readline.write_history_file, histfile)del os, histfile, readline, rlcompleter","categories":[{"name":"python","slug":"python","permalink":"https://www.xiemx.com/categories/python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://www.xiemx.com/tags/python/"}],"author":"xiemx"},{"title":"Mysql-proxyä»£ç†ç¨‹åº","slug":"build-mysql-proxy","date":"2016-02-17T22:02:43.000Z","updated":"2019-10-21T06:57:42.921Z","comments":true,"path":"/2016/02/18/build-mysql-proxy/","link":"","permalink":"https://www.xiemx.com/2016/02/18/build-mysql-proxy/","excerpt":"","text":"1ã€å®‰è£…Luaã€glibã€pkg-configã€libeventã€GCCã€makeç­‰å·¥å…·ä¸åŒçš„ç¯å¢ƒä¸‹ä¸åŒ 2ã€å®‰è£…mysql-proxy 123456789101112131415161718192021222324252627282930313233343536373839404142tar xzf mysql-proxy-0.8.1.tar.gzcd mysql-proxy-0.8.1./configure --prefix=/usr/local/mysql-proxy[root@node1 bin]# /usr/local/mysql-proxy/bin/mysql-proxy --help-allUsage:mysql-proxy [OPTION...] - MySQL ProxyHelp Options:-h, --help Show help options--help-all Show all help options--help-proxy Show options for the proxy-moduleproxy-module -P, --proxy-address=&lt;host:port&gt; listening address:port of the proxy-server (default: :4040) -r, --proxy-read-only-backend-addresses=&lt;host:port&gt; address:port of the remote slave-server (default: not set) -b, --proxy-backend-addresses=&lt;host:port&gt; address:port of the remote backend-servers (default: 127.0.0.1:3306)--proxy-skip-profiling disables profiling of queries (default: enabled)--proxy-fix-bug-25371 fix bug #25371 (mysqld &gt; 5.1.12) for older libmysql versions-s, --proxy-lua-script=&lt;file&gt; filename of the lua script (default: not set)--no-proxy don't start the proxy-module (default: enabled)--proxy-pool-no-change-user don't use CHANGE_USER to reset the connection coming from the pool (default: enabled)--proxy-connect-timeout connect timeout in seconds (default: 2.0 seconds)--proxy-read-timeout read timeout in seconds (default: 8 hours)--proxy-write-timeout write timeout in seconds (default: 8 hours)Application Options:-V, --version Show version--defaults-file=&lt;file&gt; configuration file--verbose-shutdown Always log the exit code when shutting down--daemon Start in daemon-mode--user=&lt;user&gt; Run mysql-proxy as user--basedir=&lt;absolute path&gt; Base directory to prepend to relative paths in the config--pid-file=&lt;file&gt; PID file in case we are started as daemon--plugin-dir=&lt;path&gt; path to the plugins--plugins=&lt;name&gt; plugins to load--log-level=(error|warning|info|message|debug) log all messages of level ... or higher--log-file=&lt;file&gt; log all messages in a file--log-use-syslog log all messages to syslog--log-backtrace-on-crash try to invoke debugger on crash--keepalive try to restart the proxy if it crashed--max-open-files maximum number of open files (ulimit -n)--event-threads number of event-handling threads (default: 1)--lua-path=&lt;...&gt; set the LUA_PATH--lua-cpath=&lt;...&gt; set the LUA_CPATH","categories":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/tags/mysql/"},{"name":"mysql-proxy","slug":"mysql-proxy","permalink":"https://www.xiemx.com/tags/mysql-proxy/"}],"author":"xiemx"},{"title":"Mysqlæ•°æ®åº“ä»£ç†amoeba","slug":"mysql-proxy-amoeba","date":"2016-02-17T21:02:36.000Z","updated":"2019-10-22T07:13:45.997Z","comments":true,"path":"/2016/02/18/mysql-proxy-amoeba/","link":"","permalink":"https://www.xiemx.com/2016/02/18/mysql-proxy-amoeba/","excerpt":"","text":"åŸºæœ¬ç¯å¢ƒï¼š 12345Aï¼ˆ172.25.16.10ï¼‰ï¼šå®¢æˆ·ç«¯ Bï¼ˆ172.25.16.11ï¼‰ï¼šä¸»æ•°æ®åº“ Cï¼ˆ172.25.16.12ï¼‰ï¼šä»æ•°æ®åº“ Dï¼ˆ172.25.16.13ï¼‰ï¼šä»æ•°æ®åº“Jï¼ˆ172.25.16.19ï¼‰ï¼šä»£ç†æ•°æ®åº“ åŸºäºamoebaçš„è¯»å†™åˆ†ç¦» åœ¨server j å®‰è£…JDK æ–°å»ºç›®å½•/usr/local/amoeba 1mkdir /usr/local/amoeba æŠŠå‹ç¼©åŒ…è§£å‹åˆ°è¯¥ç›®å½•/usrl/local/amoeba åœ¨confç›®å½•ä¸‹æœ‰amoebaçš„é…ç½®æ–‡ä»¶éœ€è¦ä¿®æ”¹çš„ä¸¤ä¸ªï¼šamoeba.xml å’Œ dbServers.xml amoeba.xml(3ä¸ªåœ°æ–¹è¦æ”¹):ç›‘å¬çš„ç«¯å£å·ï¼š12345&lt;proxy&gt;&lt;!-- service class must implements com.meidusa.amoeba.service.Service --&gt; &lt;service name=\"Amoeba for Mysql\" class=\"com.meidusa.amoeba.net.ServerableConnectionManager\"&gt;&lt;!-- port --&gt;&lt;property name=\"port\"&gt;3306&lt;/property&gt; å®¢æˆ·ç«¯è®¿é—®æ—¶ç”¨çš„ç”¨æˆ·å123456789101112&lt;property name=\"authenticator\"&gt; &lt;bean class=\"com.meidusa.amoeba.mysql.server.MysqlClientAuthenticator\"&gt; &lt;property name=\"user\"&gt;amoeba&lt;/property&gt; &lt;property name=\"password\"&gt;amoeba&lt;/property&gt; &lt;property name=\"filter\"&gt; &lt;bean class=\"com.meidusa.amoeba.server.IPAccessController\"&gt; &lt;property name=\"ipFile\"&gt;$&#123;amoeba.home&#125;/conf/access_list.conf&lt;/property&gt; &lt;/bean&gt; &lt;/property&gt; &lt;/bean&gt;&lt;/property&gt; read/write pool123456&lt;property name=\"sqlFunctionFile\"&gt;$&#123;amoeba.home&#125;/conf/functionMap.xml&lt;/property&gt;&lt;property name=\"LRUMapSize\"&gt;1500&lt;/property&gt; &lt;property name=\"defaultPool\"&gt;serverb#é»˜è®¤è®¿é—®çš„æ•°æ®åº“#&lt;/property&gt; &lt;property name=\"writePool\"&gt;serverb#æŒ‡å®šå¯å†™æ± #&lt;/property&gt; &lt;property name=\"readPool\"&gt;readgroup1#æŒ‡å®šåªè¯»æ± #&lt;/property&gt;&lt;property name=\"needParse\"&gt;true&lt;/property&gt; dbServers.xmlæ–‡ä»¶ï¼šä¿®æ”¹ç«¯å£å·ï¼Œç”¨æˆ·åï¼Œå¯†ç ã€‚1234567891011121314&lt;dbServer name=\"abstractServer\" abstractive=\"true\"&gt;&lt;factoryConfig class=\"com.meidusa.amoeba.mysql.net.MysqlServerConnectionFactory\"&gt; &lt;property name=\"manager\"&gt;$&#123;defaultManager&#125;&lt;/property&gt; &lt;property name=\"sendBufferSize\"&gt;64&lt;/property&gt; &lt;property name=\"receiveBufferSize\"&gt;128&lt;/property&gt; &lt;!-- mysql port --&gt; &lt;property name=\"port\"&gt;3306&lt;/property&gt; &lt;!-- mysql schema --&gt; &lt;property name=\"schema\"&gt;test&lt;/property&gt; &lt;!-- mysql user --&gt; &lt;property name=\"user\"&gt;dbproxy&lt;/property&gt; &lt;!-- mysql password --&gt; &lt;property name=\"password\"&gt;xiemx&lt;/property&gt;&lt;/factoryConfig&gt; æŒ‡å®šå¯ä»¥ä»£ç†çš„æ•°æ®åº“1234567891011121314151617181920&lt;dbServer name=\"serverb\" parent=\"abstractServer\"&gt; &lt;factoryConfig&gt; &lt;!-- mysql ip --&gt; &lt;property name=\"ipAddress\"&gt;172.25.16.11&lt;/property&gt; &lt;/factoryConfig&gt;&lt;/dbServer&gt;&lt;dbServer name=\"serverc\" parent=\"abstractServer\"&gt; &lt;factoryConfig&gt; &lt;!-- mysql ip --&gt; &lt;property name=\"ipAddress\"&gt;172.25.16.12&lt;/property&gt; &lt;/factoryConfig&gt;&lt;/dbServer&gt;&lt;dbServer name=\"serverd\" parent=\"abstractServer\"&gt; &lt;factoryConfig&gt; &lt;!-- mysql ip --&gt; &lt;property name=\"ipAddress\"&gt;172.25.16.13&lt;/property&gt; &lt;/factoryConfig&gt;&lt;/dbServer&gt; æŒ‡å®šåªè¯»ç»„12345678&lt;dbServer name=\"readgroup1\" virtual=\"true\"&gt; &lt;poolConfig class=\"com.meidusa.amoeba.server.MultipleServerPool\"&gt; &lt;!-- Load balancing strategy: 1=ROUNDROBIN , 2=WEIGHTBASED , 3=HA--&gt; &lt;property name=\"loadbalance\"&gt;1&lt;/property&gt; &lt;!-- Separated by commas,such as: server1,server2,server1 --&gt; &lt;property name=\"poolNames\"&gt;serverc,serverd&lt;/property&gt; &lt;/poolConfig&gt;&lt;/dbServer&gt; å¯åŠ¨è„šæœ¬åœ¨/binä¸‹å¯åŠ¨æ—¶ä¼šæŠ¥é”™ï¼Œéœ€è¦ä¿®æ”¹æ–‡ä»¶å³å¯ï¼šDEFAULT_OPTS=&quot;-server -Xms256m -Xmx256m -Xss228k&quot;(æœ€åä¸€ä¸ªå‚æ•°æ”¹ä¸º228å³å¯) 1./amoeba start åœ¨BCDä¸Šæˆæƒå…è®¸Jè®¿é—®æ•°æ®åº“ 1grant all on db1.* to dbproxy@'172.25.16.19' identified by 'xiemx';","categories":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/tags/mysql/"},{"name":"mysql-proxy","slug":"mysql-proxy","permalink":"https://www.xiemx.com/tags/mysql-proxy/"},{"name":"amoeba","slug":"amoeba","permalink":"https://www.xiemx.com/tags/amoeba/"}],"author":"xiemx"},{"title":"UDEVè§„åˆ™","slug":"udev","date":"2016-02-17T21:02:23.000Z","updated":"2019-10-21T06:57:42.910Z","comments":true,"path":"/2016/02/18/udev/","link":"","permalink":"https://www.xiemx.com/2016/02/18/udev/","excerpt":"","text":"udevæ ¹æ®ç³»ç»Ÿä¸­çš„ç¡¬ä»¶è®¾å¤‡çš„çŠ¶æ€åŠ¨æ€æ›´æ–°è®¾å¤‡ï¼Œé€šè¿‡å¯¹å†…æ ¸äº§ç”Ÿçš„è®¾å¤‡åå¢åŠ åˆ«åçš„æ–¹å¼æ¥è¾¾åˆ°ä¸ç®¡è®¾å¤‡è¿æ¥çš„é¡ºåºè€Œç»´æŒä¸€ä¸ªç»Ÿä¸€çš„è®¾å¤‡åçš„ç›®çš„ã€‚udevå¯ä»¥æ ¹æ®è®¾å¤‡çš„å…¶ä»–ä¿¡æ¯å¦‚æ€»çº¿ï¼ˆbusï¼‰ï¼Œç”Ÿäº§å•†ï¼ˆvendorï¼‰ç­‰ä¸åŒæ¥åŒºåˆ†ä¸åŒçš„è®¾å¤‡ï¼Œå¹¶äº§ç”Ÿè®¾å¤‡æ–‡ä»¶ã€‚udevæ˜¯ç¡¬ä»¶å¹³å°æ— å…³çš„ï¼Œå±äºuser spaceçš„è¿›ç¨‹ï¼Œå®ƒè„±ç¦»é©±åŠ¨å±‚çš„å…³è”è€Œå»ºç«‹åœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼Œéµå¾ªLinux Standard Base ï¼ˆLSBï¼‰è®¾å¤‡å‘½åæ–¹æ³•ï¼Œä½†ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å‘½å å·¥ä½œæµç¨‹å›¾ é…ç½®æ–‡ä»¶ã€ruleå‚æ•°12345678910111213141516171819202122232425262728293031323334353637383940[mingxu.xie@cn-aux-cc udev]$ ll -R.:total 8drwxr-xr-x 2 root root 4096 Jun 6 02:58 rules.d-rw-r--r-- 1 root root 218 Mar 19 2014 udev.conf./rules.d:total 32-rw-r--r-- 1 root root 640 Jul 31 2016 51-ec2-hvm-devices.rules-rw-r--r-- 1 root root 641 Jul 31 2016 52-ec2-vcpu.rules-rw-r--r-- 1 root root 740 Jul 31 2016 53-ec2-network-interfaces.rules-rw-r--r-- 1 root root 680 Jul 31 2016 60-cdrom_id.rules-rw-r--r-- 1 root root 326 Apr 26 2016 60-raw.rules-rw-r--r-- 1 root root 1343 Jul 31 2016 70-ec2-nvme-devices.rules-rw-r--r-- 1 root root 1424 Jul 31 2016 75-persistent-net-generator.rules-rwxr-xr-x 1 root root 343 Aug 21 2016 80-docker.rules# ä¸»é…ç½® /etc/udev/udev.conf udev_root=&quot;/dev/&quot;udev_rules=&quot;/etc/udev/rules.d/&quot;#ruleè§„åˆ™çš„æ–‡ä»¶å‘½åç¬¬ä¸€æ®µä¸ºæ‰§è¡Œé¡ºåºï¼ŒåŒrcè„šæœ¬[mingxu.xie@cn-aux-cc udev]$ cat rules.d/53-ec2-network-interfaces.rules# Copyright (C) 2012 Amazon.com, Inc. or its affiliates.# All Rights Reserved.## Licensed under the Apache License, Version 2.0 (the &quot;License&quot;).# You may not use this file except in compliance with the License.# A copy of the License is located at## http://aws.amazon.com/apache2.0/## or in the &quot;license&quot; file accompanying this file. This file is# distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS# OF ANY KIND, either express or implied. See the License for the# specific language governing permissions and limitations under the# License.ACTION==&quot;add&quot;, SUBSYSTEM==&quot;net&quot;, KERNEL==&quot;eth*&quot;, IMPORT&#123;program&#125;=&quot;/bin/sleep 1&quot;SUBSYSTEM==&quot;net&quot;, KERNEL==&quot;eth*&quot;, RUN+=&quot;/etc/sysconfig/network-scripts/ec2net.hotplug&quot; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102#ç›‘å¬ä¸€ä¸ªdocker run -it --rm nginx bashå®¹å™¨å¯åŠ¨çš„è®¾å¤‡å˜åŒ–æƒ…å†µï¼Œå¦‚ä¸‹[mingxu.xie@cn-aux-cc udev]$ udevadm monitormonitor will print the received events for:UDEV - the event which udev sends out after rule processingKERNEL - the kernel ueventKERNEL[240932.229041] add /devices/virtual/bdi/253:8 (bdi)KERNEL[240932.229579] add /devices/virtual/block/dm-8 (block)UDEV [240932.229612] add /devices/virtual/bdi/253:8 (bdi)UDEV [240932.229641] add /devices/virtual/block/dm-8 (block)KERNEL[240932.248388] change /devices/virtual/block/dm-8 (block)UDEV [240932.272904] change /devices/virtual/block/dm-8 (block)KERNEL[240932.425971] remove /devices/virtual/block/dm-8 (block)UDEV [240932.428073] remove /devices/virtual/block/dm-8 (block)KERNEL[240932.456141] remove /devices/virtual/bdi/253:8 (bdi)KERNEL[240932.456261] remove /devices/virtual/block/dm-8 (block)UDEV [240932.456380] remove /devices/virtual/bdi/253:8 (bdi)UDEV [240932.456419] remove /devices/virtual/block/dm-8 (block)KERNEL[240932.469307] add /devices/virtual/bdi/253:8 (bdi)KERNEL[240932.469384] add /devices/virtual/block/dm-8 (block)UDEV [240932.469657] add /devices/virtual/bdi/253:8 (bdi)UDEV [240932.469691] add /devices/virtual/block/dm-8 (block)KERNEL[240932.488228] change /devices/virtual/block/dm-8 (block)UDEV [240932.504203] change /devices/virtual/block/dm-8 (block)KERNEL[240932.636785] remove /devices/virtual/block/dm-8 (block)UDEV [240932.638755] remove /devices/virtual/block/dm-8 (block)KERNEL[240932.676137] remove /devices/virtual/bdi/253:8 (bdi)KERNEL[240932.676245] remove /devices/virtual/block/dm-8 (block)UDEV [240932.676367] remove /devices/virtual/bdi/253:8 (bdi)UDEV [240932.676420] remove /devices/virtual/block/dm-8 (block)KERNEL[240932.683098] add /devices/virtual/bdi/253:8 (bdi)KERNEL[240932.683204] add /devices/virtual/block/dm-8 (block)UDEV [240932.683384] add /devices/virtual/bdi/253:8 (bdi)UDEV [240932.683582] add /devices/virtual/block/dm-8 (block)KERNEL[240932.696227] change /devices/virtual/block/dm-8 (block)UDEV [240932.712517] change /devices/virtual/block/dm-8 (block)KERNEL[240932.793677] add /devices/virtual/net/veth4d1712b (net)KERNEL[240932.793699] add /devices/virtual/net/veth4d1712b/queues/rx-0 (queues)KERNEL[240932.793727] add /devices/virtual/net/veth4d1712b/queues/tx-0 (queues)KERNEL[240932.793908] add /devices/virtual/net/veth17f6e3e (net)KERNEL[240932.793930] add /devices/virtual/net/veth17f6e3e/queues/rx-0 (queues)KERNEL[240932.793942] add /devices/virtual/net/veth17f6e3e/queues/tx-0 (queues)UDEV [240932.827598] add /devices/virtual/net/veth4d1712b (net)UDEV [240932.827843] add /devices/virtual/net/veth4d1712b/queues/rx-0 (queues)UDEV [240932.828121] add /devices/virtual/net/veth4d1712b/queues/tx-0 (queues)KERNEL[240932.849171] add /kernel/slab/:A-0000200/cgroup/vm_area_struct(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.849196] add /kernel/slab/:A-0000064/cgroup/anon_vma_chain(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.849211] add /kernel/slab/:A-0000200/cgroup/vm_area_struct(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.849225] add /kernel/slab/anon_vma/cgroup/anon_vma(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.849238] add /kernel/slab/:aA-0000192/cgroup/dentry(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.849252] add /kernel/slab/proc_inode_cache/cgroup/proc_inode_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.849269] add /kernel/slab/:A-0000064/cgroup/anon_vma_chain(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.849436] add /kernel/slab/:0000064/cgroup/kmalloc-64(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.849455] add /kernel/slab/shmem_inode_cache/cgroup/shmem_inode_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.849709] add /kernel/slab/proc_inode_cache/cgroup/proc_inode_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.850033] add /kernel/slab/anon_vma/cgroup/anon_vma(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.850374] add /kernel/slab/shmem_inode_cache/cgroup/shmem_inode_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.850527] add /kernel/slab/:aA-0000192/cgroup/dentry(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.852368] add /kernel/slab/:0000064/cgroup/kmalloc-64(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.854849] add /kernel/slab/:0000192/cgroup/kmalloc-192(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.854871] add /kernel/slab/:0001024/cgroup/kmalloc-1024(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.855103] add /kernel/slab/radix_tree_node/cgroup/radix_tree_node(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.855120] add /kernel/slab/:0000192/cgroup/kmalloc-192(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.855133] add /kernel/slab/:A-0000192/cgroup/cred_jar(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.855145] add /kernel/slab/:A-0002048/cgroup/mm_struct(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.855158] add /kernel/slab/mqueue_inode_cache/cgroup/mqueue_inode_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.855170] add /kernel/slab/sock_inode_cache/cgroup/sock_inode_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.855359] add /kernel/slab/:A-0009664/cgroup/task_struct(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.855395] add /kernel/slab/:A-0002048/cgroup/mm_struct(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.855410] add /kernel/slab/:A-0000704/cgroup/files_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.855445] add /kernel/slab/mqueue_inode_cache/cgroup/mqueue_inode_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.855461] add /kernel/slab/sighand_cache/cgroup/sighand_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.855474] add /kernel/slab/:0001024/cgroup/kmalloc-1024(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.855487] add /kernel/slab/:A-0001024/cgroup/signal_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.855499] add /kernel/slab/:A-0000128/cgroup/pid(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.855512] add /kernel/slab/radix_tree_node/cgroup/radix_tree_node(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.856010] add /kernel/slab/sock_inode_cache/cgroup/sock_inode_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.856029] add /kernel/slab/:A-0009664/cgroup/task_struct(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.856045] add /kernel/slab/sighand_cache/cgroup/sighand_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.856077] add /kernel/slab/:0000256/cgroup/kmalloc-256(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.856092] add /kernel/slab/:A-0000704/cgroup/files_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.856104] add /kernel/slab/:0000512/cgroup/kmalloc-512(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.856188] add /kernel/slab/:A-0000128/cgroup/pid(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.857080] add /kernel/slab/:A-0000192/cgroup/cred_jar(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.857105] add /kernel/slab/:A-0001024/cgroup/signal_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.857126] add /kernel/slab/:0000256/cgroup/kmalloc-256(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.857140] add /kernel/slab/:0000512/cgroup/kmalloc-512(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.862157] add /kernel/slab/xfs_inode/cgroup/xfs_inode(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.862348] add /kernel/slab/xfs_inode/cgroup/xfs_inode(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240932.863008] add /kernel/slab/inode_cache/cgroup/inode_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.863179] add /kernel/slab/inode_cache/cgroup/inode_cache(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240932.932564] add /devices/virtual/net/veth17f6e3e (net)UDEV [240932.932779] add /devices/virtual/net/veth17f6e3e/queues/rx-0 (queues)UDEV [240932.932880] add /devices/virtual/net/veth17f6e3e/queues/tx-0 (queues)KERNEL[240932.960183] remove /devices/virtual/net/veth4d1712b (net)UDEV [240932.982851] remove /devices/virtual/net/veth4d1712b (net)KERNEL[240933.089679] add /kernel/slab/:0000008/cgroup/kmalloc-8(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240933.089933] add /kernel/slab/:0000008/cgroup/kmalloc-8(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240933.150833] add /kernel/slab/:0002048/cgroup/kmalloc-2048(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)KERNEL[240933.150863] add /kernel/slab/:0000096/cgroup/kmalloc-96(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240933.151052] add /kernel/slab/:0002048/cgroup/kmalloc-2048(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)UDEV [240933.151130] add /kernel/slab/:0000096/cgroup/kmalloc-96(990:53b4e439f50242461e4c1246718e12d769d3bc4752c0f0ed5bc4f317bb4feb3d) (cgroup)","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"udev","slug":"udev","permalink":"https://www.xiemx.com/tags/udev/"}],"author":"xiemx"},{"title":"ä¸‰ç§å…±äº«å­˜å‚¨æ¯”è¾ƒ","slug":"Three-shared-storage-comparisons","date":"2016-02-17T20:02:44.000Z","updated":"2019-10-21T06:57:43.060Z","comments":true,"path":"/2016/02/18/Three-shared-storage-comparisons/","link":"","permalink":"https://www.xiemx.com/2016/02/18/Three-shared-storage-comparisons/","excerpt":"","text":"å…±äº«å­˜å‚¨ï¼ˆShare Storageï¼‰ç±»å‹ NAS(Network Attached Storage)ç½‘ç»œé™„åŠ å­˜å‚¨ SAN (Storage Area Network)å‚¨å­˜åŒºåŸŸç½‘ç»œ iSAN (internet Storage Area Network )ä»¥å¤ªç½‘å­˜å‚¨åŒºåŸŸç½‘ç»œ,åŸºäºä»¥å¤ªç½‘çš„san NAS(Network Attached Storage) åŸºäºtcp/ipç½‘ç»œ ä»¥æ–‡ä»¶ä¸ºå•ä½è¿›è¡Œæ“ä½œï¼ˆæ–‡ä»¶é”ï¼‰ SAN (Storage Area Network) åŸºäºç¡¬ç›˜é©±åŠ¨åè®®ï¼ˆsiscï¼‰ä¼ è¾“çš„æ˜¯ç£é“/æ‰‡åŒºä¿¡æ¯ åŸºäºæ‰‡åŒº/blocké” iSAN (internet Storage Area Network ) åŸºäºtcp/ipç½‘ç»œ , é€šè¿‡ä»¥å¤ªç½‘æ•°æ®åŒ…ä¼ é€’scsiåè®®æ•°æ® åŸºäºæ‰‡åŒº/blocké”","categories":[{"name":"storage","slug":"storage","permalink":"https://www.xiemx.com/categories/storage/"}],"tags":[],"author":"xiemx"},{"title":"LVS-DRé›†ç¾¤æ„å»º","slug":"lvs-dr","date":"2016-02-17T20:02:11.000Z","updated":"2019-10-21T06:57:43.047Z","comments":true,"path":"/2016/02/18/lvs-dr/","link":"","permalink":"https://www.xiemx.com/2016/02/18/lvs-dr/","excerpt":"","text":"è®¾ç½®ç«¯å£æ ‡è®°çš„è§„åˆ™ 12345#!/bin/bashVIP=$1IPTABLES=/sbin/iptables$IPTABLES -t mangle -A PREROUTING -p tcp -d $VIP --dport 80 -j MARK --set-mark 100$IPTABLES -t mangle -A PREROUTING -p tcp -d $VIP --dport 443 -j MARK --set-mark 100 ARPé˜²ç«å¢™è®¾ç½® 1234567891011#!/bin/bashVIP=192.168.0.100RIP=192.168.0.xDGW=172.25.0.254DGWMAC=52:54:00:00:00:fearptables -Farptables -A IN -d $VIP -j DROParptables -A OUT -s $VIP -j mangle --mangle-ip-s $RIP/sbin/ifconfig eth0:1 $VIP broadcast $VIP netmask 255.255.255.0 uparp -s $DGW $DGWMAC/sbin/route add default gw $DGW æ£€æµ‹è„šæœ¬ 1234567#!/bin/bash/usr/bin/links -dump 1 $1 &gt;/dev/null 2&gt;&amp;1if [ 0 -eq $? ] ; then echo okelse echo failfi ä¸»é…ç½®æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980[root@lvs-f30 ~]# cat /etc/sysconfig/ha/lvs.cfserial_no = 25primary = 172.25.30.14primary_private = 192.168.122.246service = lvsbackup_active = 1backup = 172.25.30.15backup_private = 192.168.122.247heartbeat = 1heartbeat_port = 539keepalive = 6deadtime = 18network = directdebug_level = NONEmonitor_links = 0syncdaemon = 0syncd_iface = eth0virtual http &#123; active = 1 address = 172.25.30.100 eth0:1 vip_nmask = 255.255.255.0 fwmark = 100 port = 80 send = &quot;GET / HTTP/1.0\\r\\n\\r\\n&quot; expect = &quot;ok&quot; use_regex = 0 send_program = &quot;/bin/testlink %h&quot; load_monitor = none scheduler = wlc protocol = tcp timeout = 6 reentry = 15 quiesce_server = 0 server node1 &#123; address = 192.168.122.224 active = 1 port = 80 weight = 1 &#125; server node2 &#123; address = 192.168.122.245 active = 1 port = 80 weight = 1 &#125;&#125;virtual https &#123; active = 1 address = 172.25.30.100 eth0:1 vip_nmask = 255.255.255.0 fwmark = 100 port = 443 send = &quot;GET / HTTP/1.0\\r\\n\\r\\n&quot; expect = &quot;HTTP&quot; use_regex = 0 load_monitor = none scheduler = wlc protocol = tcp timeout = 6 reentry = 15 quiesce_server = 0 server node1 &#123; address = 192.168.122.224 active = 1 port = 443 weight = 1 &#125; server node2 &#123; address = 192.168.122.245 active = 1 port = 443 weight = 1 &#125;&#125;","categories":[{"name":"lvs","slug":"lvs","permalink":"https://www.xiemx.com/categories/lvs/"}],"tags":[{"name":"cluster","slug":"cluster","permalink":"https://www.xiemx.com/tags/cluster/"},{"name":"lvs","slug":"lvs","permalink":"https://www.xiemx.com/tags/lvs/"}],"author":"xiemx"},{"title":"ISCSIå­˜å‚¨ç½‘ç»œæ„å»º","slug":"iscsi-store","date":"2016-02-17T20:02:11.000Z","updated":"2019-10-21T06:57:42.442Z","comments":true,"path":"/2016/02/18/iscsi-store/","link":"","permalink":"https://www.xiemx.com/2016/02/18/iscsi-store/","excerpt":"","text":"iscsiçš„ç»“æ„å’Œsançš„ç»“æ„ iSCSI é€šä¿¡ç«¯ å‘èµ· I/O è¯·æ±‚çš„å¯åŠ¨è®¾å¤‡(Initiator) å“åº”è¯·æ±‚å¹¶æ‰§è¡Œå®é™… I/O æ“ä½œçš„ç›®æ ‡è®¾å¤‡(Target) iSCSIå·¥ä½œè¿‡ç¨‹ targetç«¯å¯¼å‡ºå…±äº«è®¾å¤‡ initiatorç«¯å‘ç°è®¾å¤‡ initiatorç«¯å¯¼å…¥è®¾å¤‡ initiatorç«¯åˆ†åŒºã€æ ¼å¼åŒ–ã€æŒ‚æ¥è®¾å¤‡ iSCSIå®ç°å¥—ä»¶æœåŠ¡ç«¯ï¼ˆtargetï¼‰ï¼šscsi-target-utilsè½¯ä»¶åŒ…å®¢æˆ·ç«¯ï¼ˆinitiatorï¼‰ï¼šiscsi-initiator-utilsè½¯ä»¶åŒ… éƒ¨ç½²è¿‡ç¨‹ï¼š12yum insitall scsi-target-utilsyum insitall iscsi-initiator-utils æœåŠ¡å™¨ç«¯å¯¼å‡ºå…±äº«è®¾å¤‡ï¼š é…ç½®æ–‡ä»¶å¦‚ä¸‹ 12345[root@rhel6 ~]# grep -v '#\\|^$' /etc/tgt/targets.confdefault-driver iscsi&lt;target iqn.2015-10.com.example-f30:vdb1-1g&gt; backing-store /dev/vdb1&lt;/target&gt; å¯åŠ¨tgtdæœåŠ¡ 12[root@rhel6 ~]# /etc/init.d/tgtd startStarting SCSI target daemon: [ OK ] æŸ¥çœ‹å®¢æˆ·ç«¯æœ¬åœ°æœ‰æ— /dev/sdaè®¾å¤‡ 12[root@rhel6 ~]# ll /dev/sdals: cannot access /dev/sda: No such file or directory æœç´¢targetç«¯çš„å…±äº«è®¾å¤‡ 12[root@rhel6 ~]# iscsiadm -m discovery -t st -p 172.25.30.10172.25.30.10:3260,1 iqn.2015-10.com.example-f30:vdb1-1g å¯¼å…¥targetç«¯çš„å…±äº«è®¾å¤‡ 123[root@rhel6 ~]# iscsiadm -m node -lLogging in to [iface: default, target: iqn.2015-10.com.example-f30:vdb1-1g, portal: 172.25.30.10,3260] (multiple)Login to [iface: default, target: iqn.2015-10.com.example-f30:vdb1-1g, portal: 172.25.30.10,3260] successful. æŸ¥çœ‹æœ¬åœ°/dev/sdaè®¾å¤‡ 12[root@rhel6 ~]# ll /dev/sdabrw-rw----. 1 root disk 8, 0 Jan 14 14:51 /dev/sda å¸è½½å¯¼å…¥çš„è®¾å¤‡ 1234567891011[root@rhel6 nodes]# ll /dev/sd*brw-rw----. 1 root disk 8, 0 Jan 14 14:53 /dev/sdabrw-rw----. 1 root disk 8, 16 Jan 14 15:35 /dev/sdbbrw-rw----. 1 root disk 8, 17 Jan 14 15:35 /dev/sdb1[root@rhel6 nodes]# iscsiadm -m node -T iqn.2016-01-14.com.example.node4-f24:vdb1-1G -uLogging out of session [sid: 2, target: iqn.2016-01-14.com.example.node4-f24:vdb1-1G, portal: 172.25.24.13,3260]Logout of [sid: 2, target: iqn.2016-01-14.com.example.node4-f24:vdb1-1G, portal: 172.25.24.13,3260] successful.[root@rhel6 nodes]# ll /dev/sd*brw-rw----. 1 root disk 8, 0 Jan 14 14:53 /dev/sda é…ç½®iSCSIçš„aclå’ŒéªŒè¯åœ¨targetä¸»é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¸¤è¡Œ 1234567891011[root@rhel6 ~]# grep -v '#\\|^$' /etc/tgt/targets.confdefault-driver iscsi&lt;target iqn.2015-10.com.example-f30:vdb1-1g&gt; backing-store /dev/vdb1&lt;/target&gt;&lt;target iqn.2015-10.com.example-f30:vdb2-2g&gt; backing-store /dev/vdb2 initiator-address 172.25.30.0/24 incominguser xiemx uplooking&lt;/target&gt; é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ 12/etc/init.d/tgtd reload/etc/init.d/tgtd force-reload æŸ¥çœ‹é…ç½®å¯¼å‡ºçš„è®¾å¤‡ä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768[root@rhel6 ~]# tgtadm --lld iscsi --mode target --op showTarget 1: iqn.2015-10.com.example-f30:vdb1-1g System information:â€‹ Driver: iscsiâ€‹ State: ready I_T nexus information: LUN information:â€‹ LUN: 0â€‹ Type: controllerâ€‹ SCSI ID: IET 00010000â€‹ SCSI SN: beaf10â€‹ Size: 0 MB, Block size: 1â€‹ Online: Yesâ€‹ Removable media: Noâ€‹ Prevent removal: Noâ€‹ Readonly: Noâ€‹ Backing store type: nullâ€‹ Backing store path: Noneâ€‹ Backing store flags:â€‹ LUN: 1â€‹ Type: diskâ€‹ SCSI ID: IET 00010001â€‹ SCSI SN: beaf11â€‹ Size: 1074 MB, Block size: 512â€‹ Online: Yesâ€‹ Removable media: Noâ€‹ Prevent removal: Noâ€‹ Readonly: Noâ€‹ Backing store type: rdwrâ€‹ Backing store path: /dev/vdb1â€‹ Backing store flags: Account information: ACL information:â€‹ ALL Target 2: iqn.2015-10.com.example-f30:vdb2-2g System information:â€‹ Driver: iscsiâ€‹ State: ready I_T nexus information: LUN information:â€‹ LUN: 0â€‹ Type: controllerâ€‹ SCSI ID: IET 00020000â€‹ SCSI SN: beaf20â€‹ Size: 0 MB, Block size: 1â€‹ Online: Yesâ€‹ Removable media: Noâ€‹ Prevent removal: Noâ€‹ Readonly: Noâ€‹ Backing store type: nullâ€‹ Backing store path: Noneâ€‹ Backing store flags:â€‹ LUN: 1â€‹ Type: diskâ€‹ SCSI ID: IET 00020001â€‹ SCSI SN: beaf21â€‹ Size: 2148 MB, Block size: 512â€‹ Online: Yesâ€‹ Removable media: Noâ€‹ Prevent removal: Noâ€‹ Readonly: Noâ€‹ Backing store type: rdwrâ€‹ Backing store path: /dev/vdb2â€‹ Backing store flags: Account information:â€‹ xiemx ACL information:â€‹ 172.25.30.0/24 initiatorç«¯å¼€å¯CHAPéªŒè¯å¹¶é…ç½®ç”¨æˆ·å¯†ç  1234567891011121314151617181920212223242526272829[root@rhel6 ~]grep -v '^#\\|^$' /etc/iscsi/iscsid.confiscsid.startup = /etc/rc.d/init.d/iscsid force-startnode.startup = automaticnode.leading_login = Nonode.session.auth.authmethod = CHAPnode.session.auth.username = xiemxnode.session.auth.password = uplookingnode.session.timeo.replacement_timeout = 120node.conn[0].timeo.login_timeout = 15node.conn[0].timeo.logout_timeout = 15node.conn[0].timeo.noop_out_interval = 5node.conn[0].timeo.noop_out_timeout = 5node.session.err_timeo.abort_timeout = 15node.session.err_timeo.lu_reset_timeout = 30node.session.err_timeo.tgt_reset_timeout = 30node.session.initial_login_retry_max = 8node.session.cmds_max = 128node.session.queue_depth = 32node.session.xmit_thread_priority = -20node.session.iscsi.InitialR2T = Nonode.session.iscsi.ImmediateData = Yesnode.session.iscsi.FirstBurstLength = 262144node.session.iscsi.MaxBurstLength = 16776192node.conn[0].iscsi.MaxRecvDataSegmentLength = 262144node.conn[0].iscsi.MaxXmitDataSegmentLength = 0discovery.sendtargets.iscsi.MaxRecvDataSegmentLength = 32768node.conn[0].iscsi.HeaderDigest = Nonenode.session.nr_sessions = 1node.session.iscsi.FastAbort = Yes initiatoré‡æ–°å‘ç°å¹¶å¯¼å…¥å…±äº«è®¾å¤‡ 123456789101112131415[root@rhel6 nodes]# iscsiadm -m discovery -t st -p 172.25.30.10172.25.30.10:3260,1 iqn.2015-10.com.example-f30:vdb1-1g172.25.30.10:3260,1 iqn.2015-10.com.example-f30:vdb2-2g[root@rhel6 nodes]# iscsiadm -m node -T iqn.2015-10.com.example-f30:vdb1-1g -lLogging in to [iface: default, target: iqn.2015-10.com.example-f30:vdb1-1g, portal: 172.25.30.10,3260] (multiple)Login to [iface: default, target: iqn.2015-10.com.example-f30:vdb1-1g, portal: 172.25.30.10,3260] successful.[root@rhel6 nodes]# iscsiadm -m node -T iqn.2015-10.com.example-f30:vdb2-2g -lLogging in to [iface: default, target: iqn.2015-10.com.example-f30:vdb2-2g, portal: 172.25.30.10,3260] (multiple)Login to [iface: default, target: iqn.2015-10.com.example-f30:vdb2-2g, portal: 172.25.30.10,3260] successful.[root@rhel6 nodes]# ll /dev/sd*brw-rw----. 1 root disk 8, 16 Jan 14 16:04 /dev/sdbbrw-rw----. 1 root disk 8, 32 Jan 14 16:04 /dev/sdc","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"iscsi","slug":"iscsi","permalink":"https://www.xiemx.com/tags/iscsi/"},{"name":"store","slug":"store","permalink":"https://www.xiemx.com/tags/store/"}],"author":"xiemx"},{"title":"LVS-NATé›†ç¾¤æ„å»º","slug":"lvs-nat-cluster","date":"2016-02-17T19:02:13.000Z","updated":"2019-10-21T06:57:42.819Z","comments":true,"path":"/2016/02/18/lvs-nat-cluster/","link":"","permalink":"https://www.xiemx.com/2016/02/18/lvs-nat-cluster/","excerpt":"","text":"ç”±äºlvsåŸºäºå†…æ ¸å®ç°çš„è´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œå› æ­¤ä¸»è¦æ˜¯åœ¨å†…æ ¸å±‚é¢é…ç½®ï¼Œè½¯ä»¶å±‚é¢éœ€è¦é…ç½®çš„ä¸œè¥¿å¾ˆå°‘ã€‚æˆ‘ä»¬æ˜¯é€šè¿‡è½¯ä»¶ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œå†è®²é…ç½®æ–‡ä»¶åˆ·åˆ°å†…æ ¸ä¸­ã€‚ 1234567891011121314#å®‰è£…ç»„åŒ…yum groupinstall \"Load Balancer\"#å¯åŠ¨å›¾å½¢åŒ–æœåŠ¡/etc/init.d/piranha-gui start#åˆ›å»ºpiranhaç”¨æˆ·å¯†ç piranha-passwd#é€šè¿‡å›¾å½¢åŒ–åˆ›å»ºçš„é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨/etc/sysconfig/ha/lvs.cf#å°†é…ç½®åˆ·åˆ°å†…æ ¸æ¨¡å—ä¸­ip_vså’Œip_vs*/etc/init.d/pulse start 123456789#æµ‹è¯•è„šæœ¬/bin/testlink[root@lvs-f30 ~]# cat /bin/testlink#!/bin/bash/usr/bin/links -dump 1 $1 &gt;/dev/null 2&gt;&amp;1if [ 0 -eq $? ] ; thenecho okelseecho failfi 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556[root@lvs-f30 ~]# cat /etc/sysconfig/ha/lvs.cfserial_no = 30primary = 172.25.30.14primary_private = 192.168.122.246service = lvsbackup_active = 1backup = 172.25.30.15backup_private = 192.168.122.247heartbeat = 1heartbeat_port = 539keepalive = 6deadtime = 18network = natnat_router = 192.168.122.254 eth2nat_nmask = 255.255.255.255debug_level = NONEmonitor_links = 0syncdaemon = 0syncd_iface = eth2virtual http &#123; active = 1 address = 172.25.30.100 eth0:1 vip_nmask = 255.255.255.0 port = 80 send = &quot;GET / HTTP/1.0\\r\\n\\r\\n&quot; expect = &quot;ok&quot; use_regex = 0 send_program = &quot;/bin/testlink %h&quot; load_monitor = none scheduler = wlc protocol = tcp timeout = 6 reentry = 15 quiesce_server = 0 server node1 &#123; address = 192.168.122.224 active = 1 port = 80 weight = 1 &#125; server node2 &#123; address = 192.168.122.245 active = 1 port = 80 weight = 1 â€‹&#125;&#125;","categories":[{"name":"lvs","slug":"lvs","permalink":"https://www.xiemx.com/categories/lvs/"}],"tags":[{"name":"cluster","slug":"cluster","permalink":"https://www.xiemx.com/tags/cluster/"},{"name":"lvs","slug":"lvs","permalink":"https://www.xiemx.com/tags/lvs/"}],"author":"xiemx"},{"title":"LVSçš„ä¸‰ç§è·¯ç”±æŠ€æœ¯","slug":"lvs-three-mode","date":"2016-02-17T19:02:10.000Z","updated":"2019-10-21T06:57:42.620Z","comments":true,"path":"/2016/02/18/lvs-three-mode/","link":"","permalink":"https://www.xiemx.com/2016/02/18/lvs-three-mode/","excerpt":"","text":"ç›®å‰LVSçš„ä¸‰ç§è·¯ç”±æ–¹å¼ Virtual Server via Network Address Translationï¼ˆVS-NATï¼‰ Virtual Server via Direct Routingï¼ˆVS-DRï¼‰ Virtual Server via IP Tunnelingï¼ˆVS-TUNï¼‰","categories":[{"name":"lvs","slug":"lvs","permalink":"https://www.xiemx.com/categories/lvs/"}],"tags":[{"name":"cluster","slug":"cluster","permalink":"https://www.xiemx.com/tags/cluster/"},{"name":"lvs","slug":"lvs","permalink":"https://www.xiemx.com/tags/lvs/"}],"author":"xiemx"},{"title":"rhcsæ­å»ºHAé›†ç¾¤","slug":"rhcs-ha-cluster","date":"2016-02-01T04:02:16.000Z","updated":"2019-10-19T08:27:09.995Z","comments":true,"path":"/2016/02/01/rhcs-ha-cluster/","link":"","permalink":"https://www.xiemx.com/2016/02/01/rhcs-ha-cluster/","excerpt":"","text":"YUMé…ç½®HAé›†ç¾¤(å›¾å½¢åŒ–) RHELå’ŒCentosçš„å…‰ç›˜ä¸­è‡ªå¸¦æœ‰çº¢å¸½çš„congaå¥—ä»¶ã€‚å°†å®‰è£…æºæŒ‡å‘å…‰ç›˜å³å¯yumæ¥å®‰è£…ï¼Œä¹Ÿå¯ä»¥å°†luciå’Œricciæ‹·è´å‡ºæ¥ç›´æ¥é€šè¿‡â€yum localinstall luci ricciâ€æ¥å®‰è£…ã€‚å…¶ä¸­luciæ˜¯webç•Œé¢çš„å›¾å½¢åŒ–é…ç½®å·¥å…·ï¼Œricciä¸ºåŒæ­¥é…ç½®æ–‡ä»¶çš„å·¥å…·ã€‚ricciè¿è¡Œéœ€è¦ç”¨åˆ°ricciè´¦æˆ·æƒé™ï¼Œå®‰è£…ricciæ—¶è®¾å®šä¸‹ricciå¯†ç ã€‚ å®‰è£…è®¾ç½®æ­¥éª¤ 1.æ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œç¯å¢ƒåˆå§‹åŒ– æ—¶é—´æ—¥æœŸï¼ˆdateï¼‰ elinux é˜²ç«å¢™ï¼ˆiptablesï¼‰ ä¸»æœºåï¼ˆ/etc/hostså’Œ/etc/sysconfig/networkï¼‰ ç½‘å¡ç½‘ç»œ(stop NetworkManager) yumæº 2.åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…ricciï¼Œåœ¨å…¶ä¸­ä¸€å°èŠ‚ç‚¹ä¸Šå®‰è£…luciï¼Œå¹¶é…ç½®ricciå¯†ç ã€‚ 123[root@localhost ~]# yum install luci ricci -y[root@localhost ~]# yum install ricci -y[root@localhost ~]# echo 123123123 | passwd --stdin ricci 3.å¯åŠ¨luciè¿›å…¥webé…ç½®ç•Œé¢ï¼Œå¯ä½¿ç”¨ç³»ç»Ÿrootè´¦æˆ·ç™»å½•luci 12345678910111213141516[root@localhost ~]# /etc/init.d/luci startStart luci... [ OK ]Point your web browser to https://localhost.localdomain:8084 (or equivalent) to access luci[![ha](/images/ha.png)](http://www.xiemx.com/wp-content/uploads/2016/01/ha.png)[![hainstall](/images/hainstall.png)](http://www.xiemx.com/wp-content/uploads/2016/02/hainstall.png)åœ¨åŒæœºé›†ç¾¤çš„åŸºç¡€ä¸Šæ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹è¿›å»å®ç°å¤šæœºé›†ç¾¤ï¼Œè¿™é‡Œä½¿ç”¨éå›¾å½¢åŒ–å®‰è£…å®‰è£… High Availability ç»„åŒ…[root@node3 ~]# yum groupinstall \"High Availability\"è®¾ç½®ricciç”¨æˆ·å¯†ç :[root@node1 ~]# echo uplooking | passwd --stdin ricciChanging password for user ricci.passwd: all authentication tokens updated successfully. ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/cluster/cluster.confå¹¶åŒæ­¥åˆ°æ‰€æœ‰ç»“ç‚¹ä¸Š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;cluster config_version=\"12\" name=\"f30Cluster\"&gt; &lt;clusternodes&gt; &lt;clusternode name=\"node1.xiemx.com\" nodeid=\"1\"&gt; &lt;fence&gt; &lt;method name=\"FenceMethod\"&gt; &lt;device domain=\"node1\" name=\"Fence1\"/&gt; &lt;/method&gt; &lt;/fence&gt; &lt;/clusternode&gt; &lt;clusternode name=\"node2.xiemx.com\" nodeid=\"2\"&gt; &lt;fence&gt; &lt;method name=\"FenceMethod\"&gt; &lt;device domain=\"node2\" name=\"Fence2\"/&gt; &lt;/method&gt; &lt;/fence&gt; &lt;/clusternode&gt; &lt;clusternode name=\"node3.xiemx.com\" nodeid=\"3\"&gt; &lt;fence&gt; &lt;method name=\"FenceMethod\"&gt; &lt;device domain=\"node3\" name=\"Fence3\"/&gt; &lt;/method&gt; &lt;/fence&gt; &lt;/clusternode&gt; &lt;/clusternodes&gt; &lt;cman expected_votes=\"1\"/&gt; &lt;fencedevices&gt; &lt;fencedevice agent=\"fence_xvm\" name=\"Fence1\"/&gt; &lt;fencedevice agent=\"fence_xvm\" name=\"Fence2\"/&gt; &lt;fencedevice agent=\"fence_xvm\" name=\"Fence3\"/&gt; &lt;/fencedevices&gt; &lt;rm&gt; &lt;failoverdomains&gt; &lt;failoverdomain name=\"Domain1\" restricted=\"1\"&gt; &lt;failoverdomainnode name=\"node1.xiemx.com\"/&gt; &lt;failoverdomainnode name=\"node2.xiemx.com\"/&gt; &lt;failoverdomainnode name=\"node3.xiemx.com\"/&gt; &lt;/failoverdomain&gt; &lt;/failoverdomains&gt; &lt;resources&gt; &lt;ip address=\"172.25.30.100/24\" sleeptime=\"10\"/&gt; &lt;script file=\"/etc/init.d/httpd\" name=\"httpd\"/&gt; &lt;/resources&gt; &lt;service domain=\"Domain1\" name=\"httpd\" recovery=\"restart\"&gt; &lt;ip ref=\"172.25.30.100/24\"/&gt; &lt;script ref=\"httpd\"/&gt; &lt;/service&gt; &lt;/rm&gt; &lt;/cluster&gt; åŒæ­¥é…ç½®:è¦ä¿è¯æ‰€æœ‰èŠ‚ç‚¹çš„ricciæœåŠ¡å·²å¯åŠ¨ï¼Œä¸”ricciè´¦æˆ·éƒ½é…ç½®å¯†ç  1234567[root@node1-f30 ~]# cman_tool version -rYou have not authenticated to the ricci daemon on node1-f30.example.comPassword:You have not authenticated to the ricci daemon on node3-f30.example.comPassword:You have not authenticated to the ricci daemon on node2-f30.example.comPassword: å¯åŠ¨cmanï¼Œrgmanagerï¼ŒmodclusteræœåŠ¡ 1234567891011121314151617181920212223[root@node3-f30 ~]# /etc/init.d/cman startStarting cluster:Checking if cluster has been disabled at boot... [ OK ]Checking Network Manager... [ OK ]Global setup... [ OK ]Loading kernel modules... [ OK ]Mounting configfs... [ OK ]Starting cman... [ OK ]Waiting for quorum... [ OK ]Starting fenced... [ OK ]Starting dlm_controld... [ OK ]Tuning DLM kernel config... [ OK ]Starting gfs_controld... [ OK ]Unfencing self... [ OK ]Joining fence domain... [ OK ][root@node3-f30 ~]# /etc/init.d/rgmanager startStarting Cluster Service Manager: [ OK ][root@node3-f30 ~]# /etc/init.d/modclusterd startStarting Cluster Module - cluster monitor: Setting verbosity level to LogBasic[ OK ] åˆ‡æ¢èµ„æºåˆ°node3èŠ‚ç‚¹ä¸Šå»è¿è¡Œï¼Œæµ‹è¯•èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸: 12345678910111213[root@node1-f30 ~]# clusvcadm -r httpd -m node3-f30.example.comTrying to relocate service:httpd to node3-f30.example.com...Successservice:httpd is now running on node3-f30.example.comåŒæ­¥fence_xvm.key:[root@node1-f30 ~]# scp /etc/cluster/fence_xvm.key 172.25.30.12:/etc/cluster/fence_xvm.keyThe authenticity of host '172.25.30.12 (172.25.30.12)' can't be established.RSA key fingerprint is cf:7c:26:aa:4f:41:7b:21:5e:09:ce:8a:15:2c:97:32.Are you sure you want to continue connecting (yes/no)? yesWarning: Permanently added '172.25.30.12' (RSA) to the list of known hosts.root@172.25.30.12's password:fence_xvm.key 100% 512 0.5KB/s 00:00 Qdiskä»²è£ç›˜æ·»åŠ ï¼š åœ¨æ–°çš„æœºå™¨ä¸Šå…±äº«ä¸€ä¸ªç£ç›˜å‡ºæ¥åŠ å…¥åˆ°é›†ç¾¤ä¸­,å…±äº«ç£ç›˜éœ€è¦ç”¨åˆ°scsi-target-utilså·¥å…·åŒ…ï¼Œå¯yumå®‰è£…è·å¾— 12345678910111213141516171819202122232425262728293031323334[root@rhel6 ~]# yum install scsi*å°†é…ç½®æ–‡ä»¶ä¸­çš„å¦‚ä¸‹3è¡Œé…ç½®å–æ¶ˆæ³¨é‡Šä¿®æ”¹éœ€è¦æ·»åŠ ç£ç›˜[root@rhel6 ~]# vi /etc/tgt/targets.conf&lt;target iqn.2008-09.com.example:server.target1&gt;backing-store /dev/vdb1&lt;/target&gt;é›†ç¾¤çš„èŠ‚ç‚¹ä¸­å®‰è£…åŒ… iscsi-initiator-utils[root@node1-f30 ~]# yum install scsi*æ·»åŠ ä»²è£ç›˜åˆ°æœ¬åœ°,æ ¼å¼åŒ–ä»²è£ç›˜iscsiadm -m discovery -t st -p 172.25.30.13iscsiadm -m node -lmkqdisk -c /dev/sda -l myqdisk[root@node3 ~]# iscsiadm -m discovery -t st -p 172.25.30.13Starting iscsid: [ OK ]172.25.30.13:3260,1 iqn.2008-09.com.example:server.target1[root@node3 ~]# iscsiadm -m node -lLogging in to [iface: default, target: iqn.2008-09.com.example:server.target1, portal: 172.25.30.13,3260] (multiple)Login to [iface: default, target: iqn.2008-09.com.example:server.target1, portal: 172.25.30.13,3260] successful.[root@node3 ~]# mkqdisk -c /dev/sda -l myqdiskmkqdisk v3.0.12.1Writing new quorum disk label 'myqdisk' to /dev/sda.WARNING: About to destroy all data on /dev/sda; proceed [N/y] ? yWarning: Initializing previously initialized partitionInitializing status block for node 1...Initializing status block for node 2... åœ¨luciå›¾å½¢ç•Œé¢ä¸­æ·»åŠ ä»²è£åˆ°é›†ç¾¤ ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶ç„¶åé€šè¿‡cman_tool version -ræ¥åŒæ­¥åˆ°é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Š é…ç½®æ–‡ä»¶: 123&lt;quorumd label=\"myqdisk\" min_score=\"1\"&gt;&lt;heuristic interval=\"5\" program=\"ping 172.25.30.254 -c 1\" tko=\"2\"/&gt;&lt;/quorumd&gt; åŒæ­¥é…ç½®æ–‡ä»¶æ—¶è¦æ³¨æ„ä¿®æ”¹ç‰ˆæœ¬å·","categories":[{"name":"cluster","slug":"cluster","permalink":"https://www.xiemx.com/categories/cluster/"}],"tags":[{"name":"cluster","slug":"cluster","permalink":"https://www.xiemx.com/tags/cluster/"},{"name":"rhcs","slug":"rhcs","permalink":"https://www.xiemx.com/tags/rhcs/"}],"author":"xiemx"},{"title":"mysql master-slave","slug":"mysql-master-slave","date":"2016-01-31T04:01:41.000Z","updated":"2019-10-21T06:57:42.697Z","comments":true,"path":"/2016/01/31/mysql-master-slave/","link":"","permalink":"https://www.xiemx.com/2016/01/31/mysql-master-slave/","excerpt":"","text":"Mysqlå¤åˆ¶ï¼ˆreplicationï¼‰æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„å¤åˆ¶ï¼Œä»ä¸€ä¸ªMysql å®ä¾‹ï¼ˆMasterï¼‰å¤åˆ¶åˆ°å¦ä¸€ä¸ªMysql å®ä¾‹ï¼ˆSlaveï¼‰ã€‚å®ç°æ•´ä¸ªä¸»ä»å¤åˆ¶ï¼Œéœ€è¦ç”±MasteræœåŠ¡å™¨ä¸Šçš„IOè¿›ç¨‹ï¼Œå’ŒSlaveæœåŠ¡å™¨ä¸Šçš„Sqlè¿›ç¨‹å’ŒIOè¿›ç¨‹å…±ä»å®Œæˆã€‚è¦å®ç°ä¸»ä»å¤åˆ¶ï¼Œé¦–å…ˆå¿…é¡»æ‰“å¼€Masterç«¯çš„binary logï¼ˆbin-logï¼‰åŠŸèƒ½ï¼Œå› ä¸ºæ•´ä¸ª MySQL å¤åˆ¶è¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯Slaveä»Masterç«¯è·å–ç›¸åº”çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œç„¶åå†åœ¨è‡ªå·±slaveç«¯å®Œå…¨é¡ºåºçš„æ‰§è¡Œæ—¥å¿—ä¸­æ‰€è®°å½•çš„å„ç§æ“ä½œã€‚ ï¼ˆäºŒè¿›åˆ¶æ—¥å¿—å‡ ä¹è®°å½•äº†é™¤selectä»¥å¤–çš„æ‰€æœ‰é’ˆå¯¹æ•°æ®åº“çš„sqlæ“ä½œè¯­å¥ï¼‰ä¸»ä»åŒæ­¥ä¹Ÿç§°ä¹‹ä¸ºABå¤åˆ¶ã€‚ åŸºæœ¬è¿‡ç¨‹ï¼š Slaveç«¯çš„IOè¿›ç¨‹è¿æ¥ä¸ŠMasterï¼Œå‘Masterè¯·æ±‚æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„æŒ‡å®špositionåçš„æ—¥å¿—å†…å®¹ï¼› Masteræ¥æ”¶åˆ°æ¥è‡ªSlaveçš„IOè¿›ç¨‹çš„è¯·æ±‚åï¼Œè´Ÿè´£å¤åˆ¶çš„IOè¿›ç¨‹æ ¹æ®Slaveçš„è¯·æ±‚ä¿¡æ¯ï¼Œè¯»å–ç›¸åº”æ—¥å¿—å†…å®¹ï¼Œè¿”å›ç»™Slaveçš„IOè¿›ç¨‹ã€‚å¹¶å°†æœ¬æ¬¡è¯·æ±‚è¯»å–çš„bin-logæ–‡ä»¶ååŠä½ç½®ä¸€èµ·è¿”å›ç»™Slaveç«¯ã€‚ Slaveçš„IOè¿›ç¨‹æ¥æ”¶åˆ°ä¿¡æ¯åï¼Œå°†æ¥æ”¶åˆ°çš„æ—¥å¿—å†…å®¹ä¾æ¬¡æ·»åŠ åˆ°Slaveç«¯çš„relay-logæ–‡ä»¶çš„æœ€æœ«ç«¯ï¼Œå¹¶å°†è¯»å–åˆ°çš„Masterç«¯çš„bin-logçš„æ–‡ä»¶åå’Œä½ç½®è®°å½•åˆ°master-infoæ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€æ¬¡è¯»å–çš„æ—¶å€™èƒ½å¤Ÿæ¸…æ¥šçš„å‘Šè¯‰Masterâ€œæˆ‘éœ€è¦ä»æŸä¸ªbin-logçš„å“ªä¸ªä½ç½®å¼€å§‹å¾€åçš„æ—¥å¿—å†…å®¹ï¼Œè¯·å‘ç»™æˆ‘â€ã€‚ Slaveçš„Sqlè¿›ç¨‹æ£€æµ‹åˆ°relay-logä¸­æ–°å¢åŠ äº†å†…å®¹åï¼Œä¼šè§£ærelay-logçš„å†…å®¹æˆä¸ºåœ¨Masterç«¯çœŸå®æ‰§è¡Œæ—¶å€™çš„é‚£äº›å¯æ‰§è¡Œçš„å†…å®¹ï¼Œå¹¶åœ¨è‡ªèº«æ‰§è¡Œã€‚ ###æ•°æ®åº“ä¸»ä»åŒæ­¥ï¼š 12ä¸»ï¼šservera 172.25.30.10 ä»ï¼šserverb 172.25.30.11 æ•°æ®åº“çš„ä¸»ä»åŒæ­¥ï¼ˆABå¤åˆ¶ï¼‰ï¼Œè¦ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé¦–å…ˆå°†ä¸»ä¸Šçš„æ•°æ®åº“å¤‡ä»½å‡ºæ¥ï¼Œåœ¨ä»æœºä¸Šæ¢å¤ä¸€ä¸‹ä¿è¯åŸºç¡€çš„æ•°æ®ç›¸åŒã€‚ä»ä¸Šè¿°è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥å¾—çŸ¥slaveæ˜¯é€šè¿‡è·å–masterçš„äºŒè¿›åˆ¶æ—¥å¿—æ¥é‡æ¼”æ¥è¾¾åˆ°æ•°æ®åŒæ­¥çš„ï¼Œå› æ­¤masteréœ€è¦å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—ï¼Œslaveæ¥è·å–äºŒè¿›åˆ¶æ—¥å¿—æ—¶ä½¿ç”¨ä»€ä¹ˆè´¦æˆ·ï¼Œè´¦å·å…·æœ‰ä»€ä¹ˆæƒé™éœ€è¦åœ¨masterç«¯å®šä¹‰ï¼Œsalveéœ€è¦çŸ¥é“è°æ˜¯masterï¼Œç”¨ä»€ä¹ˆè´¦æˆ·ã€åŒæ­¥å“ªä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€ä»äºŒè¿›åˆ¶æ–‡ä»¶çš„å“ªä¸ªpositionå¼€å§‹åŒæ­¥ã€‚å¦å¤–è¿˜éœ€è¦è®¾ç½®ä¸‹ä¸»ä»çš„server idã€‚ ç”±ä¸Šæ¨å¯¼å‡ºæ“ä½œæ­¥éª¤ master/slaveå…ˆè®¾ç½®server-idï¼Œmasteråœ¨å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½log-bin 123456789101112[root@localhost mysql]# cat /etc/my.cnf[mysqld]server-id=1 server-idæ•°å­—ä»»é€‰ï¼Œä½†ä¸å¯é‡å¤datadir=/var/lib/mysqllog-bin=/var/log/mysql/binlog slaveä¸éœ€è¦å¼€å¯æ­¤åŠŸèƒ½socket=/var/lib/mysql/mysql.sockuser=mysqllog-slow-queries=/var/log/mysql/slowlogsymbolic-links=0[mysqld_safe]log-error=/var/log/mysqld.logpid-file=/var/run/mysqld/mysqld.pid masteråˆ›å»ºåŒæ­¥ç”¨æˆ·ï¼Œå¹¶æˆæƒ 1mysql&gt;grant replication slave on *.* to xiemx@â€˜172.25.30.%â€™ identified by '123123';flush privileges; slaveç«¯æŒ‡å®šmasterä¿¡æ¯ 123mysql&gt;change master to master_host='172.25.30.10',master_user='xiemx',master_password='123123',master_log_file=\"binlog.000003\"ï¼Œmaster_log_pos=245;mysql&gt;slave startï¼› æŸ¥çœ‹salveçŠ¶æ€ä¿¡æ¯ï¼› 1234567891011121314151617181920212223242526272829303132333435mysql&gt; show slave status \\G; \\Gè¡¨ç¤ºå°†è¡Œå’Œåˆ—ç¿»è½¬è¿‡æ¥æ˜¾ç¤º*************************** 1. row ***************************Slave_IO_State: Waiting for master to send eventMaster_Host: 172.25.30.11Master_User: xiemxMaster_Port: 4331Connect_Retry: 60Master_Log_File: binlog.000003Read_Master_Log_Pos: 245Relay_Log_File: mysqld-relay-bin.000001 ä¸­ç»§æ—¥å¿—Relay_Log_Pos: 245Slave_IO_Running: Yes slaveçš„ioæ˜¯å¦æ­£å¸¸è¿è¡ŒSlave_SQL_Running: Yes slaveçš„sqlæ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œéœ€è¦æ³¨æ„ä¸¤ä¸ªéƒ½ä¸ºyesä¹Ÿä¸ä¸€å®šæ­£å¸¸ã€‚ä½†æœ‰ä¸€ä¸ªnoè‚¯å®šä¸æ­£å¸¸ã€‚æˆ‘ä»¬éœ€è¦åœ¨æµ‹è¯•ä¸‹è¯»å†™ã€‚Replicate_Do_DB:Replicate_Ignore_DB: mysqlReplicate_Do_Table:Replicate_Ignore_Table:Replicate_Wild_Do_Table: photo.%Replicate_Wild_Ignore_Table: mysql.%Last_Errno: 0Last_Error:Skip_Counter: 0Exec_Master_Log_Pos: 13456620Relay_Log_Space: 36764898503Until_Condition: NoneUntil_Log_File:Until_Log_Pos: 0Master_SSL_Allowed: NoMaster_SSL_CA_File:Master_SSL_CA_Path:Master_SSL_Cert:Master_SSL_Cipher:Master_SSL_Key:Seconds_Behind_Master: 249904Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã— æµ‹è¯•ä¸»ä»æ˜¯å¦åŒæ­¥ ç”±äºslaveæ˜¯ä»masterè·å–äºŒè¿›åˆ¶æ—¥å¿—æ¥åŒæ­¥æ•°æ®çš„ï¼Œå› æ­¤åœ¨slaveä¸Šä¸åº”è¯¥æœ‰ä»»ä½•éæŸ¥è¯¢ç±»çš„sqlè¯­å¥æ‰§è¡Œï¼Œå¦‚æœslaveæ‰§è¡Œäº†sqlè¯­å¥æ“ä½œäº†æŸä¸ªæ•°æ®ï¼Œå½“masteræ“ä½œè¿™ä¸ªæ•°æ®æ—¶ï¼Œsalveé€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—é‡æ¼”å»æ“ä½œæ—¶å‘ç”ŸæŠ¥é”™ï¼Œä¼šå¯¼è‡´ä¸»ä»æ–­å¼€ã€‚å¦‚æœä¸»ä»æ–­å¼€æˆ‘ä»¬å°±éœ€è¦é‡æ–°change masteræ¥å»ºç«‹ä¸»ä»ã€‚å› æ­¤åˆ‡è®°åœ¨å•å‘ä¸»ä»åŒæ­¥çš„ç¯å¢ƒä¸­ï¼Œä¸å¯æ“ä½œslaveå»æ‰§è¡ŒéæŸ¥è¯¢ç±»æ“ä½œã€‚ æˆ‘ä»¬åœ¨masterä¸Šåˆ›å»ºä¸€ä¸ªxiemxæ•°æ®åº“ï¼ŒæŸ¥çœ‹ä¸‹slaveæ˜¯å¦ä¼šè‡ªåŠ¨åˆ›å»ºå‡ºæ¥ã€‚ 12345678910mysql&gt; create database xiemxï¼›show databases;+--------------------+| Database |+--------------------+| information_schema || mysql || test || xiemx |+--------------------+4 rows in set (0.00 sec) å¦‚æœå¦‚æœåœ¨slaveä¸Šshow databasesï¼›ç»“æœå’Œä¸Šé¢ç›¸åŒçš„åˆ™è¯´æ˜ä¸»ä»åŒæ­¥è®¾ç½®æˆåŠŸã€‚","categories":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/tags/mysql/"}],"author":"xiemx"},{"title":"mysql master-master","slug":"mysql-master-master","date":"2016-01-31T04:01:23.000Z","updated":"2019-10-21T06:57:43.060Z","comments":true,"path":"/2016/01/31/mysql-master-master/","link":"","permalink":"https://www.xiemx.com/2016/01/31/mysql-master-master/","excerpt":"","text":"åŸç†åŒå•å‘ä¸»ä»ç›¸åŒï¼Œéƒ½æ˜¯salveè·å–masterçš„äºŒè¿›åˆ¶æ—¥å¿—æ¥é‡æ¼”æ•°æ®ï¼Œåœ¨äº’ä¸ºä¸»ä»çš„æ¶æ„ä¸­ï¼Œserveraæ—¢æ˜¯masteråˆæ˜¯slaveï¼Œé€šç”¨çš„serverbä¹Ÿæ˜¯masterå’Œslaveï¼Œserveraå›å»åŒæ­¥serverbçš„æ•°æ®ï¼Œserverbä¹Ÿä¼šå»åŒæ­¥serveraçš„æ“ä½œã€‚å·²è¾¾åˆ°æ•°æ®çš„ä¸€è‡´æ€§ã€‚ ç”±åŸç†å¯ä»¥å¾—çŸ¥ï¼š serveraéœ€è¦å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—æˆæƒserverbæ¥åŒæ­¥ï¼Œserveraéœ€è¦change masteræŒ‡å‘serverb serverbéœ€è¦å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—æˆæƒserveraæ¥åŒæ­¥ï¼Œserverbéœ€è¦change masteræŒ‡å‘serveraï¼Œå¦å¤–serverbçš„æ•°æ®æ˜¯é€šè¿‡masteræ¥åŒæ­¥åˆ°ä¸­ç»§æ—¥å¿—ä¸­æ¥é‡æ¼”ç”Ÿæˆçš„ï¼Œå› æ­¤éœ€è¦åœ¨å¼€å¯å°†ä¸­ç»§æ—¥å¿—å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½log_slave_update=1 éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è®¾ç½®åŒå‘ä¸»ä»æ—¶ï¼Œæˆ‘ä»¬æ˜¯å…ˆè®¾ç½®ä¸€æ¡å•å‘ä¸»ä»(servera-serverb)ï¼Œåœ¨è®¾ç½®å¦ä¸€æ¡å•å‘ä¸»ä»(serverb-servera)ã€‚æˆ‘ä»¬åœ¨è®¾ç½®å®Œç¬¬ä¸€æ¡å•å‘ä¸»ä»(servera-serverb)æˆåŠŸæ—¶ï¼Œslave(serverb)ä¸Šæ˜¯ä¸èƒ½æ‰§è¡Œä»»ä½•éæŸ¥è¯¢è¯­å¥çš„ï¼Œå› æ­¤ç¬¬äºŒæ¡å•å‘ä¸»ä»(serverb-servera)åœ¨serverbä¸Šè®¾ç½®serveraçš„åŒæ­¥è´¦æˆ·æ—¶grantæˆæƒè¯­å¥éœ€è¦é€šè¿‡(servera-serverb)è¿™æ¡å•å‘ä¸»ä»çš„master(servera)æ¥ä¼ é€’ç»™salve(serverb)ã€‚ æ“ä½œæ­¥éª¤ è®¾ç½®server-idï¼Œå¼€å¯äºŒè¿›åˆ¶æ—¥å¿—ï¼Œserverbéœ€è¦å¼€å¯ä¸­ç»§æ—¥å¿—å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½ 123456789101112[root@localhost mysql]# cat /etc/my.cnf[mysqld]server-id=1 master/slaveæ•°å­—ä¸å¯é‡å¤datadir=/var/lib/mysqllog-bin=/var/log/mysql/binlogsocket=/var/lib/mysql/mysql.socklog_slave_update=1 serverbä¸Šæ·»åŠ æ­¤é¡¹log-slow-queries=/var/log/mysql/slowlogsymbolic-links=0[mysqld_safe]log-error=/var/log/mysqld.logpid-file=/var/run/mysqld/mysqld.pid serveraåˆ›å»ºåŒæ­¥ç”¨æˆ·ï¼Œå¹¶æˆæƒ 1mysql&gt;grant replication slave on *.* to xiemx1@â€˜172.25.30.%â€™ identified by '123123';flush privileges; serverbæŒ‡å®šmasterä¿¡æ¯ 12345mysql&gt;change master to master_host='172.25.30.10',master_user='xiemx1',master_password='123123',master_log_file=\"binlog.000003\"ï¼Œmaster_log_pos=245;mysql&gt;slave startï¼›mysql&gt;show slave status\\G;æŸ¥çœ‹ioå’Œsqlæ˜¯å¦yesï¼Œåœ¨æµ‹è¯•ä¸»ä»æ˜¯å¦ç”Ÿæ•ˆï¼Œåœ¨ä¿éšœä¸»ä»ç”Ÿæ•ˆçš„æƒ…å†µä¸‹æ‰§è¡Œä¸‹åˆ—æ“ä½œã€‚ serveraä¸Šæˆæƒç¬¬äºŒæ¡å•å‘çš„åŒæ­¥è´¦æˆ· 1mysql&gt;grant replication slave on *.* to xiemx2@â€˜172.25.30.%â€™ identified by '123123';flush privileges; serveraæŒ‡å®šmasterä¿¡æ¯ 12345mysql&gt;change master to master_host='172.25.30.11',master_user='xiemx2',master_password='123123',master_log_file=\"binlog.000001\"ï¼Œmaster_log_pos=245;mysql&gt;slave startï¼›mysql&gt;show slave status\\G;æŸ¥çœ‹ioå’Œsqlæ˜¯å¦ä¸ºyes åœ¨serveraä¸Šåˆ›å»ºä¸€ä¸ªåº“çœ‹serverbæ˜¯å¦ä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œåœ¨serverbä¸Šåˆ›å»ºåº“çœ‹serveraæ˜¯å¦ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚å¦‚æœéƒ½æ²¡æœ‰é—®é¢˜çš„è¯è¯´æ˜è®¾ç½®æˆåŠŸã€‚show master status\\G; å¯ä»¥æŸ¥çœ‹å½“å‰çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶å’Œpositionå·","categories":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/tags/mysql/"}],"author":"xiemx"},{"title":"dns viewåŠŸèƒ½","slug":"dns-view","date":"2016-01-30T23:01:54.000Z","updated":"2019-10-21T06:57:42.921Z","comments":true,"path":"/2016/01/31/dns-view/","link":"","permalink":"https://www.xiemx.com/2016/01/31/dns-view/","excerpt":"","text":"å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªç½‘ç«™æœåŠ¡å™¨å­˜æ”¾åœ¨ä¸€ä¸ªåŒçº¿æˆ–è€…å¤šçº¿æœºæˆ¿å†…ï¼Œè¿™ä¸ªæœåŠ¡å™¨è¦æä¾›ä¸€ä¸ªwebç»™å…¨å›½çš„ç”¨æˆ·è®¿é—®ã€‚ç°åœ¨ç”¨çš„ç”¨æˆ·ä½¿ç”¨çš„æ˜¯ç”µä¿¡çš„ç½‘ï¼Œæœ‰çš„æ˜¯è”é€šçš„å®½å¸¦ï¼Œæœ‰çš„å¯èƒ½æ˜¯é•¿åŸé“é€šä¹‹ç±»çš„ispï¼Œå¦‚æœè®©è¿™äº›ç”¨æˆ·éƒ½å»è®¿é—®æˆ‘çš„æŸä¸€ä¸ªipï¼Œä¼šå¯¼è‡´ä¸€éƒ¨åˆ†ç”¨æˆ·å­˜åœ¨è·¨ispå»¶è¿Ÿè¾ƒé«˜çš„æƒ…å†µï¼Œè¦è§£å†³è¿™æ ·çš„ä¸€ä¸ªæƒ…å†µæˆ‘ä»¬å¯ä»¥åœ¨å¤šçº¿æœºæˆ¿å†…ç”³è¯·å¤šä¸ªispçš„ipç»‘å®šåˆ°æœºå™¨ä¸Šï¼Œç„¶åä¿®æ”¹dnsçš„è§£æï¼Œè®©dnsæ ¹æ®è¯·æ±‚çš„æ¥æºåˆ†é…ç»™ä¸åŒçš„ipã€‚é€šä¿—çš„è¯´å°±æ˜¯ç”µä¿¡ç”¨æˆ·èµ°ç”µä¿¡çº¿è·¯ï¼Œè”é€šç”¨æˆ·èµ°è”é€šçº¿è·¯ã€‚è¿™å°±è¦ç”¨åˆ°dnsçš„ä¸€ä¸ªviewåŠŸèƒ½ã€‚ å…·ä½“é…ç½®å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526view \"ç”µä¿¡-view\"&#123;match-clients &#123; æœåŠ¡å™¨ip1 &#125;;#åŒ¹é…è¿™ä¸ªip/åˆ—è¡¨ï¼Œç¬¦åˆåˆ™ä½¿ç”¨ä¸‹é¢çš„æœåŠ¡å™¨è¿›è¡Œè§£æï¼Œå¦åˆ™è·³å‡ºzone \"abc.com\" &#123;type master;file \"dx.abc.com.zone\";è¯¥zoneå†…æœåŠ¡å™¨ipaddè¦ä¸match-clientsæ‰€å±ispå¯¹åº”&#125;;include \"/etc/named.rfc1912.zones\";#éœ€è¦åŒ…å«è¯¥è¡Œã€‚&#125;view \"ç½‘é€š-view\"&#123;match-clients &#123; æœåŠ¡å™¨ip2 &#125;;#åŒ¹é…è¿™ä¸ªip/åˆ—è¡¨ï¼Œç¬¦åˆåˆ™ä½¿ç”¨ä¸‹é¢çš„æœåŠ¡å™¨è¿›è¡Œè§£æï¼Œå¦åˆ™è·³å‡ºzone \"abc.com\" &#123;type master;file \"wt.abc.com.zone\";è¯¥zoneå†…æœåŠ¡å™¨ipaddè¦ä¸match-clientsæ‰€å±ispå¯¹åº”&#125;;include \"/etc/named.rfc1912.zones\";#éœ€è¦åŒ…å«è¯¥è¡Œã€‚&#125;view \"other-view\"&#123;match-clients &#123; any &#125;;#åŒ¹é…è¿™ä¸ªipï¼Œç¬¦åˆåˆ™ä½¿ç”¨ä¸‹é¢çš„æœåŠ¡å™¨è¿›è¡Œè§£æï¼Œå¦åˆ™è·³å‡ºzone \"abc.com\" &#123;type master;file \"other.abc.com.zone\";&#125;;include \"/etc/named.rfc1912.zones\";#éœ€è¦åŒ…å«è¯¥è¡Œã€‚&#125; è¿™é‡Œåªå†™å‡ºviewéƒ¨åˆ†çš„è®¾ç½®ï¼Œå…¶ä»–éƒ¨åˆ†è®¾ç½®å¯ä»¥å‚è€ƒdnsæœåŠ¡å™¨æ­å»ºå†…å®¹ã€‚","categories":[{"name":"dns","slug":"dns","permalink":"https://www.xiemx.com/categories/dns/"}],"tags":[{"name":"dns","slug":"dns","permalink":"https://www.xiemx.com/tags/dns/"},{"name":"view","slug":"view","permalink":"https://www.xiemx.com/tags/view/"}],"author":"xiemx"},{"title":"å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«","slug":"transaction-isolation-level","date":"2016-01-30T21:01:30.000Z","updated":"2019-10-22T06:48:18.709Z","comments":true,"path":"/2016/01/31/transaction-isolation-level/","link":"","permalink":"https://www.xiemx.com/2016/01/31/transaction-isolation-level/","excerpt":"","text":"æ•°æ®åº“ç³»ç»Ÿæä¾›äº†å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š A.Serializableï¼ˆä¸²è¡ŒåŒ–ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å®Œå…¨çœ‹ä¸åˆ°å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ–°ï¼ˆäº‹åŠ¡æ‰§è¡Œçš„æ—¶å€™ä¸å…è®¸åˆ«çš„äº‹åŠ¡å¹¶å‘æ‰§è¡Œã€‚äº‹åŠ¡ä¸²è¡ŒåŒ–æ‰§è¡Œï¼Œäº‹åŠ¡åªèƒ½ä¸€ä¸ªæ¥ç€ä¸€ä¸ªåœ°æ‰§è¡Œï¼Œè€Œä¸èƒ½å¹¶å‘æ‰§è¡Œã€‚ B.Repeatable Readï¼ˆå¯é‡å¤è¯»ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„æ–°æ’å…¥çš„è®°å½•ï¼Œä½†æ˜¯ä¸èƒ½çœ‹åˆ°å…¶ä»–å…¶ä»–äº‹åŠ¡å¯¹å·²æœ‰è®°å½•çš„æ›´æ–°ã€‚ C.Read Commitedï¼ˆè¯»å·²æäº¤æ•°æ®ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„æ–°æ’å…¥çš„è®°å½•ï¼Œè€Œä¸”èƒ½çœ‹åˆ°å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„å¯¹å·²æœ‰è®°å½•çš„æ›´æ–°ã€‚ D.Read Uncommittedï¼ˆè¯»æœªæäº¤æ•°æ®ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°å…¶ä»–äº‹åŠ¡æ²¡æœ‰æäº¤çš„æ–°æ’å…¥çš„è®°å½•ï¼Œè€Œä¸”èƒ½çœ‹åˆ°å…¶ä»–äº‹åŠ¡æ²¡æœ‰æäº¤çš„å¯¹å·²æœ‰è®°å½•çš„æ›´æ–°ã€‚","categories":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/tags/mysql/"}],"author":"xiemx"},{"title":"mysql binlogæ¢å¤æ•°æ®","slug":"mysql-binlog-recovery-data","date":"2016-01-30T03:01:53.000Z","updated":"2019-10-21T06:57:42.910Z","comments":true,"path":"/2016/01/30/mysql-binlog-recovery-data/","link":"","permalink":"https://www.xiemx.com/2016/01/30/mysql-binlog-recovery-data/","excerpt":"","text":"123456789101112131415[root@localhost mysql]# cat /etc/my.cnf[mysqld]datadir=/var/lib/mysqllog-bin=/var/log/mysql/binlog å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—socket=/var/lib/mysql/mysql.sockuser=mysqllog-slow-queries=/var/log/mysql/slowlogsymbolic-links=0[mysqld_safe]log-error=/var/log/mysqld.logpid-file=/var/run/mysqld/mysqld.pid[root@localhost mysql]# cd /var/log/mysql[root@localhost mysql]# lsbinlog.000001 binlog.000002 binlog.000003 binlog.index äºŒè¿›åˆ¶ç”Ÿæˆçš„æ–‡ä»¶ æŸ¥çœ‹æ•°æ®åº“çš„æ—¥å¿—ç›¸å…³è®¾ç½®ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344mysql&gt; SHOW GLOBAL VARIABLES LIKE '%log%';+-----------------------------------------+----------------------------+| Variable_name | Value |+-----------------------------------------+----------------------------+| back_log | 50 || binlog_cache_size | 32768 || binlog_direct_non_transactional_updates | OFF || binlog_format | STATEMENT || expire_logs_days | 0 || general_log | OFF || general_log_file | /var/run/mysqld/mysqld.log || innodb_flush_log_at_trx_commit | 1 || innodb_locks_unsafe_for_binlog | OFF || innodb_log_buffer_size | 1048576 || innodb_log_file_size | 5242880 || innodb_log_files_in_group | 2 || innodb_log_group_home_dir | ./ || innodb_mirrored_log_groups | 1 || log | OFF || log_bin | ON | æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—æ˜¯å¦å¼€å¯| log_bin_trust_function_creators | OFF || log_bin_trust_routine_creators | OFF || log_error | /var/log/mysqld.log | é”™è¯¯æ—¥å¿—| log_output | FILE || log_queries_not_using_indexes | OFF || log_slave_updates | OFF || log_slow_queries | ON || log_warnings | 1 || max_binlog_cache_size | 18446744073709547520 || max_binlog_size | 1073741824 || max_relay_log_size | 0 || relay_log | | ä¸­ç»§æ—¥å¿—| relay_log_index | || relay_log_info_file | relay-log.info || relay_log_purge | ON || relay_log_space_limit | 0 || slow_query_log | ON | æ…¢æŸ¥è¯¢æ—¥å¿—| slow_query_log_file | /var/log/mysql/slowlog || sql_log_bin | ON || sql_log_off | OFF || sql_log_update | ON || sync_binlog | 0 |+-----------------------------------------+----------------------------+38 rows in set (0.00 sec) æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼šäºŒè¿›åˆ¶æ–‡ä»¶ä¸æ˜¯æ–‡æœ¬æ–‡æ¡£æ— æ³•ä½¿ç”¨catç­‰äºéƒ½æ–‡æœ¬çš„å‘½ä»¤æŸ¥çœ‹ï¼Œéœ€ä½¿ç”¨mysqlbinlogå‘½ä»¤æŸ¥çœ‹ã€‚ 1234567891011121314151617181920212223242526272829[root@localhost mysql]# mysqlbinlog binlog.000003/*!40019 SET @@session.max_insert_delayed_threads=0*/;/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;DELIMITER /*!*/;# at 4#160110 16:41:49 server id 1 end_log_pos 106 Start: binlog v 4, server v 5.1.73-log created 160110 16:41:49 at startup# Warning: this binlog is either in use or was not closed properly.ROLLBACK/*!*/;BINLOG 'TRmSVg8BAAAAZgAAAGoAAAABAAQANS4xLjczLWxvZwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABNGZJWEzgNAAgAEgAEBAQEEgAAUwAEGggAAAAICAgC'/*!*/;# at 106 positionå·æ ‡è®°#160110 17:26:15 server id 1 end_log_pos 191 Query thread_id=3 exec_time=0 error_code=0 æ—¶é—´æ ‡è®°160110è¡¨ç¤º2016-01-10SET TIMESTAMP=1452417975/*!*/;SET @@session.pseudo_thread_id=3/*!*/;SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=1, @@session.unique_checks=1, @@session.autocommit=1/*!*/;SET @@session.sql_mode=0/*!*/;SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/;/*!\\C latin1 *//*!*/;SET @@session.character_set_client=8,@@session.collation_connection=8,@@session.collation_server=8/*!*/;SET @@session.lc_time_names=0/*!*/;SET @@session.collation_database=DEFAULT/*!*/;create database xiemx å¯¹æ•°æ®åº“çš„æ“ä½œè®°å½•/*!*/;DELIMITER ;# End of log fileROLLBACK /* added by mysqlbinlog */;/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/; äºŒè¿›åˆ¶æ¢å¤å‘½ä»¤ï¼š 1234567[root @server1 mysql ] #mysqlbinlog --start-date=\"2015-06-18 9:55:00\" --stop-date=\"2015-06-18 10:05:00\" /var/log/mysql/binlog.000006 | mysql -uroot -pä»äºŒè¿›åˆ¶æ—¥å¿—binlog.000006çš„2015-06-18 9:55:00è¿™ä¸ªæ—¶é—´åˆ°2015-06-18 10:05:00ä¹‹é—´çš„æ“ä½œ[root @server1 mysql ] #mysqlbinlog --stop-position=\"368312\" /var/log/mysql/binlog.000006 | mysql -u root -p ä»äºŒè¿›åˆ¶æ—¥å¿—binlog.000006çš„å¼€å¤´æ¢å¤åˆ°368312è¿™ä¸ªpositionæ ‡è®°ç»“æŸ[root @server1 mysql ] #mysqlbinlog --start-position=\"368315\" /var/log/mysql/bin.000006 | mysql -u root -p ä»äºŒè¿›åˆ¶æ—¥å¿—binlog.000006çš„368315è¿™ä¸ªpositionæ ‡è®°æ¢å¤åˆ°æ—¥å¿—ç»“æŸ åœ¨ä½¿ç”¨äºŒè¿›åˆ¶æ¢å¤æ•°æ®åº“æ—¶å¯ä»¥ä½¿ç”¨positionæ ‡è®°å’Œæ—¶é—´æ ‡è®°ï¼Œå‡è®¾æˆ‘ä»¬åœ¨æ•°æ®åº“æ“ä½œä¸­è¯¯æ‰§è¡Œäº†é”™è¯¯çš„æ“ä½œæˆ‘ä»¬å¯ä»¥ç”¨positionå’Œæ—¶é—´æ ‡è®°æ¥è·³ è¿‡é”™è¯¯çš„æ“ä½œä¸æ‰§è¡Œï¼Œæ¢å¤å‡ºæ•°æ®åº“ã€‚äºŒè¿›åˆ¶æ—¥å¿—æ¢å¤æ•°æ®åº“æ˜¯åŸºäºæŸä¸ªå®Œæ•´å¤‡ä»½çš„åŸºç¡€ä¸Šã€‚å› æ­¤åœ¨å¤‡ä»½æ•°æ®åº“æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨flush logå‘½ä»¤æ¥åˆ·æ–°äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè®°å½•ä¸‹æ–‡ä»¶åã€‚è¿™æ ·ä¸‹æ¬¡æ•°æ®åº“å‡ºç°é—®é¢˜æˆ‘ä»¬å°±å¯ä»¥ç”¨æ‰‹ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œå¤‡ä»½æ¥æ¢å¤æ•°æ®ã€‚","categories":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/tags/mysql/"},{"name":"binlog","slug":"binlog","permalink":"https://www.xiemx.com/tags/binlog/"}],"author":"xiemx"},{"title":"Tomcatå¤šå®ä¾‹è¿è¡Œ","slug":"multi-tomcat-server","date":"2016-01-29T21:01:29.000Z","updated":"2019-10-21T06:57:43.013Z","comments":true,"path":"/2016/01/30/multi-tomcat-server/","link":"","permalink":"https://www.xiemx.com/2016/01/30/multi-tomcat-server/","excerpt":"","text":"ä¸€ä¸ªç¨‹åºé»˜è®¤åœ¨ç³»ç»Ÿä¸­éƒ½æ˜¯ç»´æŠ¤ä¸€ä¸ªè¿›ç¨‹ï¼ˆæˆ–ä¸€ä¸ªä¸»è¿›ç¨‹å¤šä¸ªå­è¿›ç¨‹ï¼‰ï¼Œè¿™æ ·çš„ç»“æ„åœ¨è¿›ç¨‹å‡ºé”™ç»ˆæ­¢æ—¶ä¼šå¯¼è‡´è¯¥è¿›ç¨‹ä¸‹æ‰€æœ‰çš„ç½‘ç«™éƒ½ä¼šæ‰“ä¸å¼€ã€‚ä½†tomcatæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´å¯åŠ¨æ—¶æŒ‡å®šçš„tomcatç¨‹åºä½ç½®æ¥å¯åŠ¨å¤šä¸ªtomcatç¨‹åºï¼Œåˆ†å±ä¸åŒçš„è¿›ç¨‹è¿™æ ·åœ¨æŸä¸ªè¿›ç¨‹ç»ˆæ­¢æ—¶ä¹Ÿä¸ä¼šå½±å“åˆ°å…¶ä»–è¿›ç¨‹ï¼Œä¸ä¼šå¯¼è‡´å…¶å®ƒç½‘ç«™æ— æ³•è®¿é—®ã€‚ä½†ä¸€ä¸ªç«¯å£åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ç›‘å¬ï¼Œå½“æˆ‘ä»¬å¯åŠ¨å¤šè¿›ç¨‹å°±ä¸èƒ½åŒæ—¶ç›‘å¬8080ç«¯å£ï¼Œæˆ‘ä»¬å¯ä»¥ä¾æ¬¡ç›‘å¬8081ï¼Œ8082ç­‰ï¼Œå¦‚æœè¦å®ç°ç›´æ¥è¾“å…¥åŸŸåè®¿é—®å¯ä»¥åœ¨å‰æ®µå¢åŠ nginxæ¥åšä»£ç†å³å¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950[root@serverc ~]# /etc/init.d/tomcat stop[root@serverc ~]# cd /home/tomcat/[root@serverc tomcat]# mkdir tomcat1 tomcat2[root@serverc tomcat]# cd apache-tomcat-8.0.24/[root@serverc apache-tomcat-8.0.24]# cp -rp logs/ temp/ tomcat1.com/ work/ webapps/ conf/ ../tomcat1/[root@serverc apache-tomcat-8.0.24]# cp -rp logs/ temp/ tomcat2.com/ work/ webapps/ conf/ ../tomcat2/[root@serverc apache-tomcat-8.0.24]# rm -rf LICENSE NOTICE RELEASE-NOTES RUNNING.txt conf logs tomcat1.com tomcat2.com webapps[root@serverc apache-tomcat-8.0.24]# lsbin lib temp work[root@serverc apache-tomcat-8.0.24]# cd ../tomcat1/[root@serverc tomcat1]# vim conf/server.xml&lt;Host name=\"www.tomcat1.com\" appBase=\"tomcat1.com\"unpackWARs=\"true\" autoDeploy=\"true\"&gt;&lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\"prefix=\"localhost_access_log\" suffix=\".txt\"pattern=\"%h %l %u %t &amp;quot;%r&amp;quot; %s %b\" /&gt;&lt;/Host&gt;[root@serverc tomcat1]# cd ../tomcat2/[root@serverc tomcat2]# vim conf/server.xml&lt;Host name=\"www.tomcat2.com\" appBase=\"tomcat2.com\"unpackWARs=\"true\" autoDeploy=\"true\"&gt;&lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\"prefix=\"localhost_access_log\" suffix=\".txt\"pattern=\"%h %l %u %t &amp;quot;%r&amp;quot; %s %b\" /&gt;&lt;/Host&gt;=============================================================================&lt;Connector port=\"8081\" protocol=\"HTTP/1.1\"connectionTimeout=\"20000\"redirectPort=\"8443\" /&gt;=============================================================================&lt;Connector port=\"8010\" protocol=\"AJP/1.3\" redirectPort=\"8443\" /&gt;[root@serverc tomcat2]# cd /etc/init.d/[root@serverc init.d]# mv tomcat tomcat1[root@serverc init.d]# vim tomcat1export CATALINA_HOME=\"/home/tomcat/apache-tomcat-8.0.24/\"export CATALINA_BASE=\"/home/tomcat/tomcat1\"[root@serverc init.d]# cp tomcat1 tomcat2[root@serverc init.d]# vim tomcat2export CATALINA_HOME=\"/home/tomcat/apache-tomcat-8.0.24/\"export CATALINA_BASE=\"/home/tomcat/tomcat2\"[root@serverc init.d]# /etc/init.d/tomcat1 start[root@serverc init.d]# /etc/init.d/tomcat2 start[root@serverc init.d]# netstat -ltunp | grep 8080tcp6 0 0 :::8080 :::* LISTEN 5749/jsvc.exec[root@serverc init.d]# netstat -ltunp | grep 8081tcp6 0 0 :::8081 :::* LISTEN 5782/jsvc.exec","categories":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.xiemx.com/categories/tomcat/"}],"tags":[{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"},{"name":"http","slug":"http","permalink":"https://www.xiemx.com/tags/http/"},{"name":"tomcat","slug":"tomcat","permalink":"https://www.xiemx.com/tags/tomcat/"}],"author":"xiemx"},{"title":"Tomcatåˆ›å»ºè™šæ‹Ÿä¸»æœº","slug":"tomcat-virtual-host","date":"2016-01-29T20:01:28.000Z","updated":"2019-10-19T07:20:12.516Z","comments":true,"path":"/2016/01/30/tomcat-virtual-host/","link":"","permalink":"https://www.xiemx.com/2016/01/30/tomcat-virtual-host/","excerpt":"","text":"1.ä¿®æ”¹tomcatæœåŠ¡çš„ä¸»é…ç½®æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ä½äºtomcatä¸»ç¨‹åºä¸‹confç›®å½•ä¸­ï¼Œæ–‡ä»¶åç§°ä¸ºserver.xml 123[root@serverc ~]# cd /home/tomcat/apache-tomcat-8.0.24/conf/ [root@serverc conf]# ls -l server.xml -rw------- 1 tomcat root 6458 Jul 2 04:23 server.xml 2.ç¼–è¾‘è¯¥æ–‡ä»¶ï¼Œæ·»åŠ è™šæ‹Ÿä¸»æœºã€‚hostå­—æ®µä¸ºtomcatæœåŠ¡çš„è™šæ‹Ÿä¸»æœºé…ç½®å­—æ®µã€‚é…ç½®ä¸¤ä¸ªè™šæ‹Ÿä¸»æœºï¼Œwww.tomcat1.comå’Œwww.tomcat2.comï¼Œä¸¤å°è™šæ‹Ÿä¸»æœºæœ‰è‡ªå·±çš„appbaseï¼ˆå³ç½‘é¡µæ–‡ä»¶æ ¹ç›®å½•ï¼Œä¸‹å›¾ä¸­ä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„è¡¨ç¤ºè™šæ‹Ÿä¸»æœºç½‘é¡µæ ¹ç›®å½•ï¼Œè¯¥è·¯å¾„æ˜¯ç›¸å¯¹äºtomcatæœåŠ¡ä¸»ç¨‹åºæ‰€åœ¨ç›®å½•æ¥è¯´ï¼Œè¯¥è·¯å¾„ç°ä¸å­˜åœ¨ï¼Œåç»­å†åˆ›å»ºï¼‰å’Œç›¸å…³æ—¥å¿—å‰ç¼€ã€‚æ³¨nameå­—æ®µä¸ºè™šæ‹Ÿä¸»æœºåï¼ŒappBaseä¸ºæ ¹ç›®å½•ï¼Œuppackwarsä¸ºè‡ªåŠ¨è§£å‹æ˜¯å¦å¼€å¯ï¼ŒautoDeployä¸ºè‡ªåŠ¨éƒ¨ç½²æ˜¯å¦å¼€å¯ 123456789101112&lt;Host name=\"www.tomcat1.com\" appBase=\"tomcat1.com\"unpackWARs=\"true\" autoDeploy=\"true\"&gt;&lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\"prefix=\"localhost_access_log\" suffix=\".txt\"pattern=\"%h %l %u %t \"%r\" %s %b\" /&gt;&lt;/Host&gt;&lt;Host name=\"www.tomcat2.com\" appBase=\"tomcat2.com\"unpackWARs=\"true\" autoDeploy=\"true\"&gt;&lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\"prefix=\"localhost_access_log\" suffix=\".txt\"pattern=\"%h %l %u %t \"%r\" %s %b\" /&gt;&lt;/Host&gt; 3.è¿›å…¥tomcatæœåŠ¡ä¸»ç¨‹åºæ‰€åœ¨ç›®å½•ï¼Œåˆ›å»ºä¸Šè¿°æ­¥éª¤ä¸­è™šæ‹Ÿä¸»æœºæ‰€æŒ‡å®šçš„appBaseï¼Œåˆ†åˆ«è¿›å…¥æ¯ä¸€ä¸ªè™šæ‹Ÿä¸»æœºçš„appBaseç›®å½•ä¸‹åˆ›å»ºROOTç›®å½•ï¼Œåœ¨ROOTç›®å½•å†™æ¯ä¸€ä¸ªè™šæ‹Ÿä¸»æœºå¯¹åº”çš„é¦–é¡µæ–‡ä»¶ã€‚ 12345678910[root@serverc conf]# cd /home/tomcat/apache-tomcat-8.0.24/ [root@serverc apache-tomcat-8.0.24]# mkdir tomcat1.com/ [root@serverc apache-tomcat-8.0.24]# cd tomcat1.com/ [root@serverc tomcat1.com]# mkdir ROOT [root@serverc tomcat1.com]# echo tomcat1 &gt; ROOT/index.html [root@serverc tomcat1.com]# cd ../ [root@serverc apache-tomcat-8.0.24]# mkdir tomcat2.com [root@serverc apache-tomcat-8.0.24]# cd tomcat2.com [root@serverc tomcat2.com]# mkdir ROOT [root@serverc tomcat2.com]# echo tomcat2 &gt; ROOT/index.html 4.é‡å¯tomcatæœåŠ¡ 12[root@serverc tomcat2.com]# /etc/init.d/tomcat stop[root@serverc tomcat2.com]# /etc/init.d/tomcat start 5.åœ¨clientç«¯æœºå™¨ä¸Šæµ‹è¯• 123456[root@workstation ~]# echo 172.25.41.10 www.tomcat1.com &gt;&gt; /etc/hosts [root@workstation ~]# echo 172.25.41.10 www.tomcat2.com &gt;&gt; /etc/hosts[root@workstation ~]# curl www.tomcat1.com:8080tomcat1[root@workstation ~]# curl www.tomcat2.com:8080tomcat2","categories":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.xiemx.com/categories/tomcat/"}],"tags":[{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"},{"name":"http","slug":"http","permalink":"https://www.xiemx.com/tags/http/"},{"name":"tomcat","slug":"tomcat","permalink":"https://www.xiemx.com/tags/tomcat/"}],"author":"xiemx"},{"title":"Tomcatæ­å»ºwebæœåŠ¡å™¨","slug":"tomcat-server","date":"2016-01-24T02:01:58.000Z","updated":"2019-10-21T06:57:43.018Z","comments":true,"path":"/2016/01/24/tomcat-server/","link":"","permalink":"https://www.xiemx.com/2016/01/24/tomcat-server/","excerpt":"","text":"tomcatæ˜¯ä¸€æ¬¾å¤„ç†jspé¡µé¢çš„webå¥—ä»¶ï¼Œå¯ä»¥å¤„ç†htmlé¡µé¢å’Œjspé¡µé¢ã€‚ç”±äºjavaè¯­è¨€çš„è·¨å¹³å°æ€§ï¼Œè½¯ä»¶åªè¦è§£å‹åå³å¯è¿è¡Œï¼Œä½†è¿è¡Œjavaéœ€è¦åœ¨ç³»ç»Ÿä¸­å®‰è£…jdkçš„javaè™šæ‹Ÿæœºã€‚tomcatçš„è½¯ä»¶åŒ…å¯ä»¥å»tomcatå®˜ç½‘http://tomcat.apache.orgè·å¾—ï¼Œjdkçš„è½¯ä»¶åŒ…éœ€è¦å»oracleå®˜ç½‘ä¸‹è½½`http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html`ã€‚ å¦å¤–åœ¨éƒ¨ç½²tomcatè™šæ‹Ÿæœºæ—¶æˆ‘ä»¬ä¸€èˆ¬ä¼šåˆ›å»ºtomcatç”¨æˆ·å’Œç»„å¹¶å°†tomcatç¨‹åºæ”¾åœ¨å®¶ç›®å½•ä¸‹ï¼Œå®¶ç›®å½•çš„æƒé™ä¸º700ï¼Œè¯¥ç›®å½•åªæœ‰tomcatç”¨æˆ·æœ‰å®Œæ•´æƒé™ï¼Œå…¶ä»–ç”¨æˆ·æ— ä»»ä½•æƒé™ï¼Œå¯å¢åŠ å®‰å…¨æ€§ã€‚å¦ä¸€ç§éƒ¨ç½²è½¯ä»¶çš„æ–¹æ³•åŒæˆ‘ä»¬å¹³æ—¶å®‰è£…æºç è½¯ä»¶ç›¸åŒï¼Œå°†è½¯ä»¶æ”¾åœ¨/usr/lib/localç›®å½•ä¸‹ã€‚è¿™é‡Œå°±å°†è½¯ä»¶éƒ¨ç½²åœ¨home/tomcat/ç›®å½•ä¸‹ã€‚ tomcatç›®å½•ç»“æ„1234567891011121314[root@serverc tomcat]# tar xf apache-tomcat-8.0.24.tar.gz -C /home/tomcat/[root@serverc tomcat]# cd /home/tomcat/apache-tomcat-8.0.24/[root@serverc apache-tomcat-8.0.24]# ls -ldrwxr-xr-x 2 root root 4096 Dec 11 14:22 bin #å­˜æ”¾å‘½ä»¤drwxr-xr-x 2 root root 4096 Jul 2 04:23 conf #å­˜æ”¾é…ç½®æ–‡ä»¶drwxr-xr-x 2 root root 4096 Dec 11 14:22 lib #å­˜æ”¾åº“æ–‡ä»¶ï¼Œjavaçš„åº“æ–‡ä»¶åç¼€ä¸ºjar-rw-r--r-- 1 root root 57011 Jul 2 04:23 LICENSEdrwxr-xr-x 2 root root 6 Jul 2 04:20 logs #å­˜æ”¾ç›¸å…³æ—¥å¿—-rw-r--r-- 1 root root 1444 Jul 2 04:23 NOTICE-rw-r--r-- 1 root root 6741 Jul 2 04:23 RELEASE-NOTES-rw-r--r-- 1 root root 16204 Jul 2 04:23 RUNNING.txtdrwxr-xr-x 2 root root 29 Dec 11 14:22 temp #å­˜æ”¾ä¸´æ—¶æ–‡ä»¶drwxr-xr-x 7 root root 76 Jul 2 04:21 webapps #é»˜è®¤ç½‘ç«™ç½‘é¡µæ–‡ä»¶æ ¹ç›®å½•drwxr-xr-x 2 root root 6 Jul 2 04:20 work #å·¥ä½œç›®å½• å¯åŠ¨tomcat12345678910111213binç›®å½•ä¸‹æœ‰æ§åˆ¶tomcatæœåŠ¡çš„å¯åŠ¨å…³é—­è„šæœ¬ï¼Œåœ¨å¯åŠ¨jdkæ—¶æˆ‘ä»¬å£°æ˜ä¸‹jdkçš„å®‰è£…ä½ç½®:export JAVA\\_HOME=\"/usr/java/jdk1.7.0\\_79/\" å£°æ˜tomcatç¨‹åºä¸­å‘½ä»¤å’Œåº“æ–‡ä»¶æ‰€åœ¨ä½ç½®export CATALINA\\_HOME=\"/home/tomcat/apache-tomcat-8.0.24/\"å£°æ˜tomcatç¨‹åºä¸­é…ç½®æ–‡ä»¶ã€ç½‘ç«™æ ¹ç›®å½•ç­‰æ‰€åœ¨ä½ç½®export CATALINA\\_BASE=\"/home/tomcat/apache-tomcat-8.0.24/\"å¯åŠ¨tomcatæœåŠ¡çš„è„šæœ¬åç§°ä¸ºstartup.shã€‚æ‰§è¡Œè¯¥è„šæœ¬å¯å¯åŠ¨tomcatæœåŠ¡ã€‚è¯¥æœåŠ¡é»˜è®¤ç›‘å¬tcp/8080ç«¯å£ã€‚å…³é—­è„šæœ¬ä¸ºshutdown.shã€‚ [root@serverc ~]# cd /home/tomcat/apache-tomcat-8.0.24/bin/ [root@serverc bin]# ./startup.sh [root@serverc bin]# ps -ef | grep java [root@serverc bin]# netstat -ltunp | grep 8080 tcp6 0 0 :::8080 :::* LISTEN 1102/java æµ‹è¯•tomcatæœåŠ¡å™¨ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥åœ°å€è®¿é—®8080ï¼Œhttp://192.168.17.10:8080 æ¥æµ‹è¯•tomcatæœåŠ¡å™¨æ˜¯å¦æ­£å¸¸","categories":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.xiemx.com/categories/tomcat/"}],"tags":[{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"},{"name":"http","slug":"http","permalink":"https://www.xiemx.com/tags/http/"},{"name":"tomcat","slug":"tomcat","permalink":"https://www.xiemx.com/tags/tomcat/"}],"author":"xiemx"},{"title":"Apacheé…ç½®æ–‡ä»¶å‚æ•°è¯¦è§£","slug":"apache-configure","date":"2016-01-17T03:01:54.000Z","updated":"2019-10-21T06:57:42.923Z","comments":true,"path":"/2016/01/17/apache-configure/","link":"","permalink":"https://www.xiemx.com/2016/01/17/apache-configure/","excerpt":"","text":"123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255[root@localhost ~]# grep -v &apos;^#\\|^$\\|#&apos; /etc/httpd/conf/httpd.confServerTokens OS å½“æœåŠ¡å™¨å“åº”ä¸»æœºå¤´ï¼ˆheaderï¼‰ä¿¡æ¯æ—¶æ˜¾ç¤ºApacheçš„ç‰ˆæœ¬å’Œæ“ä½œç³»ç»Ÿåç§°ServerRoot &quot;/etc/httpd&quot; è®¾ç½®æœåŠ¡å™¨çš„æ ¹ç›®å½•PidFile run/httpd.pid PIDå­˜æ”¾ä½ç½®Timeout 60 è‹¥60ç§’åæ²¡æœ‰æ”¶åˆ°æˆ–é€å‡ºä»»ä½•æ•°æ®å°±åˆ‡æ–­è¯¥è¿æ¥KeepAlive Off æ˜¯å¦å¼€å¯ä¿æŒé“¾æ¥çŠ¶æ€MaxKeepAliveRequests 100 åœ¨ä½¿ç”¨ä¿æŒè¿æ¥åŠŸèƒ½æ—¶ï¼Œè®¾ç½®å®¢æˆ·ä¸€æ¬¡è¯·æ±‚è¿æ¥èƒ½å“åº”æ–‡ä»¶çš„æœ€å¤§ä¸Šé™KeepAliveTimeout 15 åœ¨ä½¿ç”¨ä¿æŒè¿æ¥åŠŸèƒ½æ—¶ï¼Œä¸¤ä¸ªç›¸é‚»çš„è¿æ¥çš„æ—¶é—´é—´éš”è¶…è¿‡15ç§’ï¼Œå°±åˆ‡æ–­è¿æ¥&lt;IfModule prefork.c&gt; è®¾ç½®ä½¿ç”¨Prefork MPMè¿è¡Œæ–¹å¼çš„å‚æ•°ï¼Œæ­¤è¿è¡Œæ–¹å¼æ˜¯Red haté»˜è®¤çš„æ–¹å¼StartServers 8 è®¾ç½®æœåŠ¡å™¨å¯åŠ¨æ—¶è¿è¡Œçš„è¿›ç¨‹æ•°MinSpareServers 5 æœ€å°ç©ºé—²è¿›ç¨‹æ•°MaxSpareServers 20 æœ€å¤§ç©ºé—²è¿›ç¨‹æ•°ServerLimit 256 æœ€å¤§çš„è¿›ç¨‹æ•°MaxClients 256 æœ€å¤§çš„è¯·æ±‚å¹¶å‘MaxClients=ServerLimit*è¿›ç¨‹çš„çº¿ç¨‹æ•°MaxRequestsPerChild 4000 é™åˆ¶æ¯ä¸ªå­è¿›ç¨‹åœ¨ç»“æŸå¤„ç†è¯·æ±‚ä¹‹å‰èƒ½å¤„ç†çš„è¿æ¥è¯·æ±‚ä¸º1000&lt;/IfModule&gt;&lt;IfModule worker.c&gt; è®¾ç½®ä½¿ç”¨Worker MPMè¿è¡Œæ–¹å¼çš„å‚æ•°StartServers 4MaxClients 300MinSpareThreads 25MaxSpareThreads 75ThreadsPerChild 25MaxRequestsPerChild 0&lt;/IfModule&gt;Listen 80 ç›‘å¬ç«¯å£LoadModule auth_basic_module modules/mod_auth_basic.soLoadModule auth_digest_module modules/mod_auth_digest.soLoadModule authn_file_module modules/mod_authn_file.soLoadModule authn_alias_module modules/mod_authn_alias.soLoadModule authn_anon_module modules/mod_authn_anon.soLoadModule authn_dbm_module modules/mod_authn_dbm.soLoadModule authn_default_module modules/mod_authn_default.soLoadModule authz_host_module modules/mod_authz_host.soLoadModule authz_user_module modules/mod_authz_user.soLoadModule authz_owner_module modules/mod_authz_owner.soLoadModule authz_groupfile_module modules/mod_authz_groupfile.soLoadModule authz_dbm_module modules/mod_authz_dbm.soLoadModule authz_default_module modules/mod_authz_default.soLoadModule ldap_module modules/mod_ldap.soLoadModule authnz_ldap_module modules/mod_authnz_ldap.soLoadModule include_module modules/mod_include.soLoadModule log_config_module modules/mod_log_config.soLoadModule logio_module modules/mod_logio.soLoadModule env_module modules/mod_env.soLoadModule ext_filter_module modules/mod_ext_filter.soLoadModule mime_magic_module modules/mod_mime_magic.soLoadModule expires_module modules/mod_expires.soLoadModule deflate_module modules/mod_deflate.soLoadModule headers_module modules/mod_headers.soLoadModule usertrack_module modules/mod_usertrack.soLoadModule setenvif_module modules/mod_setenvif.soLoadModule mime_module modules/mod_mime.soLoadModule dav_module modules/mod_dav.soLoadModule status_module modules/mod_status.soLoadModule autoindex_module modules/mod_autoindex.soLoadModule info_module modules/mod_info.soLoadModule dav_fs_module modules/mod_dav_fs.soLoadModule vhost_alias_module modules/mod_vhost_alias.soLoadModule negotiation_module modules/mod_negotiation.soLoadModule dir_module modules/mod_dir.soLoadModule actions_module modules/mod_actions.soLoadModule speling_module modules/mod_speling.soLoadModule userdir_module modules/mod_userdir.soLoadModule alias_module modules/mod_alias.soLoadModule substitute_module modules/mod_substitute.soLoadModule rewrite_module modules/mod_rewrite.soLoadModule proxy_module modules/mod_proxy.soLoadModule proxy_balancer_module modules/mod_proxy_balancer.soLoadModule proxy_ftp_module modules/mod_proxy_ftp.soLoadModule proxy_http_module modules/mod_proxy_http.soLoadModule proxy_ajp_module modules/mod_proxy_ajp.soLoadModule proxy_connect_module modules/mod_proxy_connect.soLoadModule cache_module modules/mod_cache.soLoadModule suexec_module modules/mod_suexec.soLoadModule disk_cache_module modules/mod_disk_cache.soLoadModule cgi_module modules/mod_cgi.soLoadModule version_module modules/mod_version.soä»¥ä¸Šä¸ºåŠ¨æ€åŠ è½½çš„æ¨¡å—Include conf.d/*.conf å°†/etc/httpd/conf.dç›®å½•ä¸‹æ‰€æœ‰ä»¥confç»“å°¾çš„é…ç½®æ–‡ä»¶åŒ…å«è¿›æ¥User apache è¿›ç¨‹è¿è¡Œè´¦æˆ·Group apache è¿›ç¨‹è¿è¡Œç¾¤ç»„ServerAdmin root@localhost ApacheæœåŠ¡å™¨ç®¡ç†å‘˜çš„E_mailåœ°å€UseCanonicalName OffDocumentRoot &quot;/var/www/html&quot; è®¾ç½®ç½‘ç«™æ ¹ç›®å½•&lt;Directory /&gt; è®¾ç½®apacheæœåŠ¡å™¨æ ¹çš„è®¿é—®æƒé™Options FollowSymLinks å…è®¸ç¬¦å·é“¾æ¥AllowOverride None ç¦æ­¢è¯»å–.htaccessé…ç½®æ–‡ä»¶çš„å†…å®¹&lt;/Directory&gt;&lt;Directory &quot;/var/www/html&quot;&gt; è®¾ç½®Apacheæ ¹çš„è®¿é—®æƒé™Options Indexes FollowSymLinks FollowSymLinkså…è®¸ç¬¦å·é“¾æ¥ï¼ŒIndexesæ— é¦–é¡µæ—¶ç½—åˆ—å‡ºç›®å½•ä¸‹æ–‡ä»¶AllowOverride NoneOrder allow,deny å…ˆæ‰§è¡ŒAllowè®¿é—®è§„åˆ™ï¼Œåœ¨æ‰§è¡ŒDenyè®¿é—®è§„åˆ™Allow from all allowè®¿é—®è§„åˆ™ï¼Œå…è®¸æ‰€æœ‰é“¾æ¥&lt;/Directory&gt;&lt;IfModule mod_userdir.c&gt;UserDir disabled&lt;/IfModule&gt;DirectoryIndex index.html index.html.var ç½‘ç«™é¦–é¡µæ–‡ä»¶åç§°å®šä¹‰AccessFileName .htaccess è®¿é—®æ§åˆ¶æ–‡ä»¶çš„åç§°&lt;Files ~ &quot;^\\.ht&quot;&gt; å…³äº.htå¼€å¤´æ–‡ä»¶çš„æƒé™æ§åˆ¶Order allow,denyDeny from allSatisfy All è®¿é—®.htå¼€å¤´æ–‡ä»¶éœ€è¦æ»¡è¶³ä¸¤ç§è®¿é—®æ§åˆ¶éƒ½å…è®¸&lt;/Files&gt;TypesConfig /etc/mime.types MIMEå¯¹åº”æ ¼å¼çš„é…ç½®æ–‡ä»¶çš„å­˜æ”¾ä½ç½®DefaultType text/plain é»˜è®¤çš„MIMEæ–‡ä»¶ç±»å‹ä¸ºçº¯æ–‡æœ¬æˆ–HTMLæ–‡ä»¶&lt;IfModule mod_mime_magic.c&gt; å½“mod_mime_magic.cæ¨¡å—è¢«åŠ è½½æ—¶ï¼ŒæŒ‡å®šmagicä¿¡æ¯ç é…ç½®æ–‡ä»¶çš„å­˜æ”¾ä½ç½®MIMEMagicFile conf/magic&lt;/IfModule&gt;HostnameLookups Off å…³é—­è®°å½•è®¿é—®webå®¢æˆ·çš„hostnameåŠŸèƒ½ï¼Œåªè®°å½•IPErrorLog logs/error_log é”™è¯¯æ—¥å¿—å­˜æ”¾ä½ç½®LogLevel warn è®°å½•æ—¥å¿—çš„ç­‰çº§LogFormat &quot;%h %l %u %t \\&quot;%r\\&quot; %&gt;s %b \\&quot;%&#123;Referer&#125;i\\&quot; \\&quot;%&#123;User-Agent&#125;i\\&quot;&quot; combinedLogFormat &quot;%h %l %u %t \\&quot;%r\\&quot; %&gt;s %b&quot; commonLogFormat &quot;%&#123;Referer&#125;i -&gt; %U&quot; refererLogFormat &quot;%&#123;User-agent&#125;i&quot; agentä»¥ä¸Šä¸ºè®°å½•æ—¥å¿—çš„å››ç§æ ¼å¼CustomLog logs/access_log combined è®¿é—®æ—¥å¿—çš„çºªå½•æ ¼å¼ä¸ºcombinedï¼ˆæ··åˆå‹ï¼‰ï¼Œå¹¶æŒ‡å®šè®¿é—®æ—¥å¿—å­˜æ”¾ä½ç½®ServerSignature On apacheè‡ªå·±äº§ç”Ÿçš„é¡µé¢ä¸­ä½¿ç”¨apacheæœåŠ¡å™¨ç‰ˆæœ¬çš„ç­¾åAlias /icons/ &quot;/var/www/icons/&quot; å®šä¹‰åˆ«å/icons/&lt;Directory &quot;/var/www/icons&quot;&gt;Options Indexes MultiViews FollowSymLinks MultiViews ä½¿ç”¨å†…å®¹åå•†æ¥å†³å®šè¢«å‘é€çš„ç½‘é¡µçš„æ€§è´¨AllowOverride NoneOrder allow,denyAllow from all&lt;/Directory&gt;&lt;IfModule mod_dav_fs.c&gt; DAVåŠ é”æ•°æ®åº“æ–‡ä»¶çš„å­˜æ”¾ä½ç½®DAVLockDB /var/lib/dav/lockdb&lt;/IfModule&gt;ScriptAlias /cgi-bin/ &quot;/var/www/cgi-bin/&quot; è®¾ç½®CGIç›®å½•çš„è®¿é—®åˆ«å&lt;Directory &quot;/var/www/cgi-bin&quot;&gt;AllowOverride NoneOptions NoneOrder allow,denyAllow from all&lt;/Directory&gt;IndexOptions FancyIndexing VersionSort NameWidth=* HTMLTable æœªæ‰¾åˆ°é¦–é¡µæ–‡ä»¶æ—¶ç”Ÿå­˜ç›®å½•åˆ—è¡¨çš„æ–¹å¼ï¼ŒFancyIndexing å¯¹æ¯ç§ç±»å‹çš„æ–‡ä»¶å‰åŠ ä¸Šä¸€ä¸ªå°å›¾æ ‡ä»¥ç¤ºåŒºåˆ«ï¼ŒVersionSort å¯¹åŒä¸€ä¸ªè½¯ä»¶çš„å¤šä¸ªç‰ˆæœ¬è¿›è¡Œæ’åºï¼ŒNameWidth=* æ–‡ä»¶åå­—æ®µè‡ªåŠ¨é€‚åº”å½“å‰ç›®å½•ä¸‹çš„æœ€é•¿æ–‡ä»¶åã€‚ç”Ÿæˆå°å›¾æ ‡çš„æ—¶å€™ä½¿ç”¨AddIconé€‰é¡¹ã€‚Charset=UTF-8 å­—ç¬¦ç¼–ç AddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzipAddIconByType (TXT,/icons/text.gif) text/*AddIconByType (IMG,/icons/image2.gif) image/*AddIconByType (SND,/icons/sound2.gif) audio/*AddIconByType (VID,/icons/movie.gif) video/*AddIcon /icons/binary.gif .bin .exeAddIcon /icons/binhex.gif .hqxAddIcon /icons/tar.gif .tarAddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .ivAddIcon /icons/compressed.gif .Z .z .tgz .gz .zipAddIcon /icons/a.gif .ps .ai .epsAddIcon /icons/layout.gif .html .shtml .htm .pdfAddIcon /icons/text.gif .txtAddIcon /icons/c.gif .cAddIcon /icons/p.gif .pl .pyAddIcon /icons/f.gif .forAddIcon /icons/dvi.gif .dviAddIcon /icons/uuencoded.gif .uuAddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tclAddIcon /icons/tex.gif .texAddIcon /icons/bomb.gif /coreAddIcon /icons/back.gif ..AddIcon /icons/hand.right.gif READMEAddIcon /icons/folder.gif ^^DIRECTORY^^AddIcon /icons/blank.gif ^^BLANKICON^^DefaultIcon /icons/unknown.gif ä½ç½®ç±»å‹æ–‡ä»¶ä½¿ç”¨æ­¤å›¾åƒä½œä¸ºå›¾æ ‡ReadmeName README.html å½“æœåŠ¡å™¨è‡ªåŠ¨åˆ—å‡ºç›®å½•åˆ—è¡¨æ—¶ï¼Œåœ¨æ‰€ç”Ÿæˆçš„é¡µé¢ä¹‹åæ˜¾ç¤ºreadme.htmlçš„å†…å®¹HeaderName HEADER.html å½“æœåŠ¡å™¨è‡ªåŠ¨åˆ—å‡ºç›®å½•åˆ—è¡¨æ—¶ï¼Œåœ¨æ‰€ç”Ÿæˆçš„é¡µé¢ä¹‹å‰æ˜¾ç¤ºheader.htmlçš„å†…å®¹AddLanguage ca .caAddLanguage cs .cz .csAddLanguage da .dkAddLanguage de .deAddLanguage el .elAddLanguage en .enAddLanguage eo .eoAddLanguage es .esAddLanguage et .etAddLanguage fr .frAddLanguage he .heAddLanguage hr .hrAddLanguage it .itAddLanguage ja .jaAddLanguage ko .koAddLanguage ltz .ltzAddLanguage nl .nlAddLanguage nn .nnAddLanguage no .noAddLanguage pl .poAddLanguage pt .ptAddLanguage pt-BR .pt-brAddLanguage ru .ruAddLanguage sv .svAddLanguage zh-CN .zh-cnAddLanguage zh-TW .zh-twä»¥ä¸Šä¸ºè®¾ç½®ç½‘é¡µå†…å®¹çš„è¯­è¨€ç§ç±»LanguagePriority en ca cs da de el eo es et fr he hr it ja ko ltz nl nnno pl pt pt-BR ru sv zh-CN zh-TW ç”Ÿæ•ˆçš„å…ˆåé¡ºåºForceLanguagePriority Prefer FallbackPrefer å½“æœ‰å¤šç§è¯­è¨€å¯ä»¥åŒ¹é…æ—¶ï¼Œä½¿ç”¨LanguagePriority åˆ—è¡¨çš„ç¬¬ä¸€é¡¹Fallback å½“æ²¡æœ‰è¯­è¨€å¯ä»¥åŒ¹é…æ—¶ï¼Œä½¿ç”¨LanguagePriority åˆ—è¡¨çš„ç¬¬ä¸€é¡¹AddDefaultCharset UTF-8 è®¾ç½®é»˜è®¤å­—ç¬¦é›†AddType application/x-compress .ZAddType application/x-gzip .gz .tgzAddType application/x-x509-ca-cert .crtAddType application/x-pkcs7-crl .crlä»¥ä¸Šä¸ºæ·»åŠ ä¸€äº›mimeç±»å‹AddHandler type-map var è®¾ç½®apccheå¯¹æŸäº›æ‰©å±•åçš„å¤„ç†æ–¹å¼AddType text/html .shtmlAddOutputFilter INCLUDES .shtml ä½¿ç”¨è¿‡æ»¤å™¨æ‰§è¡ŒSSIAlias /error/ &quot;/var/www/error/&quot; å®šä¹‰é”™è¯¯é¡µé¢åˆ«å&lt;IfModule mod_negotiation.c&gt;&lt;IfModule mod_include.c&gt;&lt;Directory &quot;/var/www/error&quot;&gt; é”™è¯¯é¡µçš„æƒé™å®šä¹‰AllowOverride NoneOptions IncludesNoExecAddOutputFilter Includes htmlAddHandler type-map varOrder allow,denyAllow from allLanguagePriority en es de frForceLanguagePriority Prefer Fallback&lt;/Directory&gt;&lt;/IfModule&gt;&lt;/IfModule&gt;ä»¥ä¸‹ä¸ºè®¾ç½®æµè§ˆå™¨åŒ¹é…BrowserMatch &quot;Mozilla/2&quot; nokeepaliveBrowserMatch &quot;MSIE 4\\.0b2;&quot; nokeepalive downgrade-1.0 force-response-1.0BrowserMatch &quot;RealPlayer 4\\.0&quot; force-response-1.0BrowserMatch &quot;Java/1\\.0&quot; force-response-1.0BrowserMatch &quot;JDK/1\\.0&quot; force-response-1.0BrowserMatch &quot;Microsoft Data Access Internet Publishing Provider&quot;redirect-carefullyBrowserMatch &quot;MS FrontPage&quot; redirect-carefullyBrowserMatch &quot;^WebDrive&quot; redirect-carefullyBrowserMatch &quot;^WebDAVFS/1.[0123]&quot; redirect-carefullyBrowserMatch &quot;^gnome-vfs/1.0&quot; redirect-carefullyBrowserMatch &quot;^XML Spy&quot; redirect-carefullyBrowserMatch &quot;^Dreamweaver-WebDAV-SCM1&quot; redirect-carefully","categories":[{"name":"apache","slug":"apache","permalink":"https://www.xiemx.com/categories/apache/"}],"tags":[{"name":"apache","slug":"apache","permalink":"https://www.xiemx.com/tags/apache/"},{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"}],"author":"xiemx"},{"title":"Apacheè¿è¡Œæ¨¡å¼preforkå’Œworker","slug":"apache-running-mode","date":"2016-01-17T03:01:18.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2016/01/17/apache-running-mode/","link":"","permalink":"https://www.xiemx.com/2016/01/17/apache-running-mode/","excerpt":"","text":"ä¸¤ç§æ¨¡å¼ preforkæ¨¡å¼å¤šè¿›ç¨‹æ¨¡å¼ã€‚å°†MaxClientsè®¾ç½®ä¸ºä¸€ä¸ªè¶³å¤Ÿå¤§çš„æ•°å€¼ä»¥å¤„ç†æ½œåœ¨çš„è¯·æ±‚é«˜å³°ï¼ŒåŒæ—¶åˆä¸èƒ½å¤ªå¤§ï¼Œä»¥è‡´éœ€è¦ä½¿ç”¨çš„å†…å­˜è¶…å‡ºç‰©ç†å†…å­˜çš„å¤§å°ã€‚ workeræ¨¡å¼å¤šçº¿ç¨‹å¤šè¿›ç¨‹æ¨¡å¼ã€‚ç”±äºä½¿ç”¨çº¿ç¨‹æ¥å¤„ç†è¯·æ±‚ï¼Œå¯ä»¥åº”å¯¹é«˜å¹¶å‘çš„è®¿é—®ï¼Œè€Œç³»ç»Ÿèµ„æºçš„å¼€é”€å°äºåŸºäºè¿›ç¨‹çš„MPMã€‚ä½†æ˜¯ï¼Œå®ƒä¹Ÿä½¿ç”¨äº†å¤šè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹åˆæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œä»¥è·å¾—åŸºäºè¿›ç¨‹çš„MPMçš„ç¨³å®šæ€§ã€‚æ§åˆ¶æ¯ä¸ªå­è¿›ç¨‹å…è®¸å»ºç«‹çš„çº¿ç¨‹æ•°çš„ThreadsPerChildæŒ‡ä»¤ï¼Œå’Œæ§åˆ¶å…è®¸å»ºç«‹çš„æ€»çº¿ç¨‹æ•°çš„MaxClientsæŒ‡ä»¤ã€‚ preforkå’Œworkeræ¨¡å¼çš„åˆ‡æ¢[root@localhost ~]# rpm -ql httpd | grep worker/usr/sbin/httpd.worker é»˜è®¤çš„å·¥ä½œæ¨¡å¼ä¸ºpreforkå½“è¦åˆ‡æ¢æ¨¡å¼æ—¶ä¿®æ”¹/usr/sbin/ä¸‹çš„2ä¸ªå¯åŠ¨è„šæœ¬åç§°å³å¯ å°†å½“å‰çš„preforkæ¨¡å¼å¯åŠ¨æ–‡ä»¶æ”¹å 1mv httpd httpd.prefork å°†workeræ¨¡å¼çš„å¯åŠ¨æ–‡ä»¶æ”¹å 1mv httpd.worker httpd ä¿®æ”¹Apacheé…ç½®æ–‡ä»¶ 12345678910vim /etc/httpd/conf/httpd.confæ‰¾åˆ°é‡Œè¾¹çš„å¦‚ä¸‹ä¸€æ®µï¼Œå¯é€‚å½“ä¿®æ”¹è´Ÿè½½ç­‰å‚æ•°ï¼š&lt;IfModule prefork.c&gt;StartServers 8MinSpareServers 5MaxSpareServers 20ServerLimit 256MaxClients 256MaxRequestsPerChild 4000&lt;/IfModule&gt; å¤„äºç¨³å®šæ€§å’Œå®‰å…¨æ€§è€ƒè™‘ï¼Œä¸å»ºè®®æ›´æ¢apache2çš„è¿è¡Œæ–¹å¼ï¼Œä½¿ç”¨ç³»ç»Ÿé»˜è®¤preforkå³å¯ã€‚å¦å¤–å¾ˆå¤šphpæ¨¡å—ä¸èƒ½å·¥ä½œåœ¨workeræ¨¡å¼ä¸‹ï¼Œä¾‹å¦‚redhat linuxè‡ªå¸¦çš„phpä¹Ÿä¸èƒ½æ”¯æŒçº¿ç¨‹å®‰å…¨ã€‚æ‰€ä»¥æœ€å¥½ä¸è¦åˆ‡æ¢å·¥ä½œæ¨¡å¼ã€‚ preforkå’Œworkeræ¨¡å¼çš„æ¯”è¾ƒpreforkæ¨¡å¼ä½¿ç”¨å¤šä¸ªå­è¿›ç¨‹ï¼Œæ¯ä¸ªå­è¿›ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹åœ¨æŸä¸ªç¡®å®šçš„æ—¶é—´åªèƒ½ç»´æŒä¸€ä¸ªè¿æ¥ã€‚åœ¨å¤§å¤šæ•°å¹³å°ä¸Šï¼ŒPrefork MPMåœ¨æ•ˆç‡ä¸Šè¦æ¯”Worker MPMè¦é«˜ï¼Œä½†æ˜¯å†…å­˜ä½¿ç”¨å¤§å¾—å¤šã€‚preforkçš„æ— çº¿ç¨‹è®¾è®¡åœ¨æŸäº›æƒ…å†µä¸‹å°†æ¯”workeræ›´æœ‰ä¼˜åŠ¿ï¼šå®ƒå¯ä»¥ä½¿ç”¨é‚£äº›æ²¡æœ‰å¤„ç†å¥½çº¿ç¨‹å®‰å…¨çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå¹¶ ä¸”å¯¹äºé‚£äº›çº¿ç¨‹è°ƒè¯•å›°éš¾çš„å¹³å°è€Œè¨€ï¼Œå®ƒä¹Ÿæ›´å®¹æ˜“è°ƒè¯•ä¸€äº›ã€‚ workeræ¨¡å¼ä½¿ç”¨å¤šä¸ªå­è¿›ç¨‹ï¼Œæ¯ä¸ªå­è¿›ç¨‹æœ‰å¤šä¸ªçº¿ç¨‹ã€‚æ¯ä¸ªçº¿ç¨‹åœ¨æŸä¸ªç¡®å®šçš„æ—¶ é—´åªèƒ½ç»´æŒä¸€ä¸ªè¿æ¥ã€‚é€šå¸¸æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªé«˜æµé‡çš„HTTPæœåŠ¡å™¨ä¸Šï¼ŒWorker MPMæ˜¯ä¸ªæ¯”è¾ƒå¥½çš„é€‰æ‹©ï¼Œå› ä¸ºWorker MPMçš„å†…å­˜ä½¿ç”¨æ¯”Prefork MPMè¦ä½å¾—å¤šã€‚ä½†worker MPMä¹Ÿç”±ä¸å®Œå–„çš„åœ°æ–¹ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹å´©æºƒï¼Œæ•´ä¸ªè¿›ç¨‹å°±ä¼šè¿åŒå…¶æ‰€æœ‰çº¿ç¨‹ä¸€èµ·â€æ­»æ‰â€.ç”±äºçº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥ä¸€ä¸ªç¨‹åºåœ¨è¿è¡Œæ—¶å¿…é¡»è¢«ç³»ç»Ÿè¯†åˆ«ä¸ºâ€æ¯ ä¸ªçº¿ç¨‹éƒ½æ˜¯å®‰å…¨çš„â€ã€‚ æ€»çš„æ¥è¯´ï¼Œpreforkæ–¹å¼é€Ÿåº¦è¦ç¨é«˜äºworkerï¼Œç„¶è€Œå®ƒéœ€è¦çš„cpuå’Œmemoryèµ„æºä¹Ÿç¨å¤šäºwokerï¼Œä½†åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹wokerä¼˜äºpreforkã€‚ preforkæ¨¡å¼é…ç½®è¯¦è§£1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859&lt;IfModule prefork.c&gt;ServerLimit 256StartServers 5MinSpareServers 8MaxSpareServers 10MaxClients 256MaxRequestsPerChild 4000&lt;/IfModule&gt;ServerLimité»˜è®¤çš„MaxClientæœ€å¤§æ˜¯256ä¸ªçº¿ç¨‹,å¦‚æœæƒ³è®¾ç½®æ›´å¤§çš„å€¼ï¼Œå°±çš„åŠ ä¸ŠServerLimitè¿™ä¸ªå‚æ•°ã€‚20000æ˜¯ServerLimitè¿™ä¸ªå‚æ•°çš„æœ€å¤§å€¼ã€‚å¦‚æœéœ€è¦æ›´å¤§ï¼Œåˆ™å¿…é¡»ç¼–è¯‘apache,æ­¤å‰éƒ½æ˜¯ä¸éœ€è¦é‡æ–°ç¼–è¯‘Apacheã€‚ç”Ÿæ•ˆå‰æï¼šå¿…é¡»æ”¾åœ¨å…¶ä»–æŒ‡ä»¤çš„å‰é¢StartServersæŒ‡å®šæœåŠ¡å™¨å¯åŠ¨æ—¶å»ºç«‹çš„å­è¿›ç¨‹æ•°é‡ï¼Œpreforké»˜è®¤ä¸º8ã€‚MinSpareServersæŒ‡å®šç©ºé—²å­è¿›ç¨‹çš„æœ€å°æ•°é‡ï¼Œé»˜è®¤ä¸º5ã€‚å¦‚æœå½“å‰ç©ºé—²å­è¿›ç¨‹æ•°å°‘äºMinSpareServers ï¼Œé‚£ä¹ˆApacheå°†ä»¥æœ€å¤§æ¯ç§’ä¸€ä¸ªçš„é€Ÿåº¦äº§ç”Ÿæ–°çš„å­è¿›ç¨‹ã€‚æ­¤å‚æ•°ä¸è¦è®¾çš„å¤ªå¤§ã€‚MaxSpareServersè®¾ç½®ç©ºé—²å­è¿›ç¨‹çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º10ã€‚å¦‚æœå½“å‰æœ‰è¶…è¿‡MaxSpareServersæ•°é‡çš„ç©ºé—²å­è¿›ç¨‹ï¼Œé‚£ä¹ˆçˆ¶è¿›ç¨‹å°†æ€æ­»å¤šä½™çš„å­è¿›ç¨‹ã€‚æ­¤å‚æ•°ä¸è¦è®¾çš„ å¤ªå¤§ã€‚å¦‚æœä½ å°†è¯¥æŒ‡ä»¤çš„å€¼è®¾ç½®ä¸ºæ¯”MinSpareServerså°ï¼ŒApacheå°†ä¼šè‡ªåŠ¨å°†å…¶ä¿®æ”¹æˆ\"MinSpareServers+1\"ã€‚MaxClientsé™å®šåŒä¸€æ—¶é—´å®¢æˆ·ç«¯æœ€å¤§æ¥å…¥è¯·æ±‚çš„æ•°é‡(å•ä¸ªè¿›ç¨‹å¹¶å‘çº¿ç¨‹æ•°)ï¼Œé»˜è®¤ä¸º256ã€‚ä»»ä½•è¶…è¿‡MaxClientsé™åˆ¶çš„è¯·æ±‚éƒ½å°†è¿›å…¥ç­‰å€™é˜Ÿåˆ—,ä¸€æ—¦ä¸€ä¸ªé“¾æ¥è¢«é‡Šæ”¾ï¼Œé˜Ÿåˆ—ä¸­çš„è¯·æ±‚å°†å¾—åˆ°æœåŠ¡ã€‚è¦å¢å¤§è¿™ä¸ªå€¼ï¼Œä½ å¿…é¡»åŒæ—¶å¢å¤§ServerLimitã€‚MaxRequestsPerChildæ¯ä¸ªå­è¿›ç¨‹åœ¨å…¶ç”Ÿå­˜æœŸå†…å…è®¸ä¼ºæœçš„æœ€å¤§è¯·æ±‚æ•°é‡ï¼Œé»˜è®¤ä¸º10000.åˆ°è¾¾MaxRequestsPerChildçš„é™åˆ¶åï¼Œå­è¿›ç¨‹å°†ä¼šç»“æŸã€‚å¦‚æœ MaxRequestsPerChildä¸º\"0\"ï¼Œå­è¿›ç¨‹å°†æ°¸è¿œä¸ä¼šç»“æŸã€‚å°†MaxRequestsPerChildè®¾ç½®æˆéé›¶å€¼æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š1.å¯ä»¥é˜²æ­¢(å¶ç„¶çš„)å†…å­˜æ³„æ¼æ— é™è¿›è¡Œï¼Œä»è€Œè€—å°½å†…å­˜ã€‚2.ç»™è¿›ç¨‹ä¸€ä¸ªæœ‰é™å¯¿å‘½ï¼Œä»è€Œæœ‰åŠ©äºå½“æœåŠ¡å™¨è´Ÿè½½å‡è½»çš„æ—¶å€™å‡å°‘æ´»åŠ¨è¿›ç¨‹çš„æ•°é‡ã€‚workeræ¨¡å¼é…ç½®è¯¦è§£&lt;IfModule worker.c&gt;StartServers 4MaxClients 150MinSpareThreads 25MaxSpareThreads 75ThreadsPerChild 25MaxRequestsPerChild 0&lt;/IfModule&gt;StartServersæœåŠ¡å™¨å¯åŠ¨æ—¶å»ºç«‹çš„å­è¿›ç¨‹æ•°ï¼Œé»˜è®¤å€¼æ˜¯\"3\"ã€‚MaxClientså…è®¸åŒæ—¶ä¼ºæœçš„æœ€å¤§æ¥å…¥è¯·æ±‚æ•°é‡(æœ€å¤§çº¿ç¨‹æ•°é‡)ã€‚ä»»ä½•è¶…è¿‡MaxClientsé™åˆ¶çš„è¯·æ±‚éƒ½å°†è¿›å…¥ç­‰å€™é˜Ÿåˆ—ã€‚é»˜è®¤å€¼ æ˜¯\"400\",16(ServerLimit)ä¹˜ä»¥25(ThreadsPerChild)çš„ç»“æœã€‚å› æ­¤è¦å¢åŠ MaxClientsçš„æ—¶å€™ï¼Œä½ å¿…é¡»åŒæ—¶å¢ åŠ ServerLimitçš„å€¼ã€‚MinSpareThreadsæœ€å°ç©ºé—²çº¿ç¨‹æ•°,é»˜è®¤å€¼æ˜¯\"75\"ã€‚è¿™ä¸ªMPMå°†åŸºäºæ•´ä¸ªæœåŠ¡å™¨ç›‘è§†ç©ºé—²çº¿ç¨‹æ•°ã€‚å¦‚æœæœåŠ¡å™¨ä¸­æ€»çš„ç©ºé—²çº¿ç¨‹æ•°å¤ªå°‘ï¼Œå­è¿›ç¨‹å°†äº§ç”Ÿæ–°çš„ç©ºé—²çº¿ç¨‹ã€‚MaxSpareThreadsè®¾ç½®æœ€å¤§ç©ºé—²çº¿ç¨‹æ•°ã€‚é»˜è®¤å€¼æ˜¯\"250\"ã€‚è¿™ä¸ªMPMå°†åŸºäºæ•´ä¸ªæœåŠ¡å™¨ç›‘è§†ç©ºé—²çº¿ç¨‹æ•°ã€‚å¦‚æœæœåŠ¡å™¨ä¸­æ€»çš„ç©ºé—²çº¿ç¨‹æ•°å¤ªå¤šï¼Œå­è¿›ç¨‹å°†æ€æ­»å¤šä½™çš„ç©ºé—²çº¿ç¨‹ã€‚ MaxSpareThreadsçš„å–å€¼èŒƒå›´æ˜¯æœ‰é™åˆ¶çš„ã€‚Apacheå°†æŒ‰ç…§å¦‚ä¸‹é™åˆ¶è‡ªåŠ¨ä¿®æ­£ä½ è®¾ç½®çš„å€¼ï¼šworkerè¦æ±‚å…¶å¤§äºç­‰äº MinSpareThreadsåŠ ä¸ŠThreadsPerChildçš„å’Œã€‚ThreadsPerChildæ¯ä¸ªå­è¿›ç¨‹å»ºç«‹çš„å¸¸é©»çš„æ‰§è¡Œçº¿ç¨‹æ•°ã€‚é»˜è®¤å€¼æ˜¯25ã€‚å­è¿›ç¨‹åœ¨å¯åŠ¨æ—¶å»ºç«‹è¿™äº›çº¿ç¨‹åå°±ä¸å†å»ºç«‹æ–°çš„çº¿ç¨‹äº†ã€‚MaxRequestsPerChildè®¾ç½®æ¯ä¸ªå­è¿›ç¨‹åœ¨å…¶ç”Ÿå­˜æœŸå†…å…è®¸ä¼ºæœçš„æœ€å¤§è¯·æ±‚æ•°é‡ã€‚åˆ°è¾¾MaxRequestsPerChildçš„é™åˆ¶åï¼Œå­è¿›ç¨‹å°†ä¼šç»“æŸã€‚å¦‚æœMaxRequestsPerChildä¸º\"0\"ï¼Œå­è¿›ç¨‹å°†æ°¸è¿œä¸ä¼šç»“æŸã€‚å°†MaxRequestsPerChildè®¾ç½®æˆéé›¶å€¼æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š1.å¯ä»¥é˜²æ­¢(å¶ç„¶çš„)å†…å­˜æ³„æ¼æ— é™è¿›è¡Œï¼Œä»è€Œè€—å°½å†…å­˜ã€‚2.ç»™è¿›ç¨‹ä¸€ä¸ªæœ‰é™å¯¿å‘½ï¼Œä»è€Œæœ‰åŠ©äºå½“æœåŠ¡å™¨è´Ÿè½½å‡è½»çš„æ—¶å€™å‡å°‘æ´»åŠ¨è¿›ç¨‹çš„æ•°é‡ã€‚æ³¨æ„å¯¹äºKeepAliveé“¾æ¥ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªè¯·æ±‚ä¼šè¢«è®¡æ•°ã€‚äº‹å®ä¸Šï¼Œå®ƒæ”¹å˜äº†æ¯ä¸ªå­è¿›ç¨‹é™åˆ¶æœ€å¤§é“¾æ¥æ•°é‡çš„è¡Œä¸ºã€‚","categories":[{"name":"apache","slug":"apache","permalink":"https://www.xiemx.com/categories/apache/"}],"tags":[],"author":"xiemx"},{"title":"Apacheæ­å»ºwebæœåŠ¡å™¨","slug":"apache-webserver","date":"2016-01-17T02:01:16.000Z","updated":"2019-10-21T06:57:42.835Z","comments":true,"path":"/2016/01/17/apache-webserver/","link":"","permalink":"https://www.xiemx.com/2016/01/17/apache-webserver/","excerpt":"","text":"linuxä¸‹æ­å»ºwebæœåŠ¡å™¨çš„å¥—ä»¶å¾ˆå¤šï¼ŒåŸºæœ¬ä½¿ç”¨çš„è¿˜æ˜¯apacheã€nginxã€tomcatã€‚è¿™ä¸‰ç§æœåŠ¡å™¨éƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œåœ¨ä¸åŒçš„åœºæ™¯ä¸‹åº”æ ¹æ®å®é™…éœ€æ±‚é€‰ç”¨ã€‚linuxä¸‹apacheæ­å»ºwebæœåŠ¡å™¨é…ç½®èµ·æ¥è¾ƒä¸ºç®€å•ï¼Œåªéœ€åœ¨ç³»ç»Ÿä¸­å®‰è£…httpdè½¯ä»¶åŒ…å³å¯ã€‚ä½†è¦å®ç°å¤æ‚ç¯å¢ƒä¸‹çš„åº”ç”¨ï¼Œåˆ™éœ€è¦é…ç½®æ›´å¤šçš„åŠŸèƒ½ã€‚ å®‰è£…è½¯ä»¶åŒ… 123456789101112yum install httpd -y[root@localhost ~]# rpm -ql httpd | grep 'httpd\\.conf'/etc/httpd/conf/httpd.conf apacheæœåŠ¡çš„ä¸»é…ç½®æ–‡ä»¶[root@localhost ~]# grep -v '^#\\|^$\\|#' /etc/httpd/conf/httpd.confListen 80 ç›‘å¬ç«¯å£Include conf.d/*.conf è£…è½½é™„åŠ é…ç½®æ–‡ä»¶User apacheGroup apache è¿è¡Œç”¨æˆ·å’Œç»„DocumentRoot \"/var/www/html\" é»˜è®¤ä¸»ç›®å½•DirectoryIndex index.html index.html.var é»˜è®¤é¦–é¡µ åœ¨ä¸»ç›®å½•/var/www/htmlä¸‹åˆ›å»ºä¸€ä¸ªæµ‹è¯•é¡µ 123[root@localhost ~]# echo \"test page\" &gt; /var/www/html/index.html[root@localhost ~]# /etc/init.d/httpd startStarting httpd: [OK] ä½¿ç”¨æµè§ˆå™¨æµ‹è¯•è®¿é—®","categories":[{"name":"apache","slug":"apache","permalink":"https://www.xiemx.com/categories/apache/"}],"tags":[{"name":"apache","slug":"apache","permalink":"https://www.xiemx.com/tags/apache/"},{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"}],"author":"xiemx"},{"title":"Apacheçš„è®¿é—®æ§åˆ¶","slug":"apache-auth","date":"2016-01-17T02:01:04.000Z","updated":"2019-10-21T06:57:42.835Z","comments":true,"path":"/2016/01/17/apache-auth/","link":"","permalink":"https://www.xiemx.com/2016/01/17/apache-auth/","excerpt":"","text":"Apacheçš„è®¿é—®æ§åˆ¶ä¸¤ç§ï¼Œä¸€æ˜¯å®¢æˆ·ç«¯é™åˆ¶ï¼Œä¸€æ˜¯ç”¨æˆ·éªŒè¯æœºåˆ¶ã€‚ å®¢æˆ·ç«¯é™åˆ¶ï¼š1234&lt;Directory /some/dir&gt;order allow,denydeny from all&lt;/Directory &gt; è¿™å°±æ˜¯ä¸€ä¸ªç›®å½•é™åˆ¶ï¼Œä»–é™åˆ¶æ‰€æœ‰IPå¯¹è¿™ä¸ªç›®å½•çš„è®¿é—®ã€‚ ç”¨æˆ·éªŒè¯æœºåˆ¶ï¼š123456&lt;Directory /some/dir&gt;AuthType BasicAuthName \"My Auth File\"AuthUserFile /some/file/pathRequire valid-user&lt;/Directory &gt; è¿™å°±æ˜¯ä¸€ä¸ªç”¨æˆ·éªŒè¯æœºåˆ¶ï¼Œä»–è¦æ±‚ç”¨æˆ·ç»™å‡ºç”¨æˆ·åå’Œå¯†ç æ‰èƒ½è®¿é—®ç›®å½•ä¸‹çš„å†…å®¹ã€‚","categories":[{"name":"apache","slug":"apache","permalink":"https://www.xiemx.com/categories/apache/"}],"tags":[{"name":"apache","slug":"apache","permalink":"https://www.xiemx.com/tags/apache/"},{"name":"webserver","slug":"webserver","permalink":"https://www.xiemx.com/tags/webserver/"}],"author":"xiemx"},{"title":"PXEæ‰¹é‡åœ¨çº¿å®‰è£…æ“ä½œç³»ç»Ÿ","slug":"pxe-kickstart","date":"2016-01-16T23:01:10.000Z","updated":"2019-10-21T06:57:43.002Z","comments":true,"path":"/2016/01/17/pxe-kickstart/","link":"","permalink":"https://www.xiemx.com/2016/01/17/pxe-kickstart/","excerpt":"","text":"pxe é€šè¿‡ç½‘ç»œæ–¹å¼å®‰è£…éƒ¨ç½² dhcp:åŠ¨æ€ç®¡ç†åè®® ç½‘å¡æ”¯æŒtftp(æ–‡ä»¶ä¸‹è½½ä½¿ç”¨,ä¸æ”¯æŒéªŒè¯ï¼Œå®‰å…¨ç³»æ•°ä½,åªä¸‹è½½äº›åŸºç¡€æ–‡ä»¶ï¼‰ä½¿ç”¨httpä¸‹è½½ks.conf(åº”ç­”æ–‡ä»¶)/rpmåŒ… æµç¨‹123456å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯ç”³è¯·ä¸‹è½½ dhcp.client æœåŠ¡ç«¯è¿”å›ä¿¡æ¯å®¢æˆ·ç«¯ä¸‹è½½ï¼Œå¹¶åˆ†é…ç»™å®¢æˆ·ç«¯ipåœ°å€å®¢æˆ·ç«¯æ‹¿åˆ°ipåœ°å€åå»tftpæœåŠ¡ç«¯ä¸‹è½½pxelinux.0 å¹¶åœ¨å®¢æˆ·ç«¯å®‰è£…pxelinux.0(å¼•å¯¼å®‰è£…ç¨‹åºï¼‰å®¢æˆ·ç«¯å»ä¸‹è½½é…ç½®æ–‡ä»¶ pxelinux.cfg/default å®‰è£…åå‡ºç°å®‰è£…æ ‡ç­¾ æŒ‡å¼•å®‰è£…ï¼ˆä¾‹ install foution0)é€‰æ‹©å®‰è£…æ ‡ç­¾å åˆ°æœåŠ¡ç«¯ä¸‹è½½unlinuz(å¾®å‹è¿è¡Œå¹³å°ï¼‰ initrd(åŸºæœ¬çš„å‘½ä»¤ ç¨‹åºï¼‰ ksæ–‡ä»¶è·¯å¾„ï¼ˆè‡ªåŠ¨å®‰è£…ä½¿ç”¨ï¼‰ç„¶åå‡ºç°å®‰è£…ç•Œé¢ å¼€å§‹äº¤äº’å¼å®‰è£…å¦‚æœè‡ªåŠ¨å®‰è£…å»æ‰¾httpæœåŠ¡å™¨ï¼Œä¸‹è½½åº”ç­”ks.cfg,ä¸‹è½½rpmåŒ… è‡ªåŠ¨å®‰è£…åä¼šå†æ­¤è¿è¡Œks.cfgè„šæœ¬ åŸç†å›¾ï¼š1234567891011121314151617181920212223clientsï¼šdhcp client------------------------------&gt; dhcp server&lt;------------------------------åˆ†é…åœ°å€æ± ipï¼Œå‘ŠçŸ¥tftpçš„åœ°å€è¯·æ±‚pxelinux.0æ–‡ä»¶------------------------------&gt; tftp server&lt;------------------------------pxelinux.0å¼•å¯¼ç•Œé¢-------------------------------&gt; tftp server&lt;------------------------------pxelinux.cfg/defaultå®‰è£…ç•Œé¢-------------------------------&gt; tftp server&lt;-------------------------------vmlinuxz initrd ksæ–‡ä»¶è·¯å¾„-------------------------------&gt; http server&lt;------------------------------ks.cfg rpmåŒ…&lt;-------------------------------è‡ªåŠ¨æ‰§è¡Œè„šæœ¬å®‰è£…å®Œæˆ æ“ä½œæ­¥éª¤ä¾æ®ä»¥ä¸ŠåŸç†å›¾å¯ä»¥å¾—çŸ¥PXEè¿‡ç¨‹éœ€è¦ç”¨åˆ°çš„æ–‡ä»¶æœ‰pxelinux.oã€defaultã€ks.cfgã€vmlinuxzã€initrd.imgã€‚éœ€è¦ç”¨åˆ°çš„åè®®tftpã€dhcpã€httpã€‚ pxelinux.0 æ¥æºsyslinuxè½¯ä»¶åŒ…ks.cfg æ¥æºkickstartï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®‰è£…system-config-kickstartæ¥å›¾å½¢åŒ–é…ç½®vmlinuz æ¥æºäºisoé•œåƒæ–‡ä»¶default éœ€è¦æ‰‹å·¥é…ç½®initrd.img æ¥æºisoé•œåƒæ–‡ä»¶ 1.å®‰è£…è½¯ä»¶ 1yum install httpd dhcp tftp-server -y 2.é…ç½®dhcp 123456789101112131415161718[root@linux]# cat /etc/dhcpd.confddns-update-style interim;allow booting; #å®šä¹‰èƒ½å¤ŸPXEå¯åŠ¨allow bootp; #å®šä¹‰æ”¯æŒbootpnext-server 192.168.0.1; #TFTP Serverçš„IPåœ°å€filename \"pxelinux.0\"; #bootstrap æ–‡ä»¶(NBP)default-lease-time 1800;max-lease-time 7200;ping-check true;option domain-name-servers 192.168.0.1;subnet 192.168.0.0 netmask 255.255.255.0&#123;range 192.168.0.128 192.168.0.220;option routers 192.168.0.1;option broadcast-address 192.168.0.255;&#125; 3.å¯åŠ¨tftp 12345678910111213141516[root@linux]# cat /etc/xinetd.d/tftpservice tftp&#123;socket_type = dgramprotocol = udpwait = yesuser = rootserver = /usr/sbin/in.tftpdserver_args = -s /var/lib/tftpboot tftpæœåŠ¡æ ¹ç›®å½•disable = no æ˜¯å¦å…³é—­tftpæœåŠ¡per_source = 11cps = 100 2flags = IPv4&#125;é‡å¯xinetdæœåŠ¡ 4.è·å–pxelinux.0æ–‡ä»¶ 123[root@linux]# rpm -ql syslinux | grep \"pxelinux.0\"/usr/lib/syslinux/pxelinux.0[root@linux]# cp /usr/lib/syslinux/pxelinux.0 /var/lib/tftpboot/ 5.åˆ›å»º/var/lib/tftp/pxelinux.cfgç›®å½•ã€åˆ›å»ºdefaultæ–‡ä»¶ 123456789101112131415161718192021å°† boot.msg initrd.img splash.png vesamenu.c32 vmlinuz å¤åˆ¶åˆ°/var/lib/tftpboot/[root@linux]# cat /tftpboot/pxelinux.cfg/defaultdefault vesamenu.c32 æ˜¾ç¤ºå›¾å½¢åŒ–å¼•å¯¼ç•Œé¢ï¼Œä¹Ÿå¯ä»¥å†™æˆdefault linuxæ–‡æœ¬åŒ–ç•Œé¢timeout 60 ç­‰å¾…æ“ä½œæ—¶é—´display boot.msg æ˜¾ç¤ºä¸€äº›å¼•å¯¼ä¿¡æ¯menu background splash.jpg èƒŒæ™¯å›¾ç‰‡menu title Welcome to pxe Setup! ç•Œé¢æ ‡é¢˜label 1menu label Boot from ^local drive å®‰è£…1é€‰é¡¹æ ‡é¢˜menu default 60sæ— æ“ä½œé»˜è®¤å¯åŠ¨æ­¤é€‰é¡¹localboot 0xfffflabel 2menu label Install linuxipappend 2kernel vmlinuzappend initrd=initrd.img ks=http://172.25.16.9/ks.cfg 6.å°†isoæ–‡ä»¶å±•å¼€åˆ°httpç›®å½•ä¸‹ 7.ç”Ÿæˆks.cfgæ–‡ä»¶ system-config-kickstartå®‰è£…æ­¤å›¾å½¢åŒ–å·¥å…·ï¼Œç”Ÿæˆè‡ªåŠ¨åº”ç­”è„šæœ¬ã€‚ä¹Ÿå¯ä»¥æ‹·è´å·²å®‰è£…ç³»ç»Ÿä¸­è‡ªåŠ¨ç”Ÿæˆçš„è„šæœ¬ã€‚ 8.å…³é—­é˜²ç«å¢™ï¼Œselinuxã€‚æµ‹è¯•httpã€tftpç­‰æœåŠ¡éƒ½æ­£å¸¸å¯åŠ¨ä¸”æ–‡ä»¶éƒ½å·²æ”¾ç½®å¯æ­£å¸¸è®¿é—®ä¸‹è½½ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"pxe","slug":"pxe","permalink":"https://www.xiemx.com/tags/pxe/"},{"name":"kickstart","slug":"kickstart","permalink":"https://www.xiemx.com/tags/kickstart/"}],"author":"xiemx"},{"title":"DNSæœåŠ¡å™¨æ­å»º","slug":"dns-server","date":"2015-11-30T02:11:12.000Z","updated":"2019-10-21T06:57:42.819Z","comments":true,"path":"/2015/11/30/dns-server/","link":"","permalink":"https://www.xiemx.com/2015/11/30/dns-server/","excerpt":"","text":"DNSå³åŸŸåç³»ç»Ÿï¼Œç”¨äºå°†IPåœ°å€å’ŒåŸŸåä¹‹é—´çš„ç¿»è¯‘ã€‚linuxä¸­æ­å»ºdnsæœåŠ¡å™¨ä¸€èˆ¬ä½¿ç”¨BINDè½¯ä»¶æ¥å®ç°ã€‚æˆ‘ä»¬åœ¨ç½‘ç»œä¸­å¸¸å¸¸ä¼šæœ‰å°†åŸŸåè½¬åŒ–æˆIPï¼Œå’Œå°†IPè½¬åŒ–æˆåŸŸåè¿™ä¸¤ç§éœ€æ±‚ï¼Œè¿™ä¸¤ç§éœ€æ±‚å¯¹åº”äº†dnsè§£æä¸­çš„æ­£å‘å’Œåå‘è§£æã€‚ æ­£å‘è§£æï¼šå°†åŸŸåè§£ææˆIPåœ°å€ åå‘è§£æï¼šå°†ipåœ°å€è§£ææˆåŸŸå å®Œå…¨åˆæ ¼åŸŸåï¼ˆFQDNï¼‰ï¼šç‚¹ç»“å°¾çš„åŸŸåï¼Œä¾‹å¦‚â€www.xiemx.com.&quot; å°±æ˜¯ä¸€ä¸ªå®Œå…¨åˆæ ¼åŸŸåã€‚åœ¨ä¸€èˆ¬çš„ç½‘ç»œåº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥å®Œå…¨åˆæ ¼åŸŸåæœ€å³ä¾§çš„ç‚¹ï¼Œä½†DNSå¯¹è¿™ä¸ªç‚¹ä¸èƒ½éšä¾¿çœç•¥ã€‚å› ä¸ºè¿™ä¸ªç‚¹ä»£è¡¨äº†DNSçš„æ ¹ï¼Œæœ‰äº†è¿™ä¸ªç‚¹ï¼Œå®Œå…¨åˆæ ¼åŸŸåå°±å¯ä»¥è¡¨è¾¾ä¸ºä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚â€www.xiemx.com.&quot;å°±å¯ä»¥è¡¨ç¤ºä¸ºDNSæ ¹ä¸‹çš„comå­åŸŸä¸‹xiemx.comåŸŸä¸­ä¸€ä¸ªåä¸ºwwwçš„ä¸»æœºã€‚å¦‚æœDNSå‘ç°ä¸€ä¸ªåŸŸåä¸æ˜¯ä»¥ç‚¹ç»“å°¾çš„å®Œå…¨åˆæ ¼åŸŸåï¼Œå°±ä¼šæŠŠè¿™ä¸ªåŸŸååŠ ä¸Šå½“å‰çš„åŒºåŸŸåç§°ä½œä¸ºåç¼€ï¼Œè®©å…¶æ»¡è¶³å®Œå…¨åˆæ ¼åŸŸåçš„å½¢å¼éœ€æ±‚ã€‚ æŸ¥è¯¢æ–¹æ³• é€’å½’æŸ¥è¯¢:ä¸€èˆ¬å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´å±é€’å½’æŸ¥è¯¢ï¼Œå³å½“å®¢æˆ·æœºå‘DNSæœåŠ¡å™¨å‘å‡ºè¯·æ±‚å,è‹¥DNSæœåŠ¡å™¨æœ¬èº«ä¸èƒ½è§£æ,åˆ™ä¼šå‘å¦å¤–çš„DNSæœåŠ¡å™¨å‘å‡ºæŸ¥è¯¢è¯·æ±‚ï¼Œå¾—åˆ°ç»“æœåè½¬äº¤ç»™å®¢æˆ·æœºï¼› è¿­ä»£æŸ¥è¯¢(åå¤æŸ¥è¯¢):ä¸€èˆ¬DNSæœåŠ¡å™¨ä¹‹é—´å±è¿­ä»£æŸ¥è¯¢ï¼Œå¦‚ï¼šè‹¥DNS2ä¸èƒ½å“åº”DNS1çš„è¯·æ±‚ï¼Œåˆ™å®ƒä¼šå°†DNS3çš„IPç»™DNS1ï¼Œä»¥ä¾¿å…¶å†å‘DNS3å‘å‡ºè¯·æ±‚ï¼›DNS3ä¸èƒ½å“åº”DNS1çš„è¯·æ±‚ï¼Œåˆ™å®ƒä¼šå°†DNS4çš„IPç»™DNS1ã€‚å¦‚æ­¤åå¤ã€‚ è®°å½•ç±»å‹ Aè®°å½•ï¼šåŸŸååˆ°IPåœ°å€çš„æ˜ å°„ã€‚ CNAMEè®°å½•ï¼šä¹Ÿå«åˆ«åè®°å½•ï¼Œç”¨äºå®šä¹‰Aè®°å½•çš„åˆ«å MXè®°å½•ï¼šé‚®ä»¶äº¤æ¢è®°å½•ï¼ˆMXï¼‰é‚®ä»¶æœåŠ¡å™¨å‘é€é‚®ä»¶æ—¶å®šä½é‚®ä»¶æœåŠ¡å™¨ï¼Œå¯ä»¥æœ‰å¤šä¸ªMXè®°å½•ï¼Œä½†å­˜åœ¨ä¼˜å…ˆçº§å·®åˆ« NSè®°å½•ï¼šç”¨äºæ ‡è¯†åŒºåŸŸçš„DNSæœåŠ¡å™¨ï¼Œå³æ˜¯è¯´è´Ÿè´£æ­¤DNSåŒºåŸŸçš„æƒå¨åç§°æœåŠ¡å™¨ï¼Œç”¨å“ªä¸€å°DNSæœåŠ¡å™¨æ¥è§£æè¯¥åŒºåŸŸã€‚ PTRè®°å½•ï¼šæ˜¯IPåœ°å€åˆ°DNSåç§°çš„æ˜ å°„ï¼Œç”¨äºåå‘è§£æ å®‰è£…è½¯ä»¶ï¼š 1234567891011121314yum -y install bindæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯è½¯ä»¶ç‰ˆæœ¬æ˜¯9.8.2ï¼Œä¸åŒçš„ç‰ˆæœ¬é…ç½®çš„è¯­æ³•ä¼šæœ‰åŒºåˆ«ã€‚[root@localhost ~]# yum info bindLoaded plugins: product-id, refresh-packagekit, security, subscription-managerThis system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.localyumdata | 3.9 kB 00:00 ...Installed PackagesName : bindArch : x86_64Epoch : 32Version : 9.8.2Release : 0.17.rc1.el6_4.6 é…ç½®æ–‡ä»¶ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041/var/run/named/ â€”â€”è¿›ç¨‹pidæ–‡ä»¶/var/named/ â€”â€”æ•°æ®æ–‡ä»¶ç›®å½•/etc/named.conf â€”â€”ä¸»é…ç½®æ–‡ä»¶/etc/named.rfc1912.zones â€”â€”è¾…é…ç½®æ–‡ä»¶/etc/rc.d/init.d/named â€”â€”è¿›ç¨‹æ§åˆ¶è„šæœ¬æ–‡ä»¶[root@localhost ~]# cat /etc/named.confoptions &#123; listen-on port 53 &#123; any; &#125;;â€”â€”è®¾ç½®ç›‘å¬é‚£äº›ipv4åœ°å€çš„53ç«¯å£ï¼Œé»˜è®¤ä¸º127.0.0.1ã€‚è®¾ç½®anyå…è®¸æ‰€æœ‰ï¼Œä¹Ÿå¯ä»¥ï¼›å·é—´éš”ä¸€ä¸ªä¸ªç½—åˆ—IPã€‚ listen-on-v6 port 53 &#123; any; &#125;;â€”â€”ipv6 directory \"/var/named\";â€”â€”æ•°æ®ç›®å½• dump-file \"/var/named/data/cache_dump.db\"; statistics-file \"/var/named/data/named_stats.txt\"; memstatistics-file \"/var/named/data/named_mem_stats.txt\"; allow-query &#123; any; &#125;;â€”â€”å…è®¸å“ªäº›IPæ¥æŸ¥è¯¢ï¼Œé»˜è®¤ä¸ºlocalhostã€‚anyä¸ºå…è®¸æ‰€æœ‰ recursion yes;â€”â€”æ˜¯å¦å…è®¸é€’å½’ dnssec-enable yes; â€”â€”æ˜¯å¦å¯ç”¨DNSSECæ”¯æŒï¼ŒDNSå®‰å…¨æ‰©å±•ï¼ˆDNSSECï¼‰æä¾›äº†éªŒè¯DNSæ•°æ®ç”±æ•ˆæ€§çš„ç³»ç»Ÿ dnssec-validation yes; dnssec-lookaside auto; /* Path to ISC DLV key */ bindkeys-file \"/etc/named.iscdlv.key\"; managed-keys-directory \"/var/named/dynamic\";&#125;;logging &#123; channel default_debug &#123; file \"data/named.run\"; severity dynamic; &#125;;&#125;;zone \".\" IN &#123; type hint; file \"named.ca\";&#125;; â€”â€”å®šä¹‰æ ¹åŸŸæœåŠ¡å™¨include \"/etc/named.rfc1912.zones\"; â€”â€”è£…è½½è¾…é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬å°†éœ€è¦è§£æçš„åŸŸåé…ç½®å†™åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚include \"/etc/named.root.key\"; 123456789101112131415[root@localhost ~]# cat /etc/named.rfc1912.zoneszone \"xiemx.com\" IN &#123; â€”â€”\" \"å†…å†™è¦è§£æçš„åŸŸå type master; â€”â€”è®¾ç½®ç±»å‹ä¸ºmasterä¸»ç±»å‹ï¼Œè¿˜æœ‰å…¶å®ƒçš„hintæ ¹ç±»å‹ã€slaveä»ç±»å‹ã€‚å½“2å°dnsåšä¸»è¾…åŒæ­¥æ—¶ä¼šè®¾ç½®è¾…DNSä¸­çš„åŸŸç±»å‹ä¸ºslaveã€‚ file \"xiemx.com.zone\"; â€”â€”xiemx.comåŸŸçš„æ•°æ®æ–‡ä»¶ï¼Œé»˜è®¤åœ¨/var/named/ä¸­ï¼Œç¼ºçœç›®å½•å®šä¹‰åœ¨ä¸»é…ç½®ä¸­directoryè¡Œã€‚ allow-update &#123; none; &#125;;&#125;; â€”â€” xiemx.comåŸŸåçš„æ­£å‘è§£æé…ç½®zone \"1.168.192.in-addr.arpa\" IN &#123; â€”â€”\"\"å†…çš„IPåå‘å†™è¦è§£æçš„ipç½‘æ®µ.in-addr-arpa,æœ¬æ¡å°±æ˜¯è§£æ192.168.1è¿™ä¸ªç½‘æ®µ type master; file \"192.168.1.zone\"; allow-update &#123; none; &#125;;&#125;; â€”â€”192.168.1è¿™ä¸ªç½‘æ®µçš„åå‘è§£æé…ç½® ä»¥ä¸Šçš„named.rfc1912.zoneså†…å®¹åªæ˜¯èŠ‚é€‰äº†éƒ¨åˆ†ï¼Œå¦‚æˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ å®¹æ˜“å‡ºç°è¯­æ³•é”™è¯¯æ—¶ï¼Œå¯ä»¥å¤åˆ¶æ–‡ä»¶ä¸­åŸæœ‰çš„localhoståŒºåŸŸä¿¡æ¯ï¼Œç›´æ¥ä¿®æ”¹å³å¯ã€‚ 12345678910111213141516[root@localhost ~]# cat /var/named/xiemx.com.zone$TTL 1D â€”â€”TTLæ¡ç›®æ›´æ–°æ—¶é—´é»˜è®¤1Dï¼Œå½“æ—¶é—´å°æ—¶è§£æç²¾åº¦é«˜ï¼Œæ—¶é—´å¤ªå¤§ä¼šå¯¼è‡´æ›´æ”¹è§£æè®°å½•åç”Ÿæ•ˆæ—¶é—´å¤ªé•¿ï¼ŒTTLå¤ªå°çš„è¯é¢‘ç¹æ›´æ–°ä¹Ÿä¼šå½±å“åŸŸåè®¿é—®é€Ÿåº¦ã€‚@ IN SOA @ rname.invalid. (0 ; serial â€”â€”æ—¶é—´æ ‡è¯†ï¼Œä¸€èˆ¬éƒ½æ˜¯å†™å½“å‰çš„æ—¥æœŸï¼Œç”±äºä¸»è¾…åŒæ­¥æ—¶ç¡®å®šæ¡ç›®æ˜¯ä¸æ˜¯æ–°çš„1D ; refreshâ€”â€”slaveå¤šé•¿æ—¶é—´æ›´æ–°ä¸€æ¬¡1H ; retryâ€”â€”slaveåŒæ­¥å¤±è´¥æ—¶é—´éš”å¤šé•¿æ—¶é—´å†æ¬¡å°è¯•1W ; expireâ€”â€”å½“ä¸»è¾…ä¸èƒ½åŒæ­¥æ—¶ï¼Œ1å‘¨ä¹‹åè®¤ä¸ºå…¶æ­»äº¡ï¼Œä¸å†å°è¯•åŒæ­¥3H ) ; minimumâ€”â€”æ¡ç›®ç¼“å­˜æ—¶é—´ï¼Œä¸€èˆ¬ä¸ºé”™è¯¯çš„è®°å½•ä¿å­˜æ­¤æ—¶é—´ã€‚å½“ä¸€ä¸ªä¸»æœºè¯·æ±‚è§£æä¸€æ¡é”™è¯¯çš„æ¡ç›®æ—¶ï¼Œ3å°æ—¶åæ‰èƒ½å†æ¬¡è¯·æ±‚æŸ¥è¯¢NS @A 192.168.1.10www A 192.168.1.100MX 5 mail â€”â€”MXè®°å½•åæ¥5ä¸ºä¼˜å…ˆçº§ï¼Œmxè®°å½•æœ‰ä¼˜å…ˆçº§å±æ€§éœ€è¦å®šä¹‰mail A 192.168.1.101ftp CNAME ftp1 ftp1 A 192.168.1.103 $generate 150-200 test$ A 192.168.1.$ â€”â€”ç”¨å˜é‡å®šä¹‰ä¸€ä¸ªè¿ç»­èŒƒå›´çš„è§£æä¸€ä¸€å¯¹åº”åˆ«åå’ŒIP ã€‚ä¾‹ï¼štest150.xiemx.com&lt;â€”â€”&gt;192.168.1.150 1234567891011121314151617181920[root@localhost ~]# cat /var/named/192.168.1.zone$TTL 1D@ IN SOA @ rname.invalid. (0 ; serial1D ; refresh1H ; retry1W ; expire3H ) ; minimumNS xiemx.com.101 PTR www.xiemx.com.102 PTR mail.xiemx.com.103 PTR ftp.xiemx.com.103 PTR xxx.xiemx.com.ä»¥ä¸Šçš„æ­£åè§£åªæ˜¯æµ‹è¯•æ—¶éšä¾¿å†™çš„ï¼Œä¸€èˆ¬æ­£åè§£ä¼šç›¸äº’å¯¹åº”ã€‚å¦å¤–åœ¨å†™æ¡ç›®æ˜¯è¦æ³¨æ„ï¼š1.mxè®°å½•ã€cnameè®°å½•çš„å€¼ä¸€èˆ¬éƒ½ä¼šæœ‰å¯¹åº”Aè®°å½•2.æ­£åè§£ä¸­çš„@ä¼šç»§æ‰¿é…ç½®æ–‡ä»¶ä¸­\" \"å†…çš„å†…å®¹3.æ­£åè§£æ—¶å¦‚æœå†™çš„åŸŸåä¸æ˜¯å®Œå…¨åˆæ ¼åŸŸåï¼Œdnsä¼šè‡ªåŠ¨ç”¨ç»§æ‰¿çš„@æ¥è¡¥å…¨ä½ çš„åŸŸåï¼šå¦‚æ­£è§£ä¸­çš„wwwï¼Œdnsä¼šè‡ªåŠ¨è¡¥å…¨ä¸ºwww.xiemx.com.ã€‚4.åŒä¸€ä¸ªIPå¯å¯¹åº”å¤šä¸ªåŸŸåï¼ˆPTRè®°å½•å¯ä»¥å­˜åœ¨å¤šæ¡ï¼‰ï¼Œä¸€ä¸ªåŸŸååªèƒ½æœ‰1æ¡Aè®°å½•ï¼ˆä¸€ä¸ªåŸŸååªèƒ½å¯¹åº”ä¸€ä¸ªIPï¼‰ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647æµ‹è¯•ï¼š[root@localhost ~]# nslookup&gt; server 192.168.17.6Default server: 192.168.17.6Address: 192.168.17.6#53&gt; xiemx.comServer: 192.168.17.6Address: 192.168.17.6#53Name: xiemx.comAddress: 127.0.0.1&gt; www.xiemx.comServer: 192.168.17.6Address: 192.168.17.6#53Name: www.xiemx.comAddress: 192.168.1.100&gt; mail.xiemx.comServer: 192.168.17.6Address: 192.168.17.6#53Name: mail.xiemx.comAddress: 192.168.1.101&gt; ftp.xiemx.comServer: 192.168.17.6Address: 192.168.17.6#53ftp.xiemx.com canonical name = ftp1.xiemx.com.Name: xxx.xiemx.comAddress: 192.168.1.103&gt; test88.xiemx.comServer: 192.168.17.6Address: 192.168.17.6#53Name: test88.xiemx.comAddress: 192.168.1.88&gt; 192.168.1.181Server: 192.168.17.6Address: 192.168.17.6#53181.1.168.192.in-addr.arpa name = test181.xiemx.com.","categories":[{"name":"dns","slug":"dns","permalink":"https://www.xiemx.com/categories/dns/"}],"tags":[{"name":"dns","slug":"dns","permalink":"https://www.xiemx.com/tags/dns/"}],"author":"xiemx"},{"title":"NTPæœåŠ¡å™¨æ­å»º","slug":"ntp-server","date":"2015-11-29T00:11:58.000Z","updated":"2019-10-21T06:57:42.386Z","comments":true,"path":"/2015/11/29/ntp-server/","link":"","permalink":"https://www.xiemx.com/2015/11/29/ntp-server/","excerpt":"","text":"NTPå³ç½‘ç»œæ—¶é—´åè®®ï¼Œç”¨æ¥åŒæ­¥è®¡ç®—æœºæ—¶é—´ï¼Œæé«˜æ—¶é—´çš„ç²¾ç¡®åº¦ã€‚ ç¯å¢ƒï¼šRHEL6.5 å®‰è£…åŒ…ï¼šntp-4.2.6p5-1.el6.x86_64 å®‰è£…æ–¹å¼ï¼š 1yum install ntp ntpä¸»é…ç½®æ–‡ä»¶ä¸­å¹¶æ— å¤ªå¤šé…ç½®ï¼Œæœ‰æ•ˆçš„é…ç½®é»˜è®¤å¦‚ä¸‹ 123456789101112[root@localhost html]# egrep -v \"^$|^#\" /etc/ntp.confdriftfile /var/lib/ntp/driftrestrict default kod nomodify notrap nopeer noqueryâ€”â€”æ‹’ç»ipv4æŸ¥è¯¢restrict -6 default kod nomodify notrap nopeer noqueryâ€”â€”æ‹’ç»ipv6æŸ¥è¯¢restrict 127.0.0.1â€”â€”å…è®¸æœ¬æœºæŸ¥è¯¢restrict -6 ::1â€”â€”å…è®¸æœ¬æœºæŸ¥è¯¢server 0.rhel.pool.ntp.org iburstâ€”â€”serveræŒ‡å®šæˆ‘ä»¬å»å“ªé‡ŒåŒæ­¥server 1.rhel.pool.ntp.org iburstserver 2.rhel.pool.ntp.org iburstserver 3.rhel.pool.ntp.org iburstincludefile /etc/ntp/crypto/pwkeys /etc/ntp/keys æˆ‘ä»¬ä½œä¸ºæœåŠ¡å™¨ç«¯éœ€è¦æˆæƒå…¶ä»–ç”¨æˆ·è¿‡æ¥åŒæ­¥æ—¶é—´ï¼Œéœ€è¦åœ¨é…ç½®è¡Œä¸­æ·»åŠ  123restrict 192.168.10.10 mask 255.255.255.0 nomodify â€”â€”å…è®¸192.168.10.10/24è¿™å°æœºå™¨è¿‡æ¥åŒæ­¥restrict 192.168.10.0 mask 255.255.255.0 nomodify â€”â€”å…è®¸192.168.10.0/24è¿™ä¸ªç½‘æ®µçš„æœºå™¨è¿‡æ¥åŒæ­¥server 210.72.145.44 â€”â€”æˆ‘ä»¬å»è¿™å°æœºå™¨ä¸ŠåŒæ­¥æ—¶é—´ ä»¥ä¸Šè®¾ç½®è®¾ç½®å¥½åæˆ‘ä»¬å³å¯é€šè¿‡ntpdateå»åŒæ­¥æ—¶é—´ 1ntpdate 210.72.145.44 å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥é€šè¿‡ntpdateå‘æˆ‘ä»¬è¯·æ±‚æ•°æ®ï¼ŒntpæœåŠ¡å™¨æ­å»ºå¥½åå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è®¡åˆ’ä»»åŠ¡å›ºå®šæ—¶é—´æ¥å‘æˆ‘ä»¬è¯·æ±‚æ—¶é—´ã€‚ntpé…ç½®ç®€å•ï¼Œä½†è¦æ³¨æ„é˜²ç«å¢™çš„é™åˆ¶ã€‚ å¸¸ç”¨ntpæœåŠ¡å™¨ï¼š12345678910210.72.145.44 (å›½å®¶æˆæ—¶ä¸­å¿ƒæœåŠ¡å™¨IPåœ°å€)ntp.sjtu.edu.cn 202.120.2.101 (ä¸Šæµ·äº¤é€šå¤§å­¦ç½‘ç»œä¸­å¿ƒNTPæœåŠ¡å™¨åœ°å€ï¼‰s1b.time.edu.cn æ¸…åå¤§å­¦s1c.time.edu.cn åŒ—äº¬å¤§å­¦s1d.time.edu.cn ä¸œå—å¤§å­¦s1e.time.edu.cn æ¸…åå¤§å­¦s2d.time.edu.cn è¥¿å—åœ°åŒºç½‘ç»œä¸­å¿ƒs2e.time.edu.cn è¥¿åŒ—åœ°åŒºç½‘ç»œä¸­å¿ƒs2f.time.edu.cn ä¸œåŒ—åœ°åŒºç½‘ç»œä¸­å¿ƒs2g.time.edu.cn åä¸œå—åœ°åŒºç½‘ç»œä¸­å¿ƒ","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"ntp","slug":"ntp","permalink":"https://www.xiemx.com/tags/ntp/"}],"author":"xiemx"},{"title":"linuxç£ç›˜é…é¢","slug":"linux-disk-quota","date":"2015-11-28T20:11:32.000Z","updated":"2019-10-21T06:57:43.047Z","comments":true,"path":"/2015/11/29/linux-disk-quota/","link":"","permalink":"https://www.xiemx.com/2015/11/29/linux-disk-quota/","excerpt":"","text":"å†å¤šç”¨æˆ·çš„æ¨¡å¼ä¸‹ï¼Œlinuxä¸­å¸¸å¸¸éœ€è¦å¯¹ç”¨æˆ·è¿›è¡Œç£ç›˜ç©ºé—´é™åˆ¶ï¼Œä¾‹å¦‚è™šæ‹Ÿä¸»æœºéœ€è¦é™åˆ¶ç”¨æˆ·çš„ç©ºé—´ã€‚linuxå¤§å¤šæ•°çš„å‘è¡Œç‰ˆéƒ½é‡‡ç”¨quotaæ¥å¯¹ç£ç›˜é…é¢æ¥è¿›è¡Œç®¡ç†ï¼Œquotaæ˜¯ç³»ç»Ÿå†…æ ¸ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œè¦ä½¿ç”¨quotaéœ€è¦ç³»ç»Ÿå†…æ ¸æ”¯æŒquotaåŠŸèƒ½ã€‚ç›®å‰ä½¿ç”¨çš„å‘è¡Œæœ¬ä¸­éƒ½æ˜¯æ”¯æŒæ¬¡åŠŸèƒ½çš„ï¼Œå¦‚æœå†…æ ¸ä¸æ”¯æŒæ­¤åŠŸèƒ½é‚£ä¹ˆå°±éœ€è¦é‡æ–°ç¼–è¯‘ä¸‹å†…æ ¸æ¥å¼€å¯æ­¤åŠŸèƒ½ 12345678### grep CONFIG_QUOTA /boot/config-`uname -r` æ¥æ£€æŸ¥ä¸‹å†…æ ¸æ˜¯å¦æ”¯æŒ[root@localhost mnt]# grep CONFIG_QUOTA /boot/config-2.6.32-431.el6.x86_64CONFIG_QUOTA=yCONFIG_QUOTA_NETLINK_INTERFACE=y# CONFIG_QUOTA_DEBUG is not setCONFIG_QUOTA_TREE=yCONFIG_QUOTACTL=y å¦‚æœ‰ä»¥ä¸Šä¸¤æ¡åˆ™è¯´æ˜æ”¯æŒï¼Œå¦å¤–quotaæ˜¯é’ˆå¯¹ç”¨æˆ·å»é™åˆ¶å…¶å¯ä½¿ç”¨çš„blockå’Œinodeï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ä¸€ä¸ªåŸºäºæ–‡ä»¶ç³»ç»Ÿçš„é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­å¼€å¯quotaåŠŸèƒ½ï¼Œé’ˆå¯¹å·²ç»æŒ‚è½½è¿‡çš„æ–‡ä»¶ç³»ç»Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨mount -o remount,usrquota,grpquota,default /mntæ¥é‡æ–°æŒ‚è½½æ¿€æ´»ï¼ˆmntåªæ˜¯ä¸ªä¸¾ä¾‹ï¼Œå®é™…ä¸­å…ˆdf å‘½ä»¤æŸ¥çœ‹å½“å‰æŒ‚è½½ä¿¡æ¯ï¼Œåœ¨é€‰æ‹©è¦å¼€å¯çš„æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œä¹Ÿå¯ä»¥å†™åœ¨/etc/fstabæ–‡ä»¶ä¸­umount åå†mount -a æˆ–é‡å¯ç³»ç»Ÿ 12345678910111213141516171819202122[root@localhost mnt]# mount/dev/mapper/VolGroup-lv_root on / type ext4 (rw)proc on /proc type proc (rw)sysfs on /sys type sysfs (rw)devpts on /dev/pts type devpts (rw,gid=5,mode=620)tmpfs on /dev/shm type tmpfs (rw,rootcontext=\"system_u:object_r:tmpfs_t:s0\")/dev/sda1 on /boot type ext4 (rw)none on /proc/sys/fs/binfmt_misc type binfmt_misc (rw)/dev/mapper/vgxiemx-lv1 on /mnt type ext3 (rw)[root@localhost mnt]# mount -o remount,grpquota,usrquota,defaults /mnt[root@localhost mnt]# mount/dev/mapper/VolGroup-lv_root on / type ext4 (rw)proc on /proc type proc (rw)sysfs on /sys type sysfs (rw)devpts on /dev/pts type devpts (rw,gid=5,mode=620)tmpfs on /dev/shm type tmpfs (rw,rootcontext=\"system_u:object_r:tmpfs_t:s0\")/dev/sda1 on /boot type ext4 (rw)none on /proc/sys/fs/binfmt_misc type binfmt_misc (rw)/dev/mapper/vgxiemx-lv1 on /mnt type ext3 (rw,usrquota,grpquota)[root@localhost mnt]# æ­¤æ—¶å·²å¼€å¯/mntå¯¹åº”çš„æ–‡ä»¶ç³»ç»Ÿçš„quotaåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯é’ˆå¯¹/mntç›®å½•ä¸‹è¿›è¡Œç”¨æˆ·é…é¢é™åˆ¶ æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿçš„quotaä¿¡æ¯ï¼Œç”Ÿæˆquotaæ•°æ®åº“ï¼Œä¼šåœ¨æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•ä¸‹ç”Ÿæˆquota.userå’Œquota.groupäºŒä¸ªdataç±»å‹çš„æ–‡ä»¶å¯ç”¨fileå‘½ä»¤æŸ¥çœ‹ 123456[root@localhost mnt]# quotacheck -avugquotacheck: Your kernel probably supports journaled quota but you are not using it. Consider switching to journaled quota to avoid running quotacheck after an unclean shutdown.quotacheck: Scanning /dev/mapper/vgxiemx-lv1 [/mnt] donequotacheck: Checked 3 directories and 6 files[root@localhost mnt]# lsaquota.group aquota.user lost+found å¯åŠ¨quotaquotaon -av â€”aé€‰é¡¹å¯åŠ¨æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå¯æŒ‡å®šå…·ä½“æŸä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚å…³é—­quotaoffå‘½ä»¤ï¼Œå‚æ•°ç›¸åŒã€‚ 123[root@localhost /]# quotaon -av/dev/mapper/vgxiemx-lv1 [/mnt]: group quotas turned on/dev/mapper/vgxiemx-lv1 [/mnt]: user quotas turned on ç¼–è¾‘ç”¨æˆ·çš„quotaä¿¡æ¯edquota -u testuserâ€”â€”ä¼šæ‰“å¼€ä¸€ä¸ªviç•Œé¢ 123456789Disk quotas for user testuser (uid 500):Filesystem blocks soft hard inodes soft hard/dev/mapper/vgxiemx-lv1 0 10 100 0 10 100filesystemï¼šç›®æ ‡æ–‡ä»¶ç³»ç»Ÿblockï¼šç°åœ¨å·²ä½¿ç”¨çš„blockæ•°é‡inodeï¼šç°åœ¨å·²ä½¿ç”¨çš„inodeæ•°é‡softï¼šè½¯é™åˆ¶ï¼Œå¯ä½¿ç”¨çš„softæ•°é‡ï¼Œ0ä¸ºä¸é™åˆ¶ï¼Œå…·ä½“æ•°å€¼è®¾å®šåè¶…è¿‡æ•°å€¼è¿›è¡Œè­¦å‘Šï¼Œä½†ä¾æ—§å¯ä»¥å†™å…¥ï¼ŒçŸ¥é“å®½é™æ—¶é—´åˆ°è¾¾åæ— æ³•å†™å…¥é»˜è®¤å®½é™7å¤©hardï¼šç¡¬é™åˆ¶ï¼Œå¯ä½¿ç”¨block/inodeæ•°é‡ï¼Œ0ä¸ºä¸é™åˆ¶ï¼Œå…·ä½“æ•°å€¼è®¾å®šåè¶…è¿‡æ•°å€¼ï¼Œç«‹å³æ— æ³•å†™å…¥ã€‚ ä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859[testuser@localhost mnt]$ dd if=/dev/zero of=/mnt/bigfile bs=1M count=20 â€”â€”ç”Ÿæˆä¸€ä¸ª20Mçš„æ–‡ä»¶ï¼ŒæŸ¥è¿‡soft blocké™åˆ¶dm-2: warning, user block quota exceeded.1+0 records in0+0 records out98304 bytes (98 kB) copied, 0.00147599 s, 66.6 MB/s[testuser@localhost mnt]$ du bigfile â€”â€”ç»Ÿè®¡æ–‡ä»¶å¤§å°20M20 bigfile[testuser@localhost mnt]$ dd if=/dev/zero of=/mnt/bigfile bs=1M count=110â€”â€”ç”Ÿæˆä¸€ä¸ª110Mçš„æ–‡ä»¶ï¼Œè¶…è¿‡hard blocké™åˆ¶ï¼Œæœ€å10Mæ•°æ®æ— æ³•å†™å…¥dm-2: warning, user block quota exceeded.dm-2: write failed, user block limit reached.dd: writing `/mnt/bigfile': Disk quota exceeded1+0 records in0+0 records out98304 bytes (98 kB) copied, 0.000795784 s, 124 MB/s[testuser@localhost mnt]$ du bigfileâ€”â€”ç»Ÿè®¡æ–‡ä»¶å¤§å°ä¸º100M100 bigfile[testuser@localhost mnt]$ lltotal 132-rw-------. 1 root root 7168 Nov 22 04:01 aquota.group-rw-------. 1 root root 7168 Nov 22 03:58 aquota.user-rw-rw-r--. 1 testuser testuser 98304 Nov 22 04:02 bigfiledrwxrwxrwx. 2 root root 16384 Nov 22 02:31 lost+found[testuser@localhost mnt]$ touch file&#123;1..10&#125;â€”â€”åˆ›å»º10ä¸ªæ–‡ä»¶ï¼Œæ­¤æ—¶å·²æœ‰1ä¸ªbigfileï¼Œæ€»å…±11ä¸ªæ–‡ä»¶è¶…è¿‡soft inodeé™åˆ¶dm-2: warning, user file quota exceeded.[testuser@localhost mnt]$ lsaquota.group bigfile file10 file3 file5 file7 file9aquota.user file1 file2 file4 file6 file8 lost+found[testuser@localhost mnt]$ touch test&#123;1..100&#125;â€”â€”åˆ›å»º100ä¸ªæ–‡ä»¶ï¼Œæ­¤æ—¶å·²æœ‰11ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥æœ€åçš„11ä¸ªæ–‡ä»¶åº”è¯¥åˆ›å»ºä¸æˆåŠŸdm-2: write failed, user file limit reached.touch: cannot touch `test90': Disk quota exceededtouch: cannot touch `test91': Disk quota exceededtouch: cannot touch `test92': Disk quota exceededtouch: cannot touch `test93': Disk quota exceededtouch: cannot touch `test94': Disk quota exceededtouch: cannot touch `test95': Disk quota exceededtouch: cannot touch `test96': Disk quota exceededtouch: cannot touch `test97': Disk quota exceededtouch: cannot touch `test98': Disk quota exceededtouch: cannot touch `test99': Disk quota exceededtouch: cannot touch `test100': Disk quota exceeded[testuser@localhost mnt]$ lsaquota.group file7 test15 test24 test33 test42 test51 test60 test7 test79 test88aquota.user file8 test16 test25 test34 test43 test52 test61 test70 test8 test89bigfile file9 test17 test26 test35 test44 test53 test62 test71 test80 test9file1 lost+found test18 test27 test36 test45 test54 test63 test72 test81file10 test1 test19 test28 test37 test46 test55 test64 test73 test82file2 test10 test2 test29 test38 test47 test56 test65 test74 test83file3 test11 test20 test3 test39 test48 test57 test66 test75 test84file4 test12 test21 test30 test4 test49 test58 test67 test76 test85file5 test13 test22 test31 test40 test5 test59 test68 test77 test86file6 test14 test23 test32 test41 test50 test6 test69 test78 test87 4.è®¾ç½®å®½é™æ—¶é—´ 12345edquota -t â€”â€”é»˜è®¤7å¤©Grace period before enforcing soft limits for users:Time units may be: days, hours, minutes, or secondsFilesystem Block grace period Inode grace period/dev/mapper/vgxiemx-lv1 7days 7days 5.æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·çš„ç£ç›˜é…é¢æƒ…å†µï¼Œç”¨æˆ·ä¹Ÿå¯ç”¨quotaæŸ¥è¯¢å½“å‰ç”¨æˆ·çš„quotaä¿¡æ¯ 12345678910repquota -a[root@localhost mnt]# repquota -a*** Report for user quotas on device /dev/mapper/vgxiemx-lv1Block grace time: 7days; Inode grace time: 7daysBlock limits File limitsUser used soft hard grace used soft hard grace-------------------------------------------------------------------------------------------root -- 956592 0 0 6 0 0testuser ++ 100 10 100 6days 100 10 100 6days å¦‚æœè¦è®¾ç½®quotaï¼Œå»ºè®®åœ¨/etc/rc.d/rc.localä¸­å†™å…¥quotacheckå’Œquotaon å·²ä¿è¯ç³»ç»Ÿå¯åŠ¨æ—¶quotaæœåŠ¡å¼€å¯ä¸”æ•°æ®éƒ½æ˜¯æœ€æ–°çš„ã€‚åˆ†åŒºçš„quoteåŠŸèƒ½å¼€å¯å»ºè®®åœ¨/etc/fstabä¸­ã€‚ ä¾‹ï¼š 1234567891011121314/etc/fstab# Created by anaconda on Sun May 24 08:16:25 2015## Accessible filesystems, by reference, are maintained under '/dev/disk'# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info#/dev/mapper/VolGroup-lv_root / ext4 defaults 1 1UUID=3fe6311e-b3fe-4f7f-8558-4f011eab1dde /boot ext4 defaults 1 2/dev/mapper/VolGroup-lv_swap swap swap defaults 0 0tmpfs /dev/shm tmpfs defaults 0 0devpts /dev/pts devpts gid=5,mode=620 0 0sysfs /sys sysfs defaults 0 0proc /proc proc defaults 0 0/dev/mapper/vgxiemx-lv1 /mnt ext3 defaults,usrquota,grpquota 0 0","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"command","slug":"command","permalink":"https://www.xiemx.com/tags/command/"},{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"LinuxåŠ¨æ€ç£ç›˜ç®¡ç†ï¼ˆlvmï¼‰","slug":"linux-lvm","date":"2015-11-28T18:11:11.000Z","updated":"2019-10-21T06:57:42.989Z","comments":true,"path":"/2015/11/29/linux-lvm/","link":"","permalink":"https://www.xiemx.com/2015/11/29/linux-lvm/","excerpt":"","text":"lvmæ˜¯å°†åº•å±‚ç¡¬ä»¶å­˜å‚¨å±è”½æ•´åˆï¼Œé€šè¿‡è½¯ä»¶ç»„åˆåœ¨å¯¹ç³»ç»Ÿå¼€æ”¾ï¼Œæ­¤æ—¶ç³»ç»ŸæŸ¥çœ‹åˆ°çš„å°±ä¸æ˜¯åº•å±‚ä¸€å—å—çš„ç‰©ç†ç£ç›˜äº†è€Œæ˜¯æˆ‘ä»¬è™šæ‹Ÿçš„é€»è¾‘ç£ç›˜ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±çš„å¯¹è¿™äº›ç£ç›˜è¿›è¡Œå®¹é‡ç®¡ç†ã€‚lvmä»ç³»ç»Ÿå±‚é¢åˆ°ç‰©ç†å±‚é¢åˆ†åˆ«å¯¹åº”â€œæ–‡ä»¶ç³»ç»Ÿâ€”â€”lvâ€”â€”vgâ€”â€”pvâ€”â€”ç£ç›˜â€ã€‚æ‰€æœ‰å¯¹ç£ç›˜çš„ç®¡ç†éƒ½è¦éµå¾ªè¿™ä¸ªç‰©ç†ç»“æ„çš„é¡ºåºæ¥å¤„ç†ã€‚åˆ›å»ºæ—¶ç”±ä¸‹è€Œä¸Šï¼Œåˆ é™¤æ—¶ç”±ä¸Šè€Œä¸‹ï¼Œè°ƒæ•´ä¸­é—´éƒ¨åˆ†æ˜¯ä¹Ÿè¦ç»“åˆä¸Šä¸‹éƒ¨åˆ†åˆ†æéœ€æ±‚å…·ä½“åœ¨è¿›è¡Œå¤„ç†ã€‚ pvâ€”â€”ç‰©ç†å·vgâ€”â€”å·ç»„lvâ€”â€”é€»è¾‘å·peâ€”â€”æœ€å°å­˜å‚¨å•å…ƒï¼Œç±»ä¼¼ä¸ç£ç›˜block lvmæ˜¯ä»‹äºç³»ç»Ÿä¸ç¡¬ä»¶ä¹‹é—´çš„ä¸€ç§ç£ç›˜ç»„ç»‡æ–¹æ³•ï¼Œä¸‹å±‚ä¸ºä¸Šå±‚çš„åŸºç¡€ï¼Œä¸‹å±‚åˆ¶çº¦ä¸Šå±‚ã€‚ lvmç®¡ç† ç£ç›˜åˆ†åŒº 1fdisk ï¼dev/vda åŒæ­¥å†…æ ¸ä¸­çš„åˆ†åŒºè¡¨ä¿¡æ¯ï¼ˆå¦‚æœæ˜¯æ–°ç¡¬ç›˜ä¸€èˆ¬ä¸éœ€è¦è¿™ä¸€éƒ¨åˆ†ï¼‰ 1partx -a /dev/vda åˆ›å»ºpv 1234567891011121314151617181920212223242526272829303132pvcreate ï¼dev/vda1 â€”â€”æœ‰å¤šä¸ªåˆ†åŒºæ—¶å¯ä»¥ä¾æ¬¡ç©ºæ ¼é—´éš”å†™åœ¨åé¢ï¼Œä¹Ÿå¯ä»¥é’ˆå¯¹æ•´å—ç¡¬ç›˜å»ç›´æ¥åˆ›å»ºpvså’ŒpvdisplayæŸ¥çœ‹pvç¼©ç•¥å’Œè¯¦ç»†ä¿¡æ¯[root@localhost ~]# pvsPV VG Fmt Attr PSize PFree/dev/sda2 VolGroup lvm2 a-- 19.1g 0/dev/sdb lvm2 a-- 10.0g 10.0g[root@localhost ~]# pvdisplay--- Physical volume ---PV Name /dev/sda2VG Name VolGroupPV Size 19.51 GiB / not usable 3.00 MiBAllocatable yes (but full)PE Size 4.00 MiBTotal PE 4994Free PE 0Allocated PE 4994PV UUID fcQLJh-oq2G-adfr-QeEK-sdtl-XND-m1YtPA\"/dev/sdb\" is a new physical volume of \"10.00 GiB\"--- NEW Physical volume ---PV Name /dev/sdbVG NamePV Size 10.00 GiBAllocatable NOPE Size 0Total PE 0Free PE 0Allocated PE 0PV UUID WQpkNi-cN6-QogB-TLB2-R2wT-Agmh-BRBiUN åˆ›å»ºvg 12345678910111213141516171819202122232425262728293031vgcreate -s 8M vgname /dev/vda1 /dev/vda2 â€”â€” sé€‰é¡¹åˆ¶å®špeçš„å¤§å°é»˜è®¤ä¸º4Mvgså’ŒvgdisplayæŸ¥çœ‹vgä¿¡æ¯[root@localhost ~]# vgcreate -s 8M vgxiemx /dev/sdbVolume group \"vgxiemx\" successfully created[root@localhost ~]# vgsVG #PV #LV #SN Attr VSize VFreeVolGroup 1 2 0 wz--n- 19.51g 0vgxiemx 1 0 0 wz--n- 9.99g 9.99g[root@localhost ~]# vgdisplay--- Volume group ---VG Name vgxiemxSystem IDFormat lvm2Metadata Areas 1Metadata Sequence No 1VG Access read/writeVG Status resizableMAX LV 0Cur LV 0Open LV 0Max PV 0Cur PV 1Act PV 1VG Size 9.99 GiBPE Size 8.00 MiBTotal PE 1279Alloc PE / Size 0 / 0Free PE / Size 1279 / 9.99 GiBVG UUID 5WZfct-snfo-aEDl-gHuO-QDbz-v83j-L0lwmR åˆ›å»ºlv 123456789101112131415161718192021222324252627282930lvcreate -l 100 -n lvname vgnameâ€”â€”lé€‰é¡¹æŒ‡å®šåˆ†é…100ä¸ªpeç»™lv ï¼ŒnæŒ‡å®šåç§°ï¼Œæœ€åä»å“ªä¸ªvgåˆ›å»ºã€‚lvcreate -L1000M -n lvname vgnameâ€”â€”Lä¾¿æ˜¯ç›´æ¥åˆ†é…å¤šå¤§ç©ºé—´å•ä½ä¸ºK M Gã€‚Lå’Œlå‚æ•°è¿˜æœ‰å¾ˆå¤šç§å®¹é‡è¡¨ç¤ºæ–¹æ³•manæŸ¥é˜…lvså’ŒlvdisplayæŸ¥çœ‹lvä¿¡æ¯[root@localhost ~]# lvcreate -n lv1 -l 1279 vgxiemxLogical volume \"lv1\" created[root@localhost ~]# lvsLV VG Attr LSize Pool Origin Data% Move Log Cpy%Sync Convertlv_root VolGroup -wi-ao---- 17.51glv_swap VolGroup -wi-ao---- 2.00glv1 vgxiemx -wi-a----- 9.99g[root@localhost ~]# lvdisplay--- Logical volume ---LV Path /dev/vgxiemx/lv1LV Name lv1VG Name vgxiemxLV UUID nViafR-nrnS-REMQ-bGOT-uhDe-Skd0-XUNwmULV Write Access read/writeLV Creation host, time localhost.localdomain, 2015-11-22 01:50:41 +0800LV Status available# open 0LV Size 9.99 GiBCurrent LE 1279Segments 1Allocation inheritRead ahead sectors auto- currently set to 256Block device 253:2 åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ 12345678910111213141516171819202122232425mkfs.ext3 /dev/vgname/lvname â€”â€”åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ[root@localhost ~]# mkfs -t ext3 /dev/vgxiemx/lv1mke2fs 1.41.12 (17-May-2010)Filesystem label=OS type: LinuxBlock size=4096 (log=2)Fragment size=4096 (log=2)Stride=0 blocks, Stripe width=0 blocks655360 inodes, 2619392 blocks130969 blocks (5.00%) reserved for the super userFirst data block=0Maximum filesystem blocks=268435456080 block groups32768 blocks per group, 32768 fragments per group8192 inodes per groupSuperblock backups stored on blocks:32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632Writing inode tables: doneCreating journal (32768 blocks): doneWriting superblocks and filesystem accounting information: doneThis filesystem will be automatically checked every 30 mounts or180 days, whichever comes first. Use tune2fs -c or -i to override. æŒ‚è½½lv 123456789mount /dev/vgname/lvname /mnt[root@localhost ~]# mount /dev/vgxiemx/lv1 /mnt[root@localhost mnt]# df -lFilesystem 1K-blocks Used Available Use% Mounted on/dev/mapper/VolGroup-lv_root 18069936 6767876 10384148 40% /tmpfs 953788 72 953716 1% /dev/shm/dev/sda1 495844 39915 430329 9% /boot/dev/mapper/vgxiemx-lv1 10313016 154232 9634908 2% /mnt lvmè°ƒæ•´pvçš„æ–°å¢ã€åˆ é™¤pvçš„æ–°å¢å°±æ˜¯å¢åŠ æ–°çš„ç©ºé—²åˆ†åŒºæˆ–è€…æ–°çš„ç¡¬ç›˜åˆ›å»ºæˆæ–°çš„ç©ºé—²pvåŒä¸Špvåˆ›å»ºå‘½ä»¤ä¸€è‡´ pvåˆ é™¤1234567pvremove /dev/vdb[root@localhost /]# pvremove /dev/sdbLabels on physical volume \"/dev/sdb\" successfully wiped[root@localhost /]# pvsPV VG Fmt Attr PSize PFree/dev/sda2 VolGroup lvm2 a-- 19.51g 0 ç§»åŠ¨pvä¸­çš„æ•°æ®ç”±ä¸‹å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°pv/dev/sdb1ä¸­çš„1Gæ•°æ®å·²ç»è¢«æˆ‘ä»¬ç§»åŠ¨åˆ°/dev/sdb2ä¸­å»äº†ï¼Œå¦‚æœæ˜¯å•ç¡¬ç›˜åšçš„pvæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥æ’¤é™¤/dev/sdb1å¯¹åº”çš„è¿™å—ç¡¬ç›˜ï¼Œè€Œæ•°æ®æ²¡æœ‰ä¸¢å¤± 1234567891011121314151617181920212223pvremove /dev/sdb1 /dev/sdb2[root@localhost mnt]# pvsPV VG Fmt Attr PSize PFree/dev/sda2 VolGroup lvm2 a-- 19.51g 0/dev/sdb1 vgxiemx lvm2 a-- 1.01g 8.00m/dev/sdb2 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb3 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb5 lvm2 a-- 2.01g 2.01g/dev/sdb6 lvm2 a-- 4.96g 4.96g[root@localhost mnt]# pvmove /dev/sdb1 /dev/sdb2/dev/sdb1: Moved: 1.6%/dev/sdb1: Moved: 45.3%/dev/sdb1: Moved: 89.8%/dev/sdb1: Moved: 100.0%[root@localhost mnt]# pvsPV VG Fmt Attr PSize PFree/dev/sda2 VolGroup lvm2 a-- 19.51g 0/dev/sdb1 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb2 vgxiemx lvm2 a-- 1.01g 8.00m/dev/sdb3 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb5 lvm2 a-- 2.01g 2.01g/dev/sdb6 lvm2 a-- 4.96g 4.96g vgæ‰©å®¹ã€ç¼©å°ã€åˆ é™¤vgçš„æ‰©å®¹vgçš„å®¹é‡æ¥è‡ªäºpvï¼Œå¦‚æœvgçš„å®¹é‡ä¸å¤Ÿé‚£ä¹ˆvgæ‰©å®¹å…¶å®å°±æ˜¯æ–°å¢ç©ºé—²çš„pvåˆ°vgä¸­å» 1234567891011121314151617181920vgextend /dev/sdb5 vgxiemx[root@localhost /]# pvsPV VG Fmt Attr PSize PFree/dev/sda2 VolGroup lvm2 a-- 19.51g 0/dev/sdb1 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb2 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb3 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb5 lvm2 a-- 2.01g 2.01g/dev/sdb6 lvm2 a-- 4.96g 4.96g[root@localhost /]# vgextend vgxiemx /dev/sdb5Volume group \"vgxiemx\" successfully extended[root@localhost /]# pvsPV VG Fmt Attr PSize PFree/dev/sda2 VolGroup lvm2 a-- 19.51g 0/dev/sdb1 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb2 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb3 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb5 vgxiemx lvm2 a-- 2.00g 2.00g/dev/sdb6 lvm2 a-- 4.96g 4.96g vgçš„å‡å°ä¹Ÿå°±æ˜¯å°†vgä¸­çš„pvç§»é™¤ï¼Œä½†pvç§»é™¤æ˜¯å­˜åœ¨pvä¸­çš„peéƒ½å·²ç»è¢«ä½¿ç”¨å­˜åœ¨æ•°æ®ï¼Œè¿™æ˜¯æˆ‘ä»¬å°±éœ€è¦ç§»åŠ¨è¦åˆ é™¤çš„æ•°æ®åˆ°æ–°çš„pvä¸­å»ï¼Œæ–°çš„pvç©ºé—´å¿…é¡»è¦æ¯”æ—§çš„pvç©ºé—´å¤§ã€‚ 1234567891011121314151617181920vgreduce vgxiemx /dev/sdb5[root@localhost /]# pvsPV VG Fmt Attr PSize PFree/dev/sda2 VolGroup lvm2 a-- 19.51g 0/dev/sdb1 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb2 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb3 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb5 vgxiemx lvm2 a-- 2.00g 2.00g/dev/sdb6 lvm2 a-- 4.96g 4.96g[root@localhost /]# vgreduce vgxiemx /dev/sdb5Removed \"/dev/sdb5\" from volume group \"vgxiemx\"[root@localhost /]# pvsPV VG Fmt Attr PSize PFree/dev/sda2 VolGroup lvm2 a-- 19.51g 0/dev/sdb1 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb2 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb3 vgxiemx lvm2 a-- 1.01g 1.01g/dev/sdb5 lvm2 a-- 2.01g 2.01g/dev/sdb6 lvm2 a-- 4.96g 4.96g vgçš„åˆ é™¤1234567vgremove vgxiemx[root@localhost /]# vgremove vgxiemxVolume group \"vgxiemx\" successfully removed[root@localhost /]# vgsVG #PV #LV #SN Attr VSize VFreeVolGroup 1 2 0 wz--n- 19.51g 0 lvçš„æ‰©å®¹ã€ç¼©å°ã€åˆ é™¤lvçš„ç¼©å°12345678910111213lvreduce -L 9000M /dev/vgxiemx/lv1[root@localhost /]# lvreduce -L 9000M /dev/vgxiemx/lv1WARNING: Reducing active logical volume to 8.79 GiBTHIS MAY DESTROY YOUR DATA (filesystem etc.)Do you really want to reduce lv1? [y/n]: yReducing logical volume lv1 to 8.79 GiBLogical volume lv1 successfully resized[root@localhost /]# lvsLV VG Attr LSize Pool Origin Data% Move Log Cpy%Sync Convertlv_root VolGroup -wi-ao---- 17.51glv_swap VolGroup -wi-ao---- 2.00glv1 vgxiemx -wi-a----- 8.79g lvçš„æ‰©å®¹12345678910lvextend -L 10000M /dev/vgxiemx/lv1[root@localhost /]# lvextend -L 10000M /dev/vgxiemx/lv1Extending logical volume lv1 to 9.77 GiBLogical volume lv1 successfully resized[root@localhost /]# lvsLV VG Attr LSize Pool Origin Data% Move Log Cpy%Sync Convertlv_root VolGroup -wi-ao---- 17.51glv_swap VolGroup -wi-ao---- 2.00glv1 vgxiemx -wi-a----- 9.77g lvçš„åˆ é™¤123456789lvremove /dev/vgxiemx/lv1[root@localhost /]# lvremove /dev/vgxiemx/lv1Do you really want to remove active logical volume lv1? [y/n]: yLogical volume \"lv1\" successfully removed[root@localhost /]# lvsLV VG Attr LSize Pool Origin Data% Move Log Cpy%Sync Convertlv_root VolGroup -wi-ao---- 17.51glv_swap VolGroup -wi-ao---- 2.00g æ–‡ä»¶ç³»ç»Ÿçš„æ‰©ç¼©æ£€æµ‹æ–‡ä»¶ç³»ç»Ÿ12345678910e2fsck /dev/vgxiemx/lv1[root@localhost /]# e2fsck -f /dev/vgxiemx/lv1e2fsck 1.41.12 (17-May-2010)Pass 1: Checking inodes, blocks, and sizesPass 2: Checking directory structurePass 3: Checking directory connectivityPass 4: Checking reference countsPass 5: Checking group summary information/dev/vgxiemx/lv1: 11/655360 files (0.0% non-contiguous), 79696/2619392 blocks è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°123456resize2fs /dev/vgxiemx/lv1 9000M[root@localhost /]# resize2fs /dev/vgxiemx/lv1 9000Mresize2fs 1.41.12 (17-May-2010)Resizing the filesystem on /dev/vgxiemx/lv1 to 2304000 (4k) blocks.The filesystem on /dev/vgxiemx/lv1 is now 2304000 blocks long.","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"lvm","slug":"lvm","permalink":"https://www.xiemx.com/tags/lvm/"}],"author":"xiemx"},{"title":"Linuxè®¡åˆ’ä»»åŠ¡","slug":"linux-crontab-and-at","date":"2015-11-28T03:11:05.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2015/11/28/linux-crontab-and-at/","link":"","permalink":"https://www.xiemx.com/2015/11/28/linux-crontab-and-at/","excerpt":"","text":"è®¡åˆ’ä»»åŠ¡ç§ç±»ï¼š ä¸€æ¬¡æ€§è®¡åˆ’ä»»åŠ¡ï¼ˆatï¼‰ï¼šç”±è¿›ç¨‹atdå®ˆæŠ¤ å‘¨æœŸæ€§è®¡åˆ’ä»»åŠ¡ï¼ˆcronï¼‰ï¼šç”±è¿›ç¨‹crondå®ˆæŠ¤ ä¸€æ¬¡æ€§è®¡åˆ’ä»»åŠ¡ï¼ˆatï¼‰ç”Ÿæˆçš„æ–‡ä»¶å­˜æ”¾åœ¨ï¼var/spool/at/ç›®å½•ä¸‹ï¼Œä»»åŠ¡æ‰§è¡Œä¸€æ¬¡ä¹‹åè‡ªåŠ¨åˆ é™¤ã€‚ä¸€æ¬¡æ€§è®¡åˆ’ä»»åŠ¡è¿˜å¯ä»¥ç”¨batchå‘½ä»¤å»æ‰§è¡Œã€‚batchå‘½ä»¤ä¼šåœ¨ç³»ç»Ÿç©ºé—²çš„æƒ…å†µä¸‹æ‰§è¡Œä»»åŠ¡ï¼Œç”¨æ³•å’Œatç›¸åŒä½†ä¼˜å…ˆçº§ä½å»¶æ—¶æ‰§è¡Œã€‚ å‘½ä»¤ï¼š 1234567ï¼»root@localhost ~]# at now + 5 minutes at&gt; /bin/mail root -s \"testing at job\" &lt; /root/.bashrc at&gt; &lt;EOF&gt; &lt;==è¾“å…¥ [ctrl] + d ç»“æŸç¼–è¾‘ï¼æ­¤æ—¶ä¼šåœ¨ï¼var/spool/at/ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªä»»åŠ¡æ–‡ä»¶[root@localhost ~]# atq5 2015-11-25 23:00 a root[root@localhost ~]# atrm 5 ä¸€æ¬¡æ€§è®¡åˆ’ä»»åŠ¡çš„æ—¶é—´å†™æ³•æ”¯æŒå¾ˆå¤šå¯ä»¥æŸ¥çœ‹man pageï¼å½“æˆ‘ä»¬åˆ¶å®šè®¡åˆ’ä»»åŠ¡ä¹‹åï¼Œç”±äºç§ç§åŸå› è€Œè¦å»å–æ¶ˆè®¡åˆ’ä»»åŠ¡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨atqå»æŸ¥è¯¢å½“å‰ç³»ç»Ÿä¸­æœ‰å¤šå°‘ä¸ºæ‰§è¡Œçš„è®¡åˆ’ï¼Œæ¯ä¸ªè®¡åˆ’çš„ç¼–å·æ˜¯å¤šå°‘ã€‚åœ¨é€šè¿‡atrmï¼‹ä»»åŠ¡ç¼–å·æ¥åˆ é™¤è¿™ä¸ªä»»åŠ¡ã€‚ï¼etc/at.allowå’Œï¼etc/at.denyæ–‡ä»¶è§„èŒƒäº†å“ªäº›ç”¨æˆ·å¯ä»¥ä½¿ç”¨até‚£äº›ç”¨æˆ·æ— æ³•ä½¿ç”¨atã€‚å†™åœ¨allowæ–‡ä»¶è¡¨æ˜äº†å†™åœ¨æ­¤æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ‰å¯ä»¥ä½¿ç”¨atï¼Œdenyæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ— æ³•ä½¿ç”¨ã€‚ å‘¨æœŸæ€§è®¡åˆ’ä»»åŠ¡ï¼ˆcronï¼‰ç”±è¿›ç¨‹crondå®ˆæŠ¤ï¼Œç”Ÿæˆçš„ä»»åŠ¡æ–‡ä»¶å­˜æ”¾åœ¨ï¼var/spool/cron/ç›®å½•ä¸‹æ–‡ä»¶ä¼šä»¥ç”¨æˆ·åå‘½åã€‚ä¹Ÿé‡‡ç”¨äº†ï¼etc/cron.allowå’Œï¼etc/cron.denyçš„æˆæƒæ–¹å¼ã€‚é…ç½®æ–‡ä»¶ä¸ºï¼etc/crontab ã€‚å‘¨æœŸæ€§è®¡åˆ’ä»»åŠ¡åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ç”¨æˆ·çº§åˆ«ï¼ˆé€šè¿‡crontab ï¼eæ¥åˆ¶å®šï¼‰ï¼Œä¸€ç§ä¸ºç³»ç»Ÿçº§åˆ«ï¼ˆå†™åœ¨ï¼etc/crontabæ–‡ä»¶ä¸­ï¼‰ï¼Œå»ºè®®ä½¿ç”¨crontabæ¥åˆ¶å®šã€‚ å‘½ä»¤ç”¨æ³• 1234567crontab å‚æ•°-u ï¼šåªæœ‰ root æ‰èƒ½è¿›è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œäº¦å³å¸®å…¶ä»–ä½¿ç”¨è€…åˆ›å»º/ç§»é™¤ crontab å·¥ä½œæ’ç¨‹ï¼›-e ï¼šç¼–è¾‘ crontab çš„å·¥ä½œå†…å®¹ï¼ŒåŒviç¼–è¾‘æ–‡ä»¶ç›¸åŒï¼ˆå…¶å®å°±æ˜¯viäº†ä¸€ä¸ªæ–°æ–‡ä»¶åˆ°ï¼var/spool/cronä¸‹ï¼‰-l ï¼šæŸ¥é˜… crontab çš„å·¥ä½œå†…å®¹-r ï¼šç§»é™¤æ‰€æœ‰çš„ crontab çš„å·¥ä½œå†…å®¹ï¼Œè‹¥ä»…è¦ç§»é™¤ä¸€é¡¹ï¼Œè¯·ç”¨ -e å»ç¼–è¾‘ã€‚ï¼»root@localhost ï½ï¼½#crontab -u testuser -e #ä¸ºtestuserç”¨æˆ·åˆ¶å®šè®¡åˆ’ä»»åŠ¡ï¼Œä¼šæ‰“å¼€viçš„ç¼–è¾‘ç•Œé¢ï¼Œæ¯ä¸€è¡Œå°±æ˜¯ä¸€ä¸ªä»»åŠ¡ ä¾‹ï¼š 12345###æ—¶é—´çš„å†™æ³•åŸºæœ¬å°±æ˜¯\",\" \"-\" \"/\"ä¸‰ç§ç¬¦å·æ¥é—´éš”,â€œï¼Šâ€ä»£è¡¨æ‰€æœ‰éƒ½åŒ¹é…ã€‚30 * * * * &lt;==æ¯å°æ—¶çš„30åˆ†ï¼Œè¾“å‡ºhello*/10 ï¼Š * * * &lt;==æ¯éš”10åˆ†é’Ÿ30 12 * * 1,3,5 &lt;==æ¯å‘¨1 3 5çš„12æ—¶30åˆ†30 12 1 3-5 * &lt;==æ¯å¹´çš„3 4 5æœˆ1æ—¥12æ—¶30åˆ† åŒæ ·çš„ï¼etc/crontab ä¸­çš„æ—¶é—´å†™æ³•ä¹Ÿæ˜¯ç±»ä¼¼ä½†è¯­æ³•ä¸åŒcronæ¯åˆ†é’Ÿéƒ½ä¼šå»è¯»ä¸€æ¬¡è®¡åˆ’ä»»åŠ¡åŒæ—¶ä¹Ÿä¼šè¯»ä¸€æ¬¡ï¼etc/crontabæ–‡ä»¶ï¼Œcrontabæ–‡ä»¶ä¸­è®¾ç½®äº†4ä¸ªæ–‡ä»¶å¤¹ï¼ˆé…ç½®æ–‡ä»¶ä¸­çš„run-partså‘½ä»¤éƒ¨åˆ†ï¼‰ï¼Œç³»ç»Ÿä¼šåœ¨ä¸åŒçš„æ—¶é—´å»è¯»å–è¿è¡Œå…¶ä¸­çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†è„šæœ¬æ–‡ä»¶æ”¾åˆ°å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸‹ä¹Ÿå¯ä»¥å®ç°è„šæœ¬çš„å‘¨æœŸæ€§æ‰§è¡Œã€‚æˆ‘ä»¬çš„locateæ•°æ®åº“åŒæ­¥ï¼Œlogrotateç­‰éƒ½æ˜¯æ”¾åœ¨è¿™äº›ç›®å½•ä¸‹æ¥å®ç°å‘¨æœŸæ€§çš„å·¥ä½œã€‚ 12345678910111213[root@localhost ~]# cat /etc/crontabSHELL=/bin/bashPATH=/sbin:/bin:/usr/sbin:/usr/binMAILTO=rootHOME=/# run-parts01 * * * * root run-parts /etc/cron.hourly &lt;==æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡02 4 * * * root run-parts /etc/cron.daily &lt;==æ¯å¤©æ‰§è¡Œä¸€æ¬¡22 4 * * 0 root run-parts /etc/cron.weekly &lt;==æ¯å‘¨æ—¥æ‰§è¡Œä¸€æ¬¡42 4 1 * * root run-parts /etc/cron.monthly &lt;==æ¯ä¸ªæœˆ 1 å·æ‰§è¡Œä¸€æ¬¡###run-parts æˆ‘ä»¬å¯ä»¥é€šè¿‡whichå‘½ä»¤æ¥æŸ¥çœ‹å…¶å®æ˜¯/usr/bin/run-partså‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥manä¸€ä¸‹è¿™ä¸ªå‘½ä»¤ï¼Œæˆ–è€…ç›´æ¥æ‰“å¼€è¿™ä¸ªå‘½ä»¤çš„è„šæœ¬ï¼Œä¼šå‘ç°è¿™ä¸ªå‘½ä»¤ä¼šå°†ç›®å½•ä¸‹çš„è„šæœ¬å…¨éƒ¨æ‰§è¡Œä¸€æ¬¡ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"command","slug":"command","permalink":"https://www.xiemx.com/tags/command/"},{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"Linuxæ—¥å¿—ç³»ç»Ÿ","slug":"linux-log-system","date":"2015-11-28T02:11:40.000Z","updated":"2019-10-21T06:57:42.910Z","comments":true,"path":"/2015/11/28/linux-log-system/","link":"","permalink":"https://www.xiemx.com/2015/11/28/linux-log-system/","excerpt":"","text":"åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæœ‰ä¸‰ä¸ªä¸»è¦çš„æ—¥å¿—å­ç³»ç»Ÿï¼š è¿æ¥æ—¥å¿—â€“ç”±å¤šä¸ªç¨‹åºæ‰§è¡Œï¼ŒæŠŠçºªå½•å†™å…¥åˆ°/var/log/wtmpå’Œ/var/run/utmpï¼Œloginç­‰ç¨‹åºæ›´æ–°wtmpå’Œutmpæ–‡ä»¶ï¼Œä½¿ç³»ç»Ÿç®¡ç†å‘˜èƒ½å¤Ÿè·Ÿè¸ªè°åœ¨ä½•æ—¶ç™»å½•åˆ°ç³»ç»Ÿã€‚ è¿›ç¨‹ç»Ÿè®¡â€“ç”±ç³»ç»Ÿå†…æ ¸æ‰§è¡Œã€‚å½“ä¸€ä¸ªè¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œä¸ºæ¯ä¸ªè¿›ç¨‹å¾€è¿›ç¨‹ç»Ÿè®¡æ–‡ä»¶ï¼ˆpacctæˆ–acctï¼‰ä¸­å†™ä¸€ä¸ªçºªå½•ã€‚è¿›ç¨‹ç»Ÿè®¡çš„ç›®çš„æ˜¯ä¸ºç³»ç»Ÿä¸­çš„åŸºæœ¬æœåŠ¡æä¾›å‘½ä»¤ä½¿ç”¨ç»Ÿè®¡ã€‚ é”™è¯¯æ—¥å¿—â€“ç”±syslogdï¼ˆ8ï¼‰æ‰§è¡Œã€‚å„ç§ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ã€ç”¨æˆ·ç¨‹åºå’Œå†…æ ¸é€šè¿‡syslogï¼ˆ3ï¼‰å‘æ–‡ä»¶/var/log/messagesæŠ¥å‘Šå€¼å¾—æ³¨æ„çš„äº‹ä»¶ã€‚å¦å¤–æœ‰è®¸å¤šUNIXç¨‹åºåˆ›å»ºæ—¥å¿—ã€‚åƒHTTPå’ŒFTPè¿™æ ·æä¾›ç½‘ç»œæœåŠ¡çš„æœåŠ¡å™¨ä¹Ÿä¿æŒè¯¦ç»†çš„æ—¥å¿—ã€‚ å¤§éƒ¨åˆ†Linuxç³»ç»Ÿéƒ½ä½¿ç”¨syslogç®¡ç†æ—¥å¿—ï¼Œç³»ç»Ÿæ—¥å¿—é»˜è®¤ä¼šå†™åœ¨/var/logç›®å½•ä¸‹ï¼Œsyslogä¼šä¾æ®/etc/syslog.confæ–‡ä»¶ä¸­çš„é…ç½®å°†ä¸åŒçº§åˆ«ã€ä¸åŒç±»åˆ«çš„æ—¥å¿—åˆ†é—¨åˆ«ç±»çš„çºªå½•åˆ°ä¸åŒçš„æ—¥å¿—æ–‡ä»¶ä¸­å»ã€‚/etc/syslog.confä¸­ä¾ç…§å¦‚ä¸‹æ ¼å¼çºªå½•æ—¥å¿—é…ç½®ï¼š 12æ—¥å¿—å¯¹è±¡.çº§åˆ« æ—¥å¿—æ–‡ä»¶å­˜æ”¾ä½ç½®authpriv.info /var/log/secure 1234567891011121314151617ï¼»root@localhost ï½ï¼½#cat /etc/syslog.conf//å°†infoæˆ–æ›´é«˜çº§åˆ«çš„æ¶ˆæ¯é€åˆ°/var/log/messagesï¼Œé™¤äº†mailä»¥å¤–ã€‚//å…¶ä¸­*æ˜¯é€šé…ç¬¦ï¼Œä»£è¡¨ä»»ä½•è®¾å¤‡ï¼›noneè¡¨ç¤ºä¸å¯¹ä»»ä½•çº§åˆ«çš„ä¿¡æ¯è¿›è¡Œè®°å½•ã€‚*.info;mail.none;authpriv.none /var/log/messages//å°†authpirvè®¾å¤‡çš„ä»»ä½•çº§åˆ«çš„ä¿¡æ¯è®°å½•åˆ°/var/log/secureæ–‡ä»¶ä¸­ï¼Œè¿™ä¸»è¦æ˜¯ä¸€äº›å’Œè®¤ã€æƒé™ä½¿ç”¨ç›¸å…³çš„ä¿¡æ¯ã€‚authpriv.* /var/log/secure//å°†mailè®¾å¤‡ä¸­çš„ä»»ä½•çº§åˆ«çš„ä¿¡æ¯è®°å½•åˆ°/var/log/maillogæ–‡ä»¶ä¸­ï¼Œè¿™ä¸»è¦æ˜¯å’Œç”µå­é‚®ä»¶ç›¸å…³çš„ä¿¡æ¯ã€‚mail.* /var/log/maillog//å°†cronè®¾å¤‡ä¸­çš„ä»»ä½•çº§åˆ«çš„ä¿¡æ¯è®°å½•åˆ°/var/log/cronæ–‡ä»¶ä¸­ï¼Œè¿™ä¸»è¦æ˜¯å’Œç³»ç»Ÿä¸­å®šæœŸæ‰§è¡Œçš„ä»»åŠ¡ç›¸å…³çš„ä¿¡æ¯ã€‚cron.* /var/log/cron//å°†ä»»ä½•è®¾å¤‡çš„emergçº§åˆ«çš„ä¿¡æ¯å‘é€ç»™æ‰€æœ‰æ­£åœ¨ç³»ç»Ÿä¸Šçš„ç”¨æˆ·ã€‚*.emerg *//å°†uucpå’Œnewsè®¾å¤‡çš„critçº§åˆ«çš„ä¿¡æ¯è®°å½•åˆ°/var/log/spooleræ–‡ä»¶ä¸­ã€‚uucp,news.crit /var/log/spooler//å°†å’Œç³»ç»Ÿå¯åŠ¨ç›¸å…³çš„ä¿¡æ¯è®°å½•åˆ°/var/log/boot.logæ–‡ä»¶ä¸­ã€‚local7.* /var/log/boot.log æ—¥å¿—å¯¹è±¡kernâ€”â€”å†…æ ¸Userâ€”â€”ç”¨æˆ·ç¨‹åºDamonâ€”â€”ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹Mailâ€”â€”ç”µå­é‚®ä»¶ç³»ç»ŸAuthâ€”â€”ä¸å®‰å…¨æƒé™ç›¸å…³çš„å‘½ä»¤Lprâ€”â€”æ‰“å°æœºNewsâ€”â€”æ–°é—»ç»„ä¿¡æ¯Uucpâ€”â€”Uucpç¨‹åºCronâ€”â€”è®°å½•å½“å‰ç™»å½•çš„æ¯ä¸ªç”¨æˆ·ä¿¡æ¯wtmpâ€”â€”ä¸€ä¸ªç”¨æˆ·æ¯æ¬¡ç™»å½•è¿›å…¥å’Œé€€å‡ºæ—¶é—´çš„æ°¸ä¹…è®°å½•Authprivâ€”â€”æˆæƒä¿¡æ¯ æ—¥å¿—çš„çº§åˆ«emergâ€”â€”æœ€é«˜çš„ç´§æ€¥ç¨‹åº¦çŠ¶æ€alertâ€”â€”ç´§æ€¥çŠ¶æ€Cirtâ€”â€”é‡è¦ä¿¡æ¯warningâ€”â€”è­¦å‘Šerrâ€”â€”é”™è¯¯noticeâ€”â€”é€šçŸ¥infoâ€”â€”ä¸€èˆ¬æ€§æ¶ˆæ¯Debugâ€”â€”è°ƒè¯•çº§ä¿¡æ¯Noneâ€”â€”ä¸è®°å½•ä»»ä½•æ—¥å¿—ä¿¡æ¯å¸¸ç”¨çš„æ—¥å¿—æ–‡ä»¶ å¸¸è§çš„æ—¥å¿—æ–‡ä»¶cron: crontabä¾‹è¡Œäº‹åŠ¡çš„æ—¥å¿—dmesg: å†…æ ¸å¯åŠ¨æ—¶çš„æ£€æµ‹ä¿¡æ¯,è¾“å‡ºåŒ dmesg å‘½ä»¤lastlog: æ‰€æœ‰å¸å·æœ€åä¸€æ¬¡ç™»å½•çš„ç›¸å…³ä¿¡æ¯ï¼Œè¾“å‡ºåŒ lastlog å‘½ä»¤maillog: é‚®ä»¶æ¥å¾€ä¿¡æ¯messages ï¼š ç³»ç»Ÿé”™è¯¯ä¿¡æ¯secure ï¼š æ¶‰åŠåˆ°â€œè¾“å…¥å£ä»¤â€çš„æ“ä½œï¼Œéƒ½ä¼šè®°å½•äºæ­¤wtmpä¸faillog: ç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¿¡æ¯(wtmp)å’Œç™»å½•å¤±è´¥çš„ç”¨æˆ·ä¿¡æ¯(faillog)httpd, sambaç­‰ ï¼š ä¸åŒçš„ç½‘ç»œæœåŠ¡ç”¨è‡ªå·±çš„å®šåˆ¶çš„æ—¥å¿—æ–‡ä»¶utmpã€wtmpå’Œlastlogæ—¥å¿—æ–‡ä»¶æ˜¯å¤šæ•°é‡ç”¨UNIXæ—¥å¿—å­ç³»ç»Ÿçš„å…³é”®â€“ä¿æŒç”¨æˆ·ç™»å½•è¿›å…¥å’Œé€€å‡ºçš„çºªå½•ã€‚æœ‰å…³å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯è®°å½•åœ¨æ–‡ä»¶utmpä¸­ï¼›ç™»å½•è¿›å…¥å’Œé€€å‡ºçºªå½•åœ¨æ–‡ä»¶wtmpä¸­ï¼›æœ€åä¸€æ¬¡ç™»å½•æ–‡ä»¶å¯ä»¥ç”¨lastlogå‘½ä»¤å¯Ÿçœ‹ã€‚æ•°æ®äº¤æ¢ã€å…³æœºå’Œé‡èµ·ä¹Ÿè®°å½•åœ¨wtmpæ–‡ä»¶ä¸­ã€‚é€šå¸¸ï¼Œæ¯æ¬¡æœ‰ä¸€ä¸ªç”¨æˆ·ç™»å½•æ—¶ï¼Œloginç¨‹åºåœ¨æ–‡ä»¶lastlogä¸­å¯Ÿçœ‹ç”¨æˆ·çš„UIDã€‚å¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ™æŠŠç”¨æˆ·ä¸Šæ¬¡ç™»å½•ã€é€€å‡ºæ—¶é—´å’Œä¸»æœºåå†™åˆ°æ ‡å‡†è¾“å‡ºä¸­ï¼Œç„¶åloginç¨‹åºåœ¨lastlogä¸­çºªå½•æ–°çš„ç™»å½•æ—¶é—´ã€‚åœ¨æ–°çš„lastlogçºªå½•å†™å…¥åï¼Œutmpæ–‡ä»¶æ‰“å¼€å¹¶æ’å…¥ç”¨æˆ·çš„utmpçºªå½•ã€‚è¯¥çºªå½•ä¸€ç›´ç”¨åˆ°ç”¨æˆ·ç™»å½•é€€å‡ºæ—¶åˆ é™¤ã€‚utmpæ–‡ä»¶è¢«å„ç§å‘½ä»¤æ–‡ä»¶ä½¿ç”¨ï¼ŒåŒ…æ‹¬whoã€wã€userså’Œfingerã€‚ ä¸‹ä¸€æ­¥ï¼Œloginç¨‹åºæ‰“å¼€æ–‡ä»¶wtmpé™„åŠ ç”¨æˆ·çš„utmpçºªå½•ã€‚å½“ç”¨æˆ·ç™»å½•é€€å‡ºæ—¶ï¼Œå…·æœ‰æ›´æ–°æ—¶é—´æˆ³çš„åŒä¸€utmpçºªå½•é™„åŠ åˆ°æ–‡ä»¶ä¸­ã€‚wtmpæ–‡ä»¶è¢«ç¨‹åºlastå’Œacä½¿ç”¨ã€‚ æ—¥å¿—è½®æ›¿ï¼ˆlogrotateï¼‰åœ¨ç³»ç»Ÿç”¨æˆ·ä¼—å¤šçš„ï¼Œæˆ–ç³»ç»Ÿè¿è¡Œæœ‰è®¿é—®é‡éå¸¸å¤§çš„ç¨‹åºæ—¶ï¼Œæ—¥å¿—æ–‡ä»¶çš„å¢é•¿ä¼šéå¸¸è¿…é€Ÿï¼Œä¸¥é‡çš„ä¼šå¯¼è‡´ç³»ç»Ÿç£ç›˜è¢«å†™æ»¡æ•°æ®æ— æ³•è¢«å†™å…¥ç³»ç»Ÿè¿›ç¨‹æŠ¥é”™ä¸­æ­¢ç­‰ã€‚ä¸ºäº†åº”å¯¹è¿™ä¸ªé—®é¢˜ï¼ŒLinuxé‡‡å–äº†æ—¥å¿—è½®æ›¿çš„æ–¹å¼æ¥ç®¡ç†æ—¥å¿—æ–‡ä»¶ã€‚logrotateç¨‹åºä¼šä¾æ®/etc/logrotate.confå’Œ/etc/logrotate.d/ä¸­å®šä¹‰çš„è½®æ›¿è§„åˆ™æ¥è£å‰ªã€åˆ é™¤ã€å¤‡ä»½æ—¥å¿—æ–‡ä»¶ã€‚logrotateä¼šåœ¨/etc/cron.dailyç›®å½•ä¸‹ç”Ÿæˆè„šæœ¬ï¼Œæ¯å¤©è‡ªåŠ¨æ‰§è¡Œã€‚ 12345678910111213[root@localhost ~]# cat /etc/logrotate.confweekly #é»˜è®¤æ¯å‘¨è¿›è¡Œä¸€æ¬¡æ—¥å¿—æ¸…ç†rotate 4 #ä¿ç•™çš„æ—¥å¿—æ–‡ä»¶æ•°é‡create #åˆ›å»ºä¸€ä¸ªæ–°çš„æ¥å­˜å‚¨#compress #æ˜¯å¦éœ€è¦å‹ç¼©include /etc/logrotate.d #è¯»å–/etc/logrotate.dç›®å½•ä¸‹çš„æ–‡ä»¶/var/log/wtmp &#123; #é’ˆå¯¹å•ä¸ªwtmpæ—¥å¿—æ“ä½œmonthly #æ¯ä¸ªæœˆä¸€æ¬¡minsize 1M #è¶…è¿‡1Mæ•´ç†create 0664 root utmp #æ–°åŠ æ–‡ä»¶æƒé™å’Œç”¨æˆ·ç»„rotate 1 #ä¿ç•™ä¸€ä¸ªæ–‡ä»¶&#125;","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"Linuxå¯åŠ¨è¿‡ç¨‹","slug":"linux-boot-workflow","date":"2015-11-14T20:11:22.000Z","updated":"2019-10-21T06:57:42.697Z","comments":true,"path":"/2015/11/15/linux-boot-workflow/","link":"","permalink":"https://www.xiemx.com/2015/11/15/linux-boot-workflow/","excerpt":"","text":"åŠ è½½è‡ªæ£€ï¼ˆpostï¼‰ã€BIOS å½“ä½ æ‰“å¼€è®¡ç®—æœºç”µæºï¼Œè®¡ç®—æœºä¼šå¯¹ç¡¬ä»¶è®¾å¤‡åŠ ç”µï¼Œç„¶åå»æ£€æŸ¥cpuï¼Œå†…å­˜ï¼Œä¸»æ¿è¿™äº›ç¡¬ä»¶è®¾å¤‡ã€‚åŠ ç‚¹é€šè¿‡ååŠ è½½BIOSä¿¡æ¯ï¼Œè¯»å–biosä¸­å­˜å‚¨çš„è®¾å¤‡å¯åŠ¨é¡ºåºä¿¡æ¯ï¼Œå¯»æ‰¾å¯åŠ¨è®¾å¤‡ä¸€èˆ¬éƒ½æ˜¯ç¡¬ç›˜ã€å…‰ç›˜ã€Uç›˜ç­‰ã€‚ è¯»å–MBR ç¡¬ç›˜ä¸Šç¬¬0ç£é“ç¬¬ä¸€ä¸ªæ‰‡åŒºè¢«ç§°ä¸ºMBRï¼Œä¹Ÿå°±æ˜¯Master Boot Recordï¼Œå³ä¸»å¼•å¯¼è®°å½•ï¼Œå¤§å°æ˜¯512å­—èŠ‚ï¼Œå­˜æ”¾äº†446å­—èŠ‚çš„boots loaderã€64å­—èŠ‚çš„åˆ†åŒºè¡¨ä¿¡æ¯å’Œ2å­—èŠ‚çš„ç¡¬ç›˜æœ‰æ•ˆæ ‡è®°ã€‚ ç³»ç»Ÿæ‰¾åˆ°BIOSæ‰€æŒ‡å®šçš„ç¡¬ç›˜çš„MBRåï¼Œå°±ä¼šå°†å…¶å¤åˆ¶åˆ°0Ã—7c00åœ°å€æ‰€åœ¨çš„ç‰©ç†å†…å­˜ä¸­ã€‚å…¶å®è¢«å¤åˆ¶åˆ°ç‰©ç†å†…å­˜çš„å†…å®¹å°±æ˜¯Boot Loaderï¼Œå¸¸ç”¨çš„boot loader æœ‰grubã€liloã€‚ Boot Loader ç³»ç»Ÿè¯»å–å†…å­˜ä¸­çš„grubé…ç½®ä¿¡æ¯ï¼ˆä¸€èˆ¬ä¸ºmenu.lstæˆ–grub.lstï¼‰ï¼Œå¹¶ä¾ç…§æ­¤é…ç½®ä¿¡æ¯æ¥å¯åŠ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿã€‚ åŠ è½½å†…æ ¸ ä¾æ®grub.confé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œç³»ç»Ÿè¯»å–å†…æ ¸ï¼ŒæŒ‚è½½è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿinitrdã€‚ å¯åŠ¨init å†…æ ¸è¢«åŠ è½½åè¿è¡Œç¬¬ä¸€ä¸ªè¿›ç¨‹/sbin/initï¼Œè¯»å–é…ç½®æ–‡ä»¶/etc/init/rc.Scanf,æ ¹æ®æ­¤æ–‡ä»¶é…ç½®åœ¨æ‰¾åˆ°/etc/rc.d/rc.sysinitå¼€å¯ç³»ç»Ÿåˆå§‹åŒ–ï¼Œåœ¨è¯»å–/etc/inittabæ–‡ä»¶ï¼Œç¡®å®šç³»ç»Ÿçš„å¯åŠ¨çº§åˆ«ã€‚ è¿è¡Œinittabä¸­è§„å®šçº§åˆ«çš„è„šæœ¬ç¨‹åº æ ¹æ®è¿è¡Œçº§åˆ«çš„ä¸åŒï¼Œç³»ç»Ÿä¼šè¿è¡Œrc0.dåˆ°rc6.dä¸­çš„ç›¸åº”çš„è„šæœ¬ç¨‹åºï¼Œ/etc/rc.d/rcX.d/ç›®å½•ã€‚ æ‰§è¡Œ/etc/rc.d/rc.local /etc/rc.d/rcX.d/ä¸­çš„è„šæœ¬æŒ‰ç…§é…ç½®å¯åŠ¨å®Œæˆåï¼Œä¼šå¯åŠ¨rc.localã€‚ æ‰§è¡Œ/bin/login è°ƒç”¨ç™»å½•ç¨‹åºï¼Œå¯åŠ¨ç™»é™†ç•Œé¢ã€‚ ä»¥ä¸Šåªæ˜¯ç®€å•çš„ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ï¼Œå…·ä½“è¯¦ç»†çš„ç³»ç»Ÿå±‚é¢çš„å¯åŠ¨ä»ç¬¬boot loaderä¹‹åçš„æ‰§è¡Œéƒ½å¯ä»¥å‚çœ‹ç³»ç»Ÿä¸­çš„é…ç½®æ–‡ä»¶ã€‚å¯ä»¥è¯»å–ç›¸å¯¹åº”çš„è„šæœ¬å’Œé…ç½®ä»£ç ï¼Œæ ¹æ®æ–‡ä»¶ä¸­çš„è§„å®šä¸€æ­¥æ­¥çš„ç†è§£ç³»ç»Ÿçš„å¯åŠ¨ï¼Œç†è§£ç³»ç»Ÿå¯åŠ¨çš„è¯¦ç»†æ­¥éª¤ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"Linuxè¿›ç¨‹ç®¡ç†","slug":"linux-process-manager","date":"2015-11-14T20:11:14.000Z","updated":"2019-10-21T06:57:43.011Z","comments":true,"path":"/2015/11/15/linux-process-manager/","link":"","permalink":"https://www.xiemx.com/2015/11/15/linux-process-manager/","excerpt":"","text":"å½“æˆ‘ä»¬è¿è¡Œç¨‹åºæ—¶ï¼ŒLinuxä¼šä¸ºç¨‹åºåˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„ç¯å¢ƒï¼Œè¯¥ç¯å¢ƒåŒ…å«ç¨‹åºè¿è¡Œéœ€è¦çš„æ‰€æœ‰èµ„æºï¼Œä»¥ä¿è¯ç¨‹åºèƒ½å¤Ÿç‹¬ç«‹è¿è¡Œï¼Œä¸å—å…¶ä»–ç¨‹åºçš„å¹²æ‰°ã€‚ åœ¨ç³»ç»Ÿä¸­æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªæŒ‡ä»¤ï¼ŒLinux å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚ä¾‹å¦‚ä½¿ç”¨ ls å‘½ä»¤éå†ç›®å½•ä¸­çš„æ–‡ä»¶æ—¶ï¼Œå°±åˆ›å»ºäº†ä¸€ä¸ªè¿›ç¨‹ã€‚è¿›ç¨‹å°±æ˜¯ç¨‹åºçš„å®ä¾‹ã€‚ ç³»ç»Ÿé€šè¿‡ä¸€ä¸ªäº”ä½æ•°å­—è·Ÿè¸ªç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œè¿™ä¸ªæ•°å­—ç§°ä¸º pid æˆ–è¿›ç¨‹IDã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰å”¯ä¸€çš„ pidã€‚ä¸¤ä¸ª pid ä¸€æ ·çš„è¿›ç¨‹ä¸èƒ½åŒæ—¶å­˜åœ¨ï¼ŒLinuxç”¨ pid æ¥è·Ÿè¸ªç¨‹åºçš„è¿è¡ŒçŠ¶æ€ã€‚ è¿›ç¨‹æŸ¥çœ‹ps1234567891011121314151617181920212223242526272829303132333435[root@localhost ~]# ps auxUSER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMANDroot 1 0.0 0.0 19356 1540 ? Ss 02:09 0:01 /sbin/initroot 2 0.0 0.0 0 0 ? S 02:09 0:00 [kthreadd]root 3 0.0 0.0 0 0 ? S 02:09 0:00 [migration/0][root@localhost ~]# ps -efUID PID PPID C STIME TTY TIME CMDroot 1 0 0 02:09 ? 00:00:01 /sbin/initroot 2 0 0 02:09 ? 00:00:00 [kthreadd]root 3 2 0 02:09 ? 00:00:00 [migration/0][root@localhost ~]# ps -leF S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD4 S 0 1 0 0 80 0 - 4839 poll_s ? 00:00:01 init1 S 0 2 0 0 80 0 - 0 kthrea ? 00:00:00 kthreadd1 S 0 3 2 0 -40 - - 0 migrat ? 00:00:00 migration/0USER ç”¨æˆ·å UID ç”¨æˆ·IDï¼ˆUser IDï¼‰ PID è¿›ç¨‹IDï¼ˆProcess IDï¼‰ PPID çˆ¶è¿›ç¨‹çš„è¿›ç¨‹IDï¼ˆParent Process idï¼‰ SID ä¼šè¯IDï¼ˆSession idï¼‰ %CPU è¿›ç¨‹çš„cpuå ç”¨ç‡ %MEM è¿›ç¨‹çš„å†…å­˜å ç”¨ç‡ VSZ è¿›ç¨‹æ‰€ä½¿ç”¨çš„è™šå­˜çš„å¤§å°ï¼ˆVirtual Sizeï¼‰ RSS è¿›ç¨‹ä½¿ç”¨çš„å®é™…å†…å­˜çš„å¤§å° TTY ä¸è¿›ç¨‹å…³è”çš„ç»ˆç«¯ï¼ˆttyï¼‰ STAT è¿›ç¨‹çš„çŠ¶æ€ï¼šè¿›ç¨‹çŠ¶æ€ä½¿ç”¨å­—ç¬¦è¡¨ç¤ºçš„ï¼ˆSTATçš„çŠ¶æ€ç ï¼‰ START è¿›ç¨‹å¯åŠ¨æ—¶é—´å’Œæ—¥æœŸ TIME è¿›ç¨‹ä½¿ç”¨çš„æ€»cpuæ—¶é—´ COMMAND æ­£åœ¨æ‰§è¡Œçš„å‘½ä»¤è¡Œå‘½ä»¤ NI ä¼˜å…ˆçº§(Nice) PRI è¿›ç¨‹ä¼˜å…ˆçº§ç¼–å·(Priority)è¿›ç¨‹çŠ¶æ€ï¼ˆSå­—æ®µï¼‰ï¼š D=ä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€ R=è¿è¡Œ S=ç¡çœ  T=è·Ÿè¸ª/åœæ­¢ Z=åƒµå°¸è¿›ç¨‹ top123456789101112131415[root@localhost ~]# toptop - 02:45:58 up 36 min, 4 users, load average: 0.00, 0.00, 0.00Tasks: 175 total, 1 running, 174 sleeping, 0 stopped, 0 zombieCpu(s): 0.3%us, 0.3%sy, 0.0%ni, 99.3%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%stMem: 1907580k total, 528968k used, 1378612k free, 26060k buffersSwap: 2097144k total, 0k used, 2097144k free, 173020k cachedPID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND2603 root 20 0 15028 1372 1000 R 0.3 0.1 0:00.21 top1 root 20 0 19356 1540 1228 S 0.0 0.1 0:01.04 init2 root 20 0 0 0 0 S 0.0 0.0 0:00.00 kthreaddç¬¬ä¸€è¡Œæ˜¾ç¤ºç³»ç»Ÿè¿è¡Œæ—¶é—´ï¼Œç”¨æˆ·æ•°ï¼Œç³»ç»Ÿè´Ÿè½½1åˆ†é’Ÿ ï¼Œ5åˆ†é’Ÿï¼Œ15åˆ†é’Ÿçš„æƒ…å†µç¬¬äºŒè¡Œæ˜¾ç¤ºç»å¸¸æ€»æ•°ï¼Œä¸åŒstatä¸‹çš„è¿›ç¨‹æ•°é‡ ç¬¬ä¸‰è¡Œæ˜¾ç¤ºcpuä½¿ç”¨æƒ…å†µ ç¬¬å››è¡Œæ˜¾ç¤ºç‰©ç†å†…å­˜ä½¿ç”¨æƒ…å†µ ç¬¬äº”è¡Œæ˜¾ç¤ºswapäº¤æ¢åˆ†åŒºä½¿ç”¨æƒ…å†µ ä¿¡å· 1234567891011121314[root@localhost ~]# kill -l1) SIGHUP 2) SIGINT 3) SIGQUIT 4) SIGILL 5) SIGTRAP6) SIGABRT 7) SIGBUS 8) SIGFPE 9) SIGKILL 10) SIGUSR111) SIGSEGV 12) SIGUSR2 13) SIGPIPE 14) SIGALRM 15) SIGTERM16) SIGSTKFLT 17) SIGCHLD 18) SIGCONT 19) SIGSTOP 20) SIGTSTP21) SIGTTIN 22) SIGTTOU 23) SIGURG 24) SIGXCPU 25) SIGXFSZ26) SIGVTALRM 27) SIGPROF 28) SIGWINCH 29) SIGIO 30) SIGPWR31) SIGSYS 34) SIGRTMIN 35) SIGRTMIN+1 36) SIGRTMIN+2 37) SIGRTMIN+338) SIGRTMIN+4 39) SIGRTMIN+5 40) SIGRTMIN+6 41) SIGRTMIN+7 42) SIGRTMIN+843) SIGRTMIN+9 44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+1348) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-1253) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9 56) SIGRTMAX-8 57) SIGRTMAX-758) SIGRTMAX-6 59) SIGRTMAX-5 60) SIGRTMAX-4 61) SIGRTMAX-3 62) SIGRTMAX-263) SIGRTMAX-1 64) SIGRTMAX Linuxä¸­ä¿¡å·æœ‰64ç§ï¼Œé€šè¿‡killå‘½ä»¤æˆ‘ä»¬å¯ä»¥å¯¹è¿›ç¨‹å‘é€è¿™äº›ä¿¡å·æ¥å‘ŠçŸ¥è¿™äº›è¿›ç¨‹ï¼Œåšä»€ä¹ˆæ“ä½œã€‚å¸¸ç”¨çš„ä»¥ä¸‹å››ç§ 1) SIGHUPè¿™ä¸ªä¿¡å·ç”¨äºé€šçŸ¥å®ƒé‡æ–°è¯»å–é…ç½®æ–‡ä»¶ä½†ä¸å…³é—­è¿›ç¨‹ï¼Œç›¸å½“äºreloadã€‚2) SIGINTç¨‹åºç»ˆæ­¢(interrupt)ä¿¡å·, åœ¨ç”¨æˆ·é”®å…¥INTRå­—ç¬¦(é€šå¸¸æ˜¯Ctrl-C)æ—¶å‘å‡ºï¼Œç”¨äºé€šçŸ¥å‰å°è¿›ç¨‹ç»„ç»ˆæ­¢è¿›ç¨‹ã€‚9) SIGKILLç”¨æ¥ç«‹å³ç»“æŸç¨‹åºçš„è¿è¡Œ. æœ¬ä¿¡å·ä¸èƒ½è¢«é˜»å¡ã€å¤„ç†å’Œå¿½ç•¥ã€‚å¦‚æœç®¡ç†å‘˜å‘ç°æŸä¸ªè¿›ç¨‹ç»ˆæ­¢ä¸äº†ï¼Œå¯å°è¯•å‘é€è¿™ä¸ªä¿¡å·15) SIGTERMç¨‹åºç»“æŸ(terminate)ä¿¡å·, ä¸SIGKILLä¸åŒçš„æ˜¯è¯¥ä¿¡å·å¯ä»¥è¢«é˜»å¡å’Œå¤„ç†ã€‚é€šå¸¸ç”¨æ¥è¦æ±‚ç¨‹åºè‡ªå·±æ­£å¸¸é€€å‡ºï¼Œshellå‘½ä»¤killç¼ºçœäº§ç”Ÿè¿™ä¸ªä¿¡å·ã€‚å¦‚æœè¿›ç¨‹ç»ˆæ­¢ä¸äº†ï¼Œæˆ‘ä»¬æ‰ä¼šå°è¯•SIGKILLã€‚ ä¾‹ï¼škill -1 2205 â€”â€”å‘ŠçŸ¥PIDä¸º2205çš„è¿›ç¨‹é‡è½½ä¸‹é…ç½®æ–‡ä»¶ kill -9 2205 â€”â€”ç›´æ¥æ€æ­»2205è¿›ç¨‹ kill -15 2205 â€”â€”é€šçŸ¥2205è¿›ç¨‹å…³é—­ï¼Œè¿›ç¨‹ä¼šåœ¨æ”¶åˆ°ä¿¡å·åç»“æŸå·¥ä½œåè‡ªè¡Œå…³é—­ï¼Œæœ‰äº›è¿›ç¨‹ä¼šå±è”½15ä¿¡å·å¦‚bashï¼Œæ­¤æ—¶æˆ‘ä»¬åªèƒ½é€šè¿‡9ä¿¡å·å¼ºåˆ¶ç»“æŸã€‚ è¿›ç¨‹ä¼˜å…ˆçº§å‡è®¾ç³»ç»Ÿä¸­æœ‰å¤šä¸ªè¿›ç¨‹åŒæ—¶åœ¨æ’é˜Ÿæ˜¯ï¼Œcpuåº”è¯¥æœ‰é™å¤„ç†å“ªä¸ªè¿›ç¨‹å“ªï¼Ÿè¿™å°±å–å†³äºè¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„ä¼˜å…ˆå¤„ç†ã€‚è¿›ç¨‹åœ¨åˆ›å»ºæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡niceå‘½ä»¤æŒ‡å®šä»–çš„ä¼˜å…ˆçº§ï¼Œå¯¹äºå·²ç»å¼€å§‹çš„è¿›ç¨‹æˆ‘ä»¬å¯ä»¥é€šè¿‡reniceæ¥ä¿®æ”¹ä»–çš„ä¼˜å…ˆçº§ã€‚ ä¼˜å…ˆçº§èŒƒå›´ï¼š-20~19 æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œé»˜è®¤åˆ›å»ºçš„è¿›ç¨‹ä¼˜å…ˆçº§ä¸º0ã€‚ ä¾‹ï¼š 12345678910111213141516nice -n 10 vim â€”â€” åˆ›å»ºä¸€ä¸ªä¼˜å…ˆçº§ä¸º10çš„vimè¿›ç¨‹[root@localhost ~]# ps -el | grep vimF S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD0 T 0 6891 2563 0 90 10 - 35930 signal pts/2 00:00:00 vimrenice -n -10 6891 â€”â€”è°ƒæ•´6891è¿›ç¨‹çš„æœ‰é™çº§ä¸º-10[root@localhost ~]# renice -n -10 68916891: old priority 10, new priority -10rootç”¨æˆ·å¯ä»¥è‡ªç”±è°ƒæ•´ç»å¸¸çš„ä¼˜å…ˆçº§ï¼Œæ™®é€šç”¨æˆ·åªèƒ½è°ƒä½ä¸èƒ½è°ƒé«˜ã€‚ [testuser@localhost root]$ renice -n 5 69256925: old priority 0, new priority 5 [testuser@localhost root]$ renice -n 2 6925renice: 6925: setpriority: Permission denied å‰å°è¿›ç¨‹/åå°è¿›ç¨‹ç”±äºä¸€ä¸ªç»ˆç«¯åœ¨å¤„ç†å·¥ä½œæ—¶åªèƒ½å¤„ç†ä¸€ä¸ªï¼Œå½“æˆ‘ä»¬æƒ³åœ¨å¤„ç†ç¬¬äºŒä¸ªè¿›ç¨‹æ—¶ä¼šç”±äºç»ˆç«¯è¢«å ç”¨è€Œæ— æ³•å¤„ç†ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥å°†å‰å°çš„è¿™ä¸ªè¿›ç¨‹æ”¾åˆ°åå°å»è¿è¡Œï¼ŒæŠŠå‰å°çš„ç»ˆç«¯ç©ºå‡ºè®©æˆ‘ä»¬è¿è¡Œæ–°çš„è¿›ç¨‹ã€‚ å‘½ä»¤ï¼š command &amp;è®©è¿›ç¨‹åœ¨åå°è¿è¡Œ jobs â€“l æŸ¥çœ‹åå°è¿è¡Œçš„è¿›ç¨‹ fg %n è®©åå°è¿è¡Œçš„è¿›ç¨‹nåˆ°å‰å°æ¥ bg %n è®©åå°çš„è¿›ç¨‹nè¿è¡Œ ä»¥ä¸Šçš„%næ˜¯é€šè¿‡jobs -l æŸ¥çœ‹åˆ°çš„å·¥ä½œç¼–å·ä¸æ˜¯pidã€‚ ä¾‹ï¼š 123456789101112131415161718192021vim &amp; â€”â€”åœ¨åå°è¿è¡Œvimè¿›ç¨‹jobs -l â€”â€”æŸ¥çœ‹åå°æ‰€æœ‰è¿›ç¨‹fg %1 â€”â€”å°†åå°1å·è¿›ç¨‹ç§»åŠ¨åˆ°å‰å°æ¥è¿è¡Œbg %2 â€”â€” è®©åå°çš„2å·è¿›ç¨‹å¼€å§‹è¿è¡Œctrl+z â€”â€”æš‚åœå½“å‰çš„è¿›ç¨‹æ”¾åˆ°åå°ï¼Œä½†ä¸è¿è¡Œ[root@localhost ~]# vim &amp;[2] 6987 [root@localhost ~]# vi /etc/resolv.conf[3]+ Stopped vi /etc/resolv.conf[root@localhost ~]# jobs -l[1] 6891 Stopped nice -n 10 vim[2]- 6987 Stopped (tty output) vim[3]+ 6989 Stopped vi /etc/resolv.conf[root@localhost ~]# bg %2[2]- vim &amp;[root@localhost ~]# fg %3","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"tool","slug":"tool","permalink":"https://www.xiemx.com/tags/tool/"}],"author":"xiemx"},{"title":"LinuxåŒ…ç®¡ç†yumä»“åº“é…ç½®","slug":"linux-yum-repo","date":"2015-11-08T23:11:22.000Z","updated":"2019-10-21T06:57:43.060Z","comments":true,"path":"/2015/11/09/linux-yum-repo/","link":"","permalink":"https://www.xiemx.com/2015/11/09/linux-yum-repo/","excerpt":"","text":"Rhelä¸­ä½¿ç”¨ä¼ ç»Ÿçš„rpmåŒ…å®‰è£…ä¼šå­˜åœ¨ä¾å­˜å…³ç³»é—®é¢˜ï¼Œè™½ç„¶rpmä¸ºæˆ‘ä»¬åˆ—å‡ºäº†ä¾å­˜å…³ç³»ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä¸ºæˆ‘ä»¬è‡ªåŠ¨è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¾æ—§éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨çš„å»å®‰è£…ä¾å­˜åŒ…ã€‚è¿™æ ·ä½¿å¾—è½¯ä»¶çš„å®‰è£…éå¸¸éº»çƒ¦ï¼Œç”±æ­¤Linuxä¸­å‡ºç°äº†yumå·¥å…·ï¼Œyumé€šè¿‡é¢„è¯»å–è½¯ä»¶çš„ä¾å­˜å…³ç³»ç„¶åç”Ÿå­˜ç¼“å­˜ï¼Œä»¥åæˆ‘ä»¬é€šè¿‡yumå»å®‰è£…è½¯ä»¶æ˜¯yumä¼šæ ¹æ®ç¼“å­˜çš„å…³ç³»è¡¨è‡ªåŠ¨å»è¯†åˆ«rpmåŒ…çš„ä¾å­˜å…³ç³»ï¼Œä¸ºæˆ‘ä»¬è‡ªåŠ¨å¤„ç†ä¾å­˜å…³ç³»ï¼Œä½¿å¾—è½¯ä»¶çš„å®‰è£…çš„å·¥ä½œå˜å¾—ç®€å•ã€‚yumå®‰è£…è½¯ä»¶éœ€è¦ä¸€ä¸ªè½¯ä»¶ä»“ï¼Œyumä¼šè¯»å–/etc/yum.repos.d/xxxxxxx.repoçš„ä»“åº“é…ç½®æ–‡ä»¶å»ä»“åº“ä¸­æå–è½¯ä»¶æ¥å®‰è£…ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ä»“é…ç½®æ–‡ä»¶ï¼Œæ¥ä¿®æ”¹ä»“åº“ä½ç½®ï¼Œä½¿ç”¨æœ¬åœ°æˆ–è€…é€Ÿåº¦å¿«çš„ä»“ï¼ŒåŠ é€Ÿè½¯ä»¶å®‰è£…ã€‚ é…ç½®æ–‡ä»¶å†…å®¹ï¼š 123456[base]name=CentOS-$releasever - Base - mirrors.aliyun.combaseurl=http://mirrors.aliyun.com/centos/$releasever/os/$basearch/enabled=1gpgcheck=1gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-6 ä»¥ä¸Šæ˜¯é˜¿é‡Œäº‘çš„å¼€æºé•œåƒç«™çš„yumæºé…ç½®ã€‚ é…ç½®æ–‡ä»¶ä¸­ï¼š[ ]å†…çš„æ˜¯ä»“åº“çš„åå­—nameæ˜¯ä»“åº“çš„æè¿°ä¹Ÿå¯ä»¥è¯´æ˜¯åå­—baseurl ä»“åº“çš„ä½ç½®enabled æ˜¯å¦å¯ç”¨è¿™ä¸ªä»“åº“ï¼Œ1ä¸ºèµ·ç”¨ï¼Œ0ä¸ºç¦ç”¨gpgcheck æ˜¯å¦æ£€æŸ¥GPGç­¾åï¼ˆç”¨æ¥éªŒè¯è¦å®‰è£…çš„åŒ…æ˜¯ä¸æ˜¯REDHATå®˜æ–¹çš„ï¼‰gpgkey gpgkeyçš„å­˜æ”¾åœ°å€æˆ‘ä»¬å¼€å¯gpgcheck=1æ‰ä½¿ç”¨è¿™é¡¹åŠŸèƒ½ ç”±ä»¥ä¸Šçš„é…ç½®æ–‡ä»¶æˆ‘ä»¬å¯ä»¥çœ‹å‡ºåªè¦ä¿®æ”¹baseurlæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹ä»“çš„ä½ç½®ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬åœ°çš„ä»“åº“ã€‚åªè¦é…ç½®baseurlæŒ‡å‘ç›¸å¯¹åº”çš„ä»“å³å¯ã€‚å¦‚ä¸‹ 12345[xiemx] name=xiemx baseurl=file:///yumdatebase enabled=1 gpgcheck=0 åœ¨è¿è¡Œä¸‹yum clear allæ¸…ç©ºä¸‹ç¼“å­˜ yum makecacheåˆ¶ä½œæ–°çš„ç¼“å­˜ã€‚ä»¥ä¸Šçš„baseurlæˆ‘ä»¬æ˜¯å°†ç³»ç»Ÿå®‰è£…ç›˜çš„å†…å®¹å¤åˆ¶åˆ°æœ¬æœºçš„/yumdatebaseä¸‹ï¼Œç”±äºæ˜¯å…‰ç›˜çš„æºç³»ç»Ÿç”±æ­¤ä¹Ÿä¸éœ€è¦æ ¡éªŒç¨‹åºçš„å®‰å…¨æ€§æ‰€ä»¥å…³é—­gpgcheckã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒåè®®æ¥é“¾æ¥ä»“åº“å¦‚ftp://xxxxxxxxxã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"yum","slug":"yum","permalink":"https://www.xiemx.com/tags/yum/"}],"author":"xiemx"},{"title":"Linuxç›®å½•ç»“æ„","slug":"linux-tree","date":"2015-11-07T04:11:03.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2015/11/07/linux-tree/","link":"","permalink":"https://www.xiemx.com/2015/11/07/linux-tree/","excerpt":"","text":"1234567891011121314151617181920212223242526[root@localhost ~]# ls /bin dev home lost+found mnt proc sbin srv tmp varboot etc lib media opt root selinux sys usr/bin binæ˜¯Binaryçš„ç¼©å†™ã€‚è¿™ä¸ªç›®å½•å­˜æ”¾ç€æœ€ç»å¸¸ä½¿ç”¨çš„å‘½ä»¤ã€‚/boot è¿™é‡Œå­˜æ”¾çš„æ˜¯å¯åŠ¨Linuxæ—¶ä½¿ç”¨çš„ä¸€äº›æ ¸å¿ƒæ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸€äº›è¿æ¥æ–‡ä»¶ä»¥åŠé•œåƒæ–‡ä»¶ã€‚/dev devæ˜¯Device(è®¾å¤‡)çš„ç¼©å†™ã€‚è¯¥ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯Linuxçš„å¤–éƒ¨è®¾å¤‡ï¼Œåœ¨Linuxä¸­è®¿é—®è®¾å¤‡çš„æ–¹å¼å’Œè®¿é—®æ–‡ä»¶çš„æ–¹å¼æ˜¯ç›¸åŒçš„ã€‚/etc è¿™ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾æ‰€æœ‰çš„ç³»ç»Ÿç®¡ç†æ‰€éœ€è¦çš„é…ç½®æ–‡ä»¶å’Œå­ç›®å½•ã€‚/home ç”¨æˆ·çš„ä¸»ç›®å½•ï¼Œåœ¨Linuxä¸­ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ç›®å½•ï¼Œä¸€èˆ¬è¯¥ç›®å½•åæ˜¯ä»¥ç”¨æˆ·çš„è´¦å·å‘½åçš„ã€‚/lib è¿™ä¸ªç›®å½•é‡Œå­˜æ”¾ç€ç³»ç»Ÿæœ€åŸºæœ¬çš„åŠ¨æ€è¿æ¥å…±äº«åº“ï¼Œå…¶ä½œç”¨ç±»ä¼¼äºWindowsé‡Œçš„DLLæ–‡ä»¶ã€‚å‡ ä¹æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½éœ€è¦ç”¨åˆ°è¿™äº›å…±äº«åº“ã€‚/lost+found extæ–‡ä»¶ç³»ç»Ÿåˆ›å»ºï¼Œè¿™ä¸ªç›®å½•ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ç©ºçš„ï¼Œå½“ç³»ç»Ÿéæ³•å…³æœºåï¼Œè¿™é‡Œå°±å­˜æ”¾äº†ä¸€äº›æ–‡ä»¶ã€‚/media Linuxç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«ä¸€äº›è®¾å¤‡ï¼Œä¾‹å¦‚Uç›˜ã€å…‰é©±ç­‰ç­‰ï¼Œå½“è¯†åˆ«åï¼ŒLinuxä¼šæŠŠè¯†åˆ«çš„è®¾å¤‡æŒ‚è½½åˆ°è¿™ä¸ªç›®å½•ä¸‹ã€‚/mnt ç³»ç»Ÿæä¾›è¯¥ç›®å½•æ˜¯ä¸ºäº†è®©ç”¨æˆ·ä¸´æ—¶æŒ‚è½½åˆ«çš„æ–‡ä»¶ç³»ç»Ÿçš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…‰é©±æŒ‚è½½åœ¨/mnt/ä¸Šï¼Œç„¶åè¿›å…¥è¯¥ç›®å½•å°±å¯ä»¥æŸ¥çœ‹å…‰é©±é‡Œçš„å†…å®¹äº†ã€‚/opt è¿™æ˜¯ç»™ä¸»æœºé¢å¤–å®‰è£…è½¯ä»¶æ‰€æ‘†æ”¾çš„ç›®å½•ã€‚æ¯”å¦‚ä½ å®‰è£…ä¸€ä¸ªORACLEæ•°æ®åº“åˆ™å°±å¯ä»¥æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹ã€‚é»˜è®¤æ˜¯ç©ºçš„ã€‚/proc è¿™ä¸ªç›®å½•æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ç›®å½•ï¼Œå®ƒæ˜¯ç³»ç»Ÿå†…å­˜çš„æ˜ å°„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥è®¿é—®è¿™ä¸ªç›®å½•æ¥è·å–ç³»ç»Ÿä¿¡æ¯ã€‚/root è¯¥ç›®å½•ä¸ºç³»ç»Ÿç®¡ç†å‘˜ï¼Œä¹Ÿç§°ä½œè¶…çº§æƒé™è€…çš„ç”¨æˆ·ä¸»ç›®å½•ã€‚/sbin ç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨çš„ç³»ç»Ÿç®¡ç†ç¨‹åºã€‚/selinux è¿™ä¸ªç›®å½•æ˜¯Redhat/CentOSæ‰€ç‰¹æœ‰çš„ç›®å½•ï¼ŒSelinuxæ˜¯ä¸€ä¸ªå®‰å…¨æœºåˆ¶ï¼Œç±»ä¼¼äºwindowsçš„é˜²ç«å¢™ï¼Œä½†æ˜¯è¿™å¥—æœºåˆ¶æ¯”è¾ƒå¤æ‚ï¼Œè¿™ä¸ªç›®å½•å°±æ˜¯å­˜æ”¾selinuxç›¸å…³çš„æ–‡ä»¶çš„ã€‚/srv è¯¥ç›®å½•å­˜æ”¾ä¸€äº›æœåŠ¡å¯åŠ¨ä¹‹åéœ€è¦æå–çš„æ•°æ®ã€‚/sys è¿™æ˜¯linux2.6å†…æ ¸çš„ä¸€ä¸ªå¾ˆå¤§çš„å˜åŒ–ã€‚è¯¥ç›®å½•ä¸‹å®‰è£…äº†2.6å†…æ ¸ä¸­æ–°å‡ºç°çš„ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ sysfs ï¼Œsysfsæ–‡ä»¶ç³»ç»Ÿé›†æˆäº†ä¸‹é¢3ç§æ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯ï¼šé’ˆå¯¹è¿›ç¨‹ä¿¡æ¯çš„procæ–‡ä»¶ç³»ç»Ÿã€é’ˆå¯¹è®¾å¤‡çš„devfsæ–‡ä»¶ç³»ç»Ÿä»¥åŠé’ˆå¯¹ä¼ªç»ˆç«¯çš„devptsæ–‡ä»¶ç³»ç»Ÿã€‚è¯¥æ–‡ä»¶ç³»ç»Ÿæ˜¯å†…æ ¸è®¾å¤‡æ ‘çš„ä¸€ä¸ªç›´è§‚åæ˜ ã€‚å½“ä¸€ä¸ªå†…æ ¸å¯¹è±¡è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œå¯¹åº”çš„æ–‡ä»¶å’Œç›®å½•ä¹Ÿåœ¨å†…æ ¸å¯¹è±¡å­ç³»ç»Ÿç§è¢«åˆ›å»ºã€‚/tmp è¿™ä¸ªç›®å½•æ˜¯ç”¨æ¥å­˜æ”¾ä¸€äº›ä¸´æ—¶æ–‡ä»¶çš„ã€‚/usr è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç›®å½•ï¼Œç”¨æˆ·çš„å¾ˆå¤šåº”ç”¨ç¨‹åºå’Œæ–‡ä»¶éƒ½æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œç±»ä¼¼ä¸windowsä¸‹çš„program filesç›®å½•ã€‚/usr/bin ç³»ç»Ÿç”¨æˆ·ä½¿ç”¨çš„åº”ç”¨ç¨‹åºã€‚/usr/sbin è¶…çº§ç”¨æˆ·ä½¿ç”¨çš„æ¯”è¾ƒé«˜çº§çš„ç®¡ç†ç¨‹åºå’Œç³»ç»Ÿå®ˆæŠ¤ç¨‹åºã€‚/usr/src å†…æ ¸æºä»£ç é»˜è®¤çš„æ”¾ç½®ç›®å½•ã€‚/var ç»å¸¸è¢«ä¿®æ”¹çš„ç›®å½•æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚åŒ…æ‹¬å„ç§æ—¥å¿—æ–‡ä»¶ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"Linuxæ ‡å‡†è¾“å…¥è¾“å‡ºé‡å®šå‘","slug":"linux-stdin-stdout-stderr","date":"2015-11-06T21:11:17.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2015/11/07/linux-stdin-stdout-stderr/","link":"","permalink":"https://www.xiemx.com/2015/11/07/linux-stdin-stdout-stderr/","excerpt":"","text":"ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå‰ï¼Œå…ˆä¼šå‡†å¤‡å¥½æ‰€æœ‰è¾“å…¥è¾“å‡ºï¼Œé»˜è®¤åˆ†åˆ«ç»‘å®šï¼ˆstdin,stdout,stderr)ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™å‡ºç°é”™è¯¯ï¼Œå‘½ä»¤å°†ç»ˆæ­¢ï¼Œä¸ä¼šæ‰§è¡Œã€‚æ‰§è¡ŒæˆåŠŸä¼šå°†ç»“æœè¾“å‡ºåˆ°å±å¹•ä¸Šï¼Œæ‰§è¡Œé”™è¯¯æ—¶ä¹Ÿä¼šå°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°å±å¹•ã€‚è¿™äº›é»˜è®¤çš„è¾“å‡ºï¼Œè¾“å…¥éƒ½æ˜¯linuxç³»ç»Ÿå†…å®šçš„ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å€™å¹¶ä¸å¸Œæœ›æ‰§è¡Œç»“æœè¾“å‡ºåˆ°å±å¹•ã€‚æˆ‘æƒ³è¾“å‡ºåˆ°æ–‡ä»¶æˆ–å…¶å®ƒè®¾å¤‡ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦è¿›è¡Œè¾“å‡ºé‡å®šå‘äº†ã€‚è¿™äº›æ ‡å‡†è¾“å…¥è¾“å‡ºå¯¹åº”çš„æ–‡ä»¶å¦‚ä¸‹ï¼š 1234[root@localhost ~]# ll /dev/stdin /dev/stdout /dev/stderrlrwxrwxrwx. 1 root root 15 Nov 8 01:03 /dev/stderr -&gt; /proc/self/fd/2 lrwxrwxrwx. 1 root root 15 Nov 8 01:03 /dev/stdin -&gt; /proc/self/fd/0 lrwxrwxrwx. 1 root root 15 Nov 8 01:03 /dev/stdout -&gt; /proc/self/fd/1 ç”±è¿™äº›ç®¡é“æ–‡ä»¶å¯ä»¥çœ‹åˆ°linux shellä¸‹å¸¸ç”¨è¾“å…¥è¾“å‡ºæ“ä½œç¬¦æ˜¯ï¼š æ ‡å‡†è¾“å…¥ (stdin) ï¼šä»£ç ä¸º 0 ï¼Œä½¿ç”¨ &lt; æ ‡å‡†è¾“å‡º (stdout)ï¼šä»£ç ä¸º 1 ï¼Œä½¿ç”¨ &gt; æˆ– &gt;&gt; æ ‡å‡†é”™è¯¯è¾“å‡º(stderr)ï¼šä»£ç ä¸º 2 ï¼Œä½¿ç”¨ 2&gt; æˆ– 2&gt;&gt; å½“æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤æ—¶æˆ‘ä»¬ä¸æƒ³è¦ç¨‹åºå°†ç»“æœè¾“å‡ºåˆ°å±å¹•æ—¶æˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨&gt; &gt;&gt;é‡å®šå‘æ“ä½œç¬¦æ¥é‡å®šå‘æ•°æ®æµçš„è¾“å‡ºä½ç½® 123456789101112ls -l &gt; testfile1 ##æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å±æ€§ï¼Œä½†ä¸è¾“å‡ºåˆ°å±å¹•ï¼Œè¾“å‡ºåˆ°testfile1çš„æ–‡ä»¶ä¸­ã€‚echo 123qwe321|passwd --stdin testuse###è¾“å‡ºå­—ç¬¦ä¸²123qwe321ï¼Œå¹¶å°†å­—ç¬¦ä¸²é€šè¿‡æ ‡å‡†è¾“å…¥è®¾å¤‡ä¼ é€’ç»™passwdç¨‹åºå»ä¿®æ”¹testuserç”¨æˆ·çš„å¯†ç ã€‚###--stdinä»£è¡¨æ ‡å‡†è¾“å…¥è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥ç”¨/dev/stdinæ¥ä»£æ›¿ã€‚(stdinå‰æ˜¯åŒæ¨ªæ )é‡å®šå‘æ—¶è¦æ³¨æ„## &gt;é‡å®šå‘è¾“å‡ºåˆ°æ–‡ä»¶ä¸­æ—¶ä¼šæ¸…ç©ºæ–‡ä»¶ä¸­çš„å†…å®¹## &gt;&gt;ä¸ä¼šæ¸…ç©ºæ–‡ä»¶å†…å®¹ä¼šåœ¨æ–‡ä»¶æœ€åè¿½åŠ è¾“å‡ºå†…å®¹###ç”±äº&gt;ä¼šæ¸…ç©ºæ–‡ä»¶åœ¨å†™å…¥è¾“å‡ºå†…å®¹ï¼Œå› æ­¤å¸¸ç”¨æ¥æ¸…ç©ºæ–‡ä»¶echo \"\" &gt; /tmp/testfile1 ##æ¸…ç©ºtestfile1æ–‡ä»¶ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"Linuxç‰¹æ®Šæƒé™å’Œaclè®¿é—®æ§åˆ¶åˆ—è¡¨","slug":"linux-premissions-and-acl","date":"2015-11-05T01:11:28.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2015/11/05/linux-premissions-and-acl/","link":"","permalink":"https://www.xiemx.com/2015/11/05/linux-premissions-and-acl/","excerpt":"","text":"ç‰¹æ®Šæƒé™linuxä¸­é™¤äº†å¸¸è§çš„è¯»ï¼ˆrï¼‰ã€å†™ï¼ˆwï¼‰ã€æ‰§è¡Œï¼ˆxï¼‰æƒé™ä»¥å¤–ï¼Œè¿˜æœ‰3ä¸ªç‰¹æ®Šçš„æƒé™ï¼Œåˆ†åˆ«æ˜¯setuidã€setgidå’Œstick bitã€‚ setuidåªèƒ½è®¾ç½®æ–‡ä»¶ï¼Œè®©æ™®é€šç”¨æˆ·æ‹¥æœ‰å¯ä»¥æ‰§è¡Œâ€œåªæœ‰rootæƒé™æ‰èƒ½æ‰§è¡Œâ€çš„ç‰¹æ®Šæƒé™ï¼Œä¸€èˆ¬è®¾ç½®å‘½ä»¤æ–‡ä»¶æ­¤å±æ€§ã€‚è®¾ç½®æ–¹æ³•ï¼š 12chmod u+s /tmp/testfilechmod u-s /tmp/testfile å¦‚ï¼š 1-rwsr-xr-x 1 root root 22984 2015-11-04 /usr/bin/passwd setgidå¯è®¾ç½®æ–‡ä»¶å’Œç›®å½•ï¼Œå½“ç›®å½•è®¾ç½®æ­¤å±æ€§æ—¶åœ¨ç›®å½•ä¸‹åˆ›å»ºçš„æ–‡ä»¶ï¼Œé»˜è®¤æ‰€å±ç»„éƒ½ä¼šå˜ä¸ºè¯¥ç›®å½•çš„æ‰€å±ç»„ã€‚ è®¾ç½®æ–¹æ³•: 12chmod g+s /tmp/test/chmod g-s /tmp/test/ å¦‚: 12drwxr-sr-x 1 testuser testadmin 22984 2015-11-04 /tmp/test/-rw-r--r-- 1 root testadmin 22984 2015-11-04 /tmp/test/file1 â€”â€”æ–‡ä»¶æ‰€å±ç»„è‡ªåŠ¨ç»§æ‰¿testçš„æ‰€å±ç»„ sticky bitåœ¨ç›®å½•ä¸‹åˆ›å»ºçš„æ–‡ä»¶ï¼Œåªæœ‰æ–‡ä»¶çš„æ‹¥æœ‰è€…å’Œæ­¤ç›®å½•çš„æ‹¥æœ‰è€…æœ‰ç¼–è¾‘ã€åˆ é™¤æƒé™ è®¾ç½®æ–¹æ³•ï¼š 12chmod +t /tmpchmod -t /tmp ä»¥ä¸Šæƒé™ä¹Ÿå¯ä»¥é€šè¿‡æ•°å­—çš„æ–¹å¼æ¥è®¾ç½®ç‰¹æ®Šæƒé™ setuid=4ï¼Œsetgid=2ï¼Œsticky bit=1 123chmod 4777 /test/file1 â€”â€”setuidchmod 2777 /test/file2 â€”â€”setgidchmod 1777 /test/ â€”â€”sticky bit attræƒé™ï¼ˆéšè—æƒé™ï¼‰ç”¨æ¥è®¾ç½®ç‰¹æ®Šç”¨æˆ·ä¾‹å¦‚ï¼šrootä¹‹ç±»çš„æƒé™ã€‚ 12345678910111213141516è®¾ç½®æ–¹æ³•ï¼šchattr å‚æ•° æ–‡ä»¶+ ï¼šåœ¨åŸæœ‰å‚æ•°è®¾å®šåŸºç¡€ä¸Šï¼Œè¿½åŠ å‚æ•°ã€‚- ï¼šåœ¨åŸæœ‰å‚æ•°è®¾å®šåŸºç¡€ä¸Šï¼Œç§»é™¤å‚æ•°ã€‚= ï¼šæ›´æ–°ä¸ºæŒ‡å®šå‚æ•°è®¾å®šã€‚Aï¼šæ–‡ä»¶æˆ–ç›®å½•çš„ atime (access time)ä¸å¯è¢«ä¿®æ”¹(modified), é¿å…ç£ç›˜I/Oè¯»å†™å ç”¨èµ„æºã€‚Sï¼šç¡¬ç›˜I/OåŒæ­¥é€‰é¡¹ï¼ŒåŠŸèƒ½ç±»ä¼¼syncã€‚aï¼šå³appendï¼Œè®¾å®šè¯¥å‚æ•°åï¼Œåªèƒ½å‘æ–‡ä»¶ä¸­æ·»åŠ æ•°æ®ï¼Œè€Œä¸èƒ½åˆ é™¤ï¼Œå¤šç”¨äºæœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶å®‰å…¨ï¼Œåªæœ‰rootæ‰èƒ½è®¾å®šè¿™ä¸ªå±æ€§ã€‚cï¼šå³compresseï¼Œè®¾å®šæ–‡ä»¶æ˜¯å¦ç»å‹ç¼©åå†å­˜å‚¨ã€‚è¯»å–æ—¶éœ€è¦ç»è¿‡è‡ªåŠ¨è§£å‹æ“ä½œã€‚dï¼šå³no dumpï¼Œè®¾å®šæ–‡ä»¶ä¸èƒ½æˆä¸ºdumpç¨‹åºçš„å¤‡ä»½ç›®æ ‡ã€‚iï¼šè®¾å®šæ–‡ä»¶ä¸èƒ½è¢«åˆ é™¤ã€æ”¹åã€è®¾å®šé“¾æ¥å…³ç³»ï¼ŒåŒæ—¶ä¸èƒ½å†™å…¥æˆ–æ–°å¢å†…å®¹ã€‚iå‚æ•°å¯¹äºæ–‡ä»¶ ç³»ç»Ÿçš„å®‰å…¨è®¾ç½®æœ‰å¾ˆå¤§å¸®åŠ©ã€‚jï¼šå³journalï¼Œè®¾å®šæ­¤å‚æ•°ä½¿å¾—å½“é€šè¿‡mountå‚æ•°ï¼šdata=ordered æˆ–è€… data=writeback æŒ‚ è½½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶åœ¨å†™å…¥æ—¶ä¼šå…ˆè¢«è®°å½•(åœ¨journalä¸­)ã€‚å¦‚æœfilesystemè¢«è®¾å®šå‚æ•°ä¸º data=journalï¼Œåˆ™è¯¥å‚æ•°è‡ªåŠ¨å¤±æ•ˆã€‚sï¼šä¿å¯†æ€§åœ°åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼Œå³æ–‡ä»¶çš„blockã€inodeç©ºé—´è¢«å…¨éƒ¨æ¸…ç©ºæ”¶å›ã€‚uï¼šä¸sç›¸åï¼Œå½“è®¾å®šä¸ºuæ—¶ï¼Œæ•°æ®å†…å®¹å…¶å®è¿˜å­˜åœ¨ç£ç›˜ä¸­ï¼Œå¯ä»¥ç”¨äºundeletionã€‚å„å‚æ•°é€‰é¡¹ä¸­å¸¸ç”¨åˆ°çš„æ˜¯aå’Œiã€‚aé€‰é¡¹å¼ºåˆ¶åªå¯æ·»åŠ ä¸å¯åˆ é™¤ï¼Œå¤šç”¨äºæ—¥å¿—ç³»ç»Ÿçš„å®‰å…¨è®¾å®šã€‚è€Œiæ˜¯æ›´ä¸ºä¸¥æ ¼çš„å®‰å…¨è®¾å®šï¼Œåªæœ‰superuser (root) æˆ–å…·æœ‰CAP_LINUX_IMMUTABLEå¤„ç†èƒ½åŠ›ï¼ˆæ ‡è¯†ï¼‰çš„è¿›ç¨‹èƒ½å¤Ÿæ–½åŠ è¯¥é€‰é¡¹ã€‚ ä¾‹ï¼š 12345chattr +i /tmp/testfile1 â€”â€”å¢åŠ iæƒé™chattr +a /tmp/testfile1 â€”â€”å¢åŠ aæƒé™æŸ¥çœ‹æ–‡ä»¶çš„attræƒé™å¯ä½¿ç”¨lsattrå‘½ä»¤lsattr /tmp/testfile1 â€”â€”æŸ¥çœ‹æ–‡ä»¶éšè—æƒé™ ACL(è®¿é—®æ§åˆ¶åˆ—è¡¨)Linuxä¸­-rwxrwxrwx.è¿™ç§æƒé™æ–¹å¼åªèƒ½è§„èŒƒå‡ºä¸‰ç§ç±»å‹çš„æƒé™ï¼Œåœ¨ç³»ç»Ÿçš„ä½¿ç”¨ä¸­å¹¶ä¸èƒ½å®Œå…¨çš„æ»¡è¶³ç®¡ç†è€…å¯¹äºç”¨æˆ·æƒé™çš„æŒ‡å®šï¼Œå› æ­¤Linuxæ¨å‡ºäº†ACLè®¿é—®æ§åˆ¶åˆ—è¡¨è¿™ç§æƒé™ç®¡ç†æ–¹æ³•ï¼Œæ­¤æ–¹æ³•å¯ä»¥é’ˆå¯¹ä¸åŒçš„ç”¨æˆ·å’Œç»„æ¥åˆ†é…ä¸åŒçš„æƒé™é…ç½®ä¸å±€é™äºåŸå§‹çš„UGOæƒé™ç±»å‹ã€‚ ACLæƒé™çš„ç§ç±» Râ€”â€”è¯»æƒé™ Wâ€”â€”å†™æƒé™ Xâ€”â€”æ‰§è¡Œæƒé™ aclè®¿é—®æ§åˆ¶åˆ—è¡¨å¯¹äºæƒé™çš„è§„èŒƒå’ŒUGOç±»å‹çš„æƒé™æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæ˜¯é€šè¿‡RWXæ¥ç»„åˆæ§åˆ¶ç”¨æˆ·æƒé™ã€‚ä½†è®¾ç½®æ–¹æ³•ä¸åŒå…·ä½“å¦‚ä¸‹ è®¾ç½®æ–¹æ³•ï¼š 1234setfacl å‚æ•° æ–‡ä»¶-m è®¾ç½®aclè§„åˆ™-x åˆ é™¤ç”¨æˆ·çš„aclè§„åˆ™-b æ¸…ç©ºaclè§„åˆ™ ä¾‹ï¼š 123setfacl -m u:test:rwx /tmp/testfile1 â€”â€”èµ‹äºˆç”¨æˆ·testå¯¹äºæ–‡ä»¶testfile1æœ‰RWXæƒé™setfacl -x u:test /tmp/testfile1 â€”â€”åˆ é™¤ç”¨æˆ·testå¯¹äºæ–‡ä»¶testfile1çš„aclæ¡ç›®setfacl -b /tmp/testfile1 â€”â€”æ¸…ç©ºtestfile1æ–‡ä»¶çš„aclæ¡ç›® æŸ¥çœ‹æ–‡ä»¶aclæ˜¯å¦å¼€å¯å¯ä»¥é€šè¿‡ls -l æŸ¥çœ‹æ–‡ä»¶æƒé™å­—æ®µ æœ€åä¸€ä½æ˜¯å¦ä¸º+å·ã€‚å¦‚ï¼š-rwxrwxrwx+åˆ™æ­¤æ–‡ä»¶å¼€å¯äº†aclï¼Œä¹Ÿå¯é€šè¿‡å‘½ä»¤getfacl /tmp/testfile1æ¥æŸ¥çœ‹æ–‡ä»¶å…·ä½“aclæ¡ç›®ä¿¡æ¯ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"acl","slug":"acl","permalink":"https://www.xiemx.com/tags/acl/"}],"author":"xiemx"},{"title":"Linuxé“¾æ¥æ–‡ä»¶ï¼ˆlnï¼‰","slug":"linux-ln","date":"2015-11-05T01:11:15.000Z","updated":"2019-10-21T06:57:42.819Z","comments":true,"path":"/2015/11/05/linux-ln/","link":"","permalink":"https://www.xiemx.com/2015/11/05/linux-ln/","excerpt":"","text":"Linuxç³»ç»Ÿä¸­,å†…æ ¸ä¸ºæ¯ä¸€ä¸ªæ–‡ä»¶åˆ†é…ä¸€ä¸ªinode ï¼Œæ–‡ä»¶å±æ€§ä¿å­˜åœ¨inodeé‡Œï¼Œåœ¨è®¿é—®æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶ç³»ç»Ÿé€šè¿‡æŸ¥æ‰¾åˆ°æ–‡ä»¶çš„inodeä¸­å…³äºæ–‡ä»¶çš„å­˜æ”¾blockï¼Œè¿›è€Œå»ç›¸å¯¹åº”çš„blockä¸­è¯»å–æ–‡ä»¶å†…å®¹ã€‚è€Œé“¾æ¥æ˜¯ä¸€ç§åœ¨å…±äº«æ–‡ä»¶å’Œè®¿é—®å®ƒçš„ç”¨æˆ·çš„è‹¥å¹²ç›®å½•é¡¹ä¹‹é—´å»ºç«‹è”ç³»çš„ä¸€ç§æ–¹æ³•ï¼Œåœ¨ç³»ç»Ÿä¸­æœ‰ç›¸åŒçš„ä¸€ä»½æ–‡ä»¶Aå’ŒBä¸¤ä¸ªç”¨æˆ·éƒ½éœ€è¦è¿™ä¸ªæ–‡ä»¶ï¼Œä¼ ç»Ÿæ¨¡å¼ä¸‹æˆ‘ä»¬ä¼šç›´æ¥å¤åˆ¶æ–‡ä»¶åˆ†ç»™2ä¸ªç”¨æˆ·ï¼Œè¿™æ ·è™½ç„¶èƒ½å®ç°ç›®çš„ã€‚ä½†æ˜¯ä¸¤ä»½æ–‡ä»¶å ç”¨äº†æˆ‘ä»¬åŒå€çš„blockå’Œinodeèµ„æºã€‚å¦‚æœè¿™ä¸ªæ–‡ä»¶éå¸¸å¤§çš„è¯å°†é€ æˆèµ„æºçš„æå¤§æµªè´¹ã€‚æ­¤æ—¶Linuxå¼•å…¥é“¾æ¥çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é“¾æ¥çš„æ–¹å¼å»å°†æ–‡ä»¶å…±äº«ç»™ä¸¤ä¸ªç”¨æˆ·ã€‚ ä¸¤ç§é“¾æ¥ï¼š ç¡¬é“¾æ¥(Hard Link) å’Œè½¯é“¾æ¥(Soft Link)ï¼Œè½¯é“¾æ¥åˆç§°ä¸ºç¬¦å·é“¾æ¥ï¼ˆSymbolic linkï¼‰ ç¡¬é“¾æ¥ç¡¬é“¾æ¥æ–‡ä»¶å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ–‡ä»¶çš„inodeï¼Œç³»ç»Ÿä¸é‡æ–°åˆ†é…inodeã€‚ç¡¬é“¾æ¥æ–‡ä»¶ä¸­è®°å½•çš„æ˜¯æºæ–‡ä»¶çš„inodeä¿¡æ¯ï¼Œæ‰€ä»¥ç¡¬é“¾æ¥æ–‡ä»¶çš„å±æ€§å’Œæºæ–‡ä»¶çš„å±æ€§ç›¸åŒåªæ˜¯åœ¨ç¡¬é“¾æ¥è¿æ¥æ•°ä¸Š+1ï¼Œç¡¬é“¾æ¥æ–‡ä»¶ã€‚ åˆ›å»ºæ–¹æ³•ï¼š 1ln æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶ ä¾‹å­ï¼š 1234ln /tmp/testdir/testdir2/testfile1 /tmp/testfile1ls -i /tmp/testdir/testdir2/testfile1 /tmp/testfile11491138 -rw-râ€“râ€“ 1 root root 48 11-14 14:10 /tmp/testdir/testdir2/testfile11491138 -rw-râ€“râ€“ 1 root root 48 11-14 14:29 /tmp/testfile1 æ³¨æ„äº‹é¡¹ï¼š 1.ç¡¬é“¾æ¥æ–‡ä»¶æ— æ³•è·¨æ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿinodeä¿¡æ¯è®°å½•çš„ä¿¡æ¯ä¸åŒã€‚ 2.åªèƒ½å¯¹æ–‡ä»¶è®¾ç½®ç¡¬é“¾æ¥ 3.åˆ é™¤ç¡¬é“¾æ¥æ–‡ä»¶æˆ–æºæ–‡ä»¶ï¼Œåªä¼šä½¿ç¡¬é“¾æ¥è®¡æ•°å™¨-1ï¼Œä¸ä¼šåˆ é™¤æ–‡ä»¶å†…å®¹ã€‚ç›´åˆ°ç¡¬é“¾æ¥è®¡æ•°å™¨ä¸º1æ—¶ï¼Œåœ¨åˆ é™¤æ–‡ä»¶ï¼Œæ­¤æ—¶åˆ™ä¼šæ¸…é™¤æ–‡ä»¶ã€‚ 4.ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶åŒæ—¶è¢«ä¿®æ”¹ è½¯è¿æ¥è½¯è¿æ¥é€šè¿‡å­˜å‚¨æºæ–‡ä»¶çš„è·¯å¾„æ¥å®šä½æºæ–‡ä»¶ã€‚æ‰€ä»¥è½¯è¿æ¥æ–‡ä»¶çš„å¤§å°ä¸ºè·¯å¾„çš„é•¿åº¦ã€‚è½¯é“¾æ¥æ–‡ä»¶å±æ€§åŒæºæ–‡ä»¶å±æ€§ä¸åŒã€‚ åˆ›å»ºæ–¹æ³•: 1ln -s æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶ ä¾‹å­ï¼š 123ln -s /tmp/testfile /testfilesoftls -i /tmp/testfile /testfilesoft1491138 -rw-râ€“râ€“ 1 root root 48 11-14 14:17 /tmp/testfile 1491140 lrwxrwxrwx 1 root root 13 11-14 14:24 /testfilesoft -&gt; /tmp/testfile æŸ¥çœ‹ä»¥ä¸Šæ–‡ä»¶çš„è¾“å‡ºç»“æœï¼Œæºæ–‡ä»¶å’Œé“¾æ¥æ–‡ä»¶çš„å±æ€§ä¸åŒã€‚é“¾æ¥æ–‡ä»¶çš„å¤§å°ä¸º13å­—èŠ‚ï¼Œè¿™13å­—èŠ‚ç­‰äºè½¯è¿æ¥çš„è·¯å¾„â€œ/tmp/testfileâ€çš„é•¿åº¦ã€‚ æ³¨æ„äº‹é¡¹ï¼š 1.è½¯è¿æ¥æ–‡ä»¶è®°å½•çš„æ˜¯æ–‡ä»¶è·¯å¾„å› æ­¤å¯ä»¥è·¨æ–‡ä»¶ç³»ç»Ÿåˆ›å»º 2.å¯é’ˆå¯¹ç›®å½•è®¾ç½®è½¯è¿æ¥ 3.åˆ é™¤è½¯è¿æ¥æ–‡ä»¶ä¸å½±å“å…¶å®ƒé“¾æ¥æ–‡ä»¶çš„è®¿é—®ï¼Œåˆ é™¤æºæ–‡ä»¶åˆ™æ‰€æœ‰è½¯è¿æ¥æ–‡ä»¶éƒ½æ— æ³•è®¿é—®ã€‚ 4.ä¿®æ”¹ä»»æ„æ–‡ä»¶ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½ä¼šå˜åŠ¨ Linuxç³»ç»Ÿä¸­è½¯ç¡¬é“¾æ¥çš„æ–¹å¼å¯ä½¿ç”¨çš„ç¯å¢ƒä¸åŒï¼Œå…¶ä¸­è½¯è¿æ¥ä½¿ç”¨çš„æœ€å¤š","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"command","slug":"command","permalink":"https://www.xiemx.com/tags/command/"},{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"Linuxç”¨æˆ·å’Œç»„","slug":"linux-user-and-group","date":"2015-11-04T23:11:13.000Z","updated":"2019-10-21T06:57:43.061Z","comments":true,"path":"/2015/11/05/linux-user-and-group/","link":"","permalink":"https://www.xiemx.com/2015/11/05/linux-user-and-group/","excerpt":"","text":"ç”¨æˆ·å’Œç»„çš„é…ç½®æ–‡ä»¶åœ¨linuxä¸­ï¼Œç”¨æˆ·å¸å·ï¼Œç”¨æˆ·å¯†ç ï¼Œç”¨æˆ·ç»„ä¿¡æ¯å’Œç”¨æˆ·ç»„å¯†ç å‡æ˜¯å­˜æ”¾åœ¨ä¸åŒçš„é…ç½®æ–‡ä»¶ä¸­çš„ã€‚ /etc/passwdå­˜æ”¾ç”¨æˆ·é…ç½®ä¿¡æ¯ /etc/shadowå­˜æ”¾ç”¨æˆ·å¯†ç å’Œå¯†ç ç­–ç•¥ /etc/groupå­˜æ”¾ç»„é…ç½®ä¿¡æ¯ /etc/gshadowå­˜æ”¾ç»„é…ç½®ä¿¡æ¯ /etc/passwdæ–‡ä»¶ä¸­æ¯è¡Œå­˜å‚¨ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯ä»¥ï¼šåˆ†å‰²åˆ†7æ®µå…·ä½“å«ä¹‰å¦‚ä¸‹ ç”¨æˆ·å¸å·:å¯†ç å ä½ç¬¦:ç”¨æˆ·ID:ç”¨æˆ·ç»„ID:æè¿°:ç”¨æˆ·ä¸»ç›®å½•:ç”¨æˆ·æ‰€ä½¿ç”¨çš„shell 123456[mingxu.xie@cn-aux-cc ~]$ cat /etc/passwdroot:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinadm:x:3:4:adm:/var/adm:/sbin/nologinlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin /etc/shadowæ–‡ä»¶å¯¹åº”passwdæ–‡ä»¶åˆ†9æ®µï¼Œå…·ä½“ä¿¡æ¯å¦‚ä¸‹ ç”¨æˆ·å:å¯†ç :æœ€è¿‘ä¿®æ”¹æ—¶é—´:æœ€çŸ­æœ‰æ•ˆæ—¶é—´:æœ€é•¿æœ‰æ•ˆæ—¶é—´:è¿‡æœŸæé†’æ—¥æœŸ:è¿‡æœŸåå®½é™æ—¶é—´:è´¦æˆ·å¤±æ•ˆæ—¶é—´:ä¿ç•™å­—æ®µ1234567[mingxu.xie@cn-aux-cc ~]$ sudo cat /etc/shadowroot:*LOCK*:14600::::::bin:*:16323:0:99999:7:::daemon:*:16323:0:99999:7:::adm:*:16323:0:99999:7:::lp:*:16323:0:99999:7:::test:$6$getqHfvX$xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx:18185:0:99999:7::: /etc/groupæ–‡ä»¶ä¿å­˜äº†æ‰€æœ‰ç»„çš„ä¿¡æ¯ã€‚æ–‡ä»¶ä¸­æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªç»„ç”±3ä¸ªå†’å·åˆ†éš”æˆ4æ®µï¼Œå…·ä½“ä¿¡æ¯å¦‚ä¸‹ ç»„å:å¯†ç å ä½ç¬¦:ç»„ID:ç»„æˆå‘˜123456789101112[mingxu.xie@cn-aux-cc ~]$ sudo cat /etc/grouproot:x:0:bin:x:1:bin,daemondaemon:x:2:bin,daemonsys:x:3:bin,admadm:x:4:adm,daemontty:x:5:disk:x:6:lp:x:7:daemonmem:x:8:kmem:x:9:wheel:x:10:ec2-user,test /etc/gshadowæ–‡ä»¶å¯¹åº”groupæ–‡ä»¶ï¼Œåˆ†4æ®µï¼Œå…·ä½“ä¿¡æ¯å¦‚ä¸‹ ç»„å:å£ä»¤:ç»„ç®¡ç†è€…:ç»„å†…ç”¨æˆ·åˆ—è¡¨123456[mingxu.xie@cn-aux-cc ~]$ sudo cat /etc/gshadowroot:::bin:::bin,daemondaemon:::bin,daemonsys:::bin,admadm:::adm,daemon ä¿®æ”¹ä»¥ä¸Šæ–‡ä»¶å¯ä»¥å®Œæˆå¯¹ç”¨æˆ·å’Œç»„å±æ€§å’Œé…ç½®çš„æ”¹å˜ï¼Œ/sbin/nologinçš„shellå¯ä»¥ä½¿ç”¨æˆ·ä¸å¯ç™»é™†ç­‰ç­‰ã€‚ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤æ¥ä¿®æ”¹ç”¨æˆ·å±æ€§ï¼Œä½†å®è´¨ä¹Ÿæ˜¯ä¿®æ”¹æ­¤é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°ã€‚ ç”¨æˆ·å’Œç»„çš„æ“ä½œ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647481ã€æ·»åŠ æ–°ç”¨æˆ· useradd é€‰é¡¹ ç”¨æˆ·å å…¶ä¸­å„é€‰é¡¹å«ä¹‰å¦‚ä¸‹ï¼š -c comment æŒ‡å®šä¸€æ®µæ³¨é‡Šæ€§æè¿°ã€‚ -d ç›®å½• æŒ‡å®šç”¨æˆ·ä¸»ç›®å½•ï¼Œå¦‚æœæ­¤ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åŒæ—¶ä½¿ç”¨-mé€‰é¡¹ï¼Œèƒ½åˆ›å»ºä¸»ç›®å½•ã€‚ -g æŒ‡å®šç”¨æˆ·æ‰€å±çš„ç”¨æˆ·ç»„ã€‚ -G æŒ‡å®šç”¨æˆ·æ‰€å±çš„é™„åŠ ç»„ã€‚ -s æŒ‡å®šç”¨æˆ·çš„ç™»å½•Shellã€‚ -u æŒ‡å®šç”¨æˆ·çš„ç”¨æˆ·å·ï¼Œå¦‚æœåŒæ—¶æœ‰-oé€‰é¡¹ï¼Œåˆ™èƒ½é‡å¤ä½¿ç”¨å…¶ä»–ç”¨æˆ·çš„æ ‡è¯†å·ã€‚useradd -G bin -g root -s /sbin/noloing -u 101 testuser2ã€æ·»åŠ ç»„ ç”¨æ³•ï¼šgroupadd é€‰é¡¹ ç”¨æˆ·å å…¶ä¸­å„é€‰é¡¹å«ä¹‰å¦‚ä¸‹ï¼š -g æŒ‡å®šç”¨æˆ·ç»„IDgroupadd -g 40000 testgrp3ã€ä¿®æ”¹ç”¨æˆ·å±æ€§å’Œç»„å±æ€§ groupmod â€”â€”ä¿®æ”¹ç»„å±æ€§ usermod â€”â€”ä¿®æ”¹ç”¨æˆ·å±æ€§ å‚æ•°ã€è¯­æ³•å’Œåˆ›å»ºæ—¶ä½¿ç”¨çš„ç›¸åŒã€‚4ã€åˆ é™¤ç”¨æˆ·å’Œç»„ userdel testuser â€”â€”é»˜è®¤åˆ é™¤testuserç”¨æˆ·çš„é…ç½®ä½†ä¸åˆ é™¤å®¶ç›®å½•å’Œé‚®ä»¶éœ€æ‰‹å·¥åˆ é™¤ userdel -r testuser â€”â€”åˆ é™¤ç”¨æˆ·åŒæ—¶åˆ é™¤å®¶ç›®å½•æ–‡ä»¶å’Œé‚®ä»¶ groupdel testgrp â€”â€”åˆ é™¤ç»„5ã€ä¿®æ”¹ç”¨æˆ·å¯†ç ç­–ç•¥[mingxu.xie@cn-aux-cc ~]$ chage --helpUsage: chage [options] [LOGIN]Options: -d, --lastday LAST_DAY set date of last password change to LAST_DAY -E, --expiredate EXPIRE_DATE set account expiration date to EXPIRE_DATE -h, --help display this help message and exit -I, --inactive INACTIVE set password inactive after expiration to INACTIVE -l, --list show account aging information -m, --mindays MIN_DAYS set minimum number of days before password change to MIN_DAYS -M, --maxdays MAX_DAYS set maximim number of days before password change to MAX_DAYS -W, --warndays WARN_DAYS set expiration warning days to WARN_DAYSç³»ç»Ÿæ·»åŠ ç”¨æˆ·æ—¶å¦‚æœæ²¡æœ‰è§„å®šç”¨æˆ·çš„è¯¦ç»†å±æ€§ï¼Œåˆ™ç³»ç»Ÿé»˜è®¤å‚ç…§/etc/login.defs å’Œ/etc/default/useraddæ¥é…ç½®ç”¨æˆ·çš„å±æ€§ï¼ä¿®æ”¹æ­¤å¤„æ–‡æ¡£å¯ä»¥è®¾ç½®é»˜è®¤ç”¨æˆ·æ·»åŠ æ—¶çš„å±æ€§ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"},{"name":"commands","slug":"commands","permalink":"https://www.xiemx.com/tags/commands/"}],"author":"xiemx"},{"title":"LinuxæŸ¥æ‰¾","slug":"linux-find-commands","date":"2015-10-16T02:10:31.000Z","updated":"2019-10-21T06:57:42.716Z","comments":true,"path":"/2015/10/16/linux-find-commands/","link":"","permalink":"https://www.xiemx.com/2015/10/16/linux-find-commands/","excerpt":"","text":"find åŠŸèƒ½å¼ºå¤§ï¼Œç”¨æ³•è‡ªè¡Œgoogle locate locateå‘½ä»¤å…¶å®æ˜¯â€find -nameâ€çš„å¦ä¸€ç§å†™æ³•ï¼Œä½†æ˜¯è¦æ¯”åè€…å¿«å¾—å¤šï¼ŒåŸå› åœ¨äºå®ƒä¸æœç´¢å…·ä½“ç›®å½•ï¼Œè€Œæ˜¯æœç´¢ä¸€ä¸ªæ•°æ®åº“ï¼ˆ/var/lib/mlocate/mlocate.dbï¼‰ï¼Œè¿™ä¸ªæ•°æ®åº“ä¸­å« æœ‰æœ¬åœ°æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ã€‚Linuxç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªæ•°æ®åº“ï¼Œå¹¶ä¸”æ¯å¤©è‡ªåŠ¨æ›´æ–°ä¸€æ¬¡ï¼Œæ‰€ä»¥ä½¿ç”¨locateå‘½ä»¤æŸ¥ä¸åˆ°æœ€æ–°å˜åŠ¨è¿‡çš„æ–‡ä»¶ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ ä»¥åœ¨ä½¿ç”¨locateä¹‹å‰ï¼Œå…ˆä½¿ç”¨updatedbå‘½ä»¤ï¼Œæ‰‹åŠ¨æ›´æ–°æ•°æ®åº“ã€‚ ä¾‹ï¼š locate /etc/sh* â€”â€”æœç´¢etcç›®å½•ä¸‹æ‰€æœ‰ä»¥shå¼€å¤´çš„æ–‡ä»¶ã€‚ locate -i ~/m*â€”â€”æœç´¢ç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼Œæ‰€æœ‰ä»¥må¼€å¤´çš„æ–‡ä»¶ï¼Œå¹¶ä¸”å¿½ç•¥å¤§å°å†™ã€‚ whereis whereiså‘½ä»¤åªèƒ½ç”¨äºç¨‹åºåçš„æœç´¢ï¼Œè€Œä¸”åªæœç´¢äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå‚æ•°-bï¼‰ã€manè¯´æ˜æ–‡ä»¶ï¼ˆå‚æ•°-mï¼‰å’Œæºä»£ç æ–‡ä»¶ï¼ˆå‚æ•°-sï¼‰ã€‚å¦‚æœçœç•¥å‚æ•°ï¼Œåˆ™è¿”å›æ‰€æœ‰ä¿¡æ¯ã€‚ which whichå‘½ä»¤çš„ä½œç”¨æ˜¯ï¼Œåœ¨PATHå˜é‡æŒ‡å®šçš„è·¯å¾„ä¸­ï¼Œæœç´¢æŸä¸ªç³»ç»Ÿå‘½ä»¤çš„ä½ç½®ï¼Œå¹¶ä¸”è¿”å›ç¬¬ä¸€ä¸ªæœç´¢ç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨whichå‘½ä»¤ï¼Œå°±å¯ä»¥çœ‹åˆ°æŸä¸ªç³»ç»Ÿå‘½ä»¤æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠæ‰§è¡Œçš„åˆ°åº•æ˜¯å“ªä¸€ä¸ªä½ç½®çš„å‘½ä»¤ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/categories/linux/"}],"tags":[{"name":"command","slug":"command","permalink":"https://www.xiemx.com/tags/command/"},{"name":"linux","slug":"linux","permalink":"https://www.xiemx.com/tags/linux/"}],"author":"xiemx"},{"title":"PHP è°ƒç”¨date()å‡½æ•°æ—¶åŒºæŠ¥é”™","slug":"php-data-timezone","date":"2015-10-10T20:10:30.000Z","updated":"2019-10-21T06:57:42.386Z","comments":true,"path":"/2015/10/11/php-data-timezone/","link":"","permalink":"https://www.xiemx.com/2015/10/11/php-data-timezone/","excerpt":"","text":"ç°è±¡ï¼š1234â€œPHP Warning: date() [function.date]: It is not safe to rely on the systemâ€™s timezone settings.You are *required* to use the date.timezone setting or the date_default_timezone_set() function.In case you used any of those methods and you are still getting this warning, you most likelymisspelled the timezone identifier. We selected â€˜UTCâ€™ for â€™8.0/no DSTâ€™ instead inâ€ php æœ‰äº›ç‰ˆæœ¬é»˜è®¤çš„æ—¶åŒºä¸ºæ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæ•´æ—¶åŒºä¸º+0800 â€œAsia/shanghaiâ€ è§£å†³ä»¥ä¸‹æ˜¯ä¸‰ç§æ–¹æ³•(ä»»é€‰ä¸€ç§éƒ½è¡Œ)ï¼š 1231. åœ¨é¡µå¤´ä½¿ç”¨date_default_timezone_set()è®¾ç½® date_default_timezone_set('PRC');2. åœ¨é¡µå¤´ä½¿ç”¨ ini_set('date.timezone','Asia/Shanghai');3. ä¿®æ”¹php.iniã€‚æ‰“å¼€php.iniæŸ¥æ‰¾date.timezone å»æ‰å‰é¢çš„åˆ†å·ä¿®æ”¹æˆä¸ºï¼šdate.timezone = PRC","categories":[{"name":"php","slug":"php","permalink":"https://www.xiemx.com/categories/php/"}],"tags":[{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"},{"name":"php","slug":"php","permalink":"https://www.xiemx.com/tags/php/"}],"author":"xiemx"},{"title":"windowç³»ç»Ÿæ–‡ä»¶æˆ–ç›®å½•æ— æ³•åˆ é™¤è§£å†³æ–¹æ³•","slug":"window-force-delete-file","date":"2015-10-07T20:10:01.000Z","updated":"2019-10-22T07:12:54.182Z","comments":true,"path":"/2015/10/08/window-force-delete-file/","link":"","permalink":"https://www.xiemx.com/2015/10/08/window-force-delete-file/","excerpt":"","text":"æ–°å»º.BATæ‰¹å¤„ç†æ–‡ä»¶è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œç„¶åå°†è¦åˆ é™¤çš„æ–‡ä»¶æ‹–æ”¾åˆ°æ‰¹å¤„ç†æ–‡ä»¶å›¾æ ‡ä¸Šå³å¯åˆ é™¤ã€‚ 12DEL /F /A /QRD /S /Q å¯åˆ©ç”¨è½¯ä»¶æ¥è§£é”å ç”¨æ–‡ä»¶çš„è¿›ç¨‹æ¨èunlock","categories":[{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/categories/windows/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/tags/windows/"},{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"}],"author":"xiemx"},{"title":"session_start()å‡½æ•°æŠ¥é”™","slug":"session_start-error","date":"2015-09-29T17:09:15.000Z","updated":"2019-10-21T09:02:35.142Z","comments":true,"path":"/2015/09/30/session_start-error/","link":"","permalink":"https://www.xiemx.com/2015/09/30/session_start-error/","excerpt":"","text":"ç°è±¡Warning: session_start() [function.session-start]: Cannot send session cache limiter - headers already sent è§£å†³(PHP 4, PHP 5) session_start â€” å¯åŠ¨æ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯ åœ¨è°ƒç”¨æ­¤å‡½æ•°æ˜¯ä¸èƒ½å‘æµè§ˆå™¨è¾“å‡ºå†…å®¹ï¼Œå¦‚å‡ºç°ä¸Šé¢æŠ¥é”™å¯ä»¥å°†å‡½æ•°æ”¾åˆ° &lt;ï¼Ÿphpæœ€ä¸Šæ–¹é¡¶å¥å¦‚ä¸‹ 1234&lt;?phpsession_start();include xxxxxxxx;?&gt;","categories":[{"name":"php","slug":"php","permalink":"https://www.xiemx.com/categories/php/"},{"name":"debug","slug":"php/debug","permalink":"https://www.xiemx.com/categories/php/debug/"}],"tags":[{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"},{"name":"php","slug":"php","permalink":"https://www.xiemx.com/tags/php/"}],"author":"xiemx"},{"title":"2003ç³»ç»Ÿæ§åˆ¶é¢æ¿æ‰“ä¸å¼€è§£å†³åŠæ³•","slug":"windows-cant-open-contral","date":"2015-09-28T19:09:32.000Z","updated":"2019-10-21T09:02:24.150Z","comments":true,"path":"/2015/09/29/windows-cant-open-contral/","link":"","permalink":"https://www.xiemx.com/2015/09/29/windows-cant-open-contral/","excerpt":"","text":"1234è¿è¡Œregeditæ‰“å¼€æ³¨å†Œè¡¨æŠŠ HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Nls\\Localeä¸‹çš„ä¸¤ä¸ªé¡¹ä¿®æ”¹ä¸º\"(Default)\"=\"00000409\"\"00000804\"=\"1\"","categories":[{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/categories/windows/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/tags/windows/"},{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"}],"author":"xiemx"},{"title":"åº”ç”¨ç¨‹åºæ± 0x80å¤§é‡æŠ¥é”™è§£å†³åŠæ³•","slug":"apppool-0x80-error","date":"2015-09-28T18:09:58.000Z","updated":"2019-10-21T09:02:09.437Z","comments":true,"path":"/2015/09/29/apppool-0x80-error/","link":"","permalink":"https://www.xiemx.com/2015/09/29/apppool-0x80-error/","excerpt":"","text":"ä¸ºåº”ç”¨ç¨‹åºæ± æä¾›æœåŠ¡çš„è¿›ç¨‹æ„å¤–ç»ˆæ­¢ã€‚è¿›ç¨‹IDæ˜¯ã€‚è¿›ç¨‹é€€å‡ºä»£ç æ˜¯â€™0x80â€™: 1HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\W3SVC\\Parametersé”®ä¸‹æ–°å»ºä¸€ä¸ªDWORDé¡¹ï¼Œåå­—ä¸ºï¼šUseSharedWPDesktopå€¼ä¸º1 é‡å¯IIS","categories":[{"name":"iis","slug":"iis","permalink":"https://www.xiemx.com/categories/iis/"},{"name":"windows","slug":"iis/windows","permalink":"https://www.xiemx.com/categories/iis/windows/"}],"tags":[{"name":"iis","slug":"iis","permalink":"https://www.xiemx.com/tags/iis/"},{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/tags/windows/"},{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"}],"author":"xiemx"},{"title":"ç½‘ç«™æ”¯æŒ.apkæ–‡ä»¶ä¸‹è½½çš„è®¾ç½®æ–¹æ³•","slug":"website-download-apk","date":"2015-09-28T18:09:43.000Z","updated":"2019-10-21T09:02:19.371Z","comments":true,"path":"/2015/09/29/website-download-apk/","link":"","permalink":"https://www.xiemx.com/2015/09/29/website-download-apk/","excerpt":"","text":"iisæ”¯æŒ.apkæ–‡ä»¶ä¸‹è½½çš„è®¾ç½®IISæœåŠ¡å™¨ä¸èƒ½ä¸‹è½½.apkæ–‡ä»¶çš„åŸå› ï¼šiisçš„é»˜è®¤MIMEç±»å‹ä¸­æ²¡æœ‰.apkæ–‡ä»¶ï¼Œæ‰€ä»¥æ— æ³•ä¸‹è½½ã€‚ IISæœåŠ¡å™¨ä¸èƒ½ä¸‹è½½.apkæ–‡ä»¶çš„è§£å†³åŠæ³•ï¼šæ—¢ç„¶.apkæ— æ³•ä¸‹è½½æ˜¯å› ä¸ºæ²¡æœ‰MIMEï¼Œé‚£ä¹ˆæ·»åŠ ä¸€ä¸ªMIMEç±»å‹å°±å¯ä»¥äº†ã€‚ IISæœåŠ¡å™¨ä¸èƒ½ä¸‹è½½.apkæ–‡ä»¶çš„è§£å†³æ­¥éª¤ï¼š 12345æ‰“å¼€IISæœåŠ¡ç®¡ç†å™¨ï¼Œæ‰¾åˆ°æœåŠ¡å™¨ï¼Œå³é”®-å±æ€§ï¼Œæ‰“å¼€IISæœåŠ¡å±æ€§ï¼›å•å‡»MIMEç±»å‹ä¸‹çš„â€œMIMEç±»å‹â€æŒ‰é’®ï¼Œæ‰“å¼€MIMEç±»å‹è®¾ç½®çª—å£ï¼›å•å‡»â€œæ–°å»ºâ€ï¼Œå»ºç«‹æ–°çš„MIMEç±»å‹ï¼›æ‰©å±•åä¸­å¡«å†™â€œ.apkâ€,MIMEç±»å‹ä¸­å¡«å†™apkçš„MIMEç±»å‹`application/vnd.android.package-archive` é‡å¯IISï¼Œä½¿è®¾ç½®ç”Ÿæ•ˆã€‚ apacheæ”¯æŒ.apkæ–‡ä»¶ä¸‹è½½çš„è®¾ç½®åœ¨Apacheå®‰è£…ç›®å½•ä¸‹çš„mime.typesåŠ ä¸Šä»¥ä¸‹ä¸€è¡Œè¯­å¥ 1application/vnd.android.package-archive apk; é‡å¯apacheå³å¯ nginxæ”¯æŒ.apkæ–‡ä»¶ä¸‹è½½çš„è®¾ç½®apk å’Œ .ipaåˆ†åˆ«æ˜¯androidåº”ç”¨å’Œiosåº”ç”¨çš„æ‰©å±•åã€‚ å¦‚æœåœ¨æµè§ˆå™¨ä¸‹è½½è¿™äº›æ–‡ä»¶ä¸ºåç¼€çš„æ–‡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨é‡å‘½åä¸ºzipæ–‡ä»¶ã€‚ å½“ç„¶å¯ä»¥ä¸‹è½½åæ‰‹åŠ¨ä¿®æ”¹åç¼€ï¼Œä¾ç„¶å¯ä»¥å®‰è£…ã€‚ å¦‚æœæƒ³ä¸‹è½½åç¼€ç›´æ¥å°±æ˜¯apk ipaçš„ï¼Œå¯ä»¥ä¿®æ”¹ /usr/local/nginx/confç›®å½•ä¸‹çš„mime.types 12application/vnd.android.package-archive apk;application/iphone pxl ipa; å¢åŠ ä¸Šè¿°é…ç½®ï¼Œé‡å¯nginxç”Ÿæ•ˆ","categories":[{"name":"iis","slug":"iis","permalink":"https://www.xiemx.com/categories/iis/"},{"name":"nginx","slug":"iis/nginx","permalink":"https://www.xiemx.com/categories/iis/nginx/"}],"tags":[{"name":"iis","slug":"iis","permalink":"https://www.xiemx.com/tags/iis/"},{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"},{"name":"nginx","slug":"nginx","permalink":"https://www.xiemx.com/tags/nginx/"}],"author":"xiemx"},{"title":"PHPCMS V9 â€œå¯†ç é‡è¯•æ¬¡æ•°å¤ªå¤šï¼Œè¯·è¿‡-xxxåˆ†é’Ÿåé‡æ–°ç™»å½•ï¼â€çš„è§£å†³åŠæ³•","slug":"phpcms-v9-password-retry-too-more","date":"2015-09-28T18:09:35.000Z","updated":"2019-10-21T09:02:14.347Z","comments":true,"path":"/2015/09/29/phpcms-v9-password-retry-too-more/","link":"","permalink":"https://www.xiemx.com/2015/09/29/phpcms-v9-password-retry-too-more/","excerpt":"","text":"æ‰¾åˆ°æ–‡ä»¶ /phpcms/modules/admin/index.php å°†å¦‚ä¸‹ä»£ç æ³¨é‡Šæ‰ï¼š 1234if($rtime['times'] &gt;= $maxloginfailedtimes) &#123;$minute = 60-floor((SYS_TIME-$rtime['logintime'])/60);showmessage(L('wait_1_hour',array('minute'=&gt;$minute)));&#125; æ³¨æ„å“¦ï¼Œä¸€å…±æ˜¯4è¡Œã€‚","categories":[{"name":"php","slug":"php","permalink":"https://www.xiemx.com/categories/php/"}],"tags":[{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"},{"name":"php","slug":"php","permalink":"https://www.xiemx.com/tags/php/"},{"name":"CMS","slug":"CMS","permalink":"https://www.xiemx.com/tags/CMS/"}],"author":"xiemx"},{"title":"2003ç³»ç»Ÿ8Gå†…å­˜æ¡åªèƒ½è¯†åˆ«3Gè§£å†³åŠæ³•","slug":"windows-server-memory-limit","date":"2015-09-28T18:09:15.000Z","updated":"2019-10-21T09:02:29.360Z","comments":true,"path":"/2015/09/29/windows-server-memory-limit/","link":"","permalink":"https://www.xiemx.com/2015/09/29/windows-server-memory-limit/","excerpt":"","text":"ç°è±¡32ä½çš„2003ç³»ç»Ÿçš„æœºå™¨ï¼Œ8Gå†…å­˜æ¡åªèƒ½è¯†åˆ«3Gï¼Œè¿™ç§æƒ…å†µéœ€è¦è¿›ç³»ç»Ÿè¿›è¡Œä¿®æ”¹ã€‚å…·ä½“ä¿®æ”¹å¦‚ä¸‹ï¼šwin2003 32ä½ä¼ä¸šç‰ˆç†è®ºä¸Šèƒ½æ”¯æŒæœ€å¤§32Gå†…å­˜ï¼Œä½†æœ‰äº›æœºå™¨ç³»ç»Ÿåªè®¤3.25G è§£å†³åŠæ³•ï¼š1234Cï¼š\\boot.ini ä¿®æ”¹é‡Œé¢çš„å‘½ä»¤ï¼ˆ\\boot.iniæœ‰å¯èƒ½è¢«éšè—ï¼‰default=multi(0)disk(0)rdisk(0)partition(2)\\WINDOWS[operating systems](0)disk(0)rdisk(0)partition(2)\\WINDOWS=Windows Server 2003, Enterprise&amp;quot; /fastdetect /PAE","categories":[{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/categories/windows/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/tags/windows/"},{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"}],"author":"xiemx"},{"title":"è®¿é—®ç½‘ç«™è¦æ±‚è¾“å…¥å¯†ç ","slug":"iis-auth","date":"2015-08-23T18:08:15.000Z","updated":"2019-10-21T09:01:51.365Z","comments":true,"path":"/2015/08/24/iis-auth/","link":"","permalink":"https://www.xiemx.com/2015/08/24/iis-auth/","excerpt":"","text":"è®¿é—®ç½‘ç«™è¦æ±‚è¾“å…¥å¯†ç ï¼š æ–¹æ³•1 Internetâ€”åŸŸåå±æ€§â€”ç›®å½•å®‰å…¨æ€§â€”ç¼–è¾‘èº«ä»½è®¤è¯å’Œè®¿é—®æ§åˆ¶â€”â€”ä¿®æ”¹å¯†ç  ç½‘ç«™åº”ç”¨ç¨‹åºæ± â€”å±æ€§â€”æ ‡è¯†â€”â€”ä¿®æ”¹å¯†ç (å¯†ç å’Œä¸Šé¢ç›¸åŒ) æ–¹æ³•2ï¼š åˆ é™¤æƒé™ä¸­ä¸ç»Ÿä¸€çš„ç”¨æˆ·","categories":[{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/categories/windows/"},{"name":"iis","slug":"windows/iis","permalink":"https://www.xiemx.com/categories/windows/iis/"}],"tags":[{"name":"iis","slug":"iis","permalink":"https://www.xiemx.com/tags/iis/"},{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/tags/windows/"}],"author":"xiemx"},{"title":"phpmyadminä¸Šä¼ æ–‡ä»¶å¤§å°ä¿®æ”¹é™åˆ¶","slug":"phpmyadmin-upload-limit-size","date":"2015-08-23T18:08:12.000Z","updated":"2019-10-21T09:02:02.048Z","comments":true,"path":"/2015/08/24/phpmyadmin-upload-limit-size/","link":"","permalink":"https://www.xiemx.com/2015/08/24/phpmyadmin-upload-limit-size/","excerpt":"","text":"ä¿®æ”¹phpmyadminä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶ä¸»è¦åˆ†ä¿®æ”¹php.inié…ç½®æ–‡ä»¶å’Œphpmyadminé…ç½®æ–‡ä»¶ä¸¤ä¸ªæ­¥éª¤ã€‚ ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹php.inié…ç½®æ–‡ä»¶ä¸­æ–‡ä»¶ä¸Šä¼ å¤§å°é…ç½®**æ­¤æ­¥éª¤ä¸ä¸€èˆ¬çš„php.ini é…ç½®æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ–¹æ³•ä¸€è‡´ï¼Œéœ€è¦ä¿®æ”¹php.inié…ç½®æ–‡ä»¶ä¸­upload_max_filesizeå’Œpost_max_sizeä¸¤ä¸ªé€‰é¡¹å€¼ ç¬¬äºŒæ­¥ï¼šä¿®æ”¹phpæ‰§è¡Œæ—¶é—´åŠå†…å­˜é™åˆ¶å®ç°phpmyadminä¸Šä¼ å¤§æ–‡ä»¶åŠŸèƒ½å¦‚æœæƒ³è¦phpmyadminä¸Šä¼ å¤§æ–‡ä»¶ï¼Œè¿˜éœ€ä¿®æ”¹php.inié…ç½®æ–‡ä»¶ä¸­çš„max_execution_timeï¼ˆphpé¡µé¢æ‰§è¡Œæœ€å¤§æ—¶é—´ï¼‰ã€ max_input_timeï¼ˆphpé¡µé¢æ¥å—æ•°æ®æœ€å¤§æ—¶é—´ï¼‰ã€memory_limitï¼ˆphpé¡µé¢å ç”¨çš„æœ€å¤§å†…å­˜ï¼‰ä¸‰ä¸ªé…ç½®é€‰é¡¹ï¼Œè¿™æ˜¯å› ä¸º phpmyadminä¸Šä¼ å¤§æ–‡ä»¶æ—¶ï¼Œphpé¡µé¢çš„æ‰§è¡Œæ—¶é—´ã€å†…å­˜å ç”¨ä¹ŸåŠ¿å¿…å˜å¾—æ›´é•¿æ›´å¤§ï¼Œå…¶éœ€è¦phpè¿è¡Œç¯å¢ƒçš„é…åˆï¼Œå…‰ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶æ˜¯ä¸å¤Ÿçš„ã€‚ ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹phpmyadminé…ç½®æ–‡ä»¶åœ¨å®Œæˆphp.iniçš„ç›¸å…³é…ç½®åï¼Œè¿˜éœ€è¦ä¿®æ”¹phpmyadminé…ç½®ã€‚ 1ã€ä¿®æ”¹phpmyadmin configé…ç½®æ–‡ä»¶ä¸­çš„$cfgï¼»&#39;ExecTimeLimit&#39;ï¼½é…ç½®é€‰é¡¹ï¼Œé»˜è®¤å€¼æ˜¯300ï¼Œéœ€è¦ä¿®æ”¹ä¸º0ï¼Œå³æ²¡æœ‰æ—¶é—´é™åˆ¶ã€‚ 2ã€ä¿®æ”¹phpmyadminå®‰è£…æ ¹ç›®å½•ä¸‹çš„importé¡µé¢ä¸­çš„$memory_limit è¯´æ˜ï¼šé¦–é€‰è¯»å–php.inié…ç½®æ–‡ä»¶ä¸­çš„å†…å­˜é…ç½®é€‰é¡¹memory_limitï¼Œå¦‚æœä¸ºç©ºåˆ™é»˜è®¤å†…å­˜å¤§å°é™åˆ¶ä¸º2Mï¼Œå¦‚æœæ²¡æœ‰é™åˆ¶åˆ™å†…å­˜å¤§å°é™åˆ¶ä¸º10Mï¼Œä½ å¯ä»¥ç»“åˆä½ php.inié…ç½®æ–‡ä»¶ä¸­çš„ç›¸å…³ä¿¡æ¯ä¿®æ”¹è¿™æ®µä»£ç ã€‚ è‡³æ­¤ï¼Œç»è¿‡ä¿®æ”¹php.inié…ç½®æ–‡ä»¶ä¸­çš„æ–‡ä»¶ä¸Šä¼ é…ç½®é€‰é¡¹ä»¥åŠphpmyadminé…ç½®æ–‡ä»¶åï¼Œå³å¯è§£å†³phpmyadminä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶é—®é¢˜ï¼Œä»è€Œå®ç°phpmyadminä¸Šä¼ å¤§æ–‡ä»¶åŠŸèƒ½ã€‚","categories":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/tags/mysql/"},{"name":"php","slug":"php","permalink":"https://www.xiemx.com/tags/php/"},{"name":"database","slug":"database","permalink":"https://www.xiemx.com/tags/database/"},{"name":"phpmyadmin","slug":"phpmyadmin","permalink":"https://www.xiemx.com/tags/phpmyadmin/"}],"author":"xiemx"},{"title":"MySQLæ•°æ®åº“mysqlcheckçš„ä½¿ç”¨æ–¹æ³•è¯¦è§£","slug":"mysqlcheck","date":"2015-08-23T17:08:44.000Z","updated":"2019-10-21T09:01:56.752Z","comments":true,"path":"/2015/08/24/mysqlcheck/","link":"","permalink":"https://www.xiemx.com/2015/08/24/mysqlcheck/","excerpt":"","text":"mysqlcheckï¼Œæ˜¯mysqlè‡ªå¸¦çš„å¯ä»¥æ£€æŸ¥å’Œä¿®å¤MyISAMè¡¨ï¼Œå¹¶ä¸”å®ƒè¿˜å¯ä»¥ä¼˜åŒ–å’Œåˆ†æè¡¨ï¼Œmysqlcheckçš„åŠŸèƒ½ç±»ä¼¼myisamchkï¼Œä½†å…¶å·¥ä½œä¸åŒã€‚ä¸»è¦å·®åˆ«æ˜¯å½“mysqldæœåŠ¡å™¨åœ¨è¿è¡Œæ—¶å¿…é¡»ä½¿ç”¨mysqlcheckï¼Œè€Œmyisamchkåº”ç”¨äºæœåŠ¡å™¨æ²¡æœ‰è¿è¡Œæ—¶ã€‚myisamchkä¿®å¤å¤±è´¥æ˜¯ä¸å¯é€†çš„ã€‚ 1234567891.å¦‚æœéœ€è¦æ£€æŸ¥å¹¶ä¿®å¤æ‰€æœ‰çš„æ•°æ®åº“çš„æ•°æ®è¡¨mysqlcheck -A -o -r -pEnter password:database1 OKdatabase2 OK2.å¦‚æœéœ€è¦ä¿®å¤æŒ‡å®šçš„æ•°æ®åº“ç”¨mysqlcheck -A -o -r database1 -pdatabase1 OK","categories":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://www.xiemx.com/tags/mysql/"},{"name":"mysqlcheck","slug":"mysqlcheck","permalink":"https://www.xiemx.com/tags/mysqlcheck/"},{"name":"tool","slug":"tool","permalink":"https://www.xiemx.com/tags/tool/"}],"author":"xiemx"},{"title":"URLRewriterè®¾ç½®Configå’ŒIISé…ç½®åšä¼ªé™æ€","slug":"iis-set-urlrewrite","date":"2015-08-21T02:08:51.000Z","updated":"2019-10-21T08:59:59.559Z","comments":true,"path":"/2015/08/21/iis-set-urlrewrite/","link":"","permalink":"https://www.xiemx.com/2015/08/21/iis-set-urlrewrite/","excerpt":"","text":"ä¸€ã€é¦–å…ˆæ£€æŸ¥configæ–‡ä»¶é‡Œé¢æ˜¯å¦åŒ…å«è¿™ä¸¤ä¸ªèŠ‚ç‚¹ 1234567891011121314&lt;configSections&gt; &lt;section name=\"RewriterConfig\" requirePermission=\"false\" type=\"URLRewriter.Config.RewriterConfigSerializerSectionHandler, URLRewriter\"/&gt;&lt;/configSections&gt;&lt;system.web&gt; &lt;httpModules&gt; &lt;add type=\"URLRewriter.ModuleRewriter, URLRewriter\" name=\"ModuleRewriter\"/&gt; &lt;/httpModules&gt;&lt;/system.web&gt; äºŒã€é…ç½®IISã€‚ 1.æ‰“å¼€IISï¼Œé€‰æ‹©ç½‘ç«™ã€‚å³é”®ï¼Œç‚¹å‡»å±æ€§ 2.é€‰æ‹©ä¸»ç›®å½•ï¼Œç‚¹å‡»é…ç½®æŒ‰é’® 3.åœ¨å¼¹å‡ºçš„åº”ç”¨ç¨‹åºé…ç½®ä¸­ï¼Œç‚¹å‡»æ·»åŠ  4.åœ¨å¼¹å‡ºçš„æ·»åŠ /ç¼–è¾‘åº”ç”¨ç¨‹åºæ‰©å±•åæ˜ å°„ä¸­ï¼Œå¡«å†™å¯æ‰§è¡Œæ–‡ä»¶ â€‹ ç‚¹å‡»æµè§ˆï¼Œé€‰æ‹©aspnet_isapi.dllè¿™ä¸ªDLLï¼Œå®ƒä¸€èˆ¬åœ¨ï¼šC:\\WINDOWS\\Microsoft.NET\\Framework\\v2.0.50727æ–‡ä»¶å¤¹ä¸­(ä¹Ÿå°±æ˜¯ä½ çš„ç³»ç»Ÿç›˜ä¸­ï¼‰ 5.åœ¨æ‰©å±•åä¸­å¡«å†™.html 6.åœ¨åŠ¨ä½œé‡Œé€‰æ‹©é™åˆ¶ä¸ºï¼Œä»–çš„æ¡†å°±å¯ä»¥å¡«å†™äº†ï¼è¯·å¡«å†™ï¼šGET,POST 7.ä¸è¦å‹¾é€‰æŠŠç¡®è®¤æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œç„¶åç‚¹å‡»ç¡®å®š","categories":[{"name":"iis","slug":"iis","permalink":"https://www.xiemx.com/categories/iis/"},{"name":"windows","slug":"iis/windows","permalink":"https://www.xiemx.com/categories/iis/windows/"}],"tags":[{"name":"iis","slug":"iis","permalink":"https://www.xiemx.com/tags/iis/"},{"name":"windows","slug":"windows","permalink":"https://www.xiemx.com/tags/windows/"}],"author":"xiemx"},{"title":"MSSQLæ•°æ®åº“ é˜»æ­¢ä¿å­˜è¦æ±‚é‡æ–°åˆ›å»ºè¡¨çš„æ›´æ”¹","slug":"mssql-deny-save","date":"2015-08-21T02:08:42.000Z","updated":"2019-10-21T09:00:21.279Z","comments":true,"path":"/2015/08/21/mssql-deny-save/","link":"","permalink":"https://www.xiemx.com/2015/08/21/mssql-deny-save/","excerpt":"","text":"MSSQL2008ä»¥ä¸Š å·¥å…·èœå•â€”-é€‰é¡¹â€”-Designers(è®¾è®¡å™¨)â€”-é˜»æ­¢ä¿å­˜è¦æ±‚é‡æ–°åˆ›å»ºè¡¨çš„æ›´æ”¹ å–æ¶ˆå‹¾é€‰å³å¯ MSSql2005ä¸‹ æ·»åŠ excuteæƒé™","categories":[{"name":"mssql","slug":"mssql","permalink":"https://www.xiemx.com/categories/mssql/"}],"tags":[{"name":"debug","slug":"debug","permalink":"https://www.xiemx.com/tags/debug/"},{"name":"database","slug":"database","permalink":"https://www.xiemx.com/tags/database/"},{"name":"mssql","slug":"mssql","permalink":"https://www.xiemx.com/tags/mssql/"}],"author":"xiemx"},{"title":"å¸¸è§MIMEç±»å‹è®¾ç½®æ–¹æ³•","slug":"mime-type","date":"2015-08-20T17:08:58.000Z","updated":"2019-10-21T09:00:13.031Z","comments":true,"path":"/2015/08/21/mime-type/","link":"","permalink":"https://www.xiemx.com/2015/08/21/mime-type/","excerpt":"","text":"å¸¸è§MIMEç±»å‹å’Œè®¾ç½®æ–¹æ³•å½“å‰åˆ—ä¸¾äº†å¸¸ç”¨çš„MIMEç±»å‹ï¼ŒæŸ¥è¯¢è¯¦ç»†ï¼šMIME Type MIMEç±»å‹ æ‰©å±•å æ–‡æ¡£ç±»å‹ MIME ç±»å‹ .aac AAC audio audio/aac .abw AbiWord document application/x-abiword .arc Archive document (multiple files embedded) application/x-freearc .avi AVI: Audio Video Interleave video/x-msvideo .azw Amazon Kindle eBook format application/vnd.amazon.ebook .bin Any kind of binary data application/octet-stream .bmp Windows OS/2 Bitmap Graphics image/bmp .bz BZip archive application/x-bzip .bz2 BZip2 archive application/x-bzip2 .csh C-Shell script application/x-csh .css Cascading Style Sheets (CSS) text/css .csv Comma-separated values (CSV) text/csv .doc Microsoft Word application/msword .epub Electronic publication (EPUB) application/epub+zip .gif Graphics Interchange Format (GIF) image/gif .html HyperText Markup Language (HTML) text/html .ico Icon format image/vnd.microsoft.icon .ics iCalendar format text/calendar .jar Java Archive (JAR) application/java-archive .jpeg JPEG images image/jpeg .js JavaScript text/javascript .json JSON format application/json .mjs JavaScript module text/javascript .mp3 MP3 audio audio/mpeg .mpeg MPEG Video video/mpeg .oga OGG audio audio/ogg .ogv OGG video video/ogg .ogx OGG application/ogg .otf OpenType font font/otf .png Portable Network Graphics image/png .pdf Adobe Portable Document Format (PDF) application/pdf .rar RAR archive application/x-rar-compressed .rtf Rich Text Format (RTF) application/rtf .sh Bourne shell script application/x-sh .svg Scalable Vector Graphics (SVG) image/svg+xml .tar Tape Archive (TAR) application/x-tar .tiff Tagged Image File Format (TIFF) image/tiff .ttf TrueType Font font/ttf .txt Text, (generally ASCII or ISO 8859-n) text/plain .vsd Microsoft Visio application/vnd.visio .wav Waveform Audio Format audio/wav .woff Web Open Font Format (WOFF) font/woff .woff2 Web Open Font Format (WOFF) font/woff2 .xhtml XHTML application/xhtml+xml .xls Microsoft Excel application/vnd.ms-excel .xml XML application/xml .zip ZIP archive application/zip .3gp 3GPP audio/video container video/3gpp .3g2 3GPP2 audio/video container video/3gpp2 .7z 7-zip archive application/x-7z-compressed è®¾ç½®æ–¹æ³•12345# IISé»˜è®¤ç½‘ç«™å±æ€§--&gt;http å¤´--&gt;MIMEæ˜ å°„--&gt;æ–‡ä»¶ç±»å‹--&gt;æ–°ç±»å‹# nginxconf/mime.types","categories":[{"name":"http","slug":"http","permalink":"https://www.xiemx.com/categories/http/"},{"name":"mime-type","slug":"http/mime-type","permalink":"https://www.xiemx.com/categories/http/mime-type/"}],"tags":[{"name":"http","slug":"http","permalink":"https://www.xiemx.com/tags/http/"},{"name":"mime-type","slug":"mime-type","permalink":"https://www.xiemx.com/tags/mime-type/"}],"author":"xiemx"}]}